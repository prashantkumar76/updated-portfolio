import{r as h,u as re,a as qf,b as Lh,_ as me,V as Te,c as k,P as qn,M as Me,Q as st,d as ze,e as el,f as Xf,g as je,h as Kf,i as Qe,I as Oh,D as Vn,R as Wt,F as Tt,j as Wn,N as Mt,B as ki,k as Nt,l as Ai,S as Oi,C as Ve,m as kt,n as Kr,U as Xr,v as ha,o as Fn,p as Zf,q as Jt,T as ar,E as Zr,s as _l,O as di,t as fa,w as fr,x as Jr,L as Jo,y as Wi,z as Ki,A as ut,G as yi,H as Zn,J as Nh,K as so,W as La,X as Aa,Y as Rt,Z as Oa,$ as Zt,a0 as fi,a1 as Jf,a2 as Vt,a3 as Bt,a4 as Cl,a5 as $f,a6 as eA,a7 as Gh,a8 as Ks,a9 as Dn,aa as Un,ab as an,ac as vn,ad as da,ae as Hh,af as ni,ag as wl,ah as mu,ai as En,aj as Gr,ak as zt,al as tA,am as iA,an as nA,ao as rA,ap as sA,aq as oA,ar as aA,as as cA,at as lA,au as Vh,av as Hr,aw as Ln,ax as uA,ay as hA,az as Wh,aA as Na,aB as Il,aC as tl,aD as Vr,aE as fA,aF as il,aG as Li,aH as xn,aI as AA,aJ as dA,aK as Yh,aL as mA,aM as Ei,aN as pA,aO as gA,aP as jh,aQ as qh,aR as Wr,aS as sa,aT as Xn,aU as yA,aV as ma,aW as Gt,aX as vA,aY as pa,aZ as EA,a_ as xA,a$ as Xh,b0 as ji,b1 as Ar,b2 as Kh,b3 as _A,b4 as Zh,b5 as oa,b6 as lr,b7 as bl,b8 as ga,b9 as Jh,ba as CA,bb as wA,bc as IA,bd as Kn,be as $h,bf as Bl,bg as aa,bh as e1,bi as bA,bj as t1,bk as Sl,bl as i1,bm as Ml,bn as n1,bo as ca,bp as BA,bq as Zs,br as $o,bs as nl,bt as r1,bu as s1,bv as SA,bw as o1,bx as MA,by as a1,bz as c1,bA as Qi,bB as TA,bC as DA,bD as la,bE as RA,bF as rl,bG as PA,bH as pu,bI as QA,bJ as l1,bK as zA,bL as FA,bM as UA,bN as kA,bO as Ga,bP as LA,bQ as Ha,bR as OA,bS as NA,bT as GA,bU as qs,bV as ya,bW as Tl,bX as HA,bY as VA}from"./index-B9Y4ZT61.js";import{bZ as Dv,b_ as Rv,c0 as Pv,c1 as Qv,c3 as zv,b$ as Fv,c2 as Uv}from"./index-B9Y4ZT61.js";import{e as Yn,m as oo}from"./easing-0f4db1c0.esm-CK_ArS-y.js";import{u as ao,U as u1}from"./Fbx-pr99swrG.js";import{F as Lv,a as Ov}from"./Fbx-pr99swrG.js";import{u as va,I as gu}from"./Texture-DzcirA1V.js";import{T as Gv}from"./Texture-DzcirA1V.js";import{F as Vv}from"./Float-Cgqmle0h.js";function k5({onChanged:s,portal:e,preventDefault:n=!0,scroll:r=!0,keyCode:t=9}){const i=h.useRef(0),o=re(l=>l.setEvents),a=re(l=>l.get),c=re(l=>l.gl);return h.useEffect(()=>{var l;let u=[],f;const A=a().events.filter,d=(l=e==null?void 0:e.current)!==null&&l!==void 0?l:c.domElement.parentNode,x=()=>d&&s&&s(u,Math.round(i.current)%u.length);o({filter:(m,_)=>{let E=[...m];(E.length!==u.length||!u.every(C=>E.map(w=>w.object.uuid).includes(C.object.uuid)))&&(i.current=0,u=E,x()),A&&(E=A(E,_));for(let C=0;C<Math.round(i.current)%E.length;C++){const w=E.shift();E=[...E,w]}return E}});const p=m=>{var _,E;i.current=m(i.current),(_=a().events.handlers)==null||_.onPointerCancel(void 0),(E=a().events.handlers)==null||E.onPointerMove(f),x()},v=m=>{(m.keyCode||m.which)===t&&(n&&m.preventDefault(),u.length>1&&p(_=>_+1))},y=m=>{n&&m.preventDefault();let _=0;m||(m=window.event),m.wheelDelta?_=m.wheelDelta/120:m.detail&&(_=-m.detail/3),u.length>1&&p(E=>Math.abs(E-_))},g=m=>f=m;return document.addEventListener("pointermove",g,{passive:!0}),r&&document.addEventListener("wheel",y),t!==void 0&&document.addEventListener("keydown",v),()=>{o({filter:A}),t!==void 0&&document.removeEventListener("keydown",v),r&&document.removeEventListener("wheel",y),document.removeEventListener("pointermove",g)}},[c,a,o,n,r,t]),null}function L5(s,e="pointer",n="auto",r=document.body){h.useEffect(()=>{if(s)return r.style.cursor=e,()=>void(r.style.cursor=n)},[s])}const WA=s=>`Loading ${s.toFixed(2)}%`;function O5({containerStyles:s,innerStyles:e,barStyles:n,dataStyles:r,dataInterpolation:t=WA,initialState:i=o=>o}){const{active:o,progress:a}=qf(),c=h.useRef(0),l=h.useRef(0),u=h.useRef(null),[f,A]=h.useState(i(o));h.useEffect(()=>{let x;return o!==f&&(x=setTimeout(()=>A(o),300)),()=>clearTimeout(x)},[f,o]);const d=h.useCallback(()=>{u.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),u.current.innerText=t(c.current),c.current<a&&(l.current=requestAnimationFrame(d)))},[t,a]);return h.useEffect(()=>(d(),()=>cancelAnimationFrame(l.current)),[d]),f?h.createElement("div",{style:{...co.container,opacity:o?1:0,...s}},h.createElement("div",null,h.createElement("div",{style:{...co.inner,...e}},h.createElement("div",{style:{...co.bar,transform:`scaleX(${a/100})`,...n}}),h.createElement("span",{ref:u,style:{...co.data,...r}})))):null}const co={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},Va=new k,yu=new Te,Jn=new k,lo=new k,cs=new k,vu=new qn,N5=h.forwardRef(({autoTransform:s=!0,matrix:e,axisLock:n,dragLimits:r,onHover:t,onDragStart:i,onDrag:o,onDragEnd:a,children:c,dragConfig:l,...u},f)=>{const A=re(m=>m.controls),{camera:d,size:x,raycaster:p,invalidate:v}=re(),y=h.useRef(null),g=Lh({onHover:({hovering:m})=>t&&t(m??!1),onDragStart:({event:m})=>{A&&(A.enabled=!1);const{point:_}=m;y.current.matrix.decompose(Va,new st,new k),Jn.copy(_),lo.copy(Jn).sub(Va),i&&i(Va),v()},onDrag:({xy:[m,_],intentional:E})=>{if(!E)return;const C=(m-x.left)/x.width*2-1,w=-((_-x.top)/x.height)*2+1;if(yu.set(C,w),p.setFromCamera(yu,d),!n)d.getWorldDirection(cs).negate();else switch(n){case"x":cs.set(1,0,0);break;case"y":cs.set(0,1,0);break;case"z":cs.set(0,0,1);break}vu.setFromNormalAndCoplanarPoint(cs,Jn),p.ray.intersectPlane(vu,Jn);const I=y.current.matrix.clone(),B=y.current.matrixWorld.clone(),S=new k(Jn.x-lo.x,Jn.y-lo.y,Jn.z-lo.z);if(r&&(S.x=r[0]?Math.max(Math.min(S.x,r[0][1]),r[0][0]):S.x,S.y=r[1]?Math.max(Math.min(S.y,r[1][1]),r[1][0]):S.y,S.z=r[2]?Math.max(Math.min(S.z,r[2][1]),r[2][0]):S.z),s){y.current.matrix.setPosition(S);const U=y.current.matrix.clone().multiply(I.invert()),b=y.current.matrix.clone().multiply(B.invert());o&&o(y.current.matrix,U,y.current.matrixWorld,b)}else{const U=new Me().copy(y.current.matrix);U.setPosition(S);const b=U.clone().multiply(I.invert()),M=U.clone().multiply(B.invert());o&&o(U,b,y.current.matrixWorld,M)}v()},onDragEnd:()=>{A&&(A.enabled=!0),a&&a(),v()}},{drag:{filterTaps:!0,threshold:1,...typeof l=="object"?l:{}}});return h.useImperativeHandle(f,()=>y.current,[]),h.useLayoutEffect(()=>{e&&(y.current.matrix=e)},[e]),h.createElement("group",me({ref:y},g(),{matrix:e,matrixAutoUpdate:!1},u),c)}),Dl=h.createContext(null);function h1(){return h.useContext(Dl)}function G5({eps:s=1e-5,enabled:e=!0,infinite:n,horizontal:r,pages:t=1,distance:i=1,damping:o=.25,maxSpeed:a=1/0,prepend:c=!1,style:l={},children:u}){const{get:f,setEvents:A,gl:d,size:x,invalidate:p,events:v}=re(),[y]=h.useState(()=>document.createElement("div")),[g]=h.useState(()=>document.createElement("div")),[m]=h.useState(()=>document.createElement("div")),_=d.domElement.parentNode,E=h.useRef(0),C=h.useMemo(()=>({el:y,eps:s,fill:g,fixed:m,horizontal:r,damping:o,offset:0,delta:0,scroll:E,pages:t,range(B,S,U=0){const b=B-U,M=b+S+U*2;return this.offset<b?0:this.offset>M?1:(this.offset-b)/(M-b)},curve(B,S,U=0){return Math.sin(this.range(B,S,U)*Math.PI)},visible(B,S,U=0){const b=B-U,M=b+S+U*2;return this.offset>=b&&this.offset<=M}}),[s,o,r,t]);h.useEffect(()=>{y.style.position="absolute",y.style.width="100%",y.style.height="100%",y.style[r?"overflowX":"overflowY"]="auto",y.style[r?"overflowY":"overflowX"]="hidden",y.style.top="0px",y.style.left="0px";for(const S in l)y.style[S]=l[S];m.style.position="sticky",m.style.top="0px",m.style.left="0px",m.style.width="100%",m.style.height="100%",m.style.overflow="hidden",y.appendChild(m),g.style.height=r?"100%":`${t*i*100}%`,g.style.width=r?`${t*i*100}%`:"100%",g.style.pointerEvents="none",y.appendChild(g),c?_.prepend(y):_.appendChild(y),y[r?"scrollLeft":"scrollTop"]=1;const I=v.connected||d.domElement;requestAnimationFrame(()=>v.connect==null?void 0:v.connect(y));const B=f().events.compute;return A({compute(S,U){const{left:b,top:M}=_.getBoundingClientRect(),D=S.clientX-b,N=S.clientY-M;U.pointer.set(D/U.size.width*2-1,-(N/U.size.height)*2+1),U.raycaster.setFromCamera(U.pointer,U.camera)}}),()=>{_.removeChild(y),A({compute:B}),v.connect==null||v.connect(I)}},[t,i,r,y,g,m,_]),h.useEffect(()=>{if(v.connected===y){const I=x[r?"width":"height"],B=y[r?"scrollWidth":"scrollHeight"],S=B-I;let U=0,b=!0,M=!0;const D=()=>{if(!(!e||M)&&(p(),U=y[r?"scrollLeft":"scrollTop"],E.current=U/S,n)){if(!b){if(U>=S){const G=1-C.offset;y[r?"scrollLeft":"scrollTop"]=1,E.current=C.offset=-G,b=!0}else if(U<=0){const G=1+C.offset;y[r?"scrollLeft":"scrollTop"]=B,E.current=C.offset=G,b=!0}}b&&setTimeout(()=>b=!1,40)}};y.addEventListener("scroll",D,{passive:!0}),requestAnimationFrame(()=>M=!1);const N=G=>y.scrollLeft+=G.deltaY/2;return r&&y.addEventListener("wheel",N,{passive:!0}),()=>{y.removeEventListener("scroll",D),r&&y.removeEventListener("wheel",N)}}},[y,v,x,n,C,p,r,e]);let w=0;return ze((I,B)=>{w=C.offset,Yn.damp(C,"offset",E.current,o,B,a,void 0,s),Yn.damp(C,"delta",Math.abs(w-C.offset),o,B,a,void 0,s),C.delta>s&&p()}),h.createElement(Dl.Provider,{value:C},u)}const YA=h.forwardRef(({children:s},e)=>{const n=h.useRef(null);h.useImperativeHandle(e,()=>n.current,[]);const r=h1(),{width:t,height:i}=re(o=>o.viewport);return ze(()=>{n.current.position.x=r.horizontal?-t*(r.pages-1)*r.offset:0,n.current.position.y=r.horizontal?0:i*(r.pages-1)*r.offset}),h.createElement("group",{ref:n},s)}),jA=h.forwardRef(({children:s,style:e,...n},r)=>{const t=h1(),i=h.useRef(null);h.useImperativeHandle(r,()=>i.current,[]);const{width:o,height:a}=re(u=>u.size),c=h.useContext(el),l=h.useMemo(()=>Xf.createRoot(t.fixed),[t.fixed]);return ze(()=>{t.delta>t.eps&&(i.current.style.transform=`translate3d(${t.horizontal?-o*(t.pages-1)*t.offset:0}px,${t.horizontal?0:a*(t.pages-1)*-t.offset}px,0)`)}),l.render(h.createElement("div",me({ref:i,style:{...e,position:"absolute",top:0,left:0,willChange:"transform"}},n),h.createElement(Dl.Provider,{value:t},h.createElement(el.Provider,{value:c},s)))),null}),H5=h.forwardRef(({html:s,...e},n)=>{const r=s?jA:YA;return h.createElement(r,me({ref:n},e))});function V5({enabled:s=!0,snap:e,global:n,domElement:r,cursor:t=!0,children:i,speed:o=1,rotation:a=[0,0,0],zoom:c=1,polar:l=[0,Math.PI/2],azimuth:u=[-1/0,1/0],damping:f=.25}){const A=re(C=>C.events),d=re(C=>C.gl),x=r||A.connected||d.domElement,{size:p}=re(),v=h.useMemo(()=>[a[0]+l[0],a[0]+l[1]],[a[0],l[0],l[1]]),y=h.useMemo(()=>[a[1]+u[0],a[1]+u[1]],[a[1],u[0],u[1]]),g=h.useMemo(()=>[je.clamp(a[0],...v),je.clamp(a[1],...y),a[2]],[a[0],a[1],a[2],v,y]);h.useEffect(()=>{if(n&&t&&s)return x.style.cursor="grab",d.domElement.style.cursor="",()=>{x.style.cursor="default",d.domElement.style.cursor="default"}},[n,t,x,s]);const[m]=h.useState({scale:1,rotation:g,damping:f}),_=h.useRef(null);ze((C,w)=>{Yn.damp3(_.current.scale,m.scale,m.damping,w),Yn.dampE(_.current.rotation,m.rotation,m.damping,w)});const E=Lh({onHover:({last:C})=>{t&&!n&&s&&(x.style.cursor=C?"auto":"grab")},onDrag:({down:C,delta:[w,I],memo:[B,S]=m.rotation||g})=>s?(t&&(x.style.cursor=C?"grabbing":"grab"),w=je.clamp(S+w/p.width*Math.PI*o,...y),I=je.clamp(B+I/p.height*Math.PI*o,...v),m.scale=C&&I>v[1]/2?c:1,m.rotation=e&&!C?g:[I,w,0],m.damping=e&&!C&&typeof e!="boolean"?e:f,[I,w]):[I,w]},{target:n?x:void 0});return h.createElement("group",me({ref:_},E==null?void 0:E()),i)}const qA=s=>(e,n,r)=>{const t=r.subscribe;return r.subscribe=(o,a,c)=>{let l=o;if(a){const u=(c==null?void 0:c.equalityFn)||Object.is;let f=o(r.getState());l=A=>{const d=o(A);if(!u(f,d)){const x=f;a(f=d,x)}},c!=null&&c.fireImmediately&&a(f,f)}return t(l)},s(e,n,r)},XA=qA,f1=h.createContext(null);function W5({map:s,children:e,onChange:n,domElement:r}){const t=s.map(c=>c.name+c.keys).join("-"),i=h.useMemo(()=>Kf(XA(()=>s.reduce((c,l)=>({...c,[l.name]:!1}),{}))),[t]),o=h.useMemo(()=>[i.subscribe,i.getState,i],[t]),a=i.setState;return h.useEffect(()=>{const l=s.map(({name:d,keys:x,up:p})=>({keys:x,up:p,fn:v=>{a({[d]:v}),n&&n(d,v,o[1]())}})).reduce((d,{keys:x,fn:p,up:v=!0})=>(x.forEach(y=>d[y]={fn:p,pressed:!1,up:v}),d),{}),u=({key:d,code:x})=>{const p=l[d]||l[x];if(!p)return;const{fn:v,pressed:y,up:g}=p;p.pressed=!0,(g||!y)&&v(!0)},f=({key:d,code:x})=>{const p=l[d]||l[x];if(!p)return;const{fn:v,up:y}=p;p.pressed=!1,y&&v(!1)},A=r||window;return A.addEventListener("keydown",u,{passive:!0}),A.addEventListener("keyup",f,{passive:!0}),()=>{A.removeEventListener("keydown",u),A.removeEventListener("keyup",f)}},[r,t]),h.createElement(f1.Provider,{value:o,children:e})}function Y5(s){const[e,n,r]=h.useContext(f1);return s?r(s):[e,n]}var KA=Object.defineProperty,ZA=(s,e,n)=>e in s?KA(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,ls=(s,e,n)=>(ZA(s,typeof e!="symbol"?e+"":e,n),n);const Or=4,jr=1024,gn=4,JA=(s=1)=>{const e=new Float32Array(jr*gn*s*Or),n=new Vn(e,jr,gn*s,Wt,Tt);return n.wrapS=Wn,n.wrapT=Wn,n.magFilter=Mt,n.needsUpdate=!0,n},$A=(s,e,n=0)=>{const r=Math.floor(jr*(gn/4));e.arcLengthDivisions=r/2,e.updateArcLengths();const t=e.getSpacedPoints(r),i=e.computeFrenetFrames(r,!0);for(let o=0;o<r;o++){const a=Math.floor(o/jr),c=o%jr;let l=t[o];uo(s,c,l.x,l.y,l.z,0+a+gn*n),l=i.tangents[o],uo(s,c,l.x,l.y,l.z,1+a+gn*n),l=i.normals[o],uo(s,c,l.x,l.y,l.z,2+a+gn*n),l=i.binormals[o],uo(s,c,l.x,l.y,l.z,3+a+gn*n)}s.needsUpdate=!0},uo=(s,e,n,r,t,i)=>{const o=s.image,{data:a}=o,c=Or*jr*i;a[e*Or+c+0]=n,a[e*Or+c+1]=r,a[e*Or+c+2]=t,a[e*Or+c+3]=1},ed=s=>({spineTexture:{value:s},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});function td(s,e,n=1){s.__ok||(s.__ok=!0,s.onBeforeCompile=r=>{if(r.__modified)return;r.__modified=!0,Object.assign(r.uniforms,e);const t=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${gn*n}.;
		float textureStacks = ${gn/4}.;

		${r.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * ${gn}.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);r.vertexShader=t})}class id{constructor(e,n=1){ls(this,"curveArray"),ls(this,"curveLengthArray"),ls(this,"object3D"),ls(this,"splineTexure"),ls(this,"uniforms");const r=e.clone(),t=JA(n),i=ed(t);r.traverse(o=>{(o instanceof Qe||o instanceof Oh)&&(o.material=o.material.clone(),td(o.material,i,n))}),this.curveArray=new Array(n),this.curveLengthArray=new Array(n),this.object3D=r,this.splineTexure=t,this.uniforms=i}updateCurve(e,n){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const r=n.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=n,$A(this.splineTexure,n,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}let nd=class extends Qe{constructor(e,n,r=!1,t=!1,i=1e4){const o=new ki;super(o,n),this.isMarchingCubes=!0;const a=this,c=new Float32Array(12*3),l=new Float32Array(12*3),u=new Float32Array(12*3);this.enableUvs=r,this.enableColors=t,this.init=function(g){this.resolution=g,this.isolation=80,this.size=g,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const m=i*3;this.positionArray=new Float32Array(m*3);const _=new Nt(this.positionArray,3);_.setUsage(Ai),o.setAttribute("position",_),this.normalArray=new Float32Array(m*3);const E=new Nt(this.normalArray,3);if(E.setUsage(Ai),o.setAttribute("normal",E),this.enableUvs){this.uvArray=new Float32Array(m*2);const C=new Nt(this.uvArray,2);C.setUsage(Ai),o.setAttribute("uv",C)}if(this.enableColors){this.colorArray=new Float32Array(m*3);const C=new Nt(this.colorArray,3);C.setUsage(Ai),o.setAttribute("color",C)}o.boundingSphere=new Oi(new k,1)};function f(g,m,_){return g+(m-g)*_}function A(g,m,_,E,C,w,I,B,S,U){const b=(_-I)/(B-I),M=a.normal_cache;c[m+0]=E+b*a.delta,c[m+1]=C,c[m+2]=w,l[m+0]=f(M[g+0],M[g+3],b),l[m+1]=f(M[g+1],M[g+4],b),l[m+2]=f(M[g+2],M[g+5],b),u[m+0]=f(a.palette[S*3+0],a.palette[U*3+0],b),u[m+1]=f(a.palette[S*3+1],a.palette[U*3+1],b),u[m+2]=f(a.palette[S*3+2],a.palette[U*3+2],b)}function d(g,m,_,E,C,w,I,B,S,U){const b=(_-I)/(B-I),M=a.normal_cache;c[m+0]=E,c[m+1]=C+b*a.delta,c[m+2]=w;const D=g+a.yd*3;l[m+0]=f(M[g+0],M[D+0],b),l[m+1]=f(M[g+1],M[D+1],b),l[m+2]=f(M[g+2],M[D+2],b),u[m+0]=f(a.palette[S*3+0],a.palette[U*3+0],b),u[m+1]=f(a.palette[S*3+1],a.palette[U*3+1],b),u[m+2]=f(a.palette[S*3+2],a.palette[U*3+2],b)}function x(g,m,_,E,C,w,I,B,S,U){const b=(_-I)/(B-I),M=a.normal_cache;c[m+0]=E,c[m+1]=C,c[m+2]=w+b*a.delta;const D=g+a.zd*3;l[m+0]=f(M[g+0],M[D+0],b),l[m+1]=f(M[g+1],M[D+1],b),l[m+2]=f(M[g+2],M[D+2],b),u[m+0]=f(a.palette[S*3+0],a.palette[U*3+0],b),u[m+1]=f(a.palette[S*3+1],a.palette[U*3+1],b),u[m+2]=f(a.palette[S*3+2],a.palette[U*3+2],b)}function p(g){const m=g*3;a.normal_cache[m]===0&&(a.normal_cache[m+0]=a.field[g-1]-a.field[g+1],a.normal_cache[m+1]=a.field[g-a.yd]-a.field[g+a.yd],a.normal_cache[m+2]=a.field[g-a.zd]-a.field[g+a.zd])}function v(g,m,_,E,C){const w=E+1,I=E+a.yd,B=E+a.zd,S=w+a.yd,U=w+a.zd,b=E+a.yd+a.zd,M=w+a.yd+a.zd;let D=0;const N=a.field[E],G=a.field[w],q=a.field[I],X=a.field[S],O=a.field[B],H=a.field[U],T=a.field[b],W=a.field[M];N<C&&(D|=1),G<C&&(D|=2),q<C&&(D|=8),X<C&&(D|=4),O<C&&(D|=16),H<C&&(D|=32),T<C&&(D|=128),W<C&&(D|=64);const j=rd[D];if(j===0)return 0;const L=a.delta,z=g+L,F=m+L,R=_+L;j&1&&(p(E),p(w),A(E*3,0,C,g,m,_,N,G,E,w)),j&2&&(p(w),p(S),d(w*3,3,C,z,m,_,G,X,w,S)),j&4&&(p(I),p(S),A(I*3,6,C,g,F,_,q,X,I,S)),j&8&&(p(E),p(I),d(E*3,9,C,g,m,_,N,q,E,I)),j&16&&(p(B),p(U),A(B*3,12,C,g,m,R,O,H,B,U)),j&32&&(p(U),p(M),d(U*3,15,C,z,m,R,H,W,U,M)),j&64&&(p(b),p(M),A(b*3,18,C,g,F,R,T,W,b,M)),j&128&&(p(B),p(b),d(B*3,21,C,g,m,R,O,T,B,b)),j&256&&(p(E),p(B),x(E*3,24,C,g,m,_,N,O,E,B)),j&512&&(p(w),p(U),x(w*3,27,C,z,m,_,G,H,w,U)),j&1024&&(p(S),p(M),x(S*3,30,C,z,F,_,X,W,S,M)),j&2048&&(p(I),p(b),x(I*3,33,C,g,F,_,q,T,I,b)),D<<=4;let Q,J,ie,Z=0,ee=0;for(;ho[D+ee]!=-1;)Q=D+ee,J=Q+1,ie=Q+2,y(c,l,u,3*ho[Q],3*ho[J],3*ho[ie]),ee+=3,Z++;return Z}function y(g,m,_,E,C,w){const I=a.count*3;if(a.positionArray[I+0]=g[E],a.positionArray[I+1]=g[E+1],a.positionArray[I+2]=g[E+2],a.positionArray[I+3]=g[C],a.positionArray[I+4]=g[C+1],a.positionArray[I+5]=g[C+2],a.positionArray[I+6]=g[w],a.positionArray[I+7]=g[w+1],a.positionArray[I+8]=g[w+2],a.material.flatShading===!0){const B=(m[E+0]+m[C+0]+m[w+0])/3,S=(m[E+1]+m[C+1]+m[w+1])/3,U=(m[E+2]+m[C+2]+m[w+2])/3;a.normalArray[I+0]=B,a.normalArray[I+1]=S,a.normalArray[I+2]=U,a.normalArray[I+3]=B,a.normalArray[I+4]=S,a.normalArray[I+5]=U,a.normalArray[I+6]=B,a.normalArray[I+7]=S,a.normalArray[I+8]=U}else a.normalArray[I+0]=m[E+0],a.normalArray[I+1]=m[E+1],a.normalArray[I+2]=m[E+2],a.normalArray[I+3]=m[C+0],a.normalArray[I+4]=m[C+1],a.normalArray[I+5]=m[C+2],a.normalArray[I+6]=m[w+0],a.normalArray[I+7]=m[w+1],a.normalArray[I+8]=m[w+2];if(a.enableUvs){const B=a.count*2;a.uvArray[B+0]=g[E+0],a.uvArray[B+1]=g[E+2],a.uvArray[B+2]=g[C+0],a.uvArray[B+3]=g[C+2],a.uvArray[B+4]=g[w+0],a.uvArray[B+5]=g[w+2]}a.enableColors&&(a.colorArray[I+0]=_[E+0],a.colorArray[I+1]=_[E+1],a.colorArray[I+2]=_[E+2],a.colorArray[I+3]=_[C+0],a.colorArray[I+4]=_[C+1],a.colorArray[I+5]=_[C+2],a.colorArray[I+6]=_[w+0],a.colorArray[I+7]=_[w+1],a.colorArray[I+8]=_[w+2]),a.count+=3}this.addBall=function(g,m,_,E,C,w){const I=Math.sign(E);E=Math.abs(E);const B=w!=null;let S=new Ve(g,m,_);if(B)try{S=w instanceof Ve?w:Array.isArray(w)?new Ve(Math.min(Math.abs(w[0]),1),Math.min(Math.abs(w[1]),1),Math.min(Math.abs(w[2]),1)):new Ve(w)}catch{S=new Ve(g,m,_)}const U=this.size*Math.sqrt(E/C),b=_*this.size,M=m*this.size,D=g*this.size;let N=Math.floor(b-U);N<1&&(N=1);let G=Math.floor(b+U);G>this.size-1&&(G=this.size-1);let q=Math.floor(M-U);q<1&&(q=1);let X=Math.floor(M+U);X>this.size-1&&(X=this.size-1);let O=Math.floor(D-U);O<1&&(O=1);let H=Math.floor(D+U);H>this.size-1&&(H=this.size-1);let T,W,j,L,z,F,R,Q,J,ie,Z;for(j=N;j<G;j++)for(z=this.size2*j,Q=j/this.size-_,J=Q*Q,W=q;W<X;W++)for(L=z+this.size*W,R=W/this.size-m,ie=R*R,T=O;T<H;T++)if(F=T/this.size-g,Z=E/(1e-6+F*F+ie+J)-C,Z>0){this.field[L+T]+=Z*I;const ee=Math.sqrt((T-D)*(T-D)+(W-M)*(W-M)+(j-b)*(j-b))/U,ge=1-ee*ee*ee*(ee*(ee*6-15)+10);this.palette[(L+T)*3+0]+=S.r*ge,this.palette[(L+T)*3+1]+=S.g*ge,this.palette[(L+T)*3+2]+=S.b*ge}},this.addPlaneX=function(g,m){const _=this.size,E=this.yd,C=this.zd,w=this.field;let I,B,S,U,b,M,D,N=_*Math.sqrt(g/m);for(N>_&&(N=_),I=0;I<N;I++)if(M=I/_,U=M*M,b=g/(1e-4+U)-m,b>0)for(B=0;B<_;B++)for(D=I+B*E,S=0;S<_;S++)w[C*S+D]+=b},this.addPlaneY=function(g,m){const _=this.size,E=this.yd,C=this.zd,w=this.field;let I,B,S,U,b,M,D,N,G=_*Math.sqrt(g/m);for(G>_&&(G=_),B=0;B<G;B++)if(M=B/_,U=M*M,b=g/(1e-4+U)-m,b>0)for(D=B*E,I=0;I<_;I++)for(N=D+I,S=0;S<_;S++)w[C*S+N]+=b},this.addPlaneZ=function(g,m){const _=this.size,E=this.yd,C=this.zd,w=this.field;let I,B,S,U,b,M,D,N,G=_*Math.sqrt(g/m);for(G>_&&(G=_),S=0;S<G;S++)if(M=S/_,U=M*M,b=g/(1e-4+U)-m,b>0)for(D=C*S,B=0;B<_;B++)for(N=D+B*E,I=0;I<_;I++)w[N+I]+=b},this.setCell=function(g,m,_,E){const C=this.size2*_+this.size*m+g;this.field[C]=E},this.getCell=function(g,m,_){const E=this.size2*_+this.size*m+g;return this.field[E]},this.blur=function(g=1){const m=this.field,_=m.slice(),E=this.size,C=this.size2;for(let w=0;w<E;w++)for(let I=0;I<E;I++)for(let B=0;B<E;B++){const S=C*B+E*I+w;let U=_[S],b=1;for(let M=-1;M<=1;M+=2){const D=M+w;if(!(D<0||D>=E))for(let N=-1;N<=1;N+=2){const G=N+I;if(!(G<0||G>=E))for(let q=-1;q<=1;q+=2){const X=q+B;if(X<0||X>=E)continue;const O=C*X+E*G+D,H=_[O];b++,U+=g*(H-U)/b}}}m[S]=U}},this.reset=function(){for(let g=0;g<this.size3;g++)this.normal_cache[g*3]=0,this.field[g]=0,this.palette[g*3]=this.palette[g*3+1]=this.palette[g*3+2]=0},this.update=function(){this.count=0;const g=this.size-2;for(let m=1;m<g;m++){const _=this.size2*m,E=(m-this.halfsize)/this.halfsize;for(let C=1;C<g;C++){const w=_+this.size*C,I=(C-this.halfsize)/this.halfsize;for(let B=1;B<g;B++){const S=(B-this.halfsize)/this.halfsize,U=w+B;v(S,I,E,U,this.isolation)}}}this.geometry.setDrawRange(0,this.count),o.getAttribute("position").needsUpdate=!0,o.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(o.getAttribute("uv").needsUpdate=!0),this.enableColors&&(o.getAttribute("color").needsUpdate=!0),this.count/3>i&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}};const rd=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),ho=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var sd=Object.defineProperty,od=(s,e,n)=>e in s?sd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,tn=(s,e,n)=>(od(s,typeof e!="symbol"?e+"":e,n),n);class Wa{constructor(e=Math){tn(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),tn(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),tn(this,"p",[]),tn(this,"perm",[]),tn(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),tn(this,"dot",(n,r,t)=>n[0]*r+n[1]*t),tn(this,"dot3",(n,r,t,i)=>n[0]*r+n[1]*t+n[2]*i),tn(this,"dot4",(n,r,t,i,o)=>n[0]*r+n[1]*t+n[2]*i+n[3]*o),tn(this,"noise",(n,r)=>{let t,i,o;const a=.5*(Math.sqrt(3)-1),c=(n+r)*a,l=Math.floor(n+c),u=Math.floor(r+c),f=(3-Math.sqrt(3))/6,A=(l+u)*f,d=l-A,x=u-A,p=n-d,v=r-x;let y=0,g=1;p>v&&(y=1,g=0);const m=p-y+f,_=v-g+f,E=p-1+2*f,C=v-1+2*f,w=l&255,I=u&255,B=this.perm[w+this.perm[I]]%12,S=this.perm[w+y+this.perm[I+g]]%12,U=this.perm[w+1+this.perm[I+1]]%12;let b=.5-p*p-v*v;b<0?t=0:(b*=b,t=b*b*this.dot(this.grad3[B],p,v));let M=.5-m*m-_*_;M<0?i=0:(M*=M,i=M*M*this.dot(this.grad3[S],m,_));let D=.5-E*E-C*C;return D<0?o=0:(D*=D,o=D*D*this.dot(this.grad3[U],E,C)),70*(t+i+o)}),tn(this,"noise3d",(n,r,t)=>{let i,o,a,c;const u=(n+r+t)*.3333333333333333,f=Math.floor(n+u),A=Math.floor(r+u),d=Math.floor(t+u),x=1/6,p=(f+A+d)*x,v=f-p,y=A-p,g=d-p,m=n-v,_=r-y,E=t-g;let C,w,I,B,S,U;m>=_?_>=E?(C=1,w=0,I=0,B=1,S=1,U=0):m>=E?(C=1,w=0,I=0,B=1,S=0,U=1):(C=0,w=0,I=1,B=1,S=0,U=1):_<E?(C=0,w=0,I=1,B=0,S=1,U=1):m<E?(C=0,w=1,I=0,B=0,S=1,U=1):(C=0,w=1,I=0,B=1,S=1,U=0);const b=m-C+x,M=_-w+x,D=E-I+x,N=m-B+2*x,G=_-S+2*x,q=E-U+2*x,X=m-1+3*x,O=_-1+3*x,H=E-1+3*x,T=f&255,W=A&255,j=d&255,L=this.perm[T+this.perm[W+this.perm[j]]]%12,z=this.perm[T+C+this.perm[W+w+this.perm[j+I]]]%12,F=this.perm[T+B+this.perm[W+S+this.perm[j+U]]]%12,R=this.perm[T+1+this.perm[W+1+this.perm[j+1]]]%12;let Q=.6-m*m-_*_-E*E;Q<0?i=0:(Q*=Q,i=Q*Q*this.dot3(this.grad3[L],m,_,E));let J=.6-b*b-M*M-D*D;J<0?o=0:(J*=J,o=J*J*this.dot3(this.grad3[z],b,M,D));let ie=.6-N*N-G*G-q*q;ie<0?a=0:(ie*=ie,a=ie*ie*this.dot3(this.grad3[F],N,G,q));let Z=.6-X*X-O*O-H*H;return Z<0?c=0:(Z*=Z,c=Z*Z*this.dot3(this.grad3[R],X,O,H)),32*(i+o+a+c)}),tn(this,"noise4d",(n,r,t,i)=>{const o=this.grad4,a=this.simplex,c=this.perm,l=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let f,A,d,x,p;const v=(n+r+t+i)*l,y=Math.floor(n+v),g=Math.floor(r+v),m=Math.floor(t+v),_=Math.floor(i+v),E=(y+g+m+_)*u,C=y-E,w=g-E,I=m-E,B=_-E,S=n-C,U=r-w,b=t-I,M=i-B,D=S>U?32:0,N=S>b?16:0,G=U>b?8:0,q=S>M?4:0,X=U>M?2:0,O=b>M?1:0,H=D+N+G+q+X+O;let T,W,j,L,z,F,R,Q,J,ie,Z,ee;T=a[H][0]>=3?1:0,W=a[H][1]>=3?1:0,j=a[H][2]>=3?1:0,L=a[H][3]>=3?1:0,z=a[H][0]>=2?1:0,F=a[H][1]>=2?1:0,R=a[H][2]>=2?1:0,Q=a[H][3]>=2?1:0,J=a[H][0]>=1?1:0,ie=a[H][1]>=1?1:0,Z=a[H][2]>=1?1:0,ee=a[H][3]>=1?1:0;const ge=S-T+u,pe=U-W+u,te=b-j+u,ae=M-L+u,de=S-z+2*u,se=U-F+2*u,K=b-R+2*u,Y=M-Q+2*u,ne=S-J+3*u,ve=U-ie+3*u,Ee=b-Z+3*u,Ce=M-ee+3*u,xe=S-1+4*u,Oe=U-1+4*u,De=b-1+4*u,Re=M-1+4*u,Pe=y&255,ke=g&255,Ke=m&255,ot=_&255,He=c[Pe+c[ke+c[Ke+c[ot]]]]%32,Le=c[Pe+T+c[ke+W+c[Ke+j+c[ot+L]]]]%32,Fe=c[Pe+z+c[ke+F+c[Ke+R+c[ot+Q]]]]%32,ct=c[Pe+J+c[ke+ie+c[Ke+Z+c[ot+ee]]]]%32,$e=c[Pe+1+c[ke+1+c[Ke+1+c[ot+1]]]]%32;let Ze=.6-S*S-U*U-b*b-M*M;Ze<0?f=0:(Ze*=Ze,f=Ze*Ze*this.dot4(o[He],S,U,b,M));let lt=.6-ge*ge-pe*pe-te*te-ae*ae;lt<0?A=0:(lt*=lt,A=lt*lt*this.dot4(o[Le],ge,pe,te,ae));let ye=.6-de*de-se*se-K*K-Y*Y;ye<0?d=0:(ye*=ye,d=ye*ye*this.dot4(o[Fe],de,se,K,Y));let tt=.6-ne*ne-ve*ve-Ee*Ee-Ce*Ce;tt<0?x=0:(tt*=tt,x=tt*tt*this.dot4(o[ct],ne,ve,Ee,Ce));let hi=.6-xe*xe-Oe*Oe-De*De-Re*Re;return hi<0?p=0:(hi*=hi,p=hi*hi*this.dot4(o[$e],xe,Oe,De,Re)),27*(f+A+d+x+p)});for(let n=0;n<256;n++)this.p[n]=Math.floor(e.random()*256);for(let n=0;n<512;n++)this.perm[n]=this.p[n&255]}}var ad=Object.defineProperty,cd=(s,e,n)=>e in s?ad(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Eu=(s,e,n)=>(cd(s,typeof e!="symbol"?e+"":e,n),n);const ld=(()=>{const s={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new k},up:{value:new k(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${ha>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},e=new kt({name:"SkyShader",fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:Xr.clone(s.uniforms),side:Kr,depthWrite:!1});class n extends Qe{constructor(){super(new Fn(1,1,1),e)}}return Eu(n,"SkyShader",s),Eu(n,"material",e),n})(),ud=s=>s&&s.isCubeTexture;class hd extends Qe{constructor(e,n){var r,t;const i=ud(e),a=((t=i?(r=e.image[0])==null?void 0:r.width:e.image.width)!=null?t:1024)/4,c=Math.floor(Math.log2(a)),l=Math.pow(2,c),u=3*Math.max(l,16*7),f=4*l,A=[i?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/u}`,`#define CUBEUV_TEXEL_HEIGHT ${1/f}`,`#define CUBEUV_MAX_MIP ${c}.0`],d=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,x=A.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${ha>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,p={map:{value:e},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},v=new Zf(1,16),y=new kt({uniforms:p,fragmentShader:x,vertexShader:d,side:Jt});super(v,y)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}const si=new ar,fo=new k;class fd{constructor(e){let n=e.geometry;n.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),n=n.toNonIndexed()),this.geometry=n,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,n=this.weightAttribute,r=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let o=1;n&&(o=n.getX(i)+n.getX(i+1)+n.getX(i+2)),si.a.fromBufferAttribute(e,i),si.b.fromBufferAttribute(e,i+1),si.c.fromBufferAttribute(e,i+2),o*=si.getArea(),r[i/3]=o}this.distribution=new Float32Array(e.count/3);let t=0;for(let i=0;i<r.length;i++)t+=r[i],this.distribution[i]=t;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,n,r){const t=this.sampleFaceIndex();return this.sampleFace(t,e,n,r)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const n=this.distribution;let r=0,t=n.length-1,i=-1;for(;r<=t;){const o=Math.ceil((r+t)/2);if(o===0||n[o-1]<=e&&n[o]>e){i=o;break}else e<n[o]?t=o-1:r=o+1}return i}sampleFace(e,n,r,t){let i=this.randomFunction(),o=this.randomFunction();return i+o>1&&(i=1-i,o=1-o),si.a.fromBufferAttribute(this.positionAttribute,e*3),si.b.fromBufferAttribute(this.positionAttribute,e*3+1),si.c.fromBufferAttribute(this.positionAttribute,e*3+2),n.set(0,0,0).addScaledVector(si.a,i).addScaledVector(si.b,o).addScaledVector(si.c,1-(i+o)),r!==void 0&&si.getNormal(r),t!==void 0&&this.colorAttribute!==void 0&&(si.a.fromBufferAttribute(this.colorAttribute,e*3),si.b.fromBufferAttribute(this.colorAttribute,e*3+1),si.c.fromBufferAttribute(this.colorAttribute,e*3+2),fo.set(0,0,0).addScaledVector(si.a,i).addScaledVector(si.b,o).addScaledVector(si.c,1-(i+o)),t.r=fo.x,t.g=fo.y,t.b=fo.z),this}}var Ad=Object.defineProperty,dd=(s,e,n)=>e in s?Ad(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Xe=(s,e,n)=>(dd(s,typeof e!="symbol"?e+"":e,n),n);const xu=new k;let md=class extends Zr{constructor(e,n){super(),Xe(this,"object"),Xe(this,"domElement"),Xe(this,"enabled",!0),Xe(this,"movementSpeed",1),Xe(this,"lookSpeed",.005),Xe(this,"lookVertical",!0),Xe(this,"autoForward",!1),Xe(this,"activeLook",!0),Xe(this,"heightSpeed",!1),Xe(this,"heightCoef",1),Xe(this,"heightMin",0),Xe(this,"heightMax",1),Xe(this,"constrainVertical",!1),Xe(this,"verticalMin",0),Xe(this,"verticalMax",Math.PI),Xe(this,"mouseDragOn",!1),Xe(this,"autoSpeedFactor",0),Xe(this,"mouseX",0),Xe(this,"mouseY",0),Xe(this,"moveForward",!1),Xe(this,"moveBackward",!1),Xe(this,"moveLeft",!1),Xe(this,"moveRight",!1),Xe(this,"moveUp",!1),Xe(this,"moveDown",!1),Xe(this,"viewHalfX",0),Xe(this,"viewHalfY",0),Xe(this,"lat",0),Xe(this,"lon",0),Xe(this,"lookDirection",new k),Xe(this,"spherical",new _l),Xe(this,"target",new k),Xe(this,"connect",r=>{r.setAttribute("tabindex","-1"),r.style.touchAction="none",r.addEventListener("contextmenu",this.contextmenu),r.addEventListener("mousemove",this.onMouseMove),r.addEventListener("mousedown",this.onMouseDown),r.addEventListener("mouseup",this.onMouseUp),this.domElement=r,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),Xe(this,"dispose",()=>{var r,t,i,o;(r=this.domElement)==null||r.removeEventListener("contextmenu",this.contextmenu),(t=this.domElement)==null||t.removeEventListener("mousedown",this.onMouseDown),(i=this.domElement)==null||i.removeEventListener("mousemove",this.onMouseMove),(o=this.domElement)==null||o.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),Xe(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),Xe(this,"onMouseDown",r=>{var t;if((t=this.domElement)==null||t.focus(),this.activeLook)switch(r.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}),Xe(this,"onMouseUp",r=>{if(this.activeLook)switch(r.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}),Xe(this,"onMouseMove",r=>{this.domElement&&(this.mouseX=r.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=r.pageY-this.domElement.offsetTop-this.viewHalfY)}),Xe(this,"onKeyDown",r=>{switch(r.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}),Xe(this,"onKeyUp",r=>{switch(r.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}),Xe(this,"lookAt",(r,t,i)=>(r instanceof k?this.target.copy(r):t&&i&&this.target.set(r,t,i),this.object.lookAt(this.target),this.setOrientation(),this)),Xe(this,"update",r=>{if(!this.enabled)return;if(this.heightSpeed){const f=je.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=r*(f*this.heightCoef)}else this.autoSpeedFactor=0;const t=r*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let i=r*this.lookSpeed;this.activeLook||(i=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=je.degToRad(90-this.lat);const c=je.degToRad(this.lon);this.constrainVertical&&(a=je.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;xu.setFromSphericalCoords(1,a,c).add(l),this.object.lookAt(xu)}),Xe(this,"contextmenu",r=>r.preventDefault()),Xe(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-je.radToDeg(this.spherical.phi),this.lon=je.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=n,this.setOrientation(),n&&this.connect(n)}};var pd=Object.defineProperty,gd=(s,e,n)=>e in s?pd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Ae=(s,e,n)=>(gd(s,typeof e!="symbol"?e+"":e,n),n);let yd=class extends di{constructor(e,n){super(),Ae(this,"isTransformControls",!0),Ae(this,"visible",!1),Ae(this,"domElement"),Ae(this,"raycaster",new fa),Ae(this,"gizmo"),Ae(this,"plane"),Ae(this,"tempVector",new k),Ae(this,"tempVector2",new k),Ae(this,"tempQuaternion",new st),Ae(this,"unit",{X:new k(1,0,0),Y:new k(0,1,0),Z:new k(0,0,1)}),Ae(this,"pointStart",new k),Ae(this,"pointEnd",new k),Ae(this,"offset",new k),Ae(this,"rotationAxis",new k),Ae(this,"startNorm",new k),Ae(this,"endNorm",new k),Ae(this,"rotationAngle",0),Ae(this,"cameraPosition",new k),Ae(this,"cameraQuaternion",new st),Ae(this,"cameraScale",new k),Ae(this,"parentPosition",new k),Ae(this,"parentQuaternion",new st),Ae(this,"parentQuaternionInv",new st),Ae(this,"parentScale",new k),Ae(this,"worldPositionStart",new k),Ae(this,"worldQuaternionStart",new st),Ae(this,"worldScaleStart",new k),Ae(this,"worldPosition",new k),Ae(this,"worldQuaternion",new st),Ae(this,"worldQuaternionInv",new st),Ae(this,"worldScale",new k),Ae(this,"eye",new k),Ae(this,"positionStart",new k),Ae(this,"quaternionStart",new st),Ae(this,"scaleStart",new k),Ae(this,"camera"),Ae(this,"object"),Ae(this,"enabled",!0),Ae(this,"axis",null),Ae(this,"mode","translate"),Ae(this,"translationSnap",null),Ae(this,"rotationSnap",null),Ae(this,"scaleSnap",null),Ae(this,"space","world"),Ae(this,"size",1),Ae(this,"dragging",!1),Ae(this,"showX",!0),Ae(this,"showY",!0),Ae(this,"showZ",!0),Ae(this,"changeEvent",{type:"change"}),Ae(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),Ae(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),Ae(this,"objectChangeEvent",{type:"objectChange"}),Ae(this,"intersectObjectWithRay",(t,i,o)=>{const a=i.intersectObject(t,!0);for(let c=0;c<a.length;c++)if(a[c].object.visible||o)return a[c];return!1}),Ae(this,"attach",t=>(this.object=t,this.visible=!0,this)),Ae(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),Ae(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),Ae(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),Ae(this,"pointerHover",t=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(t,this.camera);const i=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);i?this.axis=i.object.name:this.axis=null}),Ae(this,"pointerDown",t=>{if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(t,this.camera);const i=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(i){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),Ae(this,"pointerMove",t=>{const i=this.axis,o=this.mode,a=this.object;let c=this.space;if(o==="scale"?c="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(c="world"),a===void 0||i===null||this.dragging===!1||t.button!==-1)return;this.raycaster.setFromCamera(t,this.camera);const l=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(l){if(this.pointEnd.copy(l.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&i!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),i.indexOf("X")===-1&&(this.offset.x=0),i.indexOf("Y")===-1&&(this.offset.y=0),i.indexOf("Z")===-1&&(this.offset.z=0),c==="local"&&i!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(c==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),c==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(o==="scale"){if(i.search("XYZ")!==-1){let u=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(u*=-1),this.tempVector2.set(u,u,u)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),i.search("X")===-1&&(this.tempVector2.x=1),i.search("Y")===-1&&(this.tempVector2.y=1),i.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(i.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const u=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*u):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(this.unit[i]),this.tempVector.copy(this.unit[i]),c==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*u),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),Ae(this,"pointerUp",t=>{t.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),Ae(this,"getPointer",t=>{var i;if(this.domElement&&((i=this.domElement.ownerDocument)!=null&&i.pointerLockElement))return{x:0,y:0,button:t.button};{const o=t.changedTouches?t.changedTouches[0]:t,a=this.domElement.getBoundingClientRect();return{x:(o.clientX-a.left)/a.width*2-1,y:-(o.clientY-a.top)/a.height*2+1,button:t.button}}}),Ae(this,"onPointerHover",t=>{if(this.enabled)switch(t.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(t));break}}),Ae(this,"onPointerDown",t=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(t)),this.pointerDown(this.getPointer(t)))}),Ae(this,"onPointerMove",t=>{this.enabled&&this.pointerMove(this.getPointer(t))}),Ae(this,"onPointerUp",t=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(t)))}),Ae(this,"getMode",()=>this.mode),Ae(this,"setMode",t=>{this.mode=t}),Ae(this,"setTranslationSnap",t=>{this.translationSnap=t}),Ae(this,"setRotationSnap",t=>{this.rotationSnap=t}),Ae(this,"setScaleSnap",t=>{this.scaleSnap=t}),Ae(this,"setSize",t=>{this.size=t}),Ae(this,"setSpace",t=>{this.space=t}),Ae(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),Ae(this,"connect",t=>{t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=t,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),Ae(this,"dispose",()=>{var t,i,o,a,c,l;(t=this.domElement)==null||t.removeEventListener("pointerdown",this.onPointerDown),(i=this.domElement)==null||i.removeEventListener("pointermove",this.onPointerHover),(a=(o=this.domElement)==null?void 0:o.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(l=(c=this.domElement)==null?void 0:c.ownerDocument)==null||l.removeEventListener("pointerup",this.onPointerUp),this.traverse(u=>{const f=u;f.geometry&&f.geometry.dispose(),f.material&&f.material.dispose()})}),this.domElement=n,this.camera=e,this.gizmo=new vd,this.add(this.gizmo),this.plane=new Ed,this.add(this.plane);const r=(t,i)=>{let o=i;Object.defineProperty(this,t,{get:function(){return o!==void 0?o:i},set:function(a){o!==a&&(o=a,this.plane[t]=a,this.gizmo[t]=a,this.dispatchEvent({type:t+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[t]=i,this.plane[t]=i,this.gizmo[t]=i};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),n!==void 0&&this.connect(n)}};class vd extends di{constructor(){super(),Ae(this,"isTransformControlsGizmo",!0),Ae(this,"type","TransformControlsGizmo"),Ae(this,"tempVector",new k(0,0,0)),Ae(this,"tempEuler",new fr),Ae(this,"alignVector",new k(0,1,0)),Ae(this,"zeroVector",new k(0,0,0)),Ae(this,"lookAtMatrix",new Me),Ae(this,"tempQuaternion",new st),Ae(this,"tempQuaternion2",new st),Ae(this,"identityQuaternion",new st),Ae(this,"unitX",new k(1,0,0)),Ae(this,"unitY",new k(0,1,0)),Ae(this,"unitZ",new k(0,0,1)),Ae(this,"gizmo"),Ae(this,"picker"),Ae(this,"helper"),Ae(this,"rotationAxis",new k),Ae(this,"cameraPosition",new k),Ae(this,"worldPositionStart",new k),Ae(this,"worldQuaternionStart",new st),Ae(this,"worldPosition",new k),Ae(this,"worldQuaternion",new st),Ae(this,"eye",new k),Ae(this,"camera",null),Ae(this,"enabled",!0),Ae(this,"axis",null),Ae(this,"mode","translate"),Ae(this,"space","world"),Ae(this,"size",1),Ae(this,"dragging",!1),Ae(this,"showX",!0),Ae(this,"showY",!0),Ae(this,"showZ",!0),Ae(this,"updateMatrixWorld",()=>{let H=this.space;this.mode==="scale"&&(H="local");const T=H==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let W=[];W=W.concat(this.picker[this.mode].children),W=W.concat(this.gizmo[this.mode].children),W=W.concat(this.helper[this.mode].children);for(let j=0;j<W.length;j++){const L=W[j];L.visible=!0,L.rotation.set(0,0,0),L.position.copy(this.worldPosition);let z;if(this.camera.isOrthographicCamera?z=(this.camera.top-this.camera.bottom)/this.camera.zoom:z=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),L.scale.set(1,1,1).multiplyScalar(z*this.size/7),L.tag==="helper"){L.visible=!1,L.name==="AXIS"?(L.position.copy(this.worldPositionStart),L.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),L.quaternion.copy(T).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(T).dot(this.eye))>.9&&(L.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),L.quaternion.copy(T).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(T).dot(this.eye))>.9&&(L.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),L.quaternion.copy(T).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(T).dot(this.eye))>.9&&(L.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),L.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),L.quaternion.multiply(this.tempQuaternion),L.visible=this.dragging),this.axis==="E"&&(L.visible=!1)):L.name==="START"?(L.position.copy(this.worldPositionStart),L.visible=this.dragging):L.name==="END"?(L.position.copy(this.worldPosition),L.visible=this.dragging):L.name==="DELTA"?(L.position.copy(this.worldPositionStart),L.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),L.scale.copy(this.tempVector),L.visible=this.dragging):(L.quaternion.copy(T),this.dragging?L.position.copy(this.worldPositionStart):L.position.copy(this.worldPosition),this.axis&&(L.visible=this.axis.search(L.name)!==-1));continue}L.quaternion.copy(T),this.mode==="translate"||this.mode==="scale"?((L.name==="X"||L.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(T).dot(this.eye))>.99&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),(L.name==="Y"||L.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(T).dot(this.eye))>.99&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),(L.name==="Z"||L.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(T).dot(this.eye))>.99&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),L.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(T).dot(this.eye))<.2&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),L.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(T).dot(this.eye))<.2&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),L.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(T).dot(this.eye))<.2&&(L.scale.set(1e-10,1e-10,1e-10),L.visible=!1),L.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(T).dot(this.eye)<0?L.tag==="fwd"?L.visible=!1:L.scale.x*=-1:L.tag==="bwd"&&(L.visible=!1)),L.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(T).dot(this.eye)<0?L.tag==="fwd"?L.visible=!1:L.scale.y*=-1:L.tag==="bwd"&&(L.visible=!1)),L.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(T).dot(this.eye)<0?L.tag==="fwd"?L.visible=!1:L.scale.z*=-1:L.tag==="bwd"&&(L.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(T),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(T).invert()),L.name.search("E")!==-1&&L.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),L.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),L.quaternion.copy(this.tempQuaternion)),L.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),L.quaternion.copy(this.tempQuaternion)),L.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),L.quaternion.copy(this.tempQuaternion))),L.visible=L.visible&&(L.name.indexOf("X")===-1||this.showX),L.visible=L.visible&&(L.name.indexOf("Y")===-1||this.showY),L.visible=L.visible&&(L.name.indexOf("Z")===-1||this.showZ),L.visible=L.visible&&(L.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),L.material.tempOpacity=L.material.tempOpacity||L.material.opacity,L.material.tempColor=L.material.tempColor||L.material.color.clone(),L.material.color.copy(L.material.tempColor),L.material.opacity=L.material.tempOpacity,this.enabled?this.axis&&(L.name===this.axis?(L.material.opacity=1,L.material.color.lerp(new Ve(1,1,1),.5)):this.axis.split("").some(function(F){return L.name===F})?(L.material.opacity=1,L.material.color.lerp(new Ve(1,1,1),.5)):(L.material.opacity*=.25,L.material.color.lerp(new Ve(1,1,1),.5))):(L.material.opacity*=.5,L.material.color.lerp(new Ve(1,1,1),.5))}super.updateMatrixWorld()});const e=new Jr({depthTest:!1,depthWrite:!1,transparent:!0,side:Jt,fog:!1,toneMapped:!1}),n=new Jo({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;const t=e.clone();t.opacity=.33;const i=e.clone();i.color.set(16711680);const o=e.clone();o.color.set(65280);const a=e.clone();a.color.set(255);const c=e.clone();c.opacity=.25;const l=c.clone();l.color.set(16776960);const u=c.clone();u.color.set(65535);const f=c.clone();f.color.set(16711935),e.clone().color.set(16776960);const d=n.clone();d.color.set(16711680);const x=n.clone();x.color.set(65280);const p=n.clone();p.color.set(255);const v=n.clone();v.color.set(65535);const y=n.clone();y.color.set(16711935);const g=n.clone();g.color.set(16776960);const m=n.clone();m.color.set(7895160);const _=g.clone();_.opacity=.25;const E=new Wi(0,.05,.2,12,1,!1),C=new Fn(.125,.125,.125),w=new ki;w.setAttribute("position",new Ki([0,0,0,1,0,0],3));const I=(H,T)=>{const W=new ki,j=[];for(let L=0;L<=64*T;++L)j.push(0,Math.cos(L/32*Math.PI)*H,Math.sin(L/32*Math.PI)*H);return W.setAttribute("position",new Ki(j,3)),W},B=()=>{const H=new ki;return H.setAttribute("position",new Ki([0,0,0,1,1,1],3)),H},S={X:[[new Qe(E,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Qe(E,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new ut(w,d)]],Y:[[new Qe(E,o),[0,1,0],null,null,"fwd"],[new Qe(E,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new ut(w,x),null,[0,0,Math.PI/2]]],Z:[[new Qe(E,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Qe(E,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new ut(w,p),null,[0,-Math.PI/2,0]]],XYZ:[[new Qe(new Zn(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new Qe(new yi(.295,.295),l.clone()),[.15,.15,0]],[new ut(w,g),[.18,.3,0],null,[.125,1,1]],[new ut(w,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Qe(new yi(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new ut(w,v),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new ut(w,v),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Qe(new yi(.295,.295),f.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new ut(w,y),[.18,0,.3],null,[.125,1,1]],[new ut(w,y),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},U={X:[[new Qe(new Wi(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Qe(new Wi(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new Qe(new Wi(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Qe(new Zn(.2,0),r)]],XY:[[new Qe(new yi(.4,.4),r),[.2,.2,0]]],YZ:[[new Qe(new yi(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Qe(new yi(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},b={START:[[new Qe(new Zn(.01,2),t),null,null,null,"helper"]],END:[[new Qe(new Zn(.01,2),t),null,null,null,"helper"]],DELTA:[[new ut(B(),t),null,null,null,"helper"]],X:[[new ut(w,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ut(w,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ut(w,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={X:[[new ut(I(1,.5),d)],[new Qe(new Zn(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new ut(I(1,.5),x),null,[0,0,-Math.PI/2]],[new Qe(new Zn(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new ut(I(1,.5),p),null,[0,Math.PI/2,0]],[new Qe(new Zn(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new ut(I(1.25,1),_),null,[0,Math.PI/2,0]],[new Qe(new Wi(.03,0,.15,4,1,!1),_),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Qe(new Wi(.03,0,.15,4,1,!1),_),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Qe(new Wi(.03,0,.15,4,1,!1),_),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Qe(new Wi(.03,0,.15,4,1,!1),_),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new ut(I(1,1),m),null,[0,Math.PI/2,0]]]},D={AXIS:[[new ut(w,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},N={X:[[new Qe(new so(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Qe(new so(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Qe(new so(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Qe(new so(1.25,.1,2,24),r)]],XYZE:[[new Qe(new Nh(.7,10,8),r)]]},G={X:[[new Qe(C,i),[.8,0,0],[0,0,-Math.PI/2]],[new ut(w,d),null,null,[.8,1,1]]],Y:[[new Qe(C,o),[0,.8,0]],[new ut(w,x),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Qe(C,a),[0,0,.8],[Math.PI/2,0,0]],[new ut(w,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Qe(C,l),[.85,.85,0],null,[2,2,.2]],[new ut(w,g),[.855,.98,0],null,[.125,1,1]],[new ut(w,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Qe(C,u),[0,.85,.85],null,[.2,2,2]],[new ut(w,v),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new ut(w,v),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Qe(C,f),[.85,0,.85],null,[2,.2,2]],[new ut(w,y),[.855,0,.98],null,[.125,1,1]],[new ut(w,y),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Qe(new Fn(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new Qe(new Fn(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new Qe(new Fn(.125,.125,.125),c.clone()),[0,0,1.1]]]},q={X:[[new Qe(new Wi(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Qe(new Wi(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new Qe(new Wi(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Qe(C,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Qe(C,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Qe(C,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Qe(new Fn(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new Qe(new Fn(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new Qe(new Fn(.2,.2,.2),r),[0,0,1.1]]]},X={X:[[new ut(w,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ut(w,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ut(w,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},O=H=>{const T=new di;for(let W in H)for(let j=H[W].length;j--;){const L=H[W][j][0].clone(),z=H[W][j][1],F=H[W][j][2],R=H[W][j][3],Q=H[W][j][4];L.name=W,L.tag=Q,z&&L.position.set(z[0],z[1],z[2]),F&&L.rotation.set(F[0],F[1],F[2]),R&&L.scale.set(R[0],R[1],R[2]),L.updateMatrix();const J=L.geometry.clone();J.applyMatrix4(L.matrix),L.geometry=J,L.renderOrder=1/0,L.position.set(0,0,0),L.rotation.set(0,0,0),L.scale.set(1,1,1),T.add(L)}return T};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=O(S)),this.add(this.gizmo.rotate=O(M)),this.add(this.gizmo.scale=O(G)),this.add(this.picker.translate=O(U)),this.add(this.picker.rotate=O(N)),this.add(this.picker.scale=O(q)),this.add(this.helper.translate=O(b)),this.add(this.helper.rotate=O(D)),this.add(this.helper.scale=O(X)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class Ed extends Qe{constructor(){super(new yi(1e5,1e5,2,2),new Jr({visible:!1,wireframe:!0,side:Jt,transparent:!0,opacity:.1,toneMapped:!1})),Ae(this,"isTransformControlsPlane",!0),Ae(this,"type","TransformControlsPlane"),Ae(this,"unitX",new k(1,0,0)),Ae(this,"unitY",new k(0,1,0)),Ae(this,"unitZ",new k(0,0,1)),Ae(this,"tempVector",new k),Ae(this,"dirVector",new k),Ae(this,"alignVector",new k),Ae(this,"tempMatrix",new Me),Ae(this,"identityQuaternion",new st),Ae(this,"cameraQuaternion",new st),Ae(this,"worldPosition",new k),Ae(this,"worldQuaternion",new st),Ae(this,"eye",new k),Ae(this,"axis",null),Ae(this,"mode","translate"),Ae(this,"space","world"),Ae(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var xd=Object.defineProperty,_d=(s,e,n)=>e in s?xd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Xt=(s,e,n)=>(_d(s,typeof e!="symbol"?e+"":e,n),n);const pr=new fr(0,0,0,"YXZ"),gr=new k,Cd={type:"change"},wd={type:"lock"},Id={type:"unlock"},_u=Math.PI/2;let bd=class extends Zr{constructor(e,n){super(),Xt(this,"camera"),Xt(this,"domElement"),Xt(this,"isLocked"),Xt(this,"minPolarAngle"),Xt(this,"maxPolarAngle"),Xt(this,"pointerSpeed"),Xt(this,"onMouseMove",r=>{!this.domElement||this.isLocked===!1||(pr.setFromQuaternion(this.camera.quaternion),pr.y-=r.movementX*.002*this.pointerSpeed,pr.x-=r.movementY*.002*this.pointerSpeed,pr.x=Math.max(_u-this.maxPolarAngle,Math.min(_u-this.minPolarAngle,pr.x)),this.camera.quaternion.setFromEuler(pr),this.dispatchEvent(Cd))}),Xt(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(wd),this.isLocked=!0):(this.dispatchEvent(Id),this.isLocked=!1))}),Xt(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Xt(this,"connect",r=>{this.domElement=r||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Xt(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Xt(this,"dispose",()=>{this.disconnect()}),Xt(this,"getObject",()=>this.camera),Xt(this,"direction",new k(0,0,-1)),Xt(this,"getDirection",r=>r.copy(this.direction).applyQuaternion(this.camera.quaternion)),Xt(this,"moveForward",r=>{gr.setFromMatrixColumn(this.camera.matrix,0),gr.crossVectors(this.camera.up,gr),this.camera.position.addScaledVector(gr,r)}),Xt(this,"moveRight",r=>{gr.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(gr,r)}),Xt(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Xt(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=n,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,n&&this.connect(n)}};var Bd=Object.defineProperty,Sd=(s,e,n)=>e in s?Bd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Kt=(s,e,n)=>(Sd(s,typeof e!="symbol"?e+"":e,n),n);let Md=class extends Zr{constructor(e){super(),Kt(this,"object"),Kt(this,"changeEvent",{type:"change"}),Kt(this,"EPS",1e-6),Kt(this,"enabled",!0),Kt(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),Kt(this,"screenOrientation",0),Kt(this,"alphaOffset",0),Kt(this,"onDeviceOrientationChangeEvent",n=>{this.deviceOrientation=n}),Kt(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),Kt(this,"zee",new k(0,0,1)),Kt(this,"euler",new fr),Kt(this,"q0",new st),Kt(this,"q1",new st(-Math.sqrt(.5),0,0,Math.sqrt(.5))),Kt(this,"setObjectQuaternion",(n,r,t,i,o)=>{this.euler.set(t,r,-i,"YXZ"),n.setFromEuler(this.euler),n.multiply(this.q1),n.multiply(this.q0.setFromAxisAngle(this.zee,-o))}),Kt(this,"connect",()=>{this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(n=>{n=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(n=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",n)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),Kt(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),Kt(this,"lastQuaternion",new st),Kt(this,"update",()=>{if(this.enabled===!1)return;const n=this.deviceOrientation;if(n){const r=n.alpha?je.degToRad(n.alpha)+this.alphaOffset:0,t=n.beta?je.degToRad(n.beta):0,i=n.gamma?je.degToRad(n.gamma):0,o=this.screenOrientation?je.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,r,t,i,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),Kt(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}};var Td=Object.defineProperty,Dd=(s,e,n)=>e in s?Td(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Se=(s,e,n)=>(Dd(s,typeof e!="symbol"?e+"":e,n),n);let Rd=class extends Zr{constructor(e,n){super(),Se(this,"enabled",!0),Se(this,"screen",{left:0,top:0,width:0,height:0}),Se(this,"rotateSpeed",1),Se(this,"zoomSpeed",1.2),Se(this,"panSpeed",.3),Se(this,"noRotate",!1),Se(this,"noZoom",!1),Se(this,"noPan",!1),Se(this,"staticMoving",!1),Se(this,"dynamicDampingFactor",.2),Se(this,"minDistance",0),Se(this,"maxDistance",1/0),Se(this,"keys",["KeyA","KeyS","KeyD"]),Se(this,"mouseButtons",{LEFT:La.ROTATE,MIDDLE:La.DOLLY,RIGHT:La.PAN}),Se(this,"object"),Se(this,"domElement"),Se(this,"cursorZoom",!1),Se(this,"target",new k),Se(this,"mousePosition",new Te),Se(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),Se(this,"EPS",1e-6),Se(this,"lastZoom",1),Se(this,"lastPosition",new k),Se(this,"cursorVector",new k),Se(this,"targetVector",new k),Se(this,"_state",this.STATE.NONE),Se(this,"_keyState",this.STATE.NONE),Se(this,"_eye",new k),Se(this,"_movePrev",new Te),Se(this,"_moveCurr",new Te),Se(this,"_lastAxis",new k),Se(this,"_lastAngle",0),Se(this,"_zoomStart",new Te),Se(this,"_zoomEnd",new Te),Se(this,"_touchZoomDistanceStart",0),Se(this,"_touchZoomDistanceEnd",0),Se(this,"_panStart",new Te),Se(this,"_panEnd",new Te),Se(this,"target0"),Se(this,"position0"),Se(this,"up0"),Se(this,"zoom0"),Se(this,"changeEvent",{type:"change"}),Se(this,"startEvent",{type:"start"}),Se(this,"endEvent",{type:"end"}),Se(this,"onScreenVector",new Te),Se(this,"getMouseOnScreen",(r,t)=>(this.onScreenVector.set((r-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),Se(this,"onCircleVector",new Te),Se(this,"getMouseOnCircle",(r,t)=>(this.onCircleVector.set((r-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),Se(this,"axis",new k),Se(this,"quaternion",new st),Se(this,"eyeDirection",new k),Se(this,"objectUpDirection",new k),Se(this,"objectSidewaysDirection",new k),Se(this,"moveDirection",new k),Se(this,"angle",0),Se(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),Se(this,"zoomCamera",()=>{let r;if(this._state===this.STATE.TOUCH_ZOOM_PAN)r=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(r):this.object.isOrthographicCamera?(this.object.zoom/=r,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(r=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(r-1)>this.EPS&&r>0&&(this.object.isPerspectiveCamera?(r>1&&this._eye.length()>=this.maxDistance-this.EPS&&(r=1),this._eye.multiplyScalar(r)):this.object.isOrthographicCamera?(r>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(r=1),this.object.zoom/=r):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,r)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),Se(this,"mouseChange",new Te),Se(this,"objectUp",new k),Se(this,"pan",new k),Se(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const r=this.object,t=(r.right-r.left)/this.object.zoom,i=(r.top-r.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=i}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),Se(this,"checkDistances",()=>{(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),Se(this,"handleResize",()=>{if(!this.domElement)return;const r=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=r.left+window.pageXOffset-t.clientLeft,this.screen.top=r.top+window.pageYOffset-t.clientTop,this.screen.width=r.width,this.screen.height=r.height}),Se(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),Se(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),Se(this,"keydown",r=>{this.enabled!==!1&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(r.code===this.keys[this.STATE.ROTATE]&&!this.noRotate?this._keyState=this.STATE.ROTATE:r.code===this.keys[this.STATE.ZOOM]&&!this.noZoom?this._keyState=this.STATE.ZOOM:r.code===this.keys[this.STATE.PAN]&&!this.noPan&&(this._keyState=this.STATE.PAN)))}),Se(this,"onPointerDown",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseDown(r);break}}),Se(this,"onPointerMove",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseMove(r);break}}),Se(this,"onPointerUp",r=>{if(this.enabled!==!1)switch(r.pointerType){case"mouse":case"pen":this.onMouseUp();break}}),Se(this,"keyup",()=>{this.enabled!==!1&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),Se(this,"onMouseDown",r=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(r.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break}const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t===this.STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):t===this.STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this.getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):t===this.STATE.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),Se(this,"onMouseMove",r=>{if(this.enabled===!1)return;const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t===this.STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(r.pageX,r.pageY))):t===this.STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this.getMouseOnScreen(r.pageX,r.pageY)):t===this.STATE.PAN&&!this.noPan&&this._panEnd.copy(this.getMouseOnScreen(r.pageX,r.pageY))}),Se(this,"onMouseUp",()=>{this.domElement&&this.enabled!==!1&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),Se(this,"mousewheel",r=>{if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.mousePosition.x=r.offsetX/this.screen.width*2-1,this.mousePosition.y=-(r.offsetY/this.screen.height)*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),Se(this,"touchstart",r=>{if(this.enabled!==!1){switch(r.preventDefault(),r.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const t=r.touches[0].pageX-r.touches[1].pageX,i=r.touches[0].pageY-r.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+i*i);const o=(r.touches[0].pageX+r.touches[1].pageX)/2,a=(r.touches[0].pageY+r.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(o,a)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(this.startEvent)}}),Se(this,"touchmove",r=>{if(this.enabled!==!1)switch(r.preventDefault(),r.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY));break;default:const t=r.touches[0].pageX-r.touches[1].pageX,i=r.touches[0].pageY-r.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+i*i);const o=(r.touches[0].pageX+r.touches[1].pageX)/2,a=(r.touches[0].pageY+r.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(o,a));break}}),Se(this,"touchend",r=>{if(this.enabled!==!1){switch(r.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(r.touches[0].pageX,r.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}this.dispatchEvent(this.endEvent)}}),Se(this,"contextmenu",r=>{this.enabled!==!1&&r.preventDefault()}),Se(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),Se(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,n!==void 0&&this.connect(n),this.update()}};var Pd=Object.defineProperty,Qd=(s,e,n)=>e in s?Pd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,oe=(s,e,n)=>(Qd(s,typeof e!="symbol"?e+"":e,n),n);const Ge={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},xt={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},et={x:0,y:0},zi={camera:new Me,gizmos:new Me},St={type:"change"},nn={type:"start"},Gi={type:"end"};let zd=class extends Zr{constructor(e,n=null,r=null){super(),oe(this,"camera"),oe(this,"domElement"),oe(this,"scene"),oe(this,"mouseActions"),oe(this,"_mouseOp"),oe(this,"_v2_1"),oe(this,"_v3_1"),oe(this,"_v3_2"),oe(this,"_m4_1"),oe(this,"_m4_2"),oe(this,"_quat"),oe(this,"_translationMatrix"),oe(this,"_rotationMatrix"),oe(this,"_scaleMatrix"),oe(this,"_rotationAxis"),oe(this,"_cameraMatrixState"),oe(this,"_cameraProjectionState"),oe(this,"_fovState"),oe(this,"_upState"),oe(this,"_zoomState"),oe(this,"_nearPos"),oe(this,"_farPos"),oe(this,"_gizmoMatrixState"),oe(this,"_up0"),oe(this,"_zoom0"),oe(this,"_fov0"),oe(this,"_initialNear"),oe(this,"_nearPos0"),oe(this,"_initialFar"),oe(this,"_farPos0"),oe(this,"_cameraMatrixState0"),oe(this,"_gizmoMatrixState0"),oe(this,"_button"),oe(this,"_touchStart"),oe(this,"_touchCurrent"),oe(this,"_input"),oe(this,"_switchSensibility"),oe(this,"_startFingerDistance"),oe(this,"_currentFingerDistance"),oe(this,"_startFingerRotation"),oe(this,"_currentFingerRotation"),oe(this,"_devPxRatio"),oe(this,"_downValid"),oe(this,"_nclicks"),oe(this,"_downEvents"),oe(this,"_clickStart"),oe(this,"_maxDownTime"),oe(this,"_maxInterval"),oe(this,"_posThreshold"),oe(this,"_movementThreshold"),oe(this,"_currentCursorPosition"),oe(this,"_startCursorPosition"),oe(this,"_grid"),oe(this,"_gridPosition"),oe(this,"_gizmos"),oe(this,"_curvePts"),oe(this,"_timeStart"),oe(this,"_animationId"),oe(this,"focusAnimationTime"),oe(this,"_timePrev"),oe(this,"_timeCurrent"),oe(this,"_anglePrev"),oe(this,"_angleCurrent"),oe(this,"_cursorPosPrev"),oe(this,"_cursorPosCurr"),oe(this,"_wPrev"),oe(this,"_wCurr"),oe(this,"adjustNearFar"),oe(this,"scaleFactor"),oe(this,"dampingFactor"),oe(this,"wMax"),oe(this,"enableAnimations"),oe(this,"enableGrid"),oe(this,"cursorZoom"),oe(this,"minFov"),oe(this,"maxFov"),oe(this,"enabled"),oe(this,"enablePan"),oe(this,"enableRotate"),oe(this,"enableZoom"),oe(this,"minDistance"),oe(this,"maxDistance"),oe(this,"minZoom"),oe(this,"maxZoom"),oe(this,"target"),oe(this,"_currentTarget"),oe(this,"_tbRadius"),oe(this,"_state"),oe(this,"onWindowResize",()=>{const t=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const l=this.calculateTbRadius(this.camera);l!==void 0&&(this._tbRadius=l)}const i=this._tbRadius/t,a=new Oa(0,0,i,i).getPoints(this._curvePts),c=new ki().setFromPoints(a);for(const l in this._gizmos.children){const u=this._gizmos.children[l];u.geometry=c}this.dispatchEvent(St)}),oe(this,"onContextMenu",t=>{if(this.enabled){for(let i=0;i<this.mouseActions.length;i++)if(this.mouseActions[i].mouse==2){t.preventDefault();break}}}),oe(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=xt.NONE}),oe(this,"onPointerDown",t=>{if(t.button==0&&t.isPrimary?(this._downValid=!0,this._downEvents.push(t)):this._downValid=!1,t.pointerType=="touch"&&this._input!=xt.CURSOR)switch(this._touchStart.push(t),this._touchCurrent.push(t),this._input){case xt.NONE:this._input=xt.ONE_FINGER,this.onSinglePanStart(t,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case xt.ONE_FINGER:case xt.ONE_FINGER_SWITCHED:this._input=xt.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case xt.TWO_FINGER:this._input=xt.MULT_FINGER,this.onTriplePanStart();break}else if(t.pointerType!="touch"&&this._input==xt.NONE){let i=null;t.ctrlKey||t.metaKey?i="CTRL":t.shiftKey&&(i="SHIFT"),this._mouseOp=this.getOpFromAction(t.button,i),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=xt.CURSOR,this._button=t.button,this.onSinglePanStart(t,this._mouseOp))}}),oe(this,"onPointerMove",t=>{if(t.pointerType=="touch"&&this._input!=xt.CURSOR)switch(this._input){case xt.ONE_FINGER:this.updateTouchEvent(t),this.onSinglePanMove(t,Ge.ROTATE);break;case xt.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],t)*this._devPxRatio>=this._switchSensibility){this._input=xt.ONE_FINGER,this.updateTouchEvent(t),this.onSinglePanStart(t,"ROTATE");break}break;case xt.TWO_FINGER:this.updateTouchEvent(t),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case xt.MULT_FINGER:this.updateTouchEvent(t),this.onTriplePanMove();break}else if(t.pointerType!="touch"&&this._input==xt.CURSOR){let i=null;t.ctrlKey||t.metaKey?i="CTRL":t.shiftKey&&(i="SHIFT");const o=this.getOpStateFromAction(this._button,i);o&&this.onSinglePanMove(t,o)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],t)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),oe(this,"onPointerUp",t=>{if(t.pointerType=="touch"&&this._input!=xt.CURSOR){const i=this._touchCurrent.length;for(let o=0;o<i;o++)if(this._touchCurrent[o].pointerId==t.pointerId){this._touchCurrent.splice(o,1),this._touchStart.splice(o,1);break}switch(this._input){case xt.ONE_FINGER:case xt.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=xt.NONE,this.onSinglePanEnd();break;case xt.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=xt.ONE_FINGER_SWITCHED;break;case xt.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=xt.NONE,this.onTriplePanEnd());break}}else t.pointerType!="touch"&&this._input==xt.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=xt.NONE,this.onSinglePanEnd(),this._button=-1);if(t.isPrimary)if(this._downValid)if(t.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const o=t.timeStamp-this._clickStart,a=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;o<=this._maxInterval&&a<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(t)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),oe(this,"onWheel",t=>{var i,o;if(this.enabled&&this.enableZoom&&this.domElement){let a=null;t.ctrlKey||t.metaKey?a="CTRL":t.shiftKey&&(a="SHIFT");const c=this.getOpFromAction("WHEEL",a);if(c){t.preventDefault(),this.dispatchEvent(nn);const l=125;let u=t.deltaY/l,f=1;switch(u>0?f=1/this.scaleFactor:u<0&&(f=this.scaleFactor),c){case"ZOOM":if(this.updateTbState(Ge.SCALE,!0),u>0?f=1/Math.pow(this.scaleFactor,u):u<0&&(f=Math.pow(this.scaleFactor,-u)),this.cursorZoom&&this.enablePan){let A;this.camera instanceof fi&&(A=(i=this.unprojectOnTbPlane(this.camera,t.clientX,t.clientY,this.domElement))==null?void 0:i.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof Zt&&(A=(o=this.unprojectOnTbPlane(this.camera,t.clientX,t.clientY,this.domElement))==null?void 0:o.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),A!==void 0&&this.applyTransformMatrix(this.applyScale(f,A))}else this.applyTransformMatrix(this.applyScale(f,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(St),this.dispatchEvent(Gi);break;case"FOV":if(this.camera instanceof Zt){this.updateTbState(Ge.FOV,!0),t.deltaX!=0&&(u=t.deltaX/l,f=1,u>0?f=1/Math.pow(this.scaleFactor,u):u<0&&(f=Math.pow(this.scaleFactor,-u))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const A=this._v3_1.distanceTo(this._gizmos.position);let d=A/f;d=je.clamp(d,this.minDistance,this.maxDistance);const x=A*Math.tan(je.DEG2RAD*this.camera.fov*.5);let p=je.RAD2DEG*(Math.atan(x/d)*2);p>this.maxFov?p=this.maxFov:p<this.minFov&&(p=this.minFov);const v=x/Math.tan(je.DEG2RAD*(p/2));f=A/v,this.setFov(p),this.applyTransformMatrix(this.applyScale(f,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(St),this.dispatchEvent(Gi);break}}}}),oe(this,"onSinglePanStart",(t,i)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(nn),this.setCenter(t.clientX,t.clientY),i){case"PAN":if(!this.enablePan)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(St)),this.camera){this.updateTbState(Ge.PAN,!0);const o=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement);o!==void 0&&this._startCursorPosition.copy(o),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(St))}break;case"ROTATE":if(!this.enableRotate)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(Ge.ROTATE,!0);const o=this.unprojectOnTbSurface(this.camera,et.x,et.y,this.domElement,this._tbRadius);o!==void 0&&this._startCursorPosition.copy(o),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(St);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof Zt&&(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(St)),this.updateTbState(Ge.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(St)),this.updateTbState(Ge.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}),oe(this,"onSinglePanMove",(t,i)=>{if(this.enabled&&this.domElement){const o=i!=this._state;switch(this.setCenter(t.clientX,t.clientY),i){case Ge.PAN:if(this.enablePan&&this.camera)if(o){this.dispatchEvent(Gi),this.dispatchEvent(nn),this.updateTbState(i,!0);const a=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const a=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement);a!==void 0&&this._currentCursorPosition.copy(a),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case Ge.ROTATE:if(this.enableRotate&&this.camera)if(o){this.dispatchEvent(Gi),this.dispatchEvent(nn),this.updateTbState(i,!0);const a=this.unprojectOnTbSurface(this.camera,et.x,et.y,this.domElement,this._tbRadius);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const a=this.unprojectOnTbSurface(this.camera,et.x,et.y,this.domElement,this._tbRadius);a!==void 0&&this._currentCursorPosition.copy(a);const c=this._startCursorPosition.distanceTo(this._currentCursorPosition),l=this._startCursorPosition.angleTo(this._currentCursorPosition),u=Math.max(c/this._tbRadius,l);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),u)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=u,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case Ge.SCALE:if(this.enableZoom)if(o)this.dispatchEvent(Gi),this.dispatchEvent(nn),this.updateTbState(i,!0),this._startCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;c<0?l=1/Math.pow(this.scaleFactor,-c*8):c>0&&(l=Math.pow(this.scaleFactor,c*8)),this.applyTransformMatrix(this.applyScale(l,this._gizmos.position))}break;case Ge.FOV:if(this.enableZoom&&this.camera instanceof Zt)if(o)this.dispatchEvent(Gi),this.dispatchEvent(nn),this.updateTbState(i,!0),this._startCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;c<0?l=1/Math.pow(this.scaleFactor,-c*8):c>0&&(l=Math.pow(this.scaleFactor,c*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let f=u/l;f=je.clamp(f,this.minDistance,this.maxDistance);const A=u*Math.tan(je.DEG2RAD*this._fovState*.5);let d=je.RAD2DEG*(Math.atan(A/f)*2);d=je.clamp(d,this.minFov,this.maxFov);const x=A/Math.tan(je.DEG2RAD*(d/2));l=u/x,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(l,this._v3_2,!1));const p=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(x/u);this._m4_1.makeTranslation(p.x,p.y,p.z)}break}this.dispatchEvent(St)}}),oe(this,"onSinglePanEnd",()=>{if(this._state==Ge.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const i=Math.abs((this._wPrev+this._wCurr)/2),o=this;this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(Ge.ANIMATION_ROTATE,!0);const c=o.calculateRotationAxis(o._cursorPosPrev,o._cursorPosCurr);o.onRotationAnim(a,c,Math.min(i,o.wMax))})}else this.updateTbState(Ge.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(St);else this.updateTbState(Ge.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(St)}else(this._state==Ge.PAN||this._state==Ge.IDLE)&&(this.updateTbState(Ge.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(St));this.dispatchEvent(Gi)}),oe(this,"onDoubleTap",t=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(nn),this.setCenter(t.clientX,t.clientY);const i=this.unprojectOnObj(this.getCursorNDC(et.x,et.y,this.domElement),this.camera);if(i&&this.enableAnimations){const o=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(Ge.ANIMATION_FOCUS,!0),o.onFocusAnim(a,i,o._cameraMatrixState,o._gizmoMatrixState)})}else i&&!this.enableAnimations&&(this.updateTbState(Ge.FOCUS,!0),this.focus(i,this.scaleFactor),this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(St))}this.dispatchEvent(Gi)}),oe(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(nn),this.updateTbState(Ge.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const t=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement,!0);t!==void 0&&this._startCursorPosition.copy(t),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),oe(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=Ge.PAN&&(this.updateTbState(Ge.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const t=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement,!0);t!==void 0&&this._currentCursorPosition.copy(t),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(St)}}),oe(this,"onDoublePanEnd",()=>{this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(Gi)}),oe(this,"onRotateStart",()=>{var t;this.enabled&&this.enableRotate&&(this.dispatchEvent(nn),this.updateTbState(Ge.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,(t=this.camera)==null||t.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),oe(this,"onRotateMove",()=>{var t;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let i;this._state!=Ge.ZROTATE&&(this.updateTbState(Ge.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),i=(t=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement))==null?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):i=new k().setFromMatrixPosition(this._gizmoMatrixState);const o=je.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);i!==void 0&&this.applyTransformMatrix(this.zRotate(i,o)),this.dispatchEvent(St)}}),oe(this,"onRotateEnd",()=>{this.updateTbState(Ge.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Gi)}),oe(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(nn),this.updateTbState(Ge.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),oe(this,"onPinchMove",()=>{var t,i;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const o=12;this._state!=Ge.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(Ge.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),o*this._devPxRatio);const a=this._currentFingerDistance/this._startFingerDistance;let c;this.enablePan?this.camera instanceof fi?c=(t=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement))==null?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof Zt&&(c=(i=this.unprojectOnTbPlane(this.camera,et.x,et.y,this.domElement))==null?void 0:i.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):c=this._gizmos.position,c!==void 0&&this.applyTransformMatrix(this.applyScale(a,c)),this.dispatchEvent(St)}}),oe(this,"onPinchEnd",()=>{this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(Gi)}),oe(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(nn),this.updateTbState(Ge.SCALE,!0);let t=0,i=0;const o=this._touchCurrent.length;for(let a=0;a<o;a++)t+=this._touchCurrent[a].clientX,i+=this._touchCurrent[a].clientY;this.setCenter(t/o,i/o),this._startCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}),oe(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let t=0,i=0;const o=this._touchCurrent.length;for(let v=0;v<o;v++)t+=this._touchCurrent[v].clientX,i+=this._touchCurrent[v].clientY;this.setCenter(t/o,i/o);const a=8;this._currentCursorPosition.setY(this.getCursorNDC(et.x,et.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;c<0?l=1/Math.pow(this.scaleFactor,-c*a):c>0&&(l=Math.pow(this.scaleFactor,c*a)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let f=u/l;f=je.clamp(f,this.minDistance,this.maxDistance);const A=u*Math.tan(je.DEG2RAD*this._fovState*.5);let d=je.RAD2DEG*(Math.atan(A/f)*2);d=je.clamp(d,this.minFov,this.maxFov);const x=A/Math.tan(je.DEG2RAD*(d/2));l=u/x,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(l,this._v3_2,!1));const p=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(x/u);this._m4_1.makeTranslation(p.x,p.y,p.z),this.dispatchEvent(St)}}),oe(this,"onTriplePanEnd",()=>{this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(Gi)}),oe(this,"setCenter",(t,i)=>{et.x=t,et.y=i}),oe(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),oe(this,"setMouseAction",(t,i,o=null)=>{const a=["PAN","ROTATE","ZOOM","FOV"],c=[0,1,2,"WHEEL"],l=["CTRL","SHIFT",null];let u;if(!a.includes(t)||!c.includes(i)||!l.includes(o)||i=="WHEEL"&&t!="ZOOM"&&t!="FOV")return!1;switch(t){case"PAN":u=Ge.PAN;break;case"ROTATE":u=Ge.ROTATE;break;case"ZOOM":u=Ge.SCALE;break;case"FOV":u=Ge.FOV;break}const f={operation:t,mouse:i,key:o,state:u};for(let A=0;A<this.mouseActions.length;A++)if(this.mouseActions[A].mouse==f.mouse&&this.mouseActions[A].key==f.key)return this.mouseActions.splice(A,1,f),!0;return this.mouseActions.push(f),!0}),oe(this,"getOpFromAction",(t,i)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==t&&o.key==i)return o.operation;if(i){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==t&&o.key==null)return o.operation}return null}),oe(this,"getOpStateFromAction",(t,i)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==t&&o.key==i)return o.state;if(i){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==t&&o.key==null)return o.state}return null}),oe(this,"getAngle",(t,i)=>Math.atan2(i.clientY-t.clientY,i.clientX-t.clientX)*180/Math.PI),oe(this,"updateTouchEvent",t=>{for(let i=0;i<this._touchCurrent.length;i++)if(this._touchCurrent[i].pointerId==t.pointerId){this._touchCurrent.splice(i,1,t);break}}),oe(this,"calculateAngularSpeed",(t,i,o,a)=>{const c=i-t,l=(a-o)/1e3;return l==0?0:c/l}),oe(this,"calculatePointersDistance",(t,i)=>Math.sqrt(Math.pow(i.clientX-t.clientX,2)+Math.pow(i.clientY-t.clientY,2))),oe(this,"calculateRotationAxis",(t,i)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(t,i).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),oe(this,"calculateTbRadius",t=>{const o=t.position.distanceTo(this._gizmos.position);if(t instanceof Zt){const a=je.DEG2RAD*t.fov*.5,c=Math.atan(t.aspect*Math.tan(a));return Math.tan(Math.min(a,c))*o*.67}else if(t instanceof fi)return Math.min(t.top,t.right)*.67}),oe(this,"focus",(t,i,o=1)=>{if(this.camera){const a=t.clone();a.sub(this._gizmos.position).multiplyScalar(o),this._translationMatrix.makeTranslation(a.x,a.y,a.z);const c=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const l=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(i,this._gizmos.position)),this._gizmoMatrixState.copy(c),this._cameraMatrixState.copy(l)}}),oe(this,"drawGrid",()=>{if(this.scene){let o,a,c,l;if(this.camera instanceof fi){const u=this.camera.right-this.camera.left,f=this.camera.bottom-this.camera.top;c=Math.max(u,f),l=c/20,o=c/this.camera.zoom*3,a=o/l*this.camera.zoom}else if(this.camera instanceof Zt){const u=this.camera.position.distanceTo(this._gizmos.position),f=je.DEG2RAD*this.camera.fov*.5,A=Math.atan(this.camera.aspect*Math.tan(f));c=Math.tan(Math.max(f,A))*u*2,l=c/20,o=c*3,a=o/l}this._grid==null&&this.camera&&(this._grid=new Jf(o,a,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}),oe(this,"connect",t=>{t===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=t,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),oe(this,"dispose",()=>{var t,i,o,a,c;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),(t=this.domElement)==null||t.removeEventListener("pointerdown",this.onPointerDown),(i=this.domElement)==null||i.removeEventListener("pointercancel",this.onPointerCancel),(o=this.domElement)==null||o.removeEventListener("wheel",this.onWheel),(a=this.domElement)==null||a.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),(c=this.scene)==null||c.remove(this._gizmos),this.disposeGrid()}),oe(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),oe(this,"easeOutCubic",t=>1-Math.pow(1-t,3)),oe(this,"activateGizmos",t=>{for(const i of this._gizmos.children)i.material.setValues({opacity:t?1:.6})}),oe(this,"getCursorNDC",(t,i,o)=>{const a=o.getBoundingClientRect();return this._v2_1.setX((t-a.left)/a.width*2-1),this._v2_1.setY((a.bottom-i)/a.height*2-1),this._v2_1.clone()}),oe(this,"getCursorPosition",(t,i,o)=>(this._v2_1.copy(this.getCursorNDC(t,i,o)),this.camera instanceof fi&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),oe(this,"setCamera",t=>{if(t){t.lookAt(this.target),t.updateMatrix(),t instanceof Zt&&(this._fov0=t.fov,this._fovState=t.fov),this._cameraMatrixState0.copy(t.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(t.projectionMatrix),this._zoom0=t.zoom,this._zoomState=this._zoom0,this._initialNear=t.near,this._nearPos0=t.position.distanceTo(this.target)-t.near,this._nearPos=this._initialNear,this._initialFar=t.far,this._farPos0=t.position.distanceTo(this.target)-t.far,this._farPos=this._initialFar,this._up0.copy(t.up),this._upState.copy(t.up),this.camera=t,this.camera.updateProjectionMatrix();const i=this.calculateTbRadius(t);i!==void 0&&(this._tbRadius=i),this.makeGizmos(this.target,this._tbRadius)}}),oe(this,"makeGizmos",(t,i)=>{const a=new Oa(0,0,i,i).getPoints(this._curvePts),c=new ki().setFromPoints(a),l=new Jo({color:16744576,fog:!1,transparent:!0,opacity:.6}),u=new Jo({color:8454016,fog:!1,transparent:!0,opacity:.6}),f=new Jo({color:8421631,fog:!1,transparent:!0,opacity:.6}),A=new ut(c,l),d=new ut(c,u),x=new ut(c,f),p=Math.PI*.5;if(A.rotation.x=p,d.rotation.y=p,this._gizmoMatrixState0.identity().setPosition(t),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&this.camera.zoom!=1){const v=1/this.camera.zoom;this._scaleMatrix.makeScale(v,v,v),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(t.x,t.y,t.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(A),this._gizmos.add(d),this._gizmos.add(x)}),oe(this,"onFocusAnim",(t,i,o,a)=>{if(this._timeStart==-1&&(this._timeStart=t),this._state==Ge.ANIMATION_FOCUS){const l=(t-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(a),l>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(i,this.scaleFactor),this._timeStart=-1,this.updateTbState(Ge.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(St);else{const u=this.easeOutCubic(l),f=1-u+this.scaleFactor*u;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(i,f,u),this.dispatchEvent(St);const A=this;this._animationId=window.requestAnimationFrame(function(d){A.onFocusAnim(d,i,o,a.clone())})}}else this._animationId=-1,this._timeStart=-1}),oe(this,"onRotationAnim",(t,i,o)=>{if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=t),this._state==Ge.ANIMATION_ROTATE){const a=(t-this._timeStart)/1e3;if(o+-this.dampingFactor*a>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(a,2)+o*a+0,this.applyTransformMatrix(this.rotate(i,this._angleCurrent)),this.dispatchEvent(St);const l=this;this._animationId=window.requestAnimationFrame(function(u){l.onRotationAnim(u,i,o)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(Ge.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(St)}else this._animationId=-1,this._timeStart=-1,this._state!=Ge.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(St))}),oe(this,"pan",(t,i,o=!1)=>{if(this.camera){const a=t.clone().sub(i);if(this.camera instanceof fi&&a.multiplyScalar(1/this.camera.zoom),this.camera instanceof Zt&&o){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const c=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);a.multiplyScalar(1/c)}this._v3_1.set(a.x,a.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return zi}),oe(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof Zt&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const t=this.calculateTbRadius(this.camera);t!==void 0&&(this._tbRadius=t),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(St)}}),oe(this,"rotate",(t,i)=>{const o=this._gizmos.position;return this._translationMatrix.makeTranslation(-o.x,-o.y,-o.z),this._rotationMatrix.makeRotationAxis(t,-i),this._m4_1.makeTranslation(o.x,o.y,o.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),zi}),oe(this,"copyState",()=>{if(this.camera){const t=JSON.stringify(this.camera instanceof fi?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(t)}}),oe(this,"pasteState",()=>{const t=this;navigator.clipboard.readText().then(function(o){t.setStateFromJSON(o)})}),oe(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof Zt&&(this._fov0=this.camera.fov))}),oe(this,"applyScale",(t,i,o=!0)=>{if(!this.camera)return;const a=i.clone();let c=1/t;if(this.camera instanceof fi){this.camera.zoom=this._zoomState,this.camera.zoom*=t,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,c=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,c=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(c,c,c),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),a.sub(this._v3_1);const l=a.clone().multiplyScalar(c);return a.sub(l),this._m4_1.makeTranslation(a.x,a.y,a.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),zi}if(this.camera instanceof Zt){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let l=this._v3_1.distanceTo(a),u=l-l*c;const f=l-u;f<this.minDistance?(c=this.minDistance/l,u=l-l*c):f>this.maxDistance&&(c=this.maxDistance/l,u=l-l*c);let A=a.clone().sub(this._v3_1).normalize().multiplyScalar(u);if(this._m4_1.makeTranslation(A.x,A.y,A.z),o){const d=this._v3_2;l=d.distanceTo(a),u=l-l*c,A=a.clone().sub(this._v3_2).normalize().multiplyScalar(u),this._translationMatrix.makeTranslation(d.x,d.y,d.z),this._scaleMatrix.makeScale(c,c,c),this._m4_2.makeTranslation(A.x,A.y,A.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-d.x,-d.y,-d.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return zi}}),oe(this,"setFov",t=>{this.camera instanceof Zt&&(this.camera.fov=je.clamp(t,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),oe(this,"setTarget",(t,i,o)=>{if(this.camera){this.target.set(t,i,o),this._gizmos.position.set(t,i,o);const a=this.calculateTbRadius(this.camera);a!==void 0&&(this._tbRadius=a),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),oe(this,"zRotate",(t,i)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,i),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._m4_1.makeTranslation(t.x,t.y,t.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(t),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,i),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),zi)),oe(this,"unprojectOnObj",(t,i)=>{if(!this.scene)return null;const o=new fa;o.near=i.near,o.far=i.far,o.setFromCamera(t,i);const a=o.intersectObjects(this.scene.children,!0);for(let c=0;c<a.length;c++)if(a[c].object.uuid!=this._gizmos.uuid&&a[c].face)return a[c].point.clone();return null}),oe(this,"unprojectOnTbSurface",(t,i,o,a,c)=>{if(t instanceof fi){this._v2_1.copy(this.getCursorPosition(i,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const l=Math.pow(this._v2_1.x,2),u=Math.pow(this._v2_1.y,2),f=Math.pow(this._tbRadius,2);return l+u<=f*.5?this._v3_1.setZ(Math.sqrt(f-(l+u))):this._v3_1.setZ(f*.5/Math.sqrt(l+u)),this._v3_1}if(t instanceof Zt){this._v2_1.copy(this.getCursorNDC(i,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),u=t.position.distanceTo(this._gizmos.position),f=Math.pow(c,2),A=this._v3_1.z,d=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(d==0)return l.set(this._v3_1.x,this._v3_1.y,c),l;const x=A/d,p=u;let v=Math.pow(x,2)+1,y=2*x*p,g=Math.pow(p,2)-f,m=Math.pow(y,2)-4*v*g;if(m>=0&&(this._v2_1.setX((-y-Math.sqrt(m))/(2*v)),this._v2_1.setY(x*this._v2_1.x+p),je.RAD2DEG*this._v2_1.angle()>=45)){const C=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return l.multiplyScalar(C),l.z+=u,l}v=x,y=p,g=-f*.5,m=Math.pow(y,2)-4*v*g,this._v2_1.setX((-y-Math.sqrt(m))/(2*v)),this._v2_1.setY(x*this._v2_1.x+p);const _=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return l.multiplyScalar(_),l.z+=u,l}}),oe(this,"unprojectOnTbPlane",(t,i,o,a,c=!1)=>{if(t instanceof fi)return this._v2_1.copy(this.getCursorPosition(i,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(t instanceof Zt){this._v2_1.copy(this.getCursorNDC(i,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),u=this._v3_1.z,f=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let A;if(c?A=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):A=t.position.distanceTo(this._gizmos.position),f==0)return l.set(0,0,0),l;const d=u/f,x=A,p=-x/d,v=Math.sqrt(Math.pow(x,2)+Math.pow(p,2));return l.multiplyScalar(v),l.z=0,l}}),oe(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof fi&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof Zt&&(this._fovState=this.camera.fov))}),oe(this,"updateTbState",(t,i)=>{this._state=t,i&&this.updateMatrixState()}),oe(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const i=this.calculateTbRadius(this.camera);i!==void 0&&(this._tbRadius=i),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof fi&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const i=je.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(i/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof Zt){const i=this.camera.position.distanceTo(this._gizmos.position);if(i>this.maxDistance+1e-6||i<this.minDistance-1e-6){const c=je.clamp(i,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(c/i,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=je.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const o=this._tbRadius,a=this.calculateTbRadius(this.camera);if(a!==void 0&&(this._tbRadius=a),o<this._tbRadius-1e-6||o>this._tbRadius+1e-6){const c=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,l=this._tbRadius/c,f=new Oa(0,0,l,l).getPoints(this._curvePts),A=new ki().setFromPoints(f);for(const d in this._gizmos.children){const x=this._gizmos.children[d];x.geometry=A}}}this.camera.lookAt(this._gizmos.position)}}),oe(this,"setStateFromJSON",t=>{const i=JSON.parse(t);if(i.arcballState&&this.camera){this._cameraMatrixState.fromArray(i.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(i.arcballState.cameraUp),this.camera.near=i.arcballState.cameraNear,this.camera.far=i.arcballState.cameraFar,this.camera.zoom=i.arcballState.cameraZoom,this.camera instanceof Zt&&(this.camera.fov=i.arcballState.cameraFov),this._gizmoMatrixState.fromArray(i.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const o=this.calculateTbRadius(this.camera);o!==void 0&&(this._tbRadius=o);const a=new Me().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(a),this.camera.lookAt(this._gizmos.position),this.updateTbState(Ge.IDLE,!1),this.dispatchEvent(St)}}),this.camera=null,this.domElement=n,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Te,this._v3_1=new k,this._v3_2=new k,this._m4_1=new Me,this._m4_2=new Me,this._quat=new st,this._translationMatrix=new Me,this._rotationMatrix=new Me,this._scaleMatrix=new Me,this._rotationAxis=new k,this._cameraMatrixState=new Me,this._cameraProjectionState=new Me,this._fovState=1,this._upState=new k,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Me,this._up0=new k,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Me,this._gizmoMatrixState0=new Me,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=xt.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new k,this._startCursorPosition=new k,this._grid=null,this._gridPosition=new k,this._gizmos=new Aa,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new k,this._cursorPosCurr=new k,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new k(0,0,0),this._currentTarget=new k(0,0,0),this._tbRadius=1,this._state=Ge.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(e!=null&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==Ge.ROTATE||this._state==Ge.ZROTATE||this._state==Ge.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),e!=null&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==Ge.SCALE||this._state==Ge.FOCUS||this._state==Ge.ANIMATION_FOCUS)&&this.camera){const n=this.calculateTbRadius(this.camera);if(n!==void 0&&(this._tbRadius=n),this.adjustNearFar){const r=this.camera.position.distanceTo(this._gizmos.position),t=new Rt;t.setFromObject(this._gizmos);const i=new Oi;t.getBoundingSphere(i);const o=Math.max(this._nearPos0,i.radius+i.center.length()),a=r-this._initialNear,c=Math.min(o,a);this.camera.near=r-c;const l=Math.min(this._farPos0,-i.radius+i.center.length()),u=r-this._initialFar,f=Math.min(l,u);this.camera.far=r-f,this.camera.updateProjectionMatrix()}else{let r=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,r=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,r=!0),r&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(St)}setTransformationMatrices(e=null,n=null){e?zi.camera?zi.camera.copy(e):zi.camera=e.clone():zi.camera=null,n?zi.gizmos?zi.gizmos.copy(n):zi.gizmos=n.clone():zi.gizmos=null}};var Fd=Object.defineProperty,Ud=(s,e,n)=>e in s?Fd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Ct=(s,e,n)=>(Ud(s,typeof e!="symbol"?e+"":e,n),n);function Cu(s){s.preventDefault()}let kd=class extends Zr{constructor(e,n){super(),Ct(this,"object"),Ct(this,"domElement",null),Ct(this,"movementSpeed",1),Ct(this,"rollSpeed",.005),Ct(this,"dragToLook",!1),Ct(this,"autoForward",!1),Ct(this,"changeEvent",{type:"change"}),Ct(this,"EPS",1e-6),Ct(this,"tmpQuaternion",new st),Ct(this,"mouseStatus",0),Ct(this,"movementSpeedMultiplier",1),Ct(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),Ct(this,"moveVector",new k(0,0,0)),Ct(this,"rotationVector",new k(0,0,0)),Ct(this,"keydown",r=>{if(!r.altKey){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}}),Ct(this,"keyup",r=>{switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}),Ct(this,"pointerdown",r=>{if(this.dragToLook)this.mouseStatus++;else{switch(r.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}}),Ct(this,"pointermove",r=>{if(!this.dragToLook||this.mouseStatus>0){const t=this.getContainerDimensions(),i=t.size[0]/2,o=t.size[1]/2;this.moveState.yawLeft=-(r.pageX-t.offset[0]-i)/i,this.moveState.pitchDown=(r.pageY-t.offset[1]-o)/o,this.updateRotationVector()}}),Ct(this,"pointerup",r=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(r.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}),Ct(this,"lastQuaternion",new st),Ct(this,"lastPosition",new k),Ct(this,"update",r=>{const t=r*this.movementSpeed,i=r*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*i,this.rotationVector.y*i,this.rotationVector.z*i,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),Ct(this,"updateMovementVector",()=>{const r=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-r+this.moveState.back}),Ct(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),Ct(this,"getContainerDimensions",()=>this.domElement!=document&&!(this.domElement instanceof Document)?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}),Ct(this,"connect",r=>{this.domElement=r,r instanceof Document||r.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",Cu),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),Ct(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",Cu),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,n!==void 0&&this.connect(n),this.updateMovementVector(),this.updateRotationVector()}};var Ld=Object.defineProperty,Od=(s,e,n)=>e in s?Ld(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,cr=(s,e,n)=>(Od(s,typeof e!="symbol"?e+"":e,n),n);class Ea{constructor(){cr(this,"enabled",!0),cr(this,"needsSwap",!0),cr(this,"clear",!1),cr(this,"renderToScreen",!1)}setSize(e,n){}render(e,n,r,t,i){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class Tn{constructor(e){cr(this,"camera",new fi(-1,1,1,-1,0,1)),cr(this,"geometry",new yi(2,2)),cr(this,"mesh"),this.mesh=new Qe(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var Nd=Object.defineProperty,Gd=(s,e,n)=>e in s?Nd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Ao=(s,e,n)=>(Gd(s,typeof e!="symbol"?e+"":e,n),n);class sl extends Ea{constructor(e,n="tDiffuse"){super(),Ao(this,"textureID"),Ao(this,"uniforms"),Ao(this,"material"),Ao(this,"fsQuad"),this.textureID=n,e instanceof kt?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=Xr.clone(e.uniforms),this.material=new kt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Tn(this.material)}render(e,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}const wu={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var Hd=Object.defineProperty,Vd=(s,e,n)=>e in s?Hd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Ya=(s,e,n)=>(Vd(s,typeof e!="symbol"?e+"":e,n),n);class Iu extends Ea{constructor(e,n){super(),Ya(this,"scene"),Ya(this,"camera"),Ya(this,"inverse"),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,n,r){const t=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(t.REPLACE,t.REPLACE,t.REPLACE),i.buffers.stencil.setFunc(t.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(t.EQUAL,1,4294967295),i.buffers.stencil.setOp(t.KEEP,t.KEEP,t.KEEP),i.buffers.stencil.setLocked(!0)}}class Wd extends Ea{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var Yd=Object.defineProperty,jd=(s,e,n)=>e in s?Yd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Hi=(s,e,n)=>(jd(s,typeof e!="symbol"?e+"":e,n),n);class qd{constructor(e,n){if(Hi(this,"renderer"),Hi(this,"_pixelRatio"),Hi(this,"_width"),Hi(this,"_height"),Hi(this,"renderTarget1"),Hi(this,"renderTarget2"),Hi(this,"writeBuffer"),Hi(this,"readBuffer"),Hi(this,"renderToScreen"),Hi(this,"passes",[]),Hi(this,"copyPass"),Hi(this,"clock"),this.renderer=e,n===void 0){const r={minFilter:Bt,magFilter:Bt,format:Wt},t=e.getSize(new Te);this._pixelRatio=e.getPixelRatio(),this._width=t.width,this._height=t.height,n=new Vt(this._width*this._pixelRatio,this._height*this._pixelRatio,r),n.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,wu===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),sl===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new sl(wu),this.copyPass.material.blending=Cl,this.clock=new $f}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,n){this.passes.splice(n,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const n=this.passes.indexOf(e);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(e){for(let n=e+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const n=this.renderer.getRenderTarget();let r=!1;const t=this.passes.length;for(let i=0;i<t;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Iu!==void 0&&(o instanceof Iu?r=!0:o instanceof Wd&&(r=!1))}}this.renderer.setRenderTarget(n)}reset(e){if(e===void 0){const n=this.renderer.getSize(new Te);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,n){this._width=e,this._height=n;const r=this._width*this._pixelRatio,t=this._height*this._pixelRatio;this.renderTarget1.setSize(r,t),this.renderTarget2.setSize(r,t);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,t)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var Xd=Object.defineProperty,Kd=(s,e,n)=>e in s?Xd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,$n=(s,e,n)=>(Kd(s,typeof e!="symbol"?e+"":e,n),n);class Zd extends Ea{constructor(e,n,r,t,i=0){super(),$n(this,"scene"),$n(this,"camera"),$n(this,"overrideMaterial"),$n(this,"clearColor"),$n(this,"clearAlpha"),$n(this,"clearDepth",!1),$n(this,"_oldClearColor",new Ve),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=t,this.clearAlpha=i,this.clear=!0,this.needsSwap=!1}render(e,n,r){let t=e.autoClear;e.autoClear=!1;let i,o=null;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=t}}class Jd extends ki{constructor(e,n,r,t){super();const i=[],o=[],a=[],c=new k,l=new Me;l.makeRotationFromEuler(r),l.setPosition(n);const u=new Me;u.copy(l).invert(),f(),this.setAttribute("position",new Ki(i,3)),this.setAttribute("normal",new Ki(o,3)),this.setAttribute("uv",new Ki(a,2));function f(){let p,v=[];const y=new k,g=new k;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const m=e.geometry,_=m.attributes.position,E=m.attributes.normal;if(m.index!==null){const C=m.index;for(p=0;p<C.count;p++)y.fromBufferAttribute(_,C.getX(p)),g.fromBufferAttribute(E,C.getX(p)),A(v,y,g)}else for(p=0;p<_.count;p++)y.fromBufferAttribute(_,p),g.fromBufferAttribute(E,p),A(v,y,g);for(v=d(v,c.set(1,0,0)),v=d(v,c.set(-1,0,0)),v=d(v,c.set(0,1,0)),v=d(v,c.set(0,-1,0)),v=d(v,c.set(0,0,1)),v=d(v,c.set(0,0,-1)),p=0;p<v.length;p++){const C=v[p];a.push(.5+C.position.x/t.x,.5+C.position.y/t.y),C.position.applyMatrix4(l),i.push(C.position.x,C.position.y,C.position.z),o.push(C.normal.x,C.normal.y,C.normal.z)}}function A(p,v,y){v.applyMatrix4(e.matrixWorld),v.applyMatrix4(u),y.transformDirection(e.matrixWorld),p.push(new bu(v.clone(),y.clone()))}function d(p,v){const y=[],g=.5*Math.abs(t.dot(v));for(let m=0;m<p.length;m+=3){let _,E,C,w=0,I,B,S,U;const b=p[m+0].position.dot(v)-g,M=p[m+1].position.dot(v)-g,D=p[m+2].position.dot(v)-g;switch(_=b>0,E=M>0,C=D>0,w=(_?1:0)+(E?1:0)+(C?1:0),w){case 0:{y.push(p[m]),y.push(p[m+1]),y.push(p[m+2]);break}case 1:{if(_&&(I=p[m+1],B=p[m+2],S=x(p[m],I,v,g),U=x(p[m],B,v,g)),E){I=p[m],B=p[m+2],S=x(p[m+1],I,v,g),U=x(p[m+1],B,v,g),y.push(S),y.push(B.clone()),y.push(I.clone()),y.push(B.clone()),y.push(S.clone()),y.push(U);break}C&&(I=p[m],B=p[m+1],S=x(p[m+2],I,v,g),U=x(p[m+2],B,v,g)),y.push(I.clone()),y.push(B.clone()),y.push(S),y.push(U),y.push(S.clone()),y.push(B.clone());break}case 2:{_||(I=p[m].clone(),B=x(I,p[m+1],v,g),S=x(I,p[m+2],v,g),y.push(I),y.push(B),y.push(S)),E||(I=p[m+1].clone(),B=x(I,p[m+2],v,g),S=x(I,p[m],v,g),y.push(I),y.push(B),y.push(S)),C||(I=p[m+2].clone(),B=x(I,p[m],v,g),S=x(I,p[m+1],v,g),y.push(I),y.push(B),y.push(S));break}}}return y}function x(p,v,y,g){const m=p.position.dot(y)-g,_=v.position.dot(y)-g,E=m/(m-_);return new bu(new k(p.position.x+E*(v.position.x-p.position.x),p.position.y+E*(v.position.y-p.position.y),p.position.z+E*(v.position.z-p.position.z)),new k(p.normal.x+E*(v.normal.x-p.normal.x),p.normal.y+E*(v.normal.y-p.normal.y),p.normal.z+E*(v.normal.z-p.normal.z)))}}}class bu{constructor(e,n){this.position=e,this.normal=n}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class $d extends eA{constructor(e,n={}){const{bevelEnabled:r=!1,bevelSize:t=8,bevelThickness:i=10,font:o,height:a=50,size:c=100,lineHeight:l=1,letterSpacing:u=0,...f}=n;if(o===void 0)super();else{const A=o.generateShapes(e,c,{lineHeight:l,letterSpacing:u});super(A,{...f,bevelEnabled:r,bevelSize:t,bevelThickness:i,depth:a})}this.type="TextGeometry"}}const em={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},tm={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},im={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},ja=new Gh,qa=new k,yr=new k,rn=new k,In=new k,un=new k,bn=new k,Bn=new k,us=new k,hs=new k,fs=new k,mo=new k,As=new k,ds=new k,ms=new k;class nm{constructor(e,n,r){this.camera=e,this.scene=n,this.startPoint=new k,this.endPoint=new k,this.collection=[],this.deep=r||Number.MAX_VALUE}select(e,n){return this.startPoint=e||this.startPoint,this.endPoint=n||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(ja,this.scene),this.collection}updateFrustum(e,n){if(e=e||this.startPoint,n=n||this.endPoint,e.x===n.x&&(n.x+=Number.EPSILON),e.y===n.y&&(n.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){yr.copy(e),yr.x=Math.min(e.x,n.x),yr.y=Math.max(e.y,n.y),n.x=Math.max(e.x,n.x),n.y=Math.min(e.y,n.y),rn.setFromMatrixPosition(this.camera.matrixWorld),In.copy(yr),un.set(n.x,yr.y,0),bn.copy(n),Bn.set(yr.x,n.y,0),In.unproject(this.camera),un.unproject(this.camera),bn.unproject(this.camera),Bn.unproject(this.camera),As.copy(In).sub(rn),ds.copy(un).sub(rn),ms.copy(bn).sub(rn),As.normalize(),ds.normalize(),ms.normalize(),As.multiplyScalar(this.deep),ds.multiplyScalar(this.deep),ms.multiplyScalar(this.deep),As.add(rn),ds.add(rn),ms.add(rn);var r=ja.planes;r[0].setFromCoplanarPoints(rn,In,un),r[1].setFromCoplanarPoints(rn,un,bn),r[2].setFromCoplanarPoints(bn,Bn,rn),r[3].setFromCoplanarPoints(Bn,In,rn),r[4].setFromCoplanarPoints(un,bn,Bn),r[5].setFromCoplanarPoints(ms,ds,As),r[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const t=Math.min(e.x,n.x),i=Math.max(e.y,n.y),o=Math.max(e.x,n.x),a=Math.min(e.y,n.y);In.set(t,i,-1),un.set(o,i,-1),bn.set(o,a,-1),Bn.set(t,a,-1),us.set(t,i,1),hs.set(o,i,1),fs.set(o,a,1),mo.set(t,a,1),In.unproject(this.camera),un.unproject(this.camera),bn.unproject(this.camera),Bn.unproject(this.camera),us.unproject(this.camera),hs.unproject(this.camera),fs.unproject(this.camera),mo.unproject(this.camera);var r=ja.planes;r[0].setFromCoplanarPoints(In,us,hs),r[1].setFromCoplanarPoints(un,hs,fs),r[2].setFromCoplanarPoints(fs,mo,Bn),r[3].setFromCoplanarPoints(mo,us,In),r[4].setFromCoplanarPoints(un,bn,Bn),r[5].setFromCoplanarPoints(fs,hs,us),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,n){if((n.isMesh||n.isLine||n.isPoints)&&n.material!==void 0&&(n.geometry.boundingSphere===null&&n.geometry.computeBoundingSphere(),qa.copy(n.geometry.boundingSphere.center),qa.applyMatrix4(n.matrixWorld),e.containsPoint(qa)&&this.collection.push(n)),n.children.length>0)for(let r=0;r<n.children.length;r++)this.searchChildInFrustum(e,n.children[r])}}class rm{constructor(e,n=" .:-=+*#%@",r={}){const t=r.resolution||.15,i=r.scale||1,o=r.color||!1,a=r.alpha||!1,c=r.block||!1,l=r.invert||!1,u=r.strResolution||"low";let f,A;const d=document.createElement("div");d.style.cursor="default";const x=document.createElement("table");d.appendChild(x);let p,v,y;this.setSize=function(D,N){f=D,A=N,e.setSize(D,N),g()},this.render=function(D,N){e.render(D,N),M(x)},this.domElement=d;function g(){p=Math.floor(f*t),v=Math.floor(A*t),w.width=p,w.height=v,y=e.domElement,y.style.backgroundColor&&(x.rows[0].cells[0].style.backgroundColor=y.style.backgroundColor,x.rows[0].cells[0].style.color=y.style.color),x.cellSpacing=0,x.cellPadding=0;const D=x.style;D.whiteSpace="pre",D.margin="0px",D.padding="0px",D.letterSpacing=b+"px",D.fontFamily=E,D.fontSize=S+"px",D.lineHeight=U+"px",D.textAlign="left",D.textDecoration="none"}const m=" .,:;i1tfLCG08@".split(""),_=" CGO08@".split(""),E="courier new, monospace",C=e.domElement,w=document.createElement("canvas");if(!w.getContext)return;const I=w.getContext("2d");if(!I.getImageData)return;let B=o?_:m;n&&(B=n);const S=2/t*i,U=2/t*i;let b=0;if(u=="low")switch(i){case 1:b=-1;break;case 2:case 3:b=-2.1;break;case 4:b=-3.1;break;case 5:b=-4.15;break}if(u=="medium")switch(i){case 1:b=0;break;case 2:b=-1;break;case 3:b=-1.04;break;case 4:case 5:b=-2.1;break}if(u=="high")switch(i){case 1:case 2:b=0;break;case 3:case 4:case 5:b=-1;break}function M(D){I.clearRect(0,0,p,v),I.drawImage(C,0,0,p,v);const N=I.getImageData(0,0,p,v).data;let G="";for(let q=0;q<v;q+=2){for(let X=0;X<p;X++){const O=(q*p+X)*4,H=N[O],T=N[O+1],W=N[O+2],j=N[O+3];let L,z;z=(.3*H+.59*T+.11*W)/255,j==0&&(z=1),L=Math.floor((1-z)*(B.length-1)),l&&(L=B.length-L-1);let F=B[L];(F===void 0||F==" ")&&(F="&nbsp;"),o?G+="<span style='color:rgb("+H+","+T+","+W+");"+(c?"background-color:rgb("+H+","+T+","+W+");":"")+(a?"opacity:"+j/255+";":"")+"'>"+F+"</span>":G+=F}G+="<br/>"}D.innerHTML=`<tr><td style="display:block;width:${f}px;height:${A}px;overflow:hidden">${G}</td></tr>`}}}var sm=Object.defineProperty,om=(s,e,n)=>e in s?sm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,Xa=(s,e,n)=>(om(s,typeof e!="symbol"?e+"":e,n),n);class am extends Ks{constructor(e){super(e)}load(e,n,r,t){const i=new Dn(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{if(typeof o!="string")throw new Error("unsupported data type");const a=JSON.parse(o),c=this.parse(a);n&&n(c)},r,t)}loadAsync(e,n){return super.loadAsync(e,n)}parse(e){return new cm(e)}}class cm{constructor(e){Xa(this,"data"),Xa(this,"isFont",!0),Xa(this,"type","Font"),this.data=e}generateShapes(e,n=100,r){const t=[],i={letterSpacing:0,lineHeight:1,...r},o=lm(e,n,this.data,i);for(let a=0,c=o.length;a<c;a++)Array.prototype.push.apply(t,o[a].toShapes(!1));return t}}function lm(s,e,n,r){const t=Array.from(s),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[];let c=0,l=0;for(let u=0;u<t.length;u++){const f=t[u];if(f===`
`)c=0,l-=o*r.lineHeight;else{const A=um(f,i,c,l,n);A&&(c+=A.offsetX+r.letterSpacing,a.push(A.path))}}return a}function um(s,e,n,r,t){const i=t.glyphs[s]||t.glyphs["?"];if(!i){console.error('THREE.Font: character "'+s+'" does not exists in font family '+t.familyName+".");return}const o=new Un;let a,c,l,u,f,A,d,x;if(i.o){const p=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let v=0,y=p.length;v<y;)switch(p[v++]){case"m":a=parseInt(p[v++])*e+n,c=parseInt(p[v++])*e+r,o.moveTo(a,c);break;case"l":a=parseInt(p[v++])*e+n,c=parseInt(p[v++])*e+r,o.lineTo(a,c);break;case"q":l=parseInt(p[v++])*e+n,u=parseInt(p[v++])*e+r,f=parseInt(p[v++])*e+n,A=parseInt(p[v++])*e+r,o.quadraticCurveTo(f,A,l,u);break;case"b":l=parseInt(p[v++])*e+n,u=parseInt(p[v++])*e+r,f=parseInt(p[v++])*e+n,A=parseInt(p[v++])*e+r,d=parseInt(p[v++])*e+n,x=parseInt(p[v++])*e+r,o.bezierCurveTo(f,A,d,x,l,u);break}}return{offsetX:i.ha*e,path:o}}class hm extends an{constructor(e=null,n=1,r=1,t=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:t},this.magFilter=Mt,this.minFilter=Mt,this.wrapR=vn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class fm{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const n=this.workerCreator();n.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=n}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,n){const r=this.workersResolve[e];if(r&&r(n),this.queue.length){const{resolve:t,msg:i,transfer:o}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,n){return new Promise(r=>{const t=this._getIdleWorker();t!==-1?(this._initWorker(t),this.workerStatus|=1<<t,this.workersResolve[t]=r,this.workers[t].postMessage(e,n)):this.queue.push({resolve:r,msg:e,transfer:n})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const A1=0,Bu=2,Am=0,dm=0,mm=2,pm=0,gm=0,ym=1,ol=2,vm=0,d1=1,Em=10,xm=64,m1=0,p1=9,g1=15,y1=16,v1=22,E1=37,x1=43,_1=76,C1=83,w1=97,I1=100,b1=103,B1=109,S1=165,M1=166;class _m{constructor(){this.vkFormat=m1,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=A1,this.levels=[],this.dataFormatDescriptor=[{vendorId:dm,descriptorType:Am,descriptorBlockSize:0,versionNumber:mm,colorModel:pm,colorPrimaries:d1,transferFunction:ol,flags:gm,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class ps{constructor(e,n,r,t){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+n,r),this._littleEndian=t,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),n=this._dataView.getUint32(this._offset+4,this._littleEndian),r=e+2**32*n;return this._offset+=8,r}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const n=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,n}_skip(e){return this._offset+=e,this}_scan(e,n){n===void 0&&(n=0);const r=this._offset;let t=0;for(;this._dataView.getUint8(this._offset)!==n&&t<e;)t++,this._offset++;return t<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,t)}}const gi=[171,75,84,88,32,50,48,187,13,10,26,10];function Su(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Cm(s){const e=new Uint8Array(s.buffer,s.byteOffset,gi.length);if(e[0]!==gi[0]||e[1]!==gi[1]||e[2]!==gi[2]||e[3]!==gi[3]||e[4]!==gi[4]||e[5]!==gi[5]||e[6]!==gi[6]||e[7]!==gi[7]||e[8]!==gi[8]||e[9]!==gi[9]||e[10]!==gi[10]||e[11]!==gi[11])throw new Error("Missing KTX 2.0 identifier.");const n=new _m,r=17*Uint32Array.BYTES_PER_ELEMENT,t=new ps(s,gi.length,r,!0);n.vkFormat=t._nextUint32(),n.typeSize=t._nextUint32(),n.pixelWidth=t._nextUint32(),n.pixelHeight=t._nextUint32(),n.pixelDepth=t._nextUint32(),n.layerCount=t._nextUint32(),n.faceCount=t._nextUint32();const i=t._nextUint32();n.supercompressionScheme=t._nextUint32();const o=t._nextUint32(),a=t._nextUint32(),c=t._nextUint32(),l=t._nextUint32(),u=t._nextUint64(),f=t._nextUint64(),A=i*3*8,d=new ps(s,gi.length+r,A,!0);for(let H=0;H<i;H++)n.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const x=new ps(s,o,a,!0),p={vendorId:x._skip(4)._nextUint16(),descriptorType:x._nextUint16(),versionNumber:x._nextUint16(),descriptorBlockSize:x._nextUint16(),colorModel:x._nextUint8(),colorPrimaries:x._nextUint8(),transferFunction:x._nextUint8(),flags:x._nextUint8(),texelBlockDimension:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],bytesPlane:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let H=0;H<g;H++){const T={bitOffset:x._nextUint16(),bitLength:x._nextUint8(),channelType:x._nextUint8(),samplePosition:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};T.channelType&xm?(T.sampleLower=x._nextInt32(),T.sampleUpper=x._nextInt32()):(T.sampleLower=x._nextUint32(),T.sampleUpper=x._nextUint32()),p.samples[H]=T}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(p);const m=new ps(s,c,l,!0);for(;m._offset<l;){const H=m._nextUint32(),T=m._scan(H),W=Su(T);if(n.keyValue[W]=m._nextUint8Array(H-T.byteLength-1),W.match(/^ktx/i)){const L=Su(n.keyValue[W]);n.keyValue[W]=L.substring(0,L.lastIndexOf("\0"))}const j=H%4?4-H%4:0;m._skip(j)}if(f<=0)return n;const _=new ps(s,u,f,!0),E=_._nextUint16(),C=_._nextUint16(),w=_._nextUint32(),I=_._nextUint32(),B=_._nextUint32(),S=_._nextUint32(),U=[];for(let H=0;H<i;H++)U.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const b=u+_._offset,M=b+w,D=M+I,N=D+B,G=new Uint8Array(s.buffer,s.byteOffset+b,w),q=new Uint8Array(s.buffer,s.byteOffset+M,I),X=new Uint8Array(s.buffer,s.byteOffset+D,B),O=new Uint8Array(s.buffer,s.byteOffset+N,S);return n.globalData={endpointCount:E,selectorCount:C,imageDescs:U,endpointsData:G,selectorsData:q,tablesData:X,extendedData:O},n}let gs,Sn,al;const Ka={env:{emscripten_notify_memory_growth:function(s){al=new Uint8Array(Sn.exports.memory.buffer)}}};class wm{init(){return gs||(typeof fetch<"u"?gs=fetch("data:application/wasm;base64,"+Mu).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Ka)).then(this._init):gs=WebAssembly.instantiate(Buffer.from(Mu,"base64"),Ka).then(this._init),gs)}_init(e){Sn=e.instance,Ka.env.emscripten_notify_memory_growth(0)}decode(e,n=0){if(!Sn)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,t=Sn.exports.malloc(r);al.set(e,t),n=n||Number(Sn.exports.ZSTD_findDecompressedSize(t,r));const i=Sn.exports.malloc(n),o=Sn.exports.ZSTD_decompress(i,n,t,r),a=al.slice(i,i+o);return Sn.exports.free(t),Sn.exports.free(i),a}}const Mu="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class Im extends da{constructor(e,n,r){super(void 0,e[0].width,e[0].height,n,r,Hh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class bm extends da{constructor(e,n,r,t,i,o){super(e,n,r,i,o),this.isCompressedArrayTexture=!0,this.image.depth=t,this.wrapR=vn}}var Bm=Object.defineProperty,Sm=(s,e,n)=>e in s?Bm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,po=(s,e,n)=>(Sm(s,typeof e!="symbol"?e+"":e,n),n);const T1=3e3,D1=3001,Tu="",Mm="display-p3",Tm="display-p3-linear",Dm="srgb-linear",Rl="srgb",Za=new WeakMap;let Ja=0,$a;const Pl=(()=>{const s=class extends Ks{constructor(n){super(n),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new fm,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(n){return this.transcoderPath=n,this}setWorkerLimit(n){return this.workerPool.setWorkerLimit(n),this}detectSupport(n){return this.workerConfig={astcSupported:n.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:n.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:n.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:n.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:n.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:n.extensions.has("WEBGL_compressed_texture_pvrtc")||n.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},n.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const n=new Dn(this.manager);n.setPath(this.transcoderPath),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.js"),t=new Dn(this.manager);t.setPath(this.transcoderPath),t.setResponseType("arraybuffer"),t.setWithCredentials(this.withCredentials);const i=t.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([r,i]).then(([o,a])=>{const c=s.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(s.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(s.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(s.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),u})}),Ja>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ja++}return this.transcoderPending}load(n,r,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new Dn(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(n,a=>{if(Za.has(a))return Za.get(a).promise.then(r).catch(i);this._createTexture(a).then(c=>r?r(c):null).catch(i)},t,i)}_createTextureFrom(n,r){const{faces:t,width:i,height:o,format:a,type:c,error:l,dfdFlags:u}=n;if(c==="error")return Promise.reject(l);let f;if(r.faceCount===6)f=new Im(t,a,ni);else{const d=t[0].mipmaps;f=r.layerCount>1?new bm(d,i,o,r.layerCount,a,ni):new da(d,i,o,a,ni)}f.minFilter=t[0].mipmaps.length===1?Bt:wl,f.magFilter=Bt,f.generateMipmaps=!1,f.needsUpdate=!0;const A=R1(r);return"colorSpace"in f?f.colorSpace=A:f.encoding=A===Rl?D1:T1,f.premultiplyAlpha=!!(u&ym),f}async _createTexture(n,r={}){const t=Cm(new Uint8Array(n));if(t.vkFormat!==m1)return Pm(t);const i=r,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:n,taskConfig:i},[n])).then(a=>this._createTextureFrom(a.data,t));return Za.set(n,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Ja--,this}};let e=s;return po(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),po(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),po(e,"EngineFormat",{RGBAFormat:Wt,RGBA_ASTC_4x4_Format:lA,RGBA_BPTC_Format:cA,RGBA_ETC2_EAC_Format:aA,RGBA_PVRTC_4BPPV1_Format:oA,RGBA_S3TC_DXT5_Format:sA,RGB_ETC1_Format:rA,RGB_ETC2_Format:nA,RGB_PVRTC_4BPPV1_Format:iA,RGB_S3TC_DXT1_Format:tA}),po(e,"BasisWorker",function(){let n,r,t;const i=_EngineFormat,o=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(v){const y=v.data;switch(y.type){case"init":n=y.config,c(y.transcoderBinary);break;case"transcode":r.then(()=>{try{const{faces:g,buffers:m,width:_,height:E,hasAlpha:C,format:w,dfdFlags:I}=l(y.buffer);self.postMessage({type:"transcode",id:y.id,faces:g,width:_,height:E,hasAlpha:C,format:w,dfdFlags:I},m)}catch(g){console.error(g),self.postMessage({type:"error",id:y.id,error:g.message})}});break}});function c(v){r=new Promise(y=>{t={wasmBinary:v,onRuntimeInitialized:y},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(v){const y=new t.KTX2File(new Uint8Array(v));function g(){y.close(),y.delete()}if(!y.isValid())throw g(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const m=y.isUASTC()?a.UASTC_4x4:a.ETC1S,_=y.getWidth(),E=y.getHeight(),C=y.getLayers()||1,w=y.getLevels(),I=y.getFaces(),B=y.getHasAlpha(),S=y.getDFDFlags(),{transcoderFormat:U,engineFormat:b}=d(m,_,E,B);if(!_||!E||!w)throw g(),new Error("THREE.KTX2Loader:	Invalid texture");if(!y.startTranscoding())throw g(),new Error("THREE.KTX2Loader: .startTranscoding failed");const M=[],D=[];for(let N=0;N<I;N++){const G=[];for(let q=0;q<w;q++){const X=[];let O,H;for(let W=0;W<C;W++){const j=y.getImageLevelInfo(q,W,N);N===0&&q===0&&W===0&&(j.origWidth%4!==0||j.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),w>1?(O=j.origWidth,H=j.origHeight):(O=j.width,H=j.height);const L=new Uint8Array(y.getImageTranscodedSizeInBytes(q,W,0,U));if(!y.transcodeImage(L,q,W,N,U,0,-1,-1))throw g(),new Error("THREE.KTX2Loader: .transcodeImage failed.");X.push(L)}const T=p(X);G.push({data:T,width:O,height:H}),D.push(T.buffer)}M.push({mipmaps:G,width:_,height:E,format:b})}return g(),{faces:M,buffers:D,width:_,height:E,hasAlpha:B,format:b,dfdFlags:S}}const u=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],f=u.sort(function(v,y){return v.priorityETC1S-y.priorityETC1S}),A=u.sort(function(v,y){return v.priorityUASTC-y.priorityUASTC});function d(v,y,g,m){let _,E;const C=v===a.ETC1S?f:A;for(let w=0;w<C.length;w++){const I=C[w];if(n[I.if]&&I.basisFormat.includes(v)&&!(m&&I.transcoderFormat.length<2)&&!(I.needsPowerOfTwo&&!(x(y)&&x(g))))return _=I.transcoderFormat[m?1:0],E=I.engineFormat[m?1:0],{transcoderFormat:_,engineFormat:E}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),_=o.RGBA32,E=i.RGBAFormat,{transcoderFormat:_,engineFormat:E}}function x(v){return v<=2?!0:(v&v-1)===0&&v!==0}function p(v){if(v.length===1)return v[0];let y=0;for(let _=0;_<v.length;_++){const E=v[_];y+=E.byteLength}const g=new Uint8Array(y);let m=0;for(let _=0;_<v.length;_++){const E=v[_];g.set(E,m),m+=E.byteLength}return g}}),e})(),Rm=new Set([Wt,Gr,En]),ec={[B1]:Wt,[w1]:Wt,[E1]:Wt,[x1]:Wt,[b1]:Gr,[C1]:Gr,[y1]:Gr,[v1]:Gr,[I1]:En,[_1]:En,[g1]:En,[p1]:En,[M1]:mu,[S1]:mu},tc={[B1]:Tt,[w1]:zt,[E1]:ni,[x1]:ni,[b1]:Tt,[C1]:zt,[y1]:ni,[v1]:ni,[I1]:Tt,[_1]:zt,[g1]:ni,[p1]:ni,[M1]:ni,[S1]:ni};async function Pm(s){const{vkFormat:e}=s;if(ec[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;s.supercompressionScheme===Bu&&($a||($a=new Promise(async o=>{const a=new wm;await a.init(),o(a)})),n=await $a);const r=[];for(let o=0;o<s.levels.length;o++){const a=Math.max(1,s.pixelWidth>>o),c=Math.max(1,s.pixelHeight>>o),l=s.pixelDepth?Math.max(1,s.pixelDepth>>o):0,u=s.levels[o];let f;if(s.supercompressionScheme===A1)f=u.levelData;else if(s.supercompressionScheme===Bu)f=n.decode(u.levelData,u.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let A;tc[e]===Tt?A=new Float32Array(f.buffer,f.byteOffset,f.byteLength/Float32Array.BYTES_PER_ELEMENT):tc[e]===zt?A=new Uint16Array(f.buffer,f.byteOffset,f.byteLength/Uint16Array.BYTES_PER_ELEMENT):A=f,r.push({data:A,width:a,height:c,depth:l})}let t;if(Rm.has(ec[e]))t=s.pixelDepth===0?new Vn(r[0].data,s.pixelWidth,s.pixelHeight):new hm(r[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");t=new da(r,s.pixelWidth,s.pixelHeight)}t.mipmaps=r,t.type=tc[e],t.format=ec[e],t.needsUpdate=!0;const i=R1(s);return"colorSpace"in t?t.colorSpace=i:t.encoding=i===Rl?D1:T1,Promise.resolve(t)}function R1(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===d1?e.transferFunction===ol?Rl:Dm:e.colorPrimaries===Em?e.transferFunction===ol?Mm:Tm:(e.colorPrimaries===vm||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Tu)}class Qm extends Vh{constructor(e){super(e),this.type=zt}parse(e){const o=function(I,B){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(B||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(B||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(B||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(B||""))}},u=`
`,f=function(I,B,S){B=B||1024;let b=I.pos,M=-1,D=0,N="",G=String.fromCharCode.apply(null,new Uint16Array(I.subarray(b,b+128)));for(;0>(M=G.indexOf(u))&&D<B&&b<I.byteLength;)N+=G,D+=G.length,b+=128,G+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(b,b+128)));return-1<M?(I.pos+=D+M+1,N+G.slice(0,M)):!1},A=function(I){const B=/^#\?(\S+)/,S=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,b=/^\s*FORMAT=(\S+)\s*$/,M=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let N,G;for((I.pos>=I.byteLength||!(N=f(I)))&&o(1,"no header found"),(G=N.match(B))||o(3,"bad initial token"),D.valid|=1,D.programtype=G[1],D.string+=N+`
`;N=f(I),N!==!1;){if(D.string+=N+`
`,N.charAt(0)==="#"){D.comments+=N+`
`;continue}if((G=N.match(S))&&(D.gamma=parseFloat(G[1])),(G=N.match(U))&&(D.exposure=parseFloat(G[1])),(G=N.match(b))&&(D.valid|=2,D.format=G[1]),(G=N.match(M))&&(D.valid|=4,D.height=parseInt(G[1],10),D.width=parseInt(G[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2||o(3,"missing format specifier"),D.valid&4||o(3,"missing image size specifier"),D},d=function(I,B,S){const U=B;if(U<8||U>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);U!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const b=new Uint8Array(4*B*S);b.length||o(4,"unable to allocate buffer space");let M=0,D=0;const N=4*U,G=new Uint8Array(4),q=new Uint8Array(N);let X=S;for(;X>0&&D<I.byteLength;){D+4>I.byteLength&&o(1),G[0]=I[D++],G[1]=I[D++],G[2]=I[D++],G[3]=I[D++],(G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=U)&&o(3,"bad rgbe scanline format");let O=0,H;for(;O<N&&D<I.byteLength;){H=I[D++];const W=H>128;if(W&&(H-=128),(H===0||O+H>N)&&o(3,"bad scanline data"),W){const j=I[D++];for(let L=0;L<H;L++)q[O++]=j}else q.set(I.subarray(D,D+H),O),O+=H,D+=H}const T=U;for(let W=0;W<T;W++){let j=0;b[M]=q[W+j],j+=U,b[M+1]=q[W+j],j+=U,b[M+2]=q[W+j],j+=U,b[M+3]=q[W+j],M+=4}X--}return b},x=function(I,B,S,U){const b=I[B+3],M=Math.pow(2,b-128)/255;S[U+0]=I[B+0]*M,S[U+1]=I[B+1]*M,S[U+2]=I[B+2]*M,S[U+3]=1},p=function(I,B,S,U){const b=I[B+3],M=Math.pow(2,b-128)/255;S[U+0]=Hr.toHalfFloat(Math.min(I[B+0]*M,65504)),S[U+1]=Hr.toHalfFloat(Math.min(I[B+1]*M,65504)),S[U+2]=Hr.toHalfFloat(Math.min(I[B+2]*M,65504)),S[U+3]=Hr.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const y=A(v),g=y.width,m=y.height,_=d(v.subarray(v.pos),g,m);let E,C,w;switch(this.type){case Tt:w=_.length/4;const I=new Float32Array(w*4);for(let S=0;S<w;S++)x(_,S*4,I,S*4);E=I,C=Tt;break;case zt:w=_.length/4;const B=new Uint16Array(w*4);for(let S=0;S<w;S++)p(_,S*4,B,S*4);E=B,C=zt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:g,height:m,data:E,header:y.string,gamma:y.gamma,exposure:y.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,n,r,t){function i(o,a){switch(o.type){case Tt:case zt:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Bt,o.magFilter=Bt,o.generateMipmaps=!1,o.flipY=!0;break}n&&n(o,a)}return super.load(e,i,r,t)}}const ys=ha>=152;class zm extends Vh{constructor(e){super(e),this.type=zt}parse(e){const B=Math.pow(2.7182818,2.2);function S(P,V){for(var $=0,le=0;le<65536;++le)(le==0||P[le>>3]&1<<(le&7))&&(V[$++]=le);for(var he=$-1;$<65536;)V[$++]=0;return he}function U(P){for(var V=0;V<16384;V++)P[V]={},P[V].len=0,P[V].lit=0,P[V].p=null}const b={l:0,c:0,lc:0};function M(P,V,$,le,he){for(;$<P;)V=V<<8|Fe(le,he),$+=8;$-=P,b.l=V>>$&(1<<P)-1,b.c=V,b.lc=$}const D=new Array(59);function N(P){for(var V=0;V<=58;++V)D[V]=0;for(var V=0;V<65537;++V)D[P[V]]+=1;for(var $=0,V=58;V>0;--V){var le=$+D[V]>>1;D[V]=$,$=le}for(var V=0;V<65537;++V){var he=P[V];he>0&&(P[V]=he|D[he]++<<6)}}function G(P,V,$,le,he,fe,we){for(var _e=$,Ie=0,be=0;he<=fe;he++){if(_e.value-$.value>le)return!1;M(6,Ie,be,P,_e);var Be=b.l;if(Ie=b.c,be=b.lc,we[he]=Be,Be==63){if(_e.value-$.value>le)throw"Something wrong with hufUnpackEncTable";M(8,Ie,be,P,_e);var ue=b.l+6;if(Ie=b.c,be=b.lc,he+ue>fe+1)throw"Something wrong with hufUnpackEncTable";for(;ue--;)we[he++]=0;he--}else if(Be>=59){var ue=Be-59+2;if(he+ue>fe+1)throw"Something wrong with hufUnpackEncTable";for(;ue--;)we[he++]=0;he--}}N(we)}function q(P){return P&63}function X(P){return P>>6}function O(P,V,$,le){for(;V<=$;V++){var he=X(P[V]),fe=q(P[V]);if(he>>fe)throw"Invalid table entry";if(fe>14){var we=le[he>>fe-14];if(we.len)throw"Invalid table entry";if(we.lit++,we.p){var _e=we.p;we.p=new Array(we.lit);for(var Ie=0;Ie<we.lit-1;++Ie)we.p[Ie]=_e[Ie]}else we.p=new Array(1);we.p[we.lit-1]=V}else if(fe)for(var be=0,Ie=1<<14-fe;Ie>0;Ie--){var we=le[(he<<14-fe)+be];if(we.len||we.p)throw"Invalid table entry";we.len=fe,we.lit=V,be++}}return!0}const H={c:0,lc:0};function T(P,V,$,le){P=P<<8|Fe($,le),V+=8,H.c=P,H.lc=V}const W={c:0,lc:0};function j(P,V,$,le,he,fe,we,_e,Ie,be){if(P==V){le<8&&(T($,le,he,we),$=H.c,le=H.lc),le-=8;var Be=$>>le,Be=new Uint8Array([Be])[0];if(Ie.value+Be>be)return!1;for(var ue=_e[Ie.value-1];Be-- >0;)_e[Ie.value++]=ue}else if(Ie.value<be)_e[Ie.value++]=P;else return!1;W.c=$,W.lc=le}function L(P){return P&65535}function z(P){var V=L(P);return V>32767?V-65536:V}const F={a:0,b:0};function R(P,V){var $=z(P),le=z(V),he=le,fe=$+(he&1)+(he>>1),we=fe,_e=fe-he;F.a=we,F.b=_e}function Q(P,V){var $=L(P),le=L(V),he=$-(le>>1)&65535,fe=le+he-32768&65535;F.a=fe,F.b=he}function J(P,V,$,le,he,fe,we){for(var _e=we<16384,Ie=$>he?he:$,be=1,Be;be<=Ie;)be<<=1;for(be>>=1,Be=be,be>>=1;be>=1;){for(var ue=0,vt=ue+fe*(he-Be),Ne=fe*be,Ue=fe*Be,We=le*be,it=le*Be,ft,At,Pt,ii;ue<=vt;ue+=Ue){for(var dt=ue,Ri=ue+le*($-Be);dt<=Ri;dt+=it){var Et=dt+We,Ot=dt+Ne,pi=Ot+We;_e?(R(P[dt+V],P[Ot+V]),ft=F.a,Pt=F.b,R(P[Et+V],P[pi+V]),At=F.a,ii=F.b,R(ft,At),P[dt+V]=F.a,P[Et+V]=F.b,R(Pt,ii),P[Ot+V]=F.a,P[pi+V]=F.b):(Q(P[dt+V],P[Ot+V]),ft=F.a,Pt=F.b,Q(P[Et+V],P[pi+V]),At=F.a,ii=F.b,Q(ft,At),P[dt+V]=F.a,P[Et+V]=F.b,Q(Pt,ii),P[Ot+V]=F.a,P[pi+V]=F.b)}if($&be){var Ot=dt+Ne;_e?R(P[dt+V],P[Ot+V]):Q(P[dt+V],P[Ot+V]),ft=F.a,P[Ot+V]=F.b,P[dt+V]=ft}}if(he&be)for(var dt=ue,Ri=ue+le*($-Be);dt<=Ri;dt+=it){var Et=dt+We;_e?R(P[dt+V],P[Et+V]):Q(P[dt+V],P[Et+V]),ft=F.a,P[Et+V]=F.b,P[dt+V]=ft}Be=be,be>>=1}return ue}function ie(P,V,$,le,he,fe,we,_e,Ie,be){for(var Be=0,ue=0,vt=_e,Ne=Math.trunc(he.value+(fe+7)/8);he.value<Ne;)for(T(Be,ue,$,he),Be=H.c,ue=H.lc;ue>=14;){var Ue=Be>>ue-14&16383,We=V[Ue];if(We.len)ue-=We.len,j(We.lit,we,Be,ue,$,le,he,Ie,be,vt),Be=W.c,ue=W.lc;else{if(!We.p)throw"hufDecode issues";var it;for(it=0;it<We.lit;it++){for(var ft=q(P[We.p[it]]);ue<ft&&he.value<Ne;)T(Be,ue,$,he),Be=H.c,ue=H.lc;if(ue>=ft&&X(P[We.p[it]])==(Be>>ue-ft&(1<<ft)-1)){ue-=ft,j(We.p[it],we,Be,ue,$,le,he,Ie,be,vt),Be=W.c,ue=W.lc;break}}if(it==We.lit)throw"hufDecode issues"}}var At=8-fe&7;for(Be>>=At,ue-=At;ue>0;){var We=V[Be<<14-ue&16383];if(We.len)ue-=We.len,j(We.lit,we,Be,ue,$,le,he,Ie,be,vt),Be=W.c,ue=W.lc;else throw"hufDecode issues"}return!0}function Z(P,V,$,le,he,fe){var we={value:0},_e=$.value,Ie=Le(V,$),be=Le(V,$);$.value+=4;var Be=Le(V,$);if($.value+=4,Ie<0||Ie>=65537||be<0||be>=65537)throw"Something wrong with HUF_ENCSIZE";var ue=new Array(65537),vt=new Array(16384);U(vt);var Ne=le-($.value-_e);if(G(P,V,$,Ne,Ie,be,ue),Be>8*(le-($.value-_e)))throw"Something wrong with hufUncompress";O(ue,Ie,be,vt),ie(ue,vt,P,V,$,Be,be,fe,he,we)}function ee(P,V,$){for(var le=0;le<$;++le)V[le]=P[V[le]]}function ge(P){for(var V=1;V<P.length;V++){var $=P[V-1]+P[V]-128;P[V]=$}}function pe(P,V){for(var $=0,le=Math.floor((P.length+1)/2),he=0,fe=P.length-1;!(he>fe||(V[he++]=P[$++],he>fe));)V[he++]=P[le++]}function te(P){for(var V=P.byteLength,$=new Array,le=0,he=new DataView(P);V>0;){var fe=he.getInt8(le++);if(fe<0){var we=-fe;V-=we+1;for(var _e=0;_e<we;_e++)$.push(he.getUint8(le++))}else{var we=fe;V-=2;for(var Ie=he.getUint8(le++),_e=0;_e<we+1;_e++)$.push(Ie)}}return $}function ae(P,V,$,le,he,fe){var Et=new DataView(fe.buffer),we=$[P.idx[0]].width,_e=$[P.idx[0]].height,Ie=3,be=Math.floor(we/8),Be=Math.ceil(we/8),ue=Math.ceil(_e/8),vt=we-(Be-1)*8,Ne=_e-(ue-1)*8,Ue={value:0},We=new Array(Ie),it=new Array(Ie),ft=new Array(Ie),At=new Array(Ie),Pt=new Array(Ie);for(let mt=0;mt<Ie;++mt)Pt[mt]=V[P.idx[mt]],We[mt]=mt<1?0:We[mt-1]+Be*ue,it[mt]=new Float32Array(64),ft[mt]=new Uint16Array(64),At[mt]=new Uint16Array(Be*64);for(let mt=0;mt<ue;++mt){var ii=8;mt==ue-1&&(ii=Ne);var dt=8;for(let _t=0;_t<Be;++_t){_t==Be-1&&(dt=vt);for(let rt=0;rt<Ie;++rt)ft[rt].fill(0),ft[rt][0]=he[We[rt]++],de(Ue,le,ft[rt]),se(ft[rt],it[rt]),K(it[rt]);Y(it);for(let rt=0;rt<Ie;++rt)ne(it[rt],At[rt],_t*64)}let Ht=0;for(let _t=0;_t<Ie;++_t){const rt=$[P.idx[_t]].type;for(let Ci=8*mt;Ci<8*mt+ii;++Ci){Ht=Pt[_t][Ci];for(let Ni=0;Ni<be;++Ni){const qt=Ni*64+(Ci&7)*8;Et.setUint16(Ht+0*2*rt,At[_t][qt+0],!0),Et.setUint16(Ht+1*2*rt,At[_t][qt+1],!0),Et.setUint16(Ht+2*2*rt,At[_t][qt+2],!0),Et.setUint16(Ht+3*2*rt,At[_t][qt+3],!0),Et.setUint16(Ht+4*2*rt,At[_t][qt+4],!0),Et.setUint16(Ht+5*2*rt,At[_t][qt+5],!0),Et.setUint16(Ht+6*2*rt,At[_t][qt+6],!0),Et.setUint16(Ht+7*2*rt,At[_t][qt+7],!0),Ht+=8*2*rt}}if(be!=Be)for(let Ci=8*mt;Ci<8*mt+ii;++Ci){const Ni=Pt[_t][Ci]+8*be*2*rt,qt=be*64+(Ci&7)*8;for(let Ji=0;Ji<dt;++Ji)Et.setUint16(Ni+Ji*2*rt,At[_t][qt+Ji],!0)}}}for(var Ri=new Uint16Array(we),Et=new DataView(fe.buffer),Ot=0;Ot<Ie;++Ot){$[P.idx[Ot]].decoded=!0;var pi=$[P.idx[Ot]].type;if($[Ot].type==2)for(var wn=0;wn<_e;++wn){const mt=Pt[Ot][wn];for(var jt=0;jt<we;++jt)Ri[jt]=Et.getUint16(mt+jt*2*pi,!0);for(var jt=0;jt<we;++jt)Et.setFloat32(mt+jt*2*pi,ye(Ri[jt]),!0)}}}function de(P,V,$){for(var le,he=1;he<64;)le=V[P.value],le==65280?he=64:le>>8==255?he+=le&255:($[he]=le,he++),P.value++}function se(P,V){V[0]=ye(P[0]),V[1]=ye(P[1]),V[2]=ye(P[5]),V[3]=ye(P[6]),V[4]=ye(P[14]),V[5]=ye(P[15]),V[6]=ye(P[27]),V[7]=ye(P[28]),V[8]=ye(P[2]),V[9]=ye(P[4]),V[10]=ye(P[7]),V[11]=ye(P[13]),V[12]=ye(P[16]),V[13]=ye(P[26]),V[14]=ye(P[29]),V[15]=ye(P[42]),V[16]=ye(P[3]),V[17]=ye(P[8]),V[18]=ye(P[12]),V[19]=ye(P[17]),V[20]=ye(P[25]),V[21]=ye(P[30]),V[22]=ye(P[41]),V[23]=ye(P[43]),V[24]=ye(P[9]),V[25]=ye(P[11]),V[26]=ye(P[18]),V[27]=ye(P[24]),V[28]=ye(P[31]),V[29]=ye(P[40]),V[30]=ye(P[44]),V[31]=ye(P[53]),V[32]=ye(P[10]),V[33]=ye(P[19]),V[34]=ye(P[23]),V[35]=ye(P[32]),V[36]=ye(P[39]),V[37]=ye(P[45]),V[38]=ye(P[52]),V[39]=ye(P[54]),V[40]=ye(P[20]),V[41]=ye(P[22]),V[42]=ye(P[33]),V[43]=ye(P[38]),V[44]=ye(P[46]),V[45]=ye(P[51]),V[46]=ye(P[55]),V[47]=ye(P[60]),V[48]=ye(P[21]),V[49]=ye(P[34]),V[50]=ye(P[37]),V[51]=ye(P[47]),V[52]=ye(P[50]),V[53]=ye(P[56]),V[54]=ye(P[59]),V[55]=ye(P[61]),V[56]=ye(P[35]),V[57]=ye(P[36]),V[58]=ye(P[48]),V[59]=ye(P[49]),V[60]=ye(P[57]),V[61]=ye(P[58]),V[62]=ye(P[62]),V[63]=ye(P[63])}function K(P){const V=.5*Math.cos(.7853975),$=.5*Math.cos(3.14159/16),le=.5*Math.cos(3.14159/8),he=.5*Math.cos(3*3.14159/16),fe=.5*Math.cos(5*3.14159/16),we=.5*Math.cos(3*3.14159/8),_e=.5*Math.cos(7*3.14159/16);for(var Ie=new Array(4),be=new Array(4),Be=new Array(4),ue=new Array(4),vt=0;vt<8;++vt){var Ne=vt*8;Ie[0]=le*P[Ne+2],Ie[1]=we*P[Ne+2],Ie[2]=le*P[Ne+6],Ie[3]=we*P[Ne+6],be[0]=$*P[Ne+1]+he*P[Ne+3]+fe*P[Ne+5]+_e*P[Ne+7],be[1]=he*P[Ne+1]-_e*P[Ne+3]-$*P[Ne+5]-fe*P[Ne+7],be[2]=fe*P[Ne+1]-$*P[Ne+3]+_e*P[Ne+5]+he*P[Ne+7],be[3]=_e*P[Ne+1]-fe*P[Ne+3]+he*P[Ne+5]-$*P[Ne+7],Be[0]=V*(P[Ne+0]+P[Ne+4]),Be[3]=V*(P[Ne+0]-P[Ne+4]),Be[1]=Ie[0]+Ie[3],Be[2]=Ie[1]-Ie[2],ue[0]=Be[0]+Be[1],ue[1]=Be[3]+Be[2],ue[2]=Be[3]-Be[2],ue[3]=Be[0]-Be[1],P[Ne+0]=ue[0]+be[0],P[Ne+1]=ue[1]+be[1],P[Ne+2]=ue[2]+be[2],P[Ne+3]=ue[3]+be[3],P[Ne+4]=ue[3]-be[3],P[Ne+5]=ue[2]-be[2],P[Ne+6]=ue[1]-be[1],P[Ne+7]=ue[0]-be[0]}for(var Ue=0;Ue<8;++Ue)Ie[0]=le*P[16+Ue],Ie[1]=we*P[16+Ue],Ie[2]=le*P[48+Ue],Ie[3]=we*P[48+Ue],be[0]=$*P[8+Ue]+he*P[24+Ue]+fe*P[40+Ue]+_e*P[56+Ue],be[1]=he*P[8+Ue]-_e*P[24+Ue]-$*P[40+Ue]-fe*P[56+Ue],be[2]=fe*P[8+Ue]-$*P[24+Ue]+_e*P[40+Ue]+he*P[56+Ue],be[3]=_e*P[8+Ue]-fe*P[24+Ue]+he*P[40+Ue]-$*P[56+Ue],Be[0]=V*(P[Ue]+P[32+Ue]),Be[3]=V*(P[Ue]-P[32+Ue]),Be[1]=Ie[0]+Ie[3],Be[2]=Ie[1]-Ie[2],ue[0]=Be[0]+Be[1],ue[1]=Be[3]+Be[2],ue[2]=Be[3]-Be[2],ue[3]=Be[0]-Be[1],P[0+Ue]=ue[0]+be[0],P[8+Ue]=ue[1]+be[1],P[16+Ue]=ue[2]+be[2],P[24+Ue]=ue[3]+be[3],P[32+Ue]=ue[3]-be[3],P[40+Ue]=ue[2]-be[2],P[48+Ue]=ue[1]-be[1],P[56+Ue]=ue[0]-be[0]}function Y(P){for(var V=0;V<64;++V){var $=P[0][V],le=P[1][V],he=P[2][V];P[0][V]=$+1.5747*he,P[1][V]=$-.1873*le-.4682*he,P[2][V]=$+1.8556*le}}function ne(P,V,$){for(var le=0;le<64;++le)V[$+le]=Hr.toHalfFloat(ve(P[le]))}function ve(P){return P<=1?Math.sign(P)*Math.pow(Math.abs(P),2.2):Math.sign(P)*Math.pow(B,Math.abs(P)-1)}function Ee(P){return new DataView(P.array.buffer,P.offset.value,P.size)}function Ce(P){var V=P.viewer.buffer.slice(P.offset.value,P.offset.value+P.size),$=new Uint8Array(te(V)),le=new Uint8Array($.length);return ge($),pe($,le),new DataView(le.buffer)}function xe(P){var V=P.array.slice(P.offset.value,P.offset.value+P.size),$=ao(V),le=new Uint8Array($.length);return ge($),pe($,le),new DataView(le.buffer)}function Oe(P){for(var V=P.viewer,$={value:P.offset.value},le=new Uint16Array(P.width*P.scanlineBlockSize*(P.channels*P.type)),he=new Uint8Array(8192),fe=0,we=new Array(P.channels),_e=0;_e<P.channels;_e++)we[_e]={},we[_e].start=fe,we[_e].end=we[_e].start,we[_e].nx=P.width,we[_e].ny=P.lines,we[_e].size=P.type,fe+=we[_e].nx*we[_e].ny*we[_e].size;var Ie=tt(V,$),be=tt(V,$);if(be>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Ie<=be)for(var _e=0;_e<be-Ie+1;_e++)he[_e+Ie]=ct(V,$);var Be=new Uint16Array(65536),ue=S(he,Be),vt=Le(V,$);Z(P.array,V,$,vt,le,fe);for(var _e=0;_e<P.channels;++_e)for(var Ne=we[_e],Ue=0;Ue<we[_e].size;++Ue)J(le,Ne.start+Ue,Ne.nx,Ne.size,Ne.ny,Ne.nx*Ne.size,ue);ee(Be,le,fe);for(var We=0,it=new Uint8Array(le.buffer.byteLength),ft=0;ft<P.lines;ft++)for(var At=0;At<P.channels;At++){var Ne=we[At],Pt=Ne.nx*Ne.size,ii=new Uint8Array(le.buffer,Ne.end*2,Pt*2);it.set(ii,We),We+=Pt*2,Ne.end+=Pt}return new DataView(it.buffer)}function De(P){var V=P.array.slice(P.offset.value,P.offset.value+P.size),$=ao(V);const le=P.lines*P.channels*P.width,he=P.type==1?new Uint16Array(le):new Uint32Array(le);let fe=0,we=0;const _e=new Array(4);for(let Ie=0;Ie<P.lines;Ie++)for(let be=0;be<P.channels;be++){let Be=0;switch(P.type){case 1:_e[0]=fe,_e[1]=_e[0]+P.width,fe=_e[1]+P.width;for(let ue=0;ue<P.width;++ue){const vt=$[_e[0]++]<<8|$[_e[1]++];Be+=vt,he[we]=Be,we++}break;case 2:_e[0]=fe,_e[1]=_e[0]+P.width,_e[2]=_e[1]+P.width,fe=_e[2]+P.width;for(let ue=0;ue<P.width;++ue){const vt=$[_e[0]++]<<24|$[_e[1]++]<<16|$[_e[2]++]<<8;Be+=vt,he[we]=Be,we++}break}}return new DataView(he.buffer)}function Re(P){var V=P.viewer,$={value:P.offset.value},le=new Uint8Array(P.width*P.lines*(P.channels*P.type*2)),he={version:$e(V,$),unknownUncompressedSize:$e(V,$),unknownCompressedSize:$e(V,$),acCompressedSize:$e(V,$),dcCompressedSize:$e(V,$),rleCompressedSize:$e(V,$),rleUncompressedSize:$e(V,$),rleRawSize:$e(V,$),totalAcUncompressedCount:$e(V,$),totalDcUncompressedCount:$e(V,$),acCompression:$e(V,$)};if(he.version<2)throw"EXRLoader.parse: "+Di.compression+" version "+he.version+" is unsupported";for(var fe=new Array,we=tt(V,$)-2;we>0;){var _e=Pe(V.buffer,$),Ie=ct(V,$),be=Ie>>2&3,Be=(Ie>>4)-1,ue=new Int8Array([Be])[0],vt=ct(V,$);fe.push({name:_e,index:ue,type:vt,compression:be}),we-=_e.length+3}for(var Ne=Di.channels,Ue=new Array(P.channels),We=0;We<P.channels;++We){var it=Ue[We]={},ft=Ne[We];it.name=ft.name,it.compression=0,it.decoded=!1,it.type=ft.pixelType,it.pLinear=ft.pLinear,it.width=P.width,it.height=P.lines}for(var At={idx:new Array(3)},Pt=0;Pt<P.channels;++Pt)for(var it=Ue[Pt],We=0;We<fe.length;++We){var ii=fe[We];it.name==ii.name&&(it.compression=ii.compression,ii.index>=0&&(At.idx[ii.index]=Pt),it.offset=Pt)}if(he.acCompressedSize>0)switch(he.acCompression){case 0:var Et=new Uint16Array(he.totalAcUncompressedCount);Z(P.array,V,$,he.acCompressedSize,Et,he.totalAcUncompressedCount);break;case 1:var dt=P.array.slice($.value,$.value+he.totalAcUncompressedCount),Ri=ao(dt),Et=new Uint16Array(Ri.buffer);$.value+=he.totalAcUncompressedCount;break}if(he.dcCompressedSize>0){var Ot={array:P.array,offset:$,size:he.dcCompressedSize},pi=new Uint16Array(xe(Ot).buffer);$.value+=he.dcCompressedSize}if(he.rleRawSize>0){var dt=P.array.slice($.value,$.value+he.rleCompressedSize),Ri=ao(dt),wn=te(Ri.buffer);$.value+=he.rleCompressedSize}for(var jt=0,mt=new Array(Ue.length),We=0;We<mt.length;++We)mt[We]=new Array;for(var Ht=0;Ht<P.lines;++Ht)for(var _t=0;_t<Ue.length;++_t)mt[_t].push(jt),jt+=Ue[_t].width*P.type*2;ae(At,mt,Ue,Et,pi,le);for(var We=0;We<Ue.length;++We){var it=Ue[We];if(!it.decoded)switch(it.compression){case 2:for(var rt=0,Ci=0,Ht=0;Ht<P.lines;++Ht){for(var Ni=mt[We][rt],qt=0;qt<it.width;++qt){for(var Ji=0;Ji<2*it.type;++Ji)le[Ni++]=wn[Ci+Ji*it.width*it.height];Ci++}rt++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(le.buffer)}function Pe(P,V){for(var $=new Uint8Array(P),le=0;$[V.value+le]!=0;)le+=1;var he=new TextDecoder().decode($.slice(V.value,V.value+le));return V.value=V.value+le+1,he}function ke(P,V,$){var le=new TextDecoder().decode(new Uint8Array(P).slice(V.value,V.value+$));return V.value=V.value+$,le}function Ke(P,V){var $=He(P,V),le=Le(P,V);return[$,le]}function ot(P,V){var $=Le(P,V),le=Le(P,V);return[$,le]}function He(P,V){var $=P.getInt32(V.value,!0);return V.value=V.value+4,$}function Le(P,V){var $=P.getUint32(V.value,!0);return V.value=V.value+4,$}function Fe(P,V){var $=P[V.value];return V.value=V.value+1,$}function ct(P,V){var $=P.getUint8(V.value);return V.value=V.value+1,$}const $e=function(P,V){let $;return"getBigInt64"in DataView.prototype?$=Number(P.getBigInt64(V.value,!0)):$=P.getUint32(V.value+4,!0)+Number(P.getUint32(V.value,!0)<<32),V.value+=8,$};function Ze(P,V){var $=P.getFloat32(V.value,!0);return V.value+=4,$}function lt(P,V){return Hr.toHalfFloat(Ze(P,V))}function ye(P){var V=(P&31744)>>10,$=P&1023;return(P>>15?-1:1)*(V?V===31?$?NaN:1/0:Math.pow(2,V-15)*(1+$/1024):6103515625e-14*($/1024))}function tt(P,V){var $=P.getUint16(V.value,!0);return V.value+=2,$}function hi(P,V){return ye(tt(P,V))}function gt(P,V,$,le){for(var he=$.value,fe=[];$.value<he+le-1;){var we=Pe(V,$),_e=He(P,$),Ie=ct(P,$);$.value+=3;var be=He(P,$),Be=He(P,$);fe.push({name:we,pixelType:_e,pLinear:Ie,xSampling:be,ySampling:Be})}return $.value+=1,fe}function at(P,V){var $=Ze(P,V),le=Ze(P,V),he=Ze(P,V),fe=Ze(P,V),we=Ze(P,V),_e=Ze(P,V),Ie=Ze(P,V),be=Ze(P,V);return{redX:$,redY:le,greenX:he,greenY:fe,blueX:we,blueY:_e,whiteX:Ie,whiteY:be}}function Ft(P,V){var $=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],le=ct(P,V);return $[le]}function wt(P,V){var $=Le(P,V),le=Le(P,V),he=Le(P,V),fe=Le(P,V);return{xMin:$,yMin:le,xMax:he,yMax:fe}}function Je(P,V){var $=["INCREASING_Y"],le=ct(P,V);return $[le]}function It(P,V){var $=Ze(P,V),le=Ze(P,V);return[$,le]}function ri(P,V){var $=Ze(P,V),le=Ze(P,V),he=Ze(P,V);return[$,le,he]}function ei(P,V,$,le,he){if(le==="string"||le==="stringvector"||le==="iccProfile")return ke(V,$,he);if(le==="chlist")return gt(P,V,$,he);if(le==="chromaticities")return at(P,$);if(le==="compression")return Ft(P,$);if(le==="box2i")return wt(P,$);if(le==="lineOrder")return Je(P,$);if(le==="float")return Ze(P,$);if(le==="v2f")return It(P,$);if(le==="v3f")return ri(P,$);if(le==="int")return He(P,$);if(le==="rational")return Ke(P,$);if(le==="timecode")return ot(P,$);if(le==="preview")return $.value+=he,"skipped";$.value+=he}function Lt(P,V,$){const le={};if(P.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";le.version=P.getUint8(4);const he=P.getUint8(5);le.spec={singleTile:!!(he&2),longName:!!(he&4),deepFormat:!!(he&8),multiPart:!!(he&16)},$.value=8;for(var fe=!0;fe;){var we=Pe(V,$);if(we==0)fe=!1;else{var _e=Pe(V,$),Ie=Le(P,$),be=ei(P,V,$,_e,Ie);be===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${_e}'.`):le[we]=be}}if((he&-5)!=0)throw console.error("EXRHeader:",le),"THREE.EXRLoader: provided file is currently unsupported.";return le}function Mi(P,V,$,le,he){const fe={size:0,viewer:V,array:$,offset:le,width:P.dataWindow.xMax-P.dataWindow.xMin+1,height:P.dataWindow.yMax-P.dataWindow.yMin+1,channels:P.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:P.channels[0].pixelType,uncompress:null,getter:null,format:null,[ys?"colorSpace":"encoding"]:null};switch(P.compression){case"NO_COMPRESSION":fe.lines=1,fe.uncompress=Ee;break;case"RLE_COMPRESSION":fe.lines=1,fe.uncompress=Ce;break;case"ZIPS_COMPRESSION":fe.lines=1,fe.uncompress=xe;break;case"ZIP_COMPRESSION":fe.lines=16,fe.uncompress=xe;break;case"PIZ_COMPRESSION":fe.lines=32,fe.uncompress=Oe;break;case"PXR24_COMPRESSION":fe.lines=16,fe.uncompress=De;break;case"DWAA_COMPRESSION":fe.lines=32,fe.uncompress=Re;break;case"DWAB_COMPRESSION":fe.lines=256,fe.uncompress=Re;break;default:throw"EXRLoader.parse: "+P.compression+" is unsupported"}if(fe.scanlineBlockSize=fe.lines,fe.type==1)switch(he){case Tt:fe.getter=hi,fe.inputSize=2;break;case zt:fe.getter=tt,fe.inputSize=2;break}else if(fe.type==2)switch(he){case Tt:fe.getter=Ze,fe.inputSize=4;break;case zt:fe.getter=lt,fe.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+fe.type+" for "+P.compression+".";fe.blockCount=(P.dataWindow.yMax+1)/fe.scanlineBlockSize;for(var we=0;we<fe.blockCount;we++)$e(V,le);fe.outputChannels=fe.channels==3?4:fe.channels;const _e=fe.width*fe.height*fe.outputChannels;switch(he){case Tt:fe.byteArray=new Float32Array(_e),fe.channels<fe.outputChannels&&fe.byteArray.fill(1,0,_e);break;case zt:fe.byteArray=new Uint16Array(_e),fe.channels<fe.outputChannels&&fe.byteArray.fill(15360,0,_e);break;default:console.error("THREE.EXRLoader: unsupported type: ",he);break}return fe.bytesPerLine=fe.width*fe.inputSize*fe.channels,fe.outputChannels==4?fe.format=Wt:fe.format=En,ys?fe.colorSpace="srgb-linear":fe.encoding=3e3,fe}const Ti=new DataView(e),Zi=new Uint8Array(e),_i={value:0},Di=Lt(Ti,e,_i),qe=Mi(Di,Ti,Zi,_i,this.type),ti={value:0},Cn={R:0,G:1,B:2,A:3,Y:0};for(let P=0;P<qe.height/qe.scanlineBlockSize;P++){const V=Le(Ti,_i);qe.size=Le(Ti,_i),qe.lines=V+qe.scanlineBlockSize>qe.height?qe.height-V:qe.scanlineBlockSize;const le=qe.size<qe.lines*qe.bytesPerLine?qe.uncompress(qe):Ee(qe);_i.value+=qe.size;for(let he=0;he<qe.scanlineBlockSize;he++){const fe=he+P*qe.scanlineBlockSize;if(fe>=qe.height)break;for(let we=0;we<qe.channels;we++){const _e=Cn[Di.channels[we].name];for(let Ie=0;Ie<qe.width;Ie++){ti.value=(he*(qe.channels*qe.width)+we*qe.width+Ie)*qe.inputSize;const be=(qe.height-1-fe)*(qe.width*qe.outputChannels)+Ie*qe.outputChannels+_e;qe.byteArray[be]=qe.getter(le,ti)}}}}return{header:Di,width:qe.width,height:qe.height,data:qe.byteArray,format:qe.format,[ys?"colorSpace":"encoding"]:qe[ys?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,r,t){function i(o,a){ys?o.colorSpace=a.colorSpace:o.encoding=a.encoding,o.minFilter=Bt,o.magFilter=Bt,o.generateMipmaps=!1,o.flipY=!1,n&&n(o,a)}return super.load(e,i,r,t)}}const Fm="srgb",ic=(()=>{class s extends Ks{constructor(n){super(n),this.defaultDPI=90,this.defaultUnit="px"}load(n,r,t,i){const o=this,a=new Dn(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(n,function(c){try{r(o.parse(c))}catch(l){i?i(l):console.error(l),o.manager.itemError(n)}},t,i)}parse(n){const r=this;function t(z,F){if(z.nodeType!==1)return;const R=E(z);let Q=!1,J=null;switch(z.nodeName){case"svg":F=p(z,F);break;case"style":o(z);break;case"g":F=p(z,F);break;case"path":F=p(z,F),z.hasAttribute("d")&&(J=i(z));break;case"rect":F=p(z,F),J=l(z);break;case"polygon":F=p(z,F),J=u(z);break;case"polyline":F=p(z,F),J=f(z);break;case"circle":F=p(z,F),J=A(z);break;case"ellipse":F=p(z,F),J=d(z);break;case"line":F=p(z,F),J=x(z);break;case"defs":Q=!0;break;case"use":F=p(z,F);const ee=(z.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),ge=z.viewportElement.getElementById(ee);ge?t(ge,F):console.warn("SVGLoader: 'use node' references non-existent node id: "+ee);break}J&&(F.fill!==void 0&&F.fill!=="none"&&J.color.setStyle(F.fill,Fm),w(J,W),M.push(J),J.userData={node:z,style:F});const ie=z.childNodes;for(let Z=0;Z<ie.length;Z++){const ee=ie[Z];Q&&ee.nodeName!=="style"&&ee.nodeName!=="defs"||t(ee,F)}R&&(N.pop(),N.length>0?W.copy(N[N.length-1]):W.identity())}function i(z){const F=new Un,R=new Te,Q=new Te,J=new Te;let ie=!0,Z=!1;const ee=z.getAttribute("d");if(ee===""||ee==="none")return null;const ge=ee.match(/[a-df-z][^a-df-z]*/gi);for(let pe=0,te=ge.length;pe<te;pe++){const ae=ge[pe],de=ae.charAt(0),se=ae.slice(1).trim();ie===!0&&(Z=!0,ie=!1);let K;switch(de){case"M":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2)R.x=K[Y+0],R.y=K[Y+1],Q.x=R.x,Q.y=R.y,Y===0?F.moveTo(R.x,R.y):F.lineTo(R.x,R.y),Y===0&&J.copy(R);break;case"H":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y++)R.x=K[Y],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"V":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y++)R.y=K[Y],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"L":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2)R.x=K[Y+0],R.y=K[Y+1],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"C":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=6)F.bezierCurveTo(K[Y+0],K[Y+1],K[Y+2],K[Y+3],K[Y+4],K[Y+5]),Q.x=K[Y+2],Q.y=K[Y+3],R.x=K[Y+4],R.y=K[Y+5],Y===0&&Z===!0&&J.copy(R);break;case"S":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=4)F.bezierCurveTo(v(R.x,Q.x),v(R.y,Q.y),K[Y+0],K[Y+1],K[Y+2],K[Y+3]),Q.x=K[Y+0],Q.y=K[Y+1],R.x=K[Y+2],R.y=K[Y+3],Y===0&&Z===!0&&J.copy(R);break;case"Q":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=4)F.quadraticCurveTo(K[Y+0],K[Y+1],K[Y+2],K[Y+3]),Q.x=K[Y+0],Q.y=K[Y+1],R.x=K[Y+2],R.y=K[Y+3],Y===0&&Z===!0&&J.copy(R);break;case"T":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2){const ve=v(R.x,Q.x),Ee=v(R.y,Q.y);F.quadraticCurveTo(ve,Ee,K[Y+0],K[Y+1]),Q.x=ve,Q.y=Ee,R.x=K[Y+0],R.y=K[Y+1],Y===0&&Z===!0&&J.copy(R)}break;case"A":K=y(se,[3,4],7);for(let Y=0,ne=K.length;Y<ne;Y+=7){if(K[Y+5]==R.x&&K[Y+6]==R.y)continue;const ve=R.clone();R.x=K[Y+5],R.y=K[Y+6],Q.x=R.x,Q.y=R.y,a(F,K[Y],K[Y+1],K[Y+2],K[Y+3],K[Y+4],ve,R),Y===0&&Z===!0&&J.copy(R)}break;case"m":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2)R.x+=K[Y+0],R.y+=K[Y+1],Q.x=R.x,Q.y=R.y,Y===0?F.moveTo(R.x,R.y):F.lineTo(R.x,R.y),Y===0&&J.copy(R);break;case"h":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y++)R.x+=K[Y],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"v":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y++)R.y+=K[Y],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"l":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2)R.x+=K[Y+0],R.y+=K[Y+1],Q.x=R.x,Q.y=R.y,F.lineTo(R.x,R.y),Y===0&&Z===!0&&J.copy(R);break;case"c":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=6)F.bezierCurveTo(R.x+K[Y+0],R.y+K[Y+1],R.x+K[Y+2],R.y+K[Y+3],R.x+K[Y+4],R.y+K[Y+5]),Q.x=R.x+K[Y+2],Q.y=R.y+K[Y+3],R.x+=K[Y+4],R.y+=K[Y+5],Y===0&&Z===!0&&J.copy(R);break;case"s":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=4)F.bezierCurveTo(v(R.x,Q.x),v(R.y,Q.y),R.x+K[Y+0],R.y+K[Y+1],R.x+K[Y+2],R.y+K[Y+3]),Q.x=R.x+K[Y+0],Q.y=R.y+K[Y+1],R.x+=K[Y+2],R.y+=K[Y+3],Y===0&&Z===!0&&J.copy(R);break;case"q":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=4)F.quadraticCurveTo(R.x+K[Y+0],R.y+K[Y+1],R.x+K[Y+2],R.y+K[Y+3]),Q.x=R.x+K[Y+0],Q.y=R.y+K[Y+1],R.x+=K[Y+2],R.y+=K[Y+3],Y===0&&Z===!0&&J.copy(R);break;case"t":K=y(se);for(let Y=0,ne=K.length;Y<ne;Y+=2){const ve=v(R.x,Q.x),Ee=v(R.y,Q.y);F.quadraticCurveTo(ve,Ee,R.x+K[Y+0],R.y+K[Y+1]),Q.x=ve,Q.y=Ee,R.x=R.x+K[Y+0],R.y=R.y+K[Y+1],Y===0&&Z===!0&&J.copy(R)}break;case"a":K=y(se,[3,4],7);for(let Y=0,ne=K.length;Y<ne;Y+=7){if(K[Y+5]==0&&K[Y+6]==0)continue;const ve=R.clone();R.x+=K[Y+5],R.y+=K[Y+6],Q.x=R.x,Q.y=R.y,a(F,K[Y],K[Y+1],K[Y+2],K[Y+3],K[Y+4],ve,R),Y===0&&Z===!0&&J.copy(R)}break;case"Z":case"z":F.currentPath.autoClose=!0,F.currentPath.curves.length>0&&(R.copy(J),F.currentPath.currentPoint.copy(R),ie=!0);break;default:console.warn(ae)}Z=!1}return F}function o(z){if(!(!z.sheet||!z.sheet.cssRules||!z.sheet.cssRules.length))for(let F=0;F<z.sheet.cssRules.length;F++){const R=z.sheet.cssRules[F];if(R.type!==1)continue;const Q=R.selectorText.split(/,/gm).filter(Boolean).map(J=>J.trim());for(let J=0;J<Q.length;J++){const ie=Object.fromEntries(Object.entries(R.style).filter(([,Z])=>Z!==""));D[Q[J]]=Object.assign(D[Q[J]]||{},ie)}}}function a(z,F,R,Q,J,ie,Z,ee){if(F==0||R==0){z.lineTo(ee.x,ee.y);return}Q=Q*Math.PI/180,F=Math.abs(F),R=Math.abs(R);const ge=(Z.x-ee.x)/2,pe=(Z.y-ee.y)/2,te=Math.cos(Q)*ge+Math.sin(Q)*pe,ae=-Math.sin(Q)*ge+Math.cos(Q)*pe;let de=F*F,se=R*R;const K=te*te,Y=ae*ae,ne=K/de+Y/se;if(ne>1){const Ke=Math.sqrt(ne);F=Ke*F,R=Ke*R,de=F*F,se=R*R}const ve=de*Y+se*K,Ee=(de*se-ve)/ve;let Ce=Math.sqrt(Math.max(0,Ee));J===ie&&(Ce=-Ce);const xe=Ce*F*ae/R,Oe=-Ce*R*te/F,De=Math.cos(Q)*xe-Math.sin(Q)*Oe+(Z.x+ee.x)/2,Re=Math.sin(Q)*xe+Math.cos(Q)*Oe+(Z.y+ee.y)/2,Pe=c(1,0,(te-xe)/F,(ae-Oe)/R),ke=c((te-xe)/F,(ae-Oe)/R,(-te-xe)/F,(-ae-Oe)/R)%(Math.PI*2);z.currentPath.absellipse(De,Re,F,R,Pe,Pe+ke,ie===0,Q)}function c(z,F,R,Q){const J=z*R+F*Q,ie=Math.sqrt(z*z+F*F)*Math.sqrt(R*R+Q*Q);let Z=Math.acos(Math.max(-1,Math.min(1,J/ie)));return z*Q-F*R<0&&(Z=-Z),Z}function l(z){const F=_(z.getAttribute("x")||0),R=_(z.getAttribute("y")||0),Q=_(z.getAttribute("rx")||z.getAttribute("ry")||0),J=_(z.getAttribute("ry")||z.getAttribute("rx")||0),ie=_(z.getAttribute("width")),Z=_(z.getAttribute("height")),ee=1-.551915024494,ge=new Un;return ge.moveTo(F+Q,R),ge.lineTo(F+ie-Q,R),(Q!==0||J!==0)&&ge.bezierCurveTo(F+ie-Q*ee,R,F+ie,R+J*ee,F+ie,R+J),ge.lineTo(F+ie,R+Z-J),(Q!==0||J!==0)&&ge.bezierCurveTo(F+ie,R+Z-J*ee,F+ie-Q*ee,R+Z,F+ie-Q,R+Z),ge.lineTo(F+Q,R+Z),(Q!==0||J!==0)&&ge.bezierCurveTo(F+Q*ee,R+Z,F,R+Z-J*ee,F,R+Z-J),ge.lineTo(F,R+J),(Q!==0||J!==0)&&ge.bezierCurveTo(F,R+J*ee,F+Q*ee,R,F+Q,R),ge}function u(z){function F(ie,Z,ee){const ge=_(Z),pe=_(ee);J===0?Q.moveTo(ge,pe):Q.lineTo(ge,pe),J++}const R=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Q=new Un;let J=0;return z.getAttribute("points").replace(R,F),Q.currentPath.autoClose=!0,Q}function f(z){function F(ie,Z,ee){const ge=_(Z),pe=_(ee);J===0?Q.moveTo(ge,pe):Q.lineTo(ge,pe),J++}const R=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Q=new Un;let J=0;return z.getAttribute("points").replace(R,F),Q.currentPath.autoClose=!1,Q}function A(z){const F=_(z.getAttribute("cx")||0),R=_(z.getAttribute("cy")||0),Q=_(z.getAttribute("r")||0),J=new Na;J.absarc(F,R,Q,0,Math.PI*2);const ie=new Un;return ie.subPaths.push(J),ie}function d(z){const F=_(z.getAttribute("cx")||0),R=_(z.getAttribute("cy")||0),Q=_(z.getAttribute("rx")||0),J=_(z.getAttribute("ry")||0),ie=new Na;ie.absellipse(F,R,Q,J,0,Math.PI*2);const Z=new Un;return Z.subPaths.push(ie),Z}function x(z){const F=_(z.getAttribute("x1")||0),R=_(z.getAttribute("y1")||0),Q=_(z.getAttribute("x2")||0),J=_(z.getAttribute("y2")||0),ie=new Un;return ie.moveTo(F,R),ie.lineTo(Q,J),ie.currentPath.autoClose=!1,ie}function p(z,F){F=Object.assign({},F);let R={};if(z.hasAttribute("class")){const Z=z.getAttribute("class").split(/\s/).filter(Boolean).map(ee=>ee.trim());for(let ee=0;ee<Z.length;ee++)R=Object.assign(R,D["."+Z[ee]])}z.hasAttribute("id")&&(R=Object.assign(R,D["#"+z.getAttribute("id")]));function Q(Z,ee,ge){ge===void 0&&(ge=function(te){return te.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),te}),z.hasAttribute(Z)&&(F[ee]=ge(z.getAttribute(Z))),R[Z]&&(F[ee]=ge(R[Z])),z.style&&z.style[Z]!==""&&(F[ee]=ge(z.style[Z]))}function J(Z){return Math.max(0,Math.min(1,_(Z)))}function ie(Z){return Math.max(0,_(Z))}return Q("fill","fill"),Q("fill-opacity","fillOpacity",J),Q("fill-rule","fillRule"),Q("opacity","opacity",J),Q("stroke","stroke"),Q("stroke-opacity","strokeOpacity",J),Q("stroke-width","strokeWidth",ie),Q("stroke-linejoin","strokeLineJoin"),Q("stroke-linecap","strokeLineCap"),Q("stroke-miterlimit","strokeMiterLimit",ie),Q("visibility","visibility"),F}function v(z,F){return z-(F-z)}function y(z,F,R){if(typeof z!="string")throw new TypeError("Invalid input: "+typeof z);const Q={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},J=0,ie=1,Z=2,ee=3;let ge=J,pe=!0,te="",ae="";const de=[];function se(ve,Ee,Ce){const xe=new SyntaxError('Unexpected character "'+ve+'" at index '+Ee+".");throw xe.partial=Ce,xe}function K(){te!==""&&(ae===""?de.push(Number(te)):de.push(Number(te)*Math.pow(10,Number(ae)))),te="",ae=""}let Y;const ne=z.length;for(let ve=0;ve<ne;ve++){if(Y=z[ve],Array.isArray(F)&&F.includes(de.length%R)&&Q.FLAGS.test(Y)){ge=ie,te=Y,K();continue}if(ge===J){if(Q.WHITESPACE.test(Y))continue;if(Q.DIGIT.test(Y)||Q.SIGN.test(Y)){ge=ie,te=Y;continue}if(Q.POINT.test(Y)){ge=Z,te=Y;continue}Q.COMMA.test(Y)&&(pe&&se(Y,ve,de),pe=!0)}if(ge===ie){if(Q.DIGIT.test(Y)){te+=Y;continue}if(Q.POINT.test(Y)){te+=Y,ge=Z;continue}if(Q.EXP.test(Y)){ge=ee;continue}Q.SIGN.test(Y)&&te.length===1&&Q.SIGN.test(te[0])&&se(Y,ve,de)}if(ge===Z){if(Q.DIGIT.test(Y)){te+=Y;continue}if(Q.EXP.test(Y)){ge=ee;continue}Q.POINT.test(Y)&&te[te.length-1]==="."&&se(Y,ve,de)}if(ge===ee){if(Q.DIGIT.test(Y)){ae+=Y;continue}if(Q.SIGN.test(Y)){if(ae===""){ae+=Y;continue}ae.length===1&&Q.SIGN.test(ae)&&se(Y,ve,de)}}Q.WHITESPACE.test(Y)?(K(),ge=J,pe=!1):Q.COMMA.test(Y)?(K(),ge=J,pe=!0):Q.SIGN.test(Y)?(K(),ge=ie,te=Y):Q.POINT.test(Y)?(K(),ge=Z,te=Y):se(Y,ve,de)}return K(),de}const g=["mm","cm","in","pt","pc","px"],m={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function _(z){let F="px";if(typeof z=="string"||z instanceof String)for(let Q=0,J=g.length;Q<J;Q++){const ie=g[Q];if(z.endsWith(ie)){F=ie,z=z.substring(0,z.length-ie.length);break}}let R;return F==="px"&&r.defaultUnit!=="px"?R=m.in[r.defaultUnit]/r.defaultDPI:(R=m[F][r.defaultUnit],R<0&&(R=m[F].in*r.defaultDPI)),R*parseFloat(z)}function E(z){if(!(z.hasAttribute("transform")||z.nodeName==="use"&&(z.hasAttribute("x")||z.hasAttribute("y"))))return null;const F=C(z);return N.length>0&&F.premultiply(N[N.length-1]),W.copy(F),N.push(F),F}function C(z){const F=new Ln,R=G;if(z.nodeName==="use"&&(z.hasAttribute("x")||z.hasAttribute("y"))){const Q=_(z.getAttribute("x")),J=_(z.getAttribute("y"));F.translate(Q,J)}if(z.hasAttribute("transform")){const Q=z.getAttribute("transform").split(")");for(let J=Q.length-1;J>=0;J--){const ie=Q[J].trim();if(ie==="")continue;const Z=ie.indexOf("("),ee=ie.length;if(Z>0&&Z<ee){const ge=ie.slice(0,Z),pe=y(ie.slice(Z+1));switch(R.identity(),ge){case"translate":if(pe.length>=1){const te=pe[0];let ae=0;pe.length>=2&&(ae=pe[1]),R.translate(te,ae)}break;case"rotate":if(pe.length>=1){let te=0,ae=0,de=0;te=pe[0]*Math.PI/180,pe.length>=3&&(ae=pe[1],de=pe[2]),q.makeTranslation(-ae,-de),X.makeRotation(te),O.multiplyMatrices(X,q),q.makeTranslation(ae,de),R.multiplyMatrices(q,O)}break;case"scale":if(pe.length>=1){const te=pe[0];let ae=te;pe.length>=2&&(ae=pe[1]),R.scale(te,ae)}break;case"skewX":pe.length===1&&R.set(1,Math.tan(pe[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":pe.length===1&&R.set(1,0,0,Math.tan(pe[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":pe.length===6&&R.set(pe[0],pe[2],pe[4],pe[1],pe[3],pe[5],0,0,1);break}}F.premultiply(R)}}return F}function w(z,F){function R(Z){T.set(Z.x,Z.y,1).applyMatrix3(F),Z.set(T.x,T.y)}function Q(Z){const ee=Z.xRadius,ge=Z.yRadius,pe=Math.cos(Z.aRotation),te=Math.sin(Z.aRotation),ae=new k(ee*pe,ee*te,0),de=new k(-ge*te,ge*pe,0),se=ae.applyMatrix3(F),K=de.applyMatrix3(F),Y=G.set(se.x,K.x,0,se.y,K.y,0,0,0,1),ne=q.copy(Y).invert(),Ce=X.copy(ne).transpose().multiply(ne).elements,xe=b(Ce[0],Ce[1],Ce[4]),Oe=Math.sqrt(xe.rt1),De=Math.sqrt(xe.rt2);if(Z.xRadius=1/Oe,Z.yRadius=1/De,Z.aRotation=Math.atan2(xe.sn,xe.cs),!((Z.aEndAngle-Z.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Pe=q.set(Oe,0,0,0,De,0,0,0,1),ke=X.set(xe.cs,xe.sn,0,-xe.sn,xe.cs,0,0,0,1),Ke=Pe.multiply(ke).multiply(Y),ot=He=>{const{x:Le,y:Fe}=new k(Math.cos(He),Math.sin(He),0).applyMatrix3(Ke);return Math.atan2(Fe,Le)};Z.aStartAngle=ot(Z.aStartAngle),Z.aEndAngle=ot(Z.aEndAngle),I(F)&&(Z.aClockwise=!Z.aClockwise)}}function J(Z){const ee=S(F),ge=U(F);Z.xRadius*=ee,Z.yRadius*=ge;const pe=ee>Number.EPSILON?Math.atan2(F.elements[1],F.elements[0]):Math.atan2(-F.elements[3],F.elements[4]);Z.aRotation+=pe,I(F)&&(Z.aStartAngle*=-1,Z.aEndAngle*=-1,Z.aClockwise=!Z.aClockwise)}const ie=z.subPaths;for(let Z=0,ee=ie.length;Z<ee;Z++){const pe=ie[Z].curves;for(let te=0;te<pe.length;te++){const ae=pe[te];ae.isLineCurve?(R(ae.v1),R(ae.v2)):ae.isCubicBezierCurve?(R(ae.v0),R(ae.v1),R(ae.v2),R(ae.v3)):ae.isQuadraticBezierCurve?(R(ae.v0),R(ae.v1),R(ae.v2)):ae.isEllipseCurve&&(H.set(ae.aX,ae.aY),R(H),ae.aX=H.x,ae.aY=H.y,B(F)?Q(ae):J(ae))}}}function I(z){const F=z.elements;return F[0]*F[4]-F[1]*F[3]<0}function B(z){const F=z.elements,R=F[0]*F[3]+F[1]*F[4];if(R===0)return!1;const Q=S(z),J=U(z);return Math.abs(R/(Q*J))>Number.EPSILON}function S(z){const F=z.elements;return Math.sqrt(F[0]*F[0]+F[1]*F[1])}function U(z){const F=z.elements;return Math.sqrt(F[3]*F[3]+F[4]*F[4])}function b(z,F,R){let Q,J,ie,Z,ee;const ge=z+R,pe=z-R,te=Math.sqrt(pe*pe+4*F*F);return ge>0?(Q=.5*(ge+te),ee=1/Q,J=z*ee*R-F*ee*F):ge<0?J=.5*(ge-te):(Q=.5*te,J=-.5*te),pe>0?ie=pe+te:ie=pe-te,Math.abs(ie)>2*Math.abs(F)?(ee=-2*F/ie,Z=1/Math.sqrt(1+ee*ee),ie=ee*Z):Math.abs(F)===0?(ie=1,Z=0):(ee=-.5*ie/F,ie=1/Math.sqrt(1+ee*ee),Z=ee*ie),pe>0&&(ee=ie,ie=-Z,Z=ee),{rt1:Q,rt2:J,cs:ie,sn:Z}}const M=[],D={},N=[],G=new Ln,q=new Ln,X=new Ln,O=new Ln,H=new Te,T=new k,W=new Ln,j=new DOMParser().parseFromString(n,"image/svg+xml");return t(j.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:M,xml:j.documentElement}}static createShapes(n){const t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:t.ORIGIN,t:0};function o(v,y,g,m){const _=v.x,E=y.x,C=g.x,w=m.x,I=v.y,B=y.y,S=g.y,U=m.y,b=(w-C)*(I-S)-(U-S)*(_-C),M=(E-_)*(I-S)-(B-I)*(_-C),D=(U-S)*(E-_)-(w-C)*(B-I),N=b/D,G=M/D;if(D===0&&b!==0||N<=0||N>=1||G<0||G>1)return null;if(b===0&&D===0){for(let q=0;q<2;q++)if(a(q===0?g:m,v,y),i.loc==t.ORIGIN){const X=q===0?g:m;return{x:X.x,y:X.y,t:i.t}}else if(i.loc==t.BETWEEN){const X=+(_+i.t*(E-_)).toPrecision(10),O=+(I+i.t*(B-I)).toPrecision(10);return{x:X,y:O,t:i.t}}return null}else{for(let O=0;O<2;O++)if(a(O===0?g:m,v,y),i.loc==t.ORIGIN){const H=O===0?g:m;return{x:H.x,y:H.y,t:i.t}}const q=+(_+N*(E-_)).toPrecision(10),X=+(I+N*(B-I)).toPrecision(10);return{x:q,y:X,t:N}}}function a(v,y,g){const m=g.x-y.x,_=g.y-y.y,E=v.x-y.x,C=v.y-y.y,w=m*C-E*_;if(v.x===y.x&&v.y===y.y){i.loc=t.ORIGIN,i.t=0;return}if(v.x===g.x&&v.y===g.y){i.loc=t.DESTINATION,i.t=1;return}if(w<-Number.EPSILON){i.loc=t.LEFT;return}if(w>Number.EPSILON){i.loc=t.RIGHT;return}if(m*E<0||_*C<0){i.loc=t.BEHIND;return}if(Math.sqrt(m*m+_*_)<Math.sqrt(E*E+C*C)){i.loc=t.BEYOND;return}let I;m!==0?I=E/m:I=C/_,i.loc=t.BETWEEN,i.t=I}function c(v,y){const g=[],m=[];for(let _=1;_<v.length;_++){const E=v[_-1],C=v[_];for(let w=1;w<y.length;w++){const I=y[w-1],B=y[w],S=o(E,C,I,B);S!==null&&g.find(U=>U.t<=S.t+Number.EPSILON&&U.t>=S.t-Number.EPSILON)===void 0&&(g.push(S),m.push(new Te(S.x,S.y)))}}return m}function l(v,y,g){const m=new Te;y.getCenter(m);const _=[];return g.forEach(E=>{E.boundingBox.containsPoint(m)&&c(v,E.points).forEach(w=>{_.push({identifier:E.identifier,isCW:E.isCW,point:w})})}),_.sort((E,C)=>E.point.x-C.point.x),_}function u(v,y,g,m,_){(_==null||_==="")&&(_="nonzero");const E=new Te;v.boundingBox.getCenter(E);const C=[new Te(g,E.y),new Te(m,E.y)],w=l(C,v.boundingBox,y);w.sort((M,D)=>M.point.x-D.point.x);const I=[],B=[];w.forEach(M=>{M.identifier===v.identifier?I.push(M):B.push(M)});const S=I[0].point.x,U=[];let b=0;for(;b<B.length&&B[b].point.x<S;)U.length>0&&U[U.length-1]===B[b].identifier?U.pop():U.push(B[b].identifier),b++;if(U.push(v.identifier),_==="evenodd"){const M=U.length%2===0,D=U[U.length-2];return{identifier:v.identifier,isHole:M,for:D}}else if(_==="nonzero"){let M=!0,D=null,N=null;for(let G=0;G<U.length;G++){const q=U[G];M?(N=y[q].isCW,M=!1,D=q):N!==y[q].isCW&&(N=y[q].isCW,M=!0)}return{identifier:v.identifier,isHole:M,for:D}}else console.warn('fill-rule: "'+_+'" is currently not implemented.')}let f=999999999,A=-999999999,d=n.subPaths.map(v=>{const y=v.getPoints();let g=-999999999,m=999999999,_=-999999999,E=999999999;for(let C=0;C<y.length;C++){const w=y[C];w.y>g&&(g=w.y),w.y<m&&(m=w.y),w.x>_&&(_=w.x),w.x<E&&(E=w.x)}return A<=_&&(A=_+1),f>=E&&(f=E-1),{curves:v.curves,points:y,isCW:hA.isClockWise(y),identifier:-1,boundingBox:new uA(new Te(E,m),new Te(_,g))}});d=d.filter(v=>v.points.length>1);for(let v=0;v<d.length;v++)d[v].identifier=v;const x=d.map(v=>u(v,d,f,A,n.userData?n.userData.style.fillRule:void 0)),p=[];return d.forEach(v=>{if(!x[v.identifier].isHole){const g=new Wh;g.curves=v.curves,x.filter(_=>_.isHole&&_.for===v.identifier).forEach(_=>{const E=d[_.identifier],C=new Na;C.curves=E.curves,g.holes.push(C)}),p.push(g)}}),p}static getStrokeStyle(n,r,t,i,o){return n=n!==void 0?n:1,r=r!==void 0?r:"#000",t=t!==void 0?t:"miter",i=i!==void 0?i:"butt",o=o!==void 0?o:4,{strokeColor:r,strokeWidth:n,strokeLineJoin:t,strokeLineCap:i,strokeMiterLimit:o}}static pointsToStroke(n,r,t,i){const o=[],a=[],c=[];if(s.pointsToStrokeWithBuffers(n,r,t,i,o,a,c)===0)return null;const l=new ki;return l.setAttribute("position",new Ki(o,3)),l.setAttribute("normal",new Ki(a,3)),l.setAttribute("uv",new Ki(c,2)),l}static pointsToStrokeWithBuffers(n,r,t,i,o,a,c,l){const u=new Te,f=new Te,A=new Te,d=new Te,x=new Te,p=new Te,v=new Te,y=new Te,g=new Te,m=new Te,_=new Te,E=new Te,C=new Te,w=new Te,I=new Te,B=new Te,S=new Te;t=t!==void 0?t:12,i=i!==void 0?i:.001,l=l!==void 0?l:0,n=pe(n);const U=n.length;if(U<2)return 0;const b=n[0].equals(n[U-1]);let M,D=n[0],N;const G=r.strokeWidth/2,q=1/(U-1);let X=0,O,H,T,W,j=!1,L=0,z=l*3,F=l*2;R(n[0],n[1],u).multiplyScalar(G),y.copy(n[0]).sub(u),g.copy(n[0]).add(u),m.copy(y),_.copy(g);for(let te=1;te<U;te++){M=n[te],te===U-1?b?N=n[1]:N=void 0:N=n[te+1];const ae=u;if(R(D,M,ae),A.copy(ae).multiplyScalar(G),E.copy(M).sub(A),C.copy(M).add(A),O=X+q,H=!1,N!==void 0){R(M,N,f),A.copy(f).multiplyScalar(G),w.copy(M).sub(A),I.copy(M).add(A),T=!0,A.subVectors(N,D),ae.dot(A)<0&&(T=!1),te===1&&(j=T),A.subVectors(N,M),A.normalize();const de=Math.abs(ae.dot(A));if(de>Number.EPSILON){const se=G/de;A.multiplyScalar(-se),d.subVectors(M,D),x.copy(d).setLength(se).add(A),B.copy(x).negate();const K=x.length(),Y=d.length();d.divideScalar(Y),p.subVectors(N,M);const ne=p.length();switch(p.divideScalar(ne),d.dot(B)<Y&&p.dot(B)<ne&&(H=!0),S.copy(x).add(M),B.add(M),W=!1,H?T?(I.copy(B),C.copy(B)):(w.copy(B),E.copy(B)):ie(),r.strokeLineJoin){case"bevel":Z(T,H,O);break;case"round":ee(T,H),T?J(M,E,w,O,0):J(M,I,C,O,1);break;case"miter":case"miter-clip":default:const ve=G*r.strokeMiterLimit/K;if(ve<1)if(r.strokeLineJoin!=="miter-clip"){Z(T,H,O);break}else ee(T,H),T?(p.subVectors(S,E).multiplyScalar(ve).add(E),v.subVectors(S,w).multiplyScalar(ve).add(w),Q(E,O,0),Q(p,O,0),Q(M,O,.5),Q(M,O,.5),Q(p,O,0),Q(v,O,0),Q(M,O,.5),Q(v,O,0),Q(w,O,0)):(p.subVectors(S,C).multiplyScalar(ve).add(C),v.subVectors(S,I).multiplyScalar(ve).add(I),Q(C,O,1),Q(p,O,1),Q(M,O,.5),Q(M,O,.5),Q(p,O,1),Q(v,O,1),Q(M,O,.5),Q(v,O,1),Q(I,O,1));else H?(T?(Q(g,X,1),Q(y,X,0),Q(S,O,0),Q(g,X,1),Q(S,O,0),Q(B,O,1)):(Q(g,X,1),Q(y,X,0),Q(S,O,1),Q(y,X,0),Q(B,O,0),Q(S,O,1)),T?w.copy(S):I.copy(S)):T?(Q(E,O,0),Q(S,O,0),Q(M,O,.5),Q(M,O,.5),Q(S,O,0),Q(w,O,0)):(Q(C,O,1),Q(S,O,1),Q(M,O,.5),Q(M,O,.5),Q(S,O,1),Q(I,O,1)),W=!0;break}}else ie()}else ie();!b&&te===U-1&&ge(n[0],m,_,T,!0,X),X=O,D=M,y.copy(w),g.copy(I)}if(!b)ge(M,E,C,T,!1,O);else if(H&&o){let te=S,ae=B;j!==T&&(te=B,ae=S),T?(W||j)&&(ae.toArray(o,0*3),ae.toArray(o,3*3),W&&te.toArray(o,1*3)):(W||!j)&&(ae.toArray(o,1*3),ae.toArray(o,3*3),W&&te.toArray(o,0*3))}return L;function R(te,ae,de){return de.subVectors(ae,te),de.set(-de.y,de.x).normalize()}function Q(te,ae,de){o&&(o[z]=te.x,o[z+1]=te.y,o[z+2]=0,a&&(a[z]=0,a[z+1]=0,a[z+2]=1),z+=3,c&&(c[F]=ae,c[F+1]=de,F+=2)),L+=3}function J(te,ae,de,se,K){u.copy(ae).sub(te).normalize(),f.copy(de).sub(te).normalize();let Y=Math.PI;const ne=u.dot(f);Math.abs(ne)<1&&(Y=Math.abs(Math.acos(ne))),Y/=t,A.copy(ae);for(let ve=0,Ee=t-1;ve<Ee;ve++)d.copy(A).rotateAround(te,Y),Q(A,se,K),Q(d,se,K),Q(te,se,.5),A.copy(d);Q(d,se,K),Q(de,se,K),Q(te,se,.5)}function ie(){Q(g,X,1),Q(y,X,0),Q(E,O,0),Q(g,X,1),Q(E,O,0),Q(C,O,1)}function Z(te,ae,de){ae?te?(Q(g,X,1),Q(y,X,0),Q(E,O,0),Q(g,X,1),Q(E,O,0),Q(B,O,1),Q(E,de,0),Q(w,de,0),Q(B,de,.5)):(Q(g,X,1),Q(y,X,0),Q(C,O,1),Q(y,X,0),Q(B,O,0),Q(C,O,1),Q(C,de,1),Q(B,de,0),Q(I,de,1)):te?(Q(E,de,0),Q(w,de,0),Q(M,de,.5)):(Q(C,de,1),Q(I,de,0),Q(M,de,.5))}function ee(te,ae){ae&&(te?(Q(g,X,1),Q(y,X,0),Q(E,O,0),Q(g,X,1),Q(E,O,0),Q(B,O,1),Q(E,X,0),Q(M,O,.5),Q(B,O,1),Q(M,O,.5),Q(w,X,0),Q(B,O,1)):(Q(g,X,1),Q(y,X,0),Q(C,O,1),Q(y,X,0),Q(B,O,0),Q(C,O,1),Q(C,X,1),Q(B,O,0),Q(M,O,.5),Q(M,O,.5),Q(B,O,0),Q(I,X,1)))}function ge(te,ae,de,se,K,Y){switch(r.strokeLineCap){case"round":K?J(te,de,ae,Y,.5):J(te,ae,de,Y,.5);break;case"square":if(K)u.subVectors(ae,te),f.set(u.y,-u.x),A.addVectors(u,f).add(te),d.subVectors(f,u).add(te),se?(A.toArray(o,1*3),d.toArray(o,0*3),d.toArray(o,3*3)):(A.toArray(o,1*3),c[3*2+1]===1?d.toArray(o,3*3):A.toArray(o,3*3),d.toArray(o,0*3));else{u.subVectors(de,te),f.set(u.y,-u.x),A.addVectors(u,f).add(te),d.subVectors(f,u).add(te);const ne=o.length;se?(A.toArray(o,ne-1*3),d.toArray(o,ne-2*3),d.toArray(o,ne-4*3)):(d.toArray(o,ne-2*3),A.toArray(o,ne-1*3),d.toArray(o,ne-4*3))}break}}function pe(te){let ae=!1;for(let se=1,K=te.length-1;se<K;se++)if(te[se].distanceTo(te[se+1])<i){ae=!0;break}if(!ae)return te;const de=[];de.push(te[0]);for(let se=1,K=te.length-1;se<K;se++)te[se].distanceTo(te[se+1])>=i&&de.push(te[se]);return de.push(te[te.length-1]),de}}}return s})(),Du=new Rt,go=new k;class xa extends Il{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Ki(e,3)),this.setAttribute("uv",new Ki(n,2))}applyMatrix4(e){const n=this.attributes.instanceStart,r=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(e),r.applyMatrix4(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new tl(n,6,1);return this.setAttribute("instanceStart",new Vr(r,3,0)),this.setAttribute("instanceEnd",new Vr(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,n=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));const t=new tl(r,n*2,1);return this.setAttribute("instanceColorStart",new Vr(t,n,0)),this.setAttribute("instanceColorEnd",new Vr(t,n,n)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new fA(e.geometry)),this}fromLineSegments(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Rt);const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;e!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Du.setFromBufferAttribute(n),this.boundingBox.union(Du))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Oi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(e!==void 0&&n!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let t=0;for(let i=0,o=e.count;i<o;i++)go.fromBufferAttribute(e,i),t=Math.max(t,r.distanceToSquared(go)),go.fromBufferAttribute(n,i),t=Math.max(t,r.distanceToSquared(go));this.boundingSphere.radius=Math.sqrt(t),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class P1 extends xa{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const n=e.length-3,r=new Float32Array(2*n);for(let t=0;t<n;t+=3)r[2*t]=e[t],r[2*t+1]=e[t+1],r[2*t+2]=e[t+2],r[2*t+3]=e[t+3],r[2*t+4]=e[t+4],r[2*t+5]=e[t+5];return super.setPositions(r),this}setColors(e,n=3){const r=e.length-n,t=new Float32Array(2*r);if(n===3)for(let i=0;i<r;i+=n)t[2*i]=e[i],t[2*i+1]=e[i+1],t[2*i+2]=e[i+2],t[2*i+3]=e[i+3],t[2*i+4]=e[i+4],t[2*i+5]=e[i+5];else for(let i=0;i<r;i+=n)t[2*i]=e[i],t[2*i+1]=e[i+1],t[2*i+2]=e[i+2],t[2*i+3]=e[i+3],t[2*i+4]=e[i+4],t[2*i+5]=e[i+5],t[2*i+6]=e[i+6],t[2*i+7]=e[i+7];return super.setColors(t,n),this}fromLine(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}}class _a extends kt{constructor(e){super({type:"LineMaterial",uniforms:Xr.clone(Xr.merge([il.common,il.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Te(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${ha>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const nc=new Li,Ru=new k,Pu=new k,oi=new Li,ai=new Li,hn=new Li,rc=new k,sc=new Me,ui=new xn,Qu=new k,yo=new Rt,vo=new Oi,fn=new Li;let yn,ur;function zu(s,e,n){return fn.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),fn.multiplyScalar(1/fn.w),fn.x=ur/n.width,fn.y=ur/n.height,fn.applyMatrix4(s.projectionMatrixInverse),fn.multiplyScalar(1/fn.w),Math.abs(Math.max(fn.x,fn.y))}function Um(s,e){const n=s.matrixWorld,r=s.geometry,t=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=Math.min(r.instanceCount,t.count);for(let a=0,c=o;a<c;a++){ui.start.fromBufferAttribute(t,a),ui.end.fromBufferAttribute(i,a),ui.applyMatrix4(n);const l=new k,u=new k;yn.distanceSqToSegment(ui.start,ui.end,u,l),u.distanceTo(l)<ur*.5&&e.push({point:u,pointOnLine:l,distance:yn.origin.distanceTo(u),object:s,face:null,faceIndex:a,uv:null,[u1]:null})}}function km(s,e,n){const r=e.projectionMatrix,i=s.material.resolution,o=s.matrixWorld,a=s.geometry,c=a.attributes.instanceStart,l=a.attributes.instanceEnd,u=Math.min(a.instanceCount,c.count),f=-e.near;yn.at(1,hn),hn.w=1,hn.applyMatrix4(e.matrixWorldInverse),hn.applyMatrix4(r),hn.multiplyScalar(1/hn.w),hn.x*=i.x/2,hn.y*=i.y/2,hn.z=0,rc.copy(hn),sc.multiplyMatrices(e.matrixWorldInverse,o);for(let A=0,d=u;A<d;A++){if(oi.fromBufferAttribute(c,A),ai.fromBufferAttribute(l,A),oi.w=1,ai.w=1,oi.applyMatrix4(sc),ai.applyMatrix4(sc),oi.z>f&&ai.z>f)continue;if(oi.z>f){const m=oi.z-ai.z,_=(oi.z-f)/m;oi.lerp(ai,_)}else if(ai.z>f){const m=ai.z-oi.z,_=(ai.z-f)/m;ai.lerp(oi,_)}oi.applyMatrix4(r),ai.applyMatrix4(r),oi.multiplyScalar(1/oi.w),ai.multiplyScalar(1/ai.w),oi.x*=i.x/2,oi.y*=i.y/2,ai.x*=i.x/2,ai.y*=i.y/2,ui.start.copy(oi),ui.start.z=0,ui.end.copy(ai),ui.end.z=0;const p=ui.closestPointToPointParameter(rc,!0);ui.at(p,Qu);const v=je.lerp(oi.z,ai.z,p),y=v>=-1&&v<=1,g=rc.distanceTo(Qu)<ur*.5;if(y&&g){ui.start.fromBufferAttribute(c,A),ui.end.fromBufferAttribute(l,A),ui.start.applyMatrix4(o),ui.end.applyMatrix4(o);const m=new k,_=new k;yn.distanceSqToSegment(ui.start,ui.end,_,m),n.push({point:_,pointOnLine:m,distance:yn.origin.distanceTo(_),object:s,face:null,faceIndex:A,uv:null,[u1]:null})}}}class Q1 extends Qe{constructor(e=new xa,n=new _a({color:Math.random()*16777215})){super(e,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,n=e.attributes.instanceStart,r=e.attributes.instanceEnd,t=new Float32Array(2*n.count);for(let o=0,a=0,c=n.count;o<c;o++,a+=2)Ru.fromBufferAttribute(n,o),Pu.fromBufferAttribute(r,o),t[a]=a===0?0:t[a-1],t[a+1]=t[a]+Ru.distanceTo(Pu);const i=new tl(t,2,1);return e.setAttribute("instanceDistanceStart",new Vr(i,1,0)),e.setAttribute("instanceDistanceEnd",new Vr(i,1,1)),this}raycast(e,n){const r=this.material.worldUnits,t=e.camera;t===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=e.params.Line2!==void 0&&e.params.Line2.threshold||0;yn=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;ur=c.linewidth+i,a.boundingSphere===null&&a.computeBoundingSphere(),vo.copy(a.boundingSphere).applyMatrix4(o);let l;if(r)l=ur*.5;else{const f=Math.max(t.near,vo.distanceToPoint(yn.origin));l=zu(t,f,c.resolution)}if(vo.radius+=l,yn.intersectsSphere(vo)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),yo.copy(a.boundingBox).applyMatrix4(o);let u;if(r)u=ur*.5;else{const f=Math.max(t.near,yo.distanceToPoint(yn.origin));u=zu(t,f,c.resolution)}yo.expandByScalar(u),yn.intersectsBox(yo)!==!1&&(r?Um(this,n):km(this,t,n))}onBeforeRender(e){const n=this.material.uniforms;n&&n.resolution&&(e.getViewport(nc),this.material.uniforms.resolution.value.set(nc.z,nc.w))}}class z1 extends Q1{constructor(e=new P1,n=new _a({color:Math.random()*16777215})){super(e,n),this.isLine2=!0,this.type="Line2"}}const Fu=s=>Symbol.iterator in s,Uu=s=>"entries"in s,ku=(s,e)=>{const n=s instanceof Map?s:new Map(s.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[t,i]of n)if(!Object.is(i,r.get(t)))return!1;return!0},Lm=(s,e)=>{const n=s[Symbol.iterator](),r=e[Symbol.iterator]();let t=n.next(),i=r.next();for(;!t.done&&!i.done;){if(!Object.is(t.value,i.value))return!1;t=n.next(),i=r.next()}return!!t.done&&!!i.done};function Om(s,e){return Object.is(s,e)?!0:typeof s!="object"||s===null||typeof e!="object"||e===null?!1:!Fu(s)||!Fu(e)?ku({entries:()=>Object.entries(s)},{entries:()=>Object.entries(e)}):Uu(s)&&Uu(e)?ku(s,e):Lm(s,e)}const F1=h.createContext([]);function ty({box:s,multiple:e,children:n,onChange:r,onChangePointerUp:t,border:i="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:a=l=>l,...c}){const[l,u]=h.useState(!1),{setEvents:f,camera:A,raycaster:d,gl:x,controls:p,size:v,get:y}=re(),[g,m]=h.useState(!1),[_,E]=h.useReducer((B,{object:S,shift:U})=>S===void 0?[]:Array.isArray(S)?S:U?B.includes(S)?B.filter(b=>b!==S):[S,...B]:B[0]===S?[]:[S],[]);h.useEffect(()=>{l?r==null||r(_):t==null||t(_)},[_,l]);const C=h.useCallback(B=>{B.stopPropagation(),E({object:a([B.object])[0],shift:e&&B.shiftKey})},[]),w=h.useCallback(B=>!g&&E({}),[g]),I=h.useRef(null);return h.useEffect(()=>{if(!s||!e)return;const B=new nm(A,I.current),S=document.createElement("div");S.style.pointerEvents="none",S.style.border=i,S.style.backgroundColor=o,S.style.position="fixed";const U=new Te,b=new Te,M=new Te,D=y().events.enabled,N=p==null?void 0:p.enabled;let G=!1;function q(z,F){const{offsetX:R,offsetY:Q}=z,{width:J,height:ie}=v;F.set(R/J*2-1,-(Q/ie)*2+1)}function X(z){var F;p&&(p.enabled=!1),f({enabled:!1}),u(G=!0),(F=x.domElement.parentElement)==null||F.appendChild(S),S.style.left=`${z.clientX}px`,S.style.top=`${z.clientY}px`,S.style.width="0px",S.style.height="0px",U.x=z.clientX,U.y=z.clientY}function O(z){M.x=Math.max(U.x,z.clientX),M.y=Math.max(U.y,z.clientY),b.x=Math.min(U.x,z.clientX),b.y=Math.min(U.y,z.clientY),S.style.left=`${b.x}px`,S.style.top=`${b.y}px`,S.style.width=`${M.x-b.x}px`,S.style.height=`${M.y-b.y}px`}function H(){if(G){var z;p&&(p.enabled=N),f({enabled:D}),u(G=!1),(z=S.parentElement)==null||z.removeChild(S)}}function T(z){z.shiftKey&&(X(z),q(z,B.startPoint))}let W=[];function j(z){if(G){O(z),q(z,B.endPoint);const F=B.select().sort(R=>R.uuid).filter(R=>R.isMesh);Om(F,W)||(W=F,E({object:a(F)}))}}function L(z){G&&H()}return document.addEventListener("pointerdown",T,{passive:!0}),document.addEventListener("pointermove",j,{passive:!0,capture:!0}),document.addEventListener("pointerup",L,{passive:!0}),()=>{document.removeEventListener("pointerdown",T),document.removeEventListener("pointermove",j,!0),document.removeEventListener("pointerup",L)}},[v.width,v.height,d,A,p,x]),h.createElement("group",me({ref:I,onClick:C,onPointerOver:()=>m(!0),onPointerOut:()=>m(!1),onPointerMissed:w},c),h.createElement(F1.Provider,{value:_},n))}function iy(){return h.useContext(F1)}const Nm=h.forwardRef(function({children:e,follow:n=!0,lockX:r=!1,lockY:t=!1,lockZ:i=!1,...o},a){const c=h.useRef(null),l=h.useRef(null),u=new st;return ze(({camera:f})=>{if(!n||!l.current)return;const A=c.current.rotation.clone();l.current.updateMatrix(),l.current.updateWorldMatrix(!1,!1),l.current.getWorldQuaternion(u),f.getWorldQuaternion(c.current.quaternion).premultiply(u.invert()),r&&(c.current.rotation.x=A.x),t&&(c.current.rotation.y=A.y),i&&(c.current.rotation.z=A.z)}),h.useImperativeHandle(a,()=>l.current,[]),h.createElement("group",me({ref:l},o),h.createElement("group",{ref:c},e))}),ny=h.forwardRef(({children:s,depth:e=-1,...n},r)=>{const t=h.useRef(null);return h.useImperativeHandle(r,()=>t.current,[]),ze(({camera:i})=>{t.current.quaternion.copy(i.quaternion),t.current.position.copy(i.position)}),h.createElement("group",me({ref:t},n),h.createElement("group",{"position-z":-e},s))}),Gm=new k,Hm=new k,Vm=new k,Wm=(s,e,n)=>{const r=n.width/2,t=n.height/2;e.updateMatrixWorld(!1);const i=s.project(e);return i.x=i.x*r+r,i.y=-(i.y*t)+t,i},Ym=(s,e,n,r=1)=>{const t=Gm.set(s.x/n.width*2-1,-(s.y/n.height)*2+1,r);return t.unproject(e),t},Ql=(s,e,n,r)=>{const t=Wm(Vm.copy(s),n,r);let i=0;for(let o=0;o<2;++o){const a=Hm.copy(t).setComponent(o,t.getComponent(o)+e),c=Ym(a,n,r,a.z);i=Math.max(i,s.distanceTo(c))}return i},jm=new k,ry=h.forwardRef(({scale:s=1,...e},n)=>{const r=h.useRef(null);return h.useImperativeHandle(n,()=>r.current,[]),ze(t=>{const i=r.current;if(!i)return;const o=Ql(i.getWorldPosition(jm),s,t.camera,t.size);i.scale.setScalar(o*s)}),h.createElement("object3D",me({ref:r},e))}),_n=h.forwardRef(function({points:e,color:n=16777215,vertexColors:r,linewidth:t,lineWidth:i,segments:o,dashed:a,...c},l){var u,f;const A=re(y=>y.size),d=h.useMemo(()=>o?new Q1:new z1,[o]),[x]=h.useState(()=>new _a),p=(r==null||(u=r[0])==null?void 0:u.length)===4?4:3,v=h.useMemo(()=>{const y=o?new xa:new P1,g=e.map(m=>{const _=Array.isArray(m);return m instanceof k||m instanceof Li?[m.x,m.y,m.z]:m instanceof Te?[m.x,m.y,0]:_&&m.length===3?[m[0],m[1],m[2]]:_&&m.length===2?[m[0],m[1],0]:m});if(y.setPositions(g.flat()),r){n=16777215;const m=r.map(_=>_ instanceof Ve?_.toArray():_);y.setColors(m.flat(),p)}return y},[e,o,r,p]);return h.useLayoutEffect(()=>{d.computeLineDistances()},[e,d]),h.useLayoutEffect(()=>{a?x.defines.USE_DASH="":delete x.defines.USE_DASH,x.needsUpdate=!0},[a,x]),h.useEffect(()=>()=>{v.dispose(),x.dispose()},[v]),h.createElement("primitive",me({object:d,ref:l},c),h.createElement("primitive",{object:v,attach:"geometry"}),h.createElement("primitive",me({object:x,attach:"material",color:n,vertexColors:!!r,resolution:[A.width,A.height],linewidth:(f=t??i)!==null&&f!==void 0?f:1,dashed:a,transparent:p===4},c)))}),qm=new k,sy=h.forwardRef(function({start:e=[0,0,0],end:n=[0,0,0],mid:r,segments:t=20,...i},o){const a=h.useRef(null);h.useImperativeHandle(o,()=>a.current);const[c]=h.useState(()=>new AA(void 0,void 0,void 0)),l=h.useCallback((f,A,d,x=20)=>(f instanceof k?c.v0.copy(f):c.v0.set(...f),A instanceof k?c.v2.copy(A):c.v2.set(...A),d instanceof k?c.v1.copy(d):Array.isArray(d)?c.v1.set(...d):c.v1.copy(c.v0.clone().add(c.v2.clone().sub(c.v0)).add(qm.set(0,c.v0.y-c.v2.y,0))),c.getPoints(x)),[]);h.useLayoutEffect(()=>{a.current.setPoints=(f,A,d)=>{const x=l(f,A,d);a.current.geometry&&a.current.geometry.setPositions(x.map(p=>p.toArray()).flat())}},[]);const u=h.useMemo(()=>l(e,n,r,t),[e,n,r,t]);return h.createElement(_n,me({ref:a,points:u},i))}),oy=h.forwardRef(function({start:e,end:n,midA:r,midB:t,segments:i=20,...o},a){const c=h.useMemo(()=>{const l=e instanceof k?e:new k(...e),u=n instanceof k?n:new k(...n),f=r instanceof k?r:new k(...r),A=t instanceof k?t:new k(...t);return new dA(l,f,A,u).getPoints(i)},[e,n,r,t,i]);return h.createElement(_n,me({ref:a,points:c},o))}),ay=h.forwardRef(function({points:e,closed:n=!1,curveType:r="centripetal",tension:t=.5,segments:i=20,vertexColors:o,...a},c){const l=h.useMemo(()=>{const A=e.map(d=>d instanceof k?d:new k(...d));return new Yh(A,n,r,t)},[e,n,r,t]),u=h.useMemo(()=>l.getPoints(i),[l,i]),f=h.useMemo(()=>{if(!o||o.length<2)return;if(o.length===i+1)return o;const A=o.map(p=>p instanceof Ve?p:new Ve(...p));n&&A.push(A[0].clone());const d=[A[0]],x=i/(A.length-1);for(let p=1;p<i;p++){const v=p%x/x,y=Math.floor(p/x);d.push(A[y].clone().lerp(A[y+1],v))}return d.push(A[A.length-1]),d},[o,i]);return h.createElement(_n,me({ref:c,points:u,vertexColors:f},a))}),cy=h.forwardRef(({url:s,distance:e=1,loop:n=!0,autoplay:r,...t},i)=>{const o=h.useRef(null);h.useImperativeHandle(i,()=>o.current,[]);const a=re(({camera:u})=>u),[c]=h.useState(()=>new mA),l=Ei(pA,s);return h.useEffect(()=>{const u=o.current;u&&(u.setBuffer(l),u.setRefDistance(e),u.setLoop(n),r&&!u.isPlaying&&u.play())},[l,a,e,n]),h.useEffect(()=>{const u=o.current;return a.add(c),()=>{a.remove(c),u&&(u.isPlaying&&u.stop(),u.source&&u.source._connected&&u.disconnect())}},[]),h.createElement("positionalAudio",me({ref:o,args:[c]},t))});function Xm(){var s=Object.create(null);function e(t,i){var o=t.id,a=t.name,c=t.dependencies;c===void 0&&(c=[]);var l=t.init;l===void 0&&(l=function(){});var u=t.getTransferables;if(u===void 0&&(u=null),!s[o])try{c=c.map(function(A){return A&&A.isWorkerModule&&(e(A,function(d){if(d instanceof Error)throw d}),A=s[A.id].value),A}),l=r("<"+a+">.init",l),u&&(u=r("<"+a+">.getTransferables",u));var f=null;typeof l=="function"?f=l.apply(void 0,c):console.error("worker module init function failed to rehydrate"),s[o]={id:o,value:f,getTransferables:u},i(f)}catch(A){A&&A.noLog||console.error(A),i(A)}}function n(t,i){var o,a=t.id,c=t.args;(!s[a]||typeof s[a].value!="function")&&i(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var l=(o=s[a]).value.apply(o,c);l&&typeof l.then=="function"?l.then(u,function(f){return i(f instanceof Error?f:new Error(""+f))}):u(l)}catch(f){i(f)}function u(f){try{var A=s[a].getTransferables&&s[a].getTransferables(f);(!A||!Array.isArray(A)||!A.length)&&(A=void 0),i(f,A)}catch(d){console.error(d),i(d)}}}function r(t,i){var o=void 0;self.troikaDefine=function(c){return o=c};var a=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+i+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(c){console.error(c)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(t){var i=t.data,o=i.messageId,a=i.action,c=i.data;try{a==="registerModule"&&e(c,function(l){l instanceof Error?postMessage({messageId:o,success:!1,error:l.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof l=="function"}})}),a==="callModule"&&n(c,function(l,u){l instanceof Error?postMessage({messageId:o,success:!1,error:l.message}):postMessage({messageId:o,success:!0,result:l},u||void 0)})}catch(l){postMessage({messageId:o,success:!1,error:l.stack})}})}function Km(s){var e=function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return e._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,n);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=s.dependencies,r=s.init;n=Array.isArray(n)?n.map(function(i){return i&&(i=i.onMainThread||i,i._getInitResult&&(i=i._getInitResult())),i}):[];var t=Promise.all(n).then(function(i){return r.apply(null,i)});return e._getInitResult=function(){return t},t},e}var U1=function(){var s=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),s=!0}catch(n){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+n.message+"]")}return U1=function(){return s},s},Zm=0,Jm=0,oc=!1,Vs=Object.create(null),Ws=Object.create(null),cl=Object.create(null);function $r(s){if((!s||typeof s.init!="function")&&!oc)throw new Error("requires `options.init` function");var e=s.dependencies,n=s.init,r=s.getTransferables,t=s.workerId,i=Km(s);t==null&&(t="#default");var o="workerModule"+ ++Zm,a=s.name||o,c=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(oc=!0,u=$r({workerId:t,name:"<"+a+"> function dependency: "+u.name,init:`function(){return (
`+ea(u)+`
)}`}),oc=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function l(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];if(!U1())return i.apply(void 0,u);if(!c){c=Lu(t,"registerModule",l.workerModuleData);var A=function(){c=null,Ws[t].delete(A)};(Ws[t]||(Ws[t]=new Set)).add(A)}return c.then(function(d){var x=d.isCallable;if(x)return Lu(t,"callModule",{id:o,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return l.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:e,init:ea(n),getTransferables:r&&ea(r)},l.onMainThread=i,l}function $m(s){Ws[s]&&Ws[s].forEach(function(e){e()}),Vs[s]&&(Vs[s].terminate(),delete Vs[s])}function ea(s){var e=s.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function e2(s){var e=Vs[s];if(!e){var n=ea(Xm);e=Vs[s]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+s.replace(/\*/g,"")+` **/

;(`+n+")()"],{type:"application/javascript"}))),e.onmessage=function(r){var t=r.data,i=t.messageId,o=cl[i];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete cl[i],o(t)}}return e}function Lu(s,e,n){return new Promise(function(r,t){var i=++Jm;cl[i]=function(o){o.success?r(o.result):t(new Error("Error in worker "+e+" call: "+o.error))},e2(s).postMessage({messageId:i,action:e,data:n})})}function k1(){var s=function(e){function n(O,H,T,W,j,L,z,F){var R=1-z;F.x=R*R*O+2*R*z*T+z*z*j,F.y=R*R*H+2*R*z*W+z*z*L}function r(O,H,T,W,j,L,z,F,R,Q){var J=1-R;Q.x=J*J*J*O+3*J*J*R*T+3*J*R*R*j+R*R*R*z,Q.y=J*J*J*H+3*J*J*R*W+3*J*R*R*L+R*R*R*F}function t(O,H){for(var T=/([MLQCZ])([^MLQCZ]*)/g,W,j,L,z,F;W=T.exec(O);){var R=W[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Q){return parseFloat(Q)});switch(W[1]){case"M":z=j=R[0],F=L=R[1];break;case"L":(R[0]!==z||R[1]!==F)&&H("L",z,F,z=R[0],F=R[1]);break;case"Q":{H("Q",z,F,z=R[2],F=R[3],R[0],R[1]);break}case"C":{H("C",z,F,z=R[4],F=R[5],R[0],R[1],R[2],R[3]);break}case"Z":(z!==j||F!==L)&&H("L",z,F,j,L);break}}}function i(O,H,T){T===void 0&&(T=16);var W={x:0,y:0};t(O,function(j,L,z,F,R,Q,J,ie,Z){switch(j){case"L":H(L,z,F,R);break;case"Q":{for(var ee=L,ge=z,pe=1;pe<T;pe++)n(L,z,Q,J,F,R,pe/(T-1),W),H(ee,ge,W.x,W.y),ee=W.x,ge=W.y;break}case"C":{for(var te=L,ae=z,de=1;de<T;de++)r(L,z,Q,J,ie,Z,F,R,de/(T-1),W),H(te,ae,W.x,W.y),te=W.x,ae=W.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",c=new WeakMap,l={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(O,H){var T=O.getContext?O.getContext("webgl",l):O,W=c.get(T);if(!W){let J=function(te){var ae=L[te];if(!ae&&(ae=L[te]=T.getExtension(te),!ae))throw new Error(te+" not supported");return ae},ie=function(te,ae){var de=T.createShader(ae);return T.shaderSource(de,te),T.compileShader(de),de},Z=function(te,ae,de,se){if(!z[te]){var K={},Y={},ne=T.createProgram();T.attachShader(ne,ie(ae,T.VERTEX_SHADER)),T.attachShader(ne,ie(de,T.FRAGMENT_SHADER)),T.linkProgram(ne),z[te]={program:ne,transaction:function(Ee){T.useProgram(ne),Ee({setUniform:function(xe,Oe){for(var De=[],Re=arguments.length-2;Re-- >0;)De[Re]=arguments[Re+2];var Pe=Y[Oe]||(Y[Oe]=T.getUniformLocation(ne,Oe));T["uniform"+xe].apply(T,[Pe].concat(De))},setAttribute:function(xe,Oe,De,Re,Pe){var ke=K[xe];ke||(ke=K[xe]={buf:T.createBuffer(),loc:T.getAttribLocation(ne,xe),data:null}),T.bindBuffer(T.ARRAY_BUFFER,ke.buf),T.vertexAttribPointer(ke.loc,Oe,T.FLOAT,!1,0,0),T.enableVertexAttribArray(ke.loc),j?T.vertexAttribDivisor(ke.loc,Re):J("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ke.loc,Re),Pe!==ke.data&&(T.bufferData(T.ARRAY_BUFFER,Pe,De),ke.data=Pe)}})}}}z[te].transaction(se)},ee=function(te,ae){R++;try{T.activeTexture(T.TEXTURE0+R);var de=F[te];de||(de=F[te]=T.createTexture(),T.bindTexture(T.TEXTURE_2D,de),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST)),T.bindTexture(T.TEXTURE_2D,de),ae(de,R)}finally{R--}},ge=function(te,ae,de){var se=T.createFramebuffer();Q.push(se),T.bindFramebuffer(T.FRAMEBUFFER,se),T.activeTexture(T.TEXTURE0+ae),T.bindTexture(T.TEXTURE_2D,te),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,te,0);try{de(se)}finally{T.deleteFramebuffer(se),T.bindFramebuffer(T.FRAMEBUFFER,Q[--Q.length-1]||null)}},pe=function(){L={},z={},F={},R=-1,Q.length=0};var j=typeof WebGL2RenderingContext<"u"&&T instanceof WebGL2RenderingContext,L={},z={},F={},R=-1,Q=[];T.canvas.addEventListener("webglcontextlost",function(te){pe(),te.preventDefault()},!1),c.set(T,W={gl:T,isWebGL2:j,getExtension:J,withProgram:Z,withTexture:ee,withTextureFramebuffer:ge,handleContextLoss:pe})}H(W)}function f(O,H,T,W,j,L,z,F){z===void 0&&(z=15),F===void 0&&(F=null),u(O,function(R){var Q=R.gl,J=R.withProgram,ie=R.withTexture;ie("copy",function(Z,ee){Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,j,L,0,Q.RGBA,Q.UNSIGNED_BYTE,H),J("copy",o,a,function(ge){var pe=ge.setUniform,te=ge.setAttribute;te("aUV",2,Q.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),pe("1i","image",ee),Q.bindFramebuffer(Q.FRAMEBUFFER,F||null),Q.disable(Q.BLEND),Q.colorMask(z&8,z&4,z&2,z&1),Q.viewport(T,W,j,L),Q.scissor(T,W,j,L),Q.drawArrays(Q.TRIANGLES,0,3)})})})}function A(O,H,T){var W=O.width,j=O.height;u(O,function(L){var z=L.gl,F=new Uint8Array(W*j*4);z.readPixels(0,0,W,j,z.RGBA,z.UNSIGNED_BYTE,F),O.width=H,O.height=T,f(z,F,0,0,W,j)})}var d=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:f,resizeWebGLCanvasWithoutClearing:A});function x(O,H,T,W,j,L){L===void 0&&(L=1);var z=new Uint8Array(O*H),F=W[2]-W[0],R=W[3]-W[1],Q=[];i(T,function(te,ae,de,se){Q.push({x1:te,y1:ae,x2:de,y2:se,minX:Math.min(te,de),minY:Math.min(ae,se),maxX:Math.max(te,de),maxY:Math.max(ae,se)})}),Q.sort(function(te,ae){return te.maxX-ae.maxX});for(var J=0;J<O;J++)for(var ie=0;ie<H;ie++){var Z=ge(W[0]+F*(J+.5)/O,W[1]+R*(ie+.5)/H),ee=Math.pow(1-Math.abs(Z)/j,L)/2;Z<0&&(ee=1-ee),ee=Math.max(0,Math.min(255,Math.round(ee*255))),z[ie*O+J]=ee}return z;function ge(te,ae){for(var de=1/0,se=1/0,K=Q.length;K--;){var Y=Q[K];if(Y.maxX+se<=te)break;if(te+se>Y.minX&&ae-se<Y.maxY&&ae+se>Y.minY){var ne=y(te,ae,Y.x1,Y.y1,Y.x2,Y.y2);ne<de&&(de=ne,se=Math.sqrt(de))}}return pe(te,ae)&&(se=-se),se}function pe(te,ae){for(var de=0,se=Q.length;se--;){var K=Q[se];if(K.maxX<=te)break;var Y=K.y1>ae!=K.y2>ae&&te<(K.x2-K.x1)*(ae-K.y1)/(K.y2-K.y1)+K.x1;Y&&(de+=K.y1<K.y2?1:-1)}return de!==0}}function p(O,H,T,W,j,L,z,F,R,Q){L===void 0&&(L=1),F===void 0&&(F=0),R===void 0&&(R=0),Q===void 0&&(Q=0),v(O,H,T,W,j,L,z,null,F,R,Q)}function v(O,H,T,W,j,L,z,F,R,Q,J){L===void 0&&(L=1),R===void 0&&(R=0),Q===void 0&&(Q=0),J===void 0&&(J=0);for(var ie=x(O,H,T,W,j,L),Z=new Uint8Array(ie.length*4),ee=0;ee<ie.length;ee++)Z[ee*4+J]=ie[ee];f(z,Z,R,Q,O,H,1<<3-J,F)}function y(O,H,T,W,j,L){var z=j-T,F=L-W,R=z*z+F*F,Q=R?Math.max(0,Math.min(1,((O-T)*z+(H-W)*F)/R)):0,J=O-(T+Q*z),ie=H-(W+Q*F);return J*J+ie*ie}var g=Object.freeze({__proto__:null,generate:x,generateIntoCanvas:p,generateIntoFramebuffer:v}),m="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",_="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",E="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",C=new Float32Array([0,0,2,0,0,2]),w=null,I=!1,B={},S=new WeakMap;function U(O){if(!I&&!N(O))throw new Error("WebGL generation not supported")}function b(O,H,T,W,j,L,z){if(L===void 0&&(L=1),z===void 0&&(z=null),!z&&(z=w,!z)){var F=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!F)throw new Error("OffscreenCanvas or DOM canvas not supported");z=w=F.getContext("webgl",{depth:!1})}U(z);var R=new Uint8Array(O*H*4);u(z,function(Z){var ee=Z.gl,ge=Z.withTexture,pe=Z.withTextureFramebuffer;ge("readable",function(te,ae){ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,O,H,0,ee.RGBA,ee.UNSIGNED_BYTE,null),pe(te,ae,function(de){D(O,H,T,W,j,L,ee,de,0,0,0),ee.readPixels(0,0,O,H,ee.RGBA,ee.UNSIGNED_BYTE,R)})})});for(var Q=new Uint8Array(O*H),J=0,ie=0;J<R.length;J+=4)Q[ie++]=R[J];return Q}function M(O,H,T,W,j,L,z,F,R,Q){L===void 0&&(L=1),F===void 0&&(F=0),R===void 0&&(R=0),Q===void 0&&(Q=0),D(O,H,T,W,j,L,z,null,F,R,Q)}function D(O,H,T,W,j,L,z,F,R,Q,J){L===void 0&&(L=1),R===void 0&&(R=0),Q===void 0&&(Q=0),J===void 0&&(J=0),U(z);var ie=[];i(T,function(Z,ee,ge,pe){ie.push(Z,ee,ge,pe)}),ie=new Float32Array(ie),u(z,function(Z){var ee=Z.gl,ge=Z.isWebGL2,pe=Z.getExtension,te=Z.withProgram,ae=Z.withTexture,de=Z.withTextureFramebuffer,se=Z.handleContextLoss;if(ae("rawDistances",function(K,Y){(O!==K._lastWidth||H!==K._lastHeight)&&ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,K._lastWidth=O,K._lastHeight=H,0,ee.RGBA,ee.UNSIGNED_BYTE,null),te("main",m,_,function(ne){var ve=ne.setAttribute,Ee=ne.setUniform,Ce=!ge&&pe("ANGLE_instanced_arrays"),xe=!ge&&pe("EXT_blend_minmax");ve("aUV",2,ee.STATIC_DRAW,0,C),ve("aLineSegment",4,ee.DYNAMIC_DRAW,1,ie),Ee.apply(void 0,["4f","uGlyphBounds"].concat(W)),Ee("1f","uMaxDistance",j),Ee("1f","uExponent",L),de(K,Y,function(Oe){ee.enable(ee.BLEND),ee.colorMask(!0,!0,!0,!0),ee.viewport(0,0,O,H),ee.scissor(0,0,O,H),ee.blendFunc(ee.ONE,ee.ONE),ee.blendEquationSeparate(ee.FUNC_ADD,ge?ee.MAX:xe.MAX_EXT),ee.clear(ee.COLOR_BUFFER_BIT),ge?ee.drawArraysInstanced(ee.TRIANGLES,0,3,ie.length/4):Ce.drawArraysInstancedANGLE(ee.TRIANGLES,0,3,ie.length/4)})}),te("post",o,E,function(ne){ne.setAttribute("aUV",2,ee.STATIC_DRAW,0,C),ne.setUniform("1i","tex",Y),ee.bindFramebuffer(ee.FRAMEBUFFER,F),ee.disable(ee.BLEND),ee.colorMask(J===0,J===1,J===2,J===3),ee.viewport(R,Q,O,H),ee.scissor(R,Q,O,H),ee.drawArrays(ee.TRIANGLES,0,3)})}),ee.isContextLost())throw se(),new Error("webgl context lost")})}function N(O){var H=!O||O===w?B:O.canvas||O,T=S.get(H);if(T===void 0){I=!0;var W=null;try{var j=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],L=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,O);T=L&&j.length===L.length&&L.every(function(z,F){return z===j[F]}),T||(W="bad trial run results",console.info(j,L))}catch(z){T=!1,W=z.message}W&&console.warn("WebGL SDF generation not supported:",W),I=!1,S.set(H,T)}return T}var G=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:M,generateIntoFramebuffer:D,isSupported:N});function q(O,H,T,W,j,L){j===void 0&&(j=Math.max(W[2]-W[0],W[3]-W[1])/2),L===void 0&&(L=1);try{return b.apply(G,arguments)}catch(z){return console.info("WebGL SDF generation failed, falling back to JS",z),x.apply(g,arguments)}}function X(O,H,T,W,j,L,z,F,R,Q){j===void 0&&(j=Math.max(W[2]-W[0],W[3]-W[1])/2),L===void 0&&(L=1),F===void 0&&(F=0),R===void 0&&(R=0),Q===void 0&&(Q=0);try{return M.apply(G,arguments)}catch(J){return console.info("WebGL SDF generation failed, falling back to JS",J),p.apply(g,arguments)}}return e.forEachPathCommand=t,e.generate=q,e.generateIntoCanvas=X,e.javascript=g,e.pathToLineSegments=i,e.webgl=G,e.webglUtils=d,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return s}function t2(){var s=function(e){var n={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},t={};r.L=1,t[1]="L",Object.keys(n).forEach(function(se,K){r[se]=1<<K+1,t[r[se]]=se}),Object.freeze(r);var i=r.LRI|r.RLI|r.FSI,o=r.L|r.R|r.AL,a=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,c=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,l=r.S|r.WS|r.B|i|r.PDI|c,u=null;function f(){if(!u){u=new Map;var se=function(Y){if(n.hasOwnProperty(Y)){var ne=0;n[Y].split(",").forEach(function(ve){var Ee=ve.split("+"),Ce=Ee[0],xe=Ee[1];Ce=parseInt(Ce,36),xe=xe?parseInt(xe,36):0,u.set(ne+=Ce,r[Y]);for(var Oe=0;Oe<xe;Oe++)u.set(++ne,r[Y])})}};for(var K in n)se(K)}}function A(se){return f(),u.get(se.codePointAt(0))||r.L}function d(se){return t[A(se)]}var x={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function p(se,K){var Y=36,ne=0,ve=new Map,Ee=K&&new Map,Ce;return se.split(",").forEach(function xe(Oe){if(Oe.indexOf("+")!==-1)for(var De=+Oe;De--;)xe(Ce);else{Ce=Oe;var Re=Oe.split(">"),Pe=Re[0],ke=Re[1];Pe=String.fromCodePoint(ne+=parseInt(Pe,Y)),ke=String.fromCodePoint(ne+=parseInt(ke,Y)),ve.set(Pe,ke),K&&Ee.set(ke,Pe)}}),{map:ve,reverseMap:Ee}}var v,y,g;function m(){if(!v){var se=p(x.pairs,!0),K=se.map,Y=se.reverseMap;v=K,y=Y,g=p(x.canonical,!1).map}}function _(se){return m(),v.get(se)||null}function E(se){return m(),y.get(se)||null}function C(se){return m(),g.get(se)||null}var w=r.L,I=r.R,B=r.EN,S=r.ES,U=r.ET,b=r.AN,M=r.CS,D=r.B,N=r.S,G=r.ON,q=r.BN,X=r.NSM,O=r.AL,H=r.LRO,T=r.RLO,W=r.LRE,j=r.RLE,L=r.PDF,z=r.LRI,F=r.RLI,R=r.FSI,Q=r.PDI;function J(se,K){for(var Y=125,ne=new Uint32Array(se.length),ve=0;ve<se.length;ve++)ne[ve]=A(se[ve]);var Ee=new Map;function Ce(wi,en){var Ii=ne[wi];ne[wi]=en,Ee.set(Ii,Ee.get(Ii)-1),Ii&a&&Ee.set(a,Ee.get(a)-1),Ee.set(en,(Ee.get(en)||0)+1),en&a&&Ee.set(a,(Ee.get(a)||0)+1)}for(var xe=new Uint8Array(se.length),Oe=new Map,De=[],Re=null,Pe=0;Pe<se.length;Pe++)Re||De.push(Re={start:Pe,end:se.length-1,level:K==="rtl"?1:K==="ltr"?0:Au(Pe,!1)}),ne[Pe]&D&&(Re.end=Pe,Re=null);for(var ke=j|W|T|H|i|Q|L|D,Ke=function(wi){return wi+(wi&1?1:2)},ot=function(wi){return wi+(wi&1?2:1)},He=0;He<De.length;He++){Re=De[He];var Le=[{_level:Re.level,_override:0,_isolate:0}],Fe=void 0,ct=0,$e=0,Ze=0;Ee.clear();for(var lt=Re.start;lt<=Re.end;lt++){var ye=ne[lt];if(Fe=Le[Le.length-1],Ee.set(ye,(Ee.get(ye)||0)+1),ye&a&&Ee.set(a,(Ee.get(a)||0)+1),ye&ke)if(ye&(j|W)){xe[lt]=Fe._level;var tt=(ye===j?ot:Ke)(Fe._level);tt<=Y&&!ct&&!$e?Le.push({_level:tt,_override:0,_isolate:0}):ct||$e++}else if(ye&(T|H)){xe[lt]=Fe._level;var hi=(ye===T?ot:Ke)(Fe._level);hi<=Y&&!ct&&!$e?Le.push({_level:hi,_override:ye&T?I:w,_isolate:0}):ct||$e++}else if(ye&i){ye&R&&(ye=Au(lt+1,!0)===1?F:z),xe[lt]=Fe._level,Fe._override&&Ce(lt,Fe._override);var gt=(ye===F?ot:Ke)(Fe._level);gt<=Y&&ct===0&&$e===0?(Ze++,Le.push({_level:gt,_override:0,_isolate:1,_isolInitIndex:lt})):ct++}else if(ye&Q){if(ct>0)ct--;else if(Ze>0){for($e=0;!Le[Le.length-1]._isolate;)Le.pop();var at=Le[Le.length-1]._isolInitIndex;at!=null&&(Oe.set(at,lt),Oe.set(lt,at)),Le.pop(),Ze--}Fe=Le[Le.length-1],xe[lt]=Fe._level,Fe._override&&Ce(lt,Fe._override)}else ye&L?(ct===0&&($e>0?$e--:!Fe._isolate&&Le.length>1&&(Le.pop(),Fe=Le[Le.length-1])),xe[lt]=Fe._level):ye&D&&(xe[lt]=Re.level);else xe[lt]=Fe._level,Fe._override&&ye!==q&&Ce(lt,Fe._override)}for(var Ft=[],wt=null,Je=Re.start;Je<=Re.end;Je++){var It=ne[Je];if(!(It&c)){var ri=xe[Je],ei=It&i,Lt=It===Q;wt&&ri===wt._level?(wt._end=Je,wt._endsWithIsolInit=ei):Ft.push(wt={_start:Je,_end:Je,_level:ri,_startsWithPDI:Lt,_endsWithIsolInit:ei})}}for(var Mi=[],Ti=0;Ti<Ft.length;Ti++){var Zi=Ft[Ti];if(!Zi._startsWithPDI||Zi._startsWithPDI&&!Oe.has(Zi._start)){for(var _i=[wt=Zi],Di=void 0;wt&&wt._endsWithIsolInit&&(Di=Oe.get(wt._end))!=null;)for(var qe=Ti+1;qe<Ft.length;qe++)if(Ft[qe]._start===Di){_i.push(wt=Ft[qe]);break}for(var ti=[],Cn=0;Cn<_i.length;Cn++)for(var P=_i[Cn],V=P._start;V<=P._end;V++)ti.push(V);for(var $=xe[ti[0]],le=Re.level,he=ti[0]-1;he>=0;he--)if(!(ne[he]&c)){le=xe[he];break}var fe=ti[ti.length-1],we=xe[fe],_e=Re.level;if(!(ne[fe]&i)){for(var Ie=fe+1;Ie<=Re.end;Ie++)if(!(ne[Ie]&c)){_e=xe[Ie];break}}Mi.push({_seqIndices:ti,_sosType:Math.max(le,$)%2?I:w,_eosType:Math.max(_e,we)%2?I:w})}}for(var be=0;be<Mi.length;be++){var Be=Mi[be],ue=Be._seqIndices,vt=Be._sosType,Ne=Be._eosType,Ue=xe[ue[0]]&1?I:w;if(Ee.get(X))for(var We=0;We<ue.length;We++){var it=ue[We];if(ne[it]&X){for(var ft=vt,At=We-1;At>=0;At--)if(!(ne[ue[At]]&c)){ft=ne[ue[At]];break}Ce(it,ft&(i|Q)?G:ft)}}if(Ee.get(B))for(var Pt=0;Pt<ue.length;Pt++){var ii=ue[Pt];if(ne[ii]&B)for(var dt=Pt-1;dt>=-1;dt--){var Ri=dt===-1?vt:ne[ue[dt]];if(Ri&o){Ri===O&&Ce(ii,b);break}}}if(Ee.get(O))for(var Et=0;Et<ue.length;Et++){var Ot=ue[Et];ne[Ot]&O&&Ce(Ot,I)}if(Ee.get(S)||Ee.get(M))for(var pi=1;pi<ue.length-1;pi++){var wn=ue[pi];if(ne[wn]&(S|M)){for(var jt=0,mt=0,Ht=pi-1;Ht>=0&&(jt=ne[ue[Ht]],!!(jt&c));Ht--);for(var _t=pi+1;_t<ue.length&&(mt=ne[ue[_t]],!!(mt&c));_t++);jt===mt&&(ne[wn]===S?jt===B:jt&(B|b))&&Ce(wn,jt)}}if(Ee.get(B))for(var rt=0;rt<ue.length;rt++){var Ci=ue[rt];if(ne[Ci]&B){for(var Ni=rt-1;Ni>=0&&ne[ue[Ni]]&(U|c);Ni--)Ce(ue[Ni],B);for(rt++;rt<ue.length&&ne[ue[rt]]&(U|c|B);rt++)ne[ue[rt]]!==B&&Ce(ue[rt],B)}}if(Ee.get(U)||Ee.get(S)||Ee.get(M))for(var qt=0;qt<ue.length;qt++){var Ji=ue[qt];if(ne[Ji]&(U|S|M)){Ce(Ji,G);for(var $s=qt-1;$s>=0&&ne[ue[$s]]&c;$s--)Ce(ue[$s],G);for(var eo=qt+1;eo<ue.length&&ne[ue[eo]]&c;eo++)Ce(ue[eo],G)}}if(Ee.get(B))for(var Ma=0,tu=vt;Ma<ue.length;Ma++){var iu=ue[Ma],Ta=ne[iu];Ta&B?tu===w&&Ce(iu,w):Ta&o&&(tu=Ta)}if(Ee.get(a)){var ts=I|B|b,nu=ts|w,to=[];{for(var dr=[],mr=0;mr<ue.length;mr++)if(ne[ue[mr]]&a){var is=se[ue[mr]],ru=void 0;if(_(is)!==null)if(dr.length<63)dr.push({char:is,seqIndex:mr});else break;else if((ru=E(is))!==null)for(var ns=dr.length-1;ns>=0;ns--){var Da=dr[ns].char;if(Da===ru||Da===E(C(is))||_(C(Da))===is){to.push([dr[ns].seqIndex,mr]),dr.length=ns;break}}}to.sort(function(wi,en){return wi[0]-en[0]})}for(var Ra=0;Ra<to.length;Ra++){for(var su=to[Ra],io=su[0],Pa=su[1],ou=!1,$i=0,Qa=io+1;Qa<Pa;Qa++){var au=ue[Qa];if(ne[au]&nu){ou=!0;var cu=ne[au]&ts?I:w;if(cu===Ue){$i=cu;break}}}if(ou&&!$i){$i=vt;for(var za=io-1;za>=0;za--){var lu=ue[za];if(ne[lu]&nu){var uu=ne[lu]&ts?I:w;uu!==Ue?$i=uu:$i=Ue;break}}}if($i){if(ne[ue[io]]=ne[ue[Pa]]=$i,$i!==Ue){for(var rs=io+1;rs<ue.length;rs++)if(!(ne[ue[rs]]&c)){A(se[ue[rs]])&X&&(ne[ue[rs]]=$i);break}}if($i!==Ue){for(var ss=Pa+1;ss<ue.length;ss++)if(!(ne[ue[ss]]&c)){A(se[ue[ss]])&X&&(ne[ue[ss]]=$i);break}}}}for(var Pn=0;Pn<ue.length;Pn++)if(ne[ue[Pn]]&a){for(var hu=Pn,Fa=Pn,Ua=vt,os=Pn-1;os>=0;os--)if(ne[ue[os]]&c)hu=os;else{Ua=ne[ue[os]]&ts?I:w;break}for(var fu=Ne,as=Pn+1;as<ue.length;as++)if(ne[ue[as]]&(a|c))Fa=as;else{fu=ne[ue[as]]&ts?I:w;break}for(var ka=hu;ka<=Fa;ka++)ne[ue[ka]]=Ua===fu?Ua:Ue;Pn=Fa}}}for(var Pi=Re.start;Pi<=Re.end;Pi++){var Yf=xe[Pi],no=ne[Pi];if(Yf&1?no&(w|B|b)&&xe[Pi]++:no&I?xe[Pi]++:no&(b|B)&&(xe[Pi]+=2),no&c&&(xe[Pi]=Pi===0?Re.level:xe[Pi-1]),Pi===Re.end||A(se[Pi])&(N|D))for(var ro=Pi;ro>=0&&A(se[ro])&l;ro--)xe[ro]=Re.level}}return{levels:xe,paragraphs:De};function Au(wi,en){for(var Ii=wi;Ii<se.length;Ii++){var Qn=ne[Ii];if(Qn&(I|O))return 1;if(Qn&(D|w)||en&&Qn===Q)return 0;if(Qn&i){var du=jf(Ii);Ii=du===-1?se.length:du}}return 0}function jf(wi){for(var en=1,Ii=wi+1;Ii<se.length;Ii++){var Qn=ne[Ii];if(Qn&D)break;if(Qn&Q){if(--en===0)return Ii}else Qn&i&&en++}return-1}}var ie="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Z;function ee(){if(!Z){var se=p(ie,!0),K=se.map,Y=se.reverseMap;Y.forEach(function(ne,ve){K.set(ve,ne)}),Z=K}}function ge(se){return ee(),Z.get(se)||null}function pe(se,K,Y,ne){var ve=se.length;Y=Math.max(0,Y==null?0:+Y),ne=Math.min(ve-1,ne==null?ve-1:+ne);for(var Ee=new Map,Ce=Y;Ce<=ne;Ce++)if(K[Ce]&1){var xe=ge(se[Ce]);xe!==null&&Ee.set(Ce,xe)}return Ee}function te(se,K,Y,ne){var ve=se.length;Y=Math.max(0,Y==null?0:+Y),ne=Math.min(ve-1,ne==null?ve-1:+ne);var Ee=[];return K.paragraphs.forEach(function(Ce){var xe=Math.max(Y,Ce.start),Oe=Math.min(ne,Ce.end);if(xe<Oe){for(var De=K.levels.slice(xe,Oe+1),Re=Oe;Re>=xe&&A(se[Re])&l;Re--)De[Re]=Ce.level;for(var Pe=Ce.level,ke=1/0,Ke=0;Ke<De.length;Ke++){var ot=De[Ke];ot>Pe&&(Pe=ot),ot<ke&&(ke=ot|1)}for(var He=Pe;He>=ke;He--)for(var Le=0;Le<De.length;Le++)if(De[Le]>=He){for(var Fe=Le;Le+1<De.length&&De[Le+1]>=He;)Le++;Le>Fe&&Ee.push([Fe+xe,Le+xe])}}}),Ee}function ae(se,K,Y,ne){var ve=de(se,K,Y,ne),Ee=[].concat(se);return ve.forEach(function(Ce,xe){Ee[xe]=(K.levels[Ce]&1?ge(se[Ce]):null)||se[Ce]}),Ee.join("")}function de(se,K,Y,ne){for(var ve=te(se,K,Y,ne),Ee=[],Ce=0;Ce<se.length;Ce++)Ee[Ce]=Ce;return ve.forEach(function(xe){for(var Oe=xe[0],De=xe[1],Re=Ee.slice(Oe,De+1),Pe=Re.length;Pe--;)Ee[De-Pe]=Re[Pe]}),Ee}return e.closingToOpeningBracket=E,e.getBidiCharType=A,e.getBidiCharTypeName=d,e.getCanonicalBracket=C,e.getEmbeddingLevels=J,e.getMirroredCharacter=ge,e.getMirroredCharactersMap=pe,e.getReorderSegments=te,e.getReorderedIndices=de,e.getReorderedString=ae,e.openingToClosingBracket=_,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return s}const L1=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ll(s){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function n(r,t){let i=Wr[t];return i?ll(i):r}return s.replace(e,n)}const li=[];for(let s=0;s<256;s++)li[s]=(s<16?"0":"")+s.toString(16);function i2(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(li[s&255]+li[s>>8&255]+li[s>>16&255]+li[s>>24&255]+"-"+li[e&255]+li[e>>8&255]+"-"+li[e>>16&15|64]+li[e>>24&255]+"-"+li[n&63|128]+li[n>>8&255]+"-"+li[n>>16&255]+li[n>>24&255]+li[r&255]+li[r>>8&255]+li[r>>16&255]+li[r>>24&255]).toUpperCase()}const er=Object.assign||function(){let s=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let r=arguments[e];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},n2=Date.now(),Ou=new WeakMap,Nu=new Map;let r2=1e10;function ul(s,e){const n=c2(e);let r=Ou.get(s);if(r||Ou.set(s,r=Object.create(null)),r[n])return new r[n];const t=`_onBeforeCompile${n}`,i=function(l,u){s.onBeforeCompile.call(this,l,u);const f=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let A=Nu[f];if(!A){const d=s2(this,l,e,n);A=Nu[f]=d}l.vertexShader=A.vertexShader,l.fragmentShader=A.fragmentShader,er(l.uniforms,this.uniforms),e.timeUniform&&(l.uniforms[e.timeUniform]={get value(){return Date.now()-n2}}),this[t]&&this[t](l)},o=function(){return a(e.chained?s:s.clone())},a=function(l){const u=Object.create(l,c);return Object.defineProperty(u,"baseMaterial",{value:s}),Object.defineProperty(u,"id",{value:r2++}),u.uuid=i2(),u.uniforms=er({},l.uniforms,e.uniforms),u.defines=er({},l.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",u.extensions=er({},l.extensions,e.extensions),u._listeners=void 0,u},c={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>s.type,set:l=>{s.type=l}},isDerivedFrom:{writable:!0,configurable:!0,value:function(l){const u=this.baseMaterial;return l===u||u.isDerivedMaterial&&u.isDerivedFrom(l)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return s.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get(){return i},set(l){this[t]=l}},copy:{writable:!0,configurable:!0,value:function(l){return s.copy.call(this,l),!s.isShaderMaterial&&!s.isDerivedMaterial&&(er(this.extensions,l.extensions),er(this.defines,l.defines),er(this.uniforms,Xr.clone(l.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const l=new s.constructor;return a(l).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let l=this._depthMaterial;return l||(l=this._depthMaterial=ul(s.isDerivedMaterial?s.getDepthMaterial():new jh({depthPacking:qh}),e),l.defines.IS_DEPTH_MATERIAL="",l.uniforms=this.uniforms),l}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let l=this._distanceMaterial;return l||(l=this._distanceMaterial=ul(s.isDerivedMaterial?s.getDistanceMaterial():new gA,e),l.defines.IS_DISTANCE_MATERIAL="",l.uniforms=this.uniforms),l}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:l,_distanceMaterial:u}=this;l&&l.dispose(),u&&u.dispose(),s.dispose.call(this)}}};return r[n]=o,new o}function s2(s,{vertexShader:e,fragmentShader:n},r,t){let{vertexDefs:i,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:c,fragmentDefs:l,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:A,customRewriter:d,timeUniform:x}=r;if(i=i||"",o=o||"",a=a||"",l=l||"",u=u||"",f=f||"",(c||d)&&(e=ll(e)),(A||d)&&(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),n=ll(n)),d){let p=d({vertexShader:e,fragmentShader:n});e=p.vertexShader,n=p.fragmentShader}if(A){let p=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(p.push(v),"")),f=`${A}
${p.join(`
`)}
${f}`}if(x){const p=`
uniform float ${x};
`;i=p+i,l=p+l}return c&&(e=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${e}
`,i=`${i}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${c}
}
`,o=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(p,v,y,g)=>/\battribute\s+vec[23]\s+$/.test(g.substr(0,y))?v:`troika_${v}_${t}`),s.map&&s.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),e=Gu(e,t,i,o,a),n=Gu(n,t,l,u,f),{vertexShader:e,fragmentShader:n}}function Gu(s,e,n,r,t){return(r||t||n)&&(s=s.replace(L1,`
${n}
void troikaOrigMain${e}() {`),s+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${t}
}`),s}function o2(s,e){return s==="uniforms"?void 0:typeof e=="function"?e.toString():e}let a2=0;const Hu=new Map;function c2(s){const e=JSON.stringify(s,o2);let n=Hu.get(e);return n==null&&Hu.set(e,n=++a2),n}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function l2(){return typeof window>"u"&&(self.window=self),function(s){var e={parse:function(t){var i=e._bin,o=new Uint8Array(t);if(i.readASCII(o,0,4)=="ttcf"){var a=4;i.readUshort(o,a),a+=2,i.readUshort(o,a),a+=2;var c=i.readUint(o,a);a+=4;for(var l=[],u=0;u<c;u++){var f=i.readUint(o,a);a+=4,l.push(e._readFont(o,f))}return l}return[e._readFont(o,0)]},_readFont:function(t,i){var o=e._bin,a=i;o.readFixed(t,i),i+=4;var c=o.readUshort(t,i);i+=2,o.readUshort(t,i),i+=2,o.readUshort(t,i),i+=2,o.readUshort(t,i),i+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:t,_offset:a},f={},A=0;A<c;A++){var d=o.readASCII(t,i,4);i+=4,o.readUint(t,i),i+=4;var x=o.readUint(t,i);i+=4;var p=o.readUint(t,i);i+=4,f[d]={offset:x,length:p}}for(A=0;A<l.length;A++){var v=l[A];f[v]&&(u[v.trim()]=e[v.trim()].parse(t,f[v].offset,f[v].length,u))}return u},_tabOffset:function(t,i,o){for(var a=e._bin,c=a.readUshort(t,o+4),l=o+12,u=0;u<c;u++){var f=a.readASCII(t,l,4);l+=4,a.readUint(t,l),l+=4;var A=a.readUint(t,l);if(l+=4,a.readUint(t,l),l+=4,f==i)return A}return 0}};e._bin={readFixed:function(t,i){return(t[i]<<8|t[i+1])+(t[i+2]<<8|t[i+3])/65540},readF2dot14:function(t,i){return e._bin.readShort(t,i)/16384},readInt:function(t,i){return e._bin._view(t).getInt32(i)},readInt8:function(t,i){return e._bin._view(t).getInt8(i)},readShort:function(t,i){return e._bin._view(t).getInt16(i)},readUshort:function(t,i){return e._bin._view(t).getUint16(i)},readUshorts:function(t,i,o){for(var a=[],c=0;c<o;c++)a.push(e._bin.readUshort(t,i+2*c));return a},readUint:function(t,i){return e._bin._view(t).getUint32(i)},readUint64:function(t,i){return 4294967296*e._bin.readUint(t,i)+e._bin.readUint(t,i+4)},readASCII:function(t,i,o){for(var a="",c=0;c<o;c++)a+=String.fromCharCode(t[i+c]);return a},readUnicode:function(t,i,o){for(var a="",c=0;c<o;c++){var l=t[i++]<<8|t[i++];a+=String.fromCharCode(l)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,i,o){var a=e._bin._tdec;return a&&i==0&&o==t.length?a.decode(t):e._bin.readASCII(t,i,o)},readBytes:function(t,i,o){for(var a=[],c=0;c<o;c++)a.push(t[i+c]);return a},readASCIIArray:function(t,i,o){for(var a=[],c=0;c<o;c++)a.push(String.fromCharCode(t[i+c]));return a},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},e._lctf={},e._lctf.parse=function(t,i,o,a,c){var l=e._bin,u={},f=i;l.readFixed(t,i),i+=4;var A=l.readUshort(t,i);i+=2;var d=l.readUshort(t,i);i+=2;var x=l.readUshort(t,i);return i+=2,u.scriptList=e._lctf.readScriptList(t,f+A),u.featureList=e._lctf.readFeatureList(t,f+d),u.lookupList=e._lctf.readLookupList(t,f+x,c),u},e._lctf.readLookupList=function(t,i,o){var a=e._bin,c=i,l=[],u=a.readUshort(t,i);i+=2;for(var f=0;f<u;f++){var A=a.readUshort(t,i);i+=2;var d=e._lctf.readLookupTable(t,c+A,o);l.push(d)}return l},e._lctf.readLookupTable=function(t,i,o){var a=e._bin,c=i,l={tabs:[]};l.ltype=a.readUshort(t,i),i+=2,l.flag=a.readUshort(t,i),i+=2;var u=a.readUshort(t,i);i+=2;for(var f=l.ltype,A=0;A<u;A++){var d=a.readUshort(t,i);i+=2;var x=o(t,f,c+d,l);l.tabs.push(x)}return l},e._lctf.numOfOnes=function(t){for(var i=0,o=0;o<32;o++)(t>>>o&1)!=0&&i++;return i},e._lctf.readClassDef=function(t,i){var o=e._bin,a=[],c=o.readUshort(t,i);if(i+=2,c==1){var l=o.readUshort(t,i);i+=2;var u=o.readUshort(t,i);i+=2;for(var f=0;f<u;f++)a.push(l+f),a.push(l+f),a.push(o.readUshort(t,i)),i+=2}if(c==2){var A=o.readUshort(t,i);for(i+=2,f=0;f<A;f++)a.push(o.readUshort(t,i)),i+=2,a.push(o.readUshort(t,i)),i+=2,a.push(o.readUshort(t,i)),i+=2}return a},e._lctf.getInterval=function(t,i){for(var o=0;o<t.length;o+=3){var a=t[o],c=t[o+1];if(t[o+2],a<=i&&i<=c)return o}return-1},e._lctf.readCoverage=function(t,i){var o=e._bin,a={};a.fmt=o.readUshort(t,i),i+=2;var c=o.readUshort(t,i);return i+=2,a.fmt==1&&(a.tab=o.readUshorts(t,i,c)),a.fmt==2&&(a.tab=o.readUshorts(t,i,3*c)),a},e._lctf.coverageIndex=function(t,i){var o=t.tab;if(t.fmt==1)return o.indexOf(i);if(t.fmt==2){var a=e._lctf.getInterval(o,i);if(a!=-1)return o[a+2]+(i-o[a])}return-1},e._lctf.readFeatureList=function(t,i){var o=e._bin,a=i,c=[],l=o.readUshort(t,i);i+=2;for(var u=0;u<l;u++){var f=o.readASCII(t,i,4);i+=4;var A=o.readUshort(t,i);i+=2;var d=e._lctf.readFeatureTable(t,a+A);d.tag=f.trim(),c.push(d)}return c},e._lctf.readFeatureTable=function(t,i){var o=e._bin,a=i,c={},l=o.readUshort(t,i);i+=2,l>0&&(c.featureParams=a+l);var u=o.readUshort(t,i);i+=2,c.tab=[];for(var f=0;f<u;f++)c.tab.push(o.readUshort(t,i+2*f));return c},e._lctf.readScriptList=function(t,i){var o=e._bin,a=i,c={},l=o.readUshort(t,i);i+=2;for(var u=0;u<l;u++){var f=o.readASCII(t,i,4);i+=4;var A=o.readUshort(t,i);i+=2,c[f.trim()]=e._lctf.readScriptTable(t,a+A)}return c},e._lctf.readScriptTable=function(t,i){var o=e._bin,a=i,c={},l=o.readUshort(t,i);i+=2,l>0&&(c.default=e._lctf.readLangSysTable(t,a+l));var u=o.readUshort(t,i);i+=2;for(var f=0;f<u;f++){var A=o.readASCII(t,i,4);i+=4;var d=o.readUshort(t,i);i+=2,c[A.trim()]=e._lctf.readLangSysTable(t,a+d)}return c},e._lctf.readLangSysTable=function(t,i){var o=e._bin,a={};o.readUshort(t,i),i+=2,a.reqFeature=o.readUshort(t,i),i+=2;var c=o.readUshort(t,i);return i+=2,a.features=o.readUshorts(t,i,c),a},e.CFF={},e.CFF.parse=function(t,i,o){var a=e._bin;(t=new Uint8Array(t.buffer,i,o))[i=0],t[++i],t[++i],t[++i],i++;var c=[];i=e.CFF.readIndex(t,i,c);for(var l=[],u=0;u<c.length-1;u++)l.push(a.readASCII(t,i+c[u],c[u+1]-c[u]));i+=c[c.length-1];var f=[];i=e.CFF.readIndex(t,i,f);var A=[];for(u=0;u<f.length-1;u++)A.push(e.CFF.readDict(t,i+f[u],i+f[u+1]));i+=f[f.length-1];var d=A[0],x=[];i=e.CFF.readIndex(t,i,x);var p=[];for(u=0;u<x.length-1;u++)p.push(a.readASCII(t,i+x[u],x[u+1]-x[u]));if(i+=x[x.length-1],e.CFF.readSubrs(t,i,d),d.CharStrings){i=d.CharStrings,x=[],i=e.CFF.readIndex(t,i,x);var v=[];for(u=0;u<x.length-1;u++)v.push(a.readBytes(t,i+x[u],x[u+1]-x[u]));d.CharStrings=v}if(d.ROS){i=d.FDArray;var y=[];for(i=e.CFF.readIndex(t,i,y),d.FDArray=[],u=0;u<y.length-1;u++){var g=e.CFF.readDict(t,i+y[u],i+y[u+1]);e.CFF._readFDict(t,g,p),d.FDArray.push(g)}i+=y[y.length-1],i=d.FDSelect,d.FDSelect=[];var m=t[i];if(i++,m!=3)throw m;var _=a.readUshort(t,i);for(i+=2,u=0;u<_+1;u++)d.FDSelect.push(a.readUshort(t,i),t[i+2]),i+=3}return d.Encoding&&(d.Encoding=e.CFF.readEncoding(t,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=e.CFF.readCharset(t,d.charset,d.CharStrings.length)),e.CFF._readFDict(t,d,p),d},e.CFF._readFDict=function(t,i,o){var a;for(var c in i.Private&&(a=i.Private[1],i.Private=e.CFF.readDict(t,a,a+i.Private[0]),i.Private.Subrs&&e.CFF.readSubrs(t,a+i.Private.Subrs,i.Private)),i)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(c)!=-1&&(i[c]=o[i[c]-426+35])},e.CFF.readSubrs=function(t,i,o){var a=e._bin,c=[];i=e.CFF.readIndex(t,i,c);var l,u=c.length;l=u<1240?107:u<33900?1131:32768,o.Bias=l,o.Subrs=[];for(var f=0;f<c.length-1;f++)o.Subrs.push(a.readBytes(t,i+c[f],c[f+1]-c[f]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(t,i){for(var o=0;o<t.charset.length;o++)if(t.charset[o]==i)return o;return-1},e.CFF.glyphBySE=function(t,i){return i<0||i>255?-1:e.CFF.glyphByUnicode(t,e.CFF.tableSE[i])},e.CFF.readEncoding=function(t,i,o){e._bin;var a=[".notdef"],c=t[i];if(i++,c!=0)throw"error: unknown encoding format: "+c;var l=t[i];i++;for(var u=0;u<l;u++)a.push(t[i+u]);return a},e.CFF.readCharset=function(t,i,o){var a=e._bin,c=[".notdef"],l=t[i];if(i++,l==0)for(var u=0;u<o;u++){var f=a.readUshort(t,i);i+=2,c.push(f)}else{if(l!=1&&l!=2)throw"error: format: "+l;for(;c.length<o;){f=a.readUshort(t,i),i+=2;var A=0;for(l==1?(A=t[i],i++):(A=a.readUshort(t,i),i+=2),u=0;u<=A;u++)c.push(f),f++}}return c},e.CFF.readIndex=function(t,i,o){var a=e._bin,c=a.readUshort(t,i)+1,l=t[i+=2];if(i++,l==1)for(var u=0;u<c;u++)o.push(t[i+u]);else if(l==2)for(u=0;u<c;u++)o.push(a.readUshort(t,i+2*u));else if(l==3)for(u=0;u<c;u++)o.push(16777215&a.readUint(t,i+3*u-1));else if(c!=1)throw"unsupported offset size: "+l+", count: "+c;return(i+=c*l)-1},e.CFF.getCharString=function(t,i,o){var a=e._bin,c=t[i],l=t[i+1];t[i+2],t[i+3],t[i+4];var u=1,f=null,A=null;c<=20&&(f=c,u=1),c==12&&(f=100*c+l,u=2),21<=c&&c<=27&&(f=c,u=1),c==28&&(A=a.readShort(t,i+1),u=3),29<=c&&c<=31&&(f=c,u=1),32<=c&&c<=246&&(A=c-139,u=1),247<=c&&c<=250&&(A=256*(c-247)+l+108,u=2),251<=c&&c<=254&&(A=256*-(c-251)-l-108,u=2),c==255&&(A=a.readInt(t,i+1)/65535,u=5),o.val=A??"o"+f,o.size=u},e.CFF.readCharString=function(t,i,o){for(var a=i+o,c=e._bin,l=[];i<a;){var u=t[i],f=t[i+1];t[i+2],t[i+3],t[i+4];var A=1,d=null,x=null;u<=20&&(d=u,A=1),u==12&&(d=100*u+f,A=2),u!=19&&u!=20||(d=u,A=2),21<=u&&u<=27&&(d=u,A=1),u==28&&(x=c.readShort(t,i+1),A=3),29<=u&&u<=31&&(d=u,A=1),32<=u&&u<=246&&(x=u-139,A=1),247<=u&&u<=250&&(x=256*(u-247)+f+108,A=2),251<=u&&u<=254&&(x=256*-(u-251)-f-108,A=2),u==255&&(x=c.readInt(t,i+1)/65535,A=5),l.push(x??"o"+d),i+=A}return l},e.CFF.readDict=function(t,i,o){for(var a=e._bin,c={},l=[];i<o;){var u=t[i],f=t[i+1];t[i+2],t[i+3],t[i+4];var A=1,d=null,x=null;if(u==28&&(x=a.readShort(t,i+1),A=3),u==29&&(x=a.readInt(t,i+1),A=5),32<=u&&u<=246&&(x=u-139,A=1),247<=u&&u<=250&&(x=256*(u-247)+f+108,A=2),251<=u&&u<=254&&(x=256*-(u-251)-f-108,A=2),u==255)throw x=a.readInt(t,i+1)/65535,A=5,"unknown number";if(u==30){var p=[];for(A=1;;){var v=t[i+A];A++;var y=v>>4,g=15&v;if(y!=15&&p.push(y),g!=15&&p.push(g),g==15)break}for(var m="",_=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],E=0;E<p.length;E++)m+=_[p[E]];x=parseFloat(m)}u<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],A=1,u==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],A=2)),d!=null?(c[d]=l.length==1?l[0]:l,l=[]):l.push(x),i+=A}return c},e.cmap={},e.cmap.parse=function(t,i,o){t=new Uint8Array(t.buffer,i,o),i=0;var a=e._bin,c={};a.readUshort(t,i),i+=2;var l=a.readUshort(t,i);i+=2;var u=[];c.tables=[];for(var f=0;f<l;f++){var A=a.readUshort(t,i);i+=2;var d=a.readUshort(t,i);i+=2;var x=a.readUint(t,i);i+=4;var p="p"+A+"e"+d,v=u.indexOf(x);if(v==-1){var y;v=c.tables.length,u.push(x);var g=a.readUshort(t,x);g==0?y=e.cmap.parse0(t,x):g==4?y=e.cmap.parse4(t,x):g==6?y=e.cmap.parse6(t,x):g==12?y=e.cmap.parse12(t,x):console.debug("unknown format: "+g,A,d,x),c.tables.push(y)}if(c[p]!=null)throw"multiple tables for one platform+encoding";c[p]=v}return c},e.cmap.parse0=function(t,i){var o=e._bin,a={};a.format=o.readUshort(t,i),i+=2;var c=o.readUshort(t,i);i+=2,o.readUshort(t,i),i+=2,a.map=[];for(var l=0;l<c-6;l++)a.map.push(t[i+l]);return a},e.cmap.parse4=function(t,i){var o=e._bin,a=i,c={};c.format=o.readUshort(t,i),i+=2;var l=o.readUshort(t,i);i+=2,o.readUshort(t,i),i+=2;var u=o.readUshort(t,i);i+=2;var f=u/2;c.searchRange=o.readUshort(t,i),i+=2,c.entrySelector=o.readUshort(t,i),i+=2,c.rangeShift=o.readUshort(t,i),i+=2,c.endCount=o.readUshorts(t,i,f),i+=2*f,i+=2,c.startCount=o.readUshorts(t,i,f),i+=2*f,c.idDelta=[];for(var A=0;A<f;A++)c.idDelta.push(o.readShort(t,i)),i+=2;for(c.idRangeOffset=o.readUshorts(t,i,f),i+=2*f,c.glyphIdArray=[];i<a+l;)c.glyphIdArray.push(o.readUshort(t,i)),i+=2;return c},e.cmap.parse6=function(t,i){var o=e._bin,a={};a.format=o.readUshort(t,i),i+=2,o.readUshort(t,i),i+=2,o.readUshort(t,i),i+=2,a.firstCode=o.readUshort(t,i),i+=2;var c=o.readUshort(t,i);i+=2,a.glyphIdArray=[];for(var l=0;l<c;l++)a.glyphIdArray.push(o.readUshort(t,i)),i+=2;return a},e.cmap.parse12=function(t,i){var o=e._bin,a={};a.format=o.readUshort(t,i),i+=2,i+=2,o.readUint(t,i),i+=4,o.readUint(t,i),i+=4;var c=o.readUint(t,i);i+=4,a.groups=[];for(var l=0;l<c;l++){var u=i+12*l,f=o.readUint(t,u+0),A=o.readUint(t,u+4),d=o.readUint(t,u+8);a.groups.push([f,A,d])}return a},e.glyf={},e.glyf.parse=function(t,i,o,a){for(var c=[],l=0;l<a.maxp.numGlyphs;l++)c.push(null);return c},e.glyf._parseGlyf=function(t,i){var o=e._bin,a=t._data,c=e._tabOffset(a,"glyf",t._offset)+t.loca[i];if(t.loca[i]==t.loca[i+1])return null;var l={};if(l.noc=o.readShort(a,c),c+=2,l.xMin=o.readShort(a,c),c+=2,l.yMin=o.readShort(a,c),c+=2,l.xMax=o.readShort(a,c),c+=2,l.yMax=o.readShort(a,c),c+=2,l.xMin>=l.xMax||l.yMin>=l.yMax)return null;if(l.noc>0){l.endPts=[];for(var u=0;u<l.noc;u++)l.endPts.push(o.readUshort(a,c)),c+=2;var f=o.readUshort(a,c);if(c+=2,a.length-c<f)return null;l.instructions=o.readBytes(a,c,f),c+=f;var A=l.endPts[l.noc-1]+1;for(l.flags=[],u=0;u<A;u++){var d=a[c];if(c++,l.flags.push(d),(8&d)!=0){var x=a[c];c++;for(var p=0;p<x;p++)l.flags.push(d),u++}}for(l.xs=[],u=0;u<A;u++){var v=(2&l.flags[u])!=0,y=(16&l.flags[u])!=0;v?(l.xs.push(y?a[c]:-a[c]),c++):y?l.xs.push(0):(l.xs.push(o.readShort(a,c)),c+=2)}for(l.ys=[],u=0;u<A;u++)v=(4&l.flags[u])!=0,y=(32&l.flags[u])!=0,v?(l.ys.push(y?a[c]:-a[c]),c++):y?l.ys.push(0):(l.ys.push(o.readShort(a,c)),c+=2);var g=0,m=0;for(u=0;u<A;u++)g+=l.xs[u],m+=l.ys[u],l.xs[u]=g,l.ys[u]=m}else{var _;l.parts=[];do{_=o.readUshort(a,c),c+=2;var E={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(l.parts.push(E),E.glyphIndex=o.readUshort(a,c),c+=2,1&_){var C=o.readShort(a,c);c+=2;var w=o.readShort(a,c);c+=2}else C=o.readInt8(a,c),c++,w=o.readInt8(a,c),c++;2&_?(E.m.tx=C,E.m.ty=w):(E.p1=C,E.p2=w),8&_?(E.m.a=E.m.d=o.readF2dot14(a,c),c+=2):64&_?(E.m.a=o.readF2dot14(a,c),c+=2,E.m.d=o.readF2dot14(a,c),c+=2):128&_&&(E.m.a=o.readF2dot14(a,c),c+=2,E.m.b=o.readF2dot14(a,c),c+=2,E.m.c=o.readF2dot14(a,c),c+=2,E.m.d=o.readF2dot14(a,c),c+=2)}while(32&_);if(256&_){var I=o.readUshort(a,c);for(c+=2,l.instr=[],u=0;u<I;u++)l.instr.push(a[c]),c++}}return l},e.GDEF={},e.GDEF.parse=function(t,i,o,a){var c=i;i+=4;var l=e._bin.readUshort(t,i);return{glyphClassDef:l===0?null:e._lctf.readClassDef(t,c+l)}},e.GPOS={},e.GPOS.parse=function(t,i,o,a){return e._lctf.parse(t,i,o,a,e.GPOS.subt)},e.GPOS.subt=function(t,i,o,a){var c=e._bin,l=o,u={};if(u.fmt=c.readUshort(t,o),o+=2,i==1||i==2||i==3||i==7||i==8&&u.fmt<=2){var f=c.readUshort(t,o);o+=2,u.coverage=e._lctf.readCoverage(t,f+l)}if(i==1&&u.fmt==1){var A=c.readUshort(t,o);o+=2,A!=0&&(u.pos=e.GPOS.readValueRecord(t,o,A))}else if(i==2&&u.fmt>=1&&u.fmt<=2){A=c.readUshort(t,o),o+=2;var d=c.readUshort(t,o);o+=2;var x=e._lctf.numOfOnes(A),p=e._lctf.numOfOnes(d);if(u.fmt==1){u.pairsets=[];var v=c.readUshort(t,o);o+=2;for(var y=0;y<v;y++){var g=l+c.readUshort(t,o);o+=2;var m=c.readUshort(t,g);g+=2;for(var _=[],E=0;E<m;E++){var C=c.readUshort(t,g);g+=2,A!=0&&(b=e.GPOS.readValueRecord(t,g,A),g+=2*x),d!=0&&(M=e.GPOS.readValueRecord(t,g,d),g+=2*p),_.push({gid2:C,val1:b,val2:M})}u.pairsets.push(_)}}if(u.fmt==2){var w=c.readUshort(t,o);o+=2;var I=c.readUshort(t,o);o+=2;var B=c.readUshort(t,o);o+=2;var S=c.readUshort(t,o);for(o+=2,u.classDef1=e._lctf.readClassDef(t,l+w),u.classDef2=e._lctf.readClassDef(t,l+I),u.matrix=[],y=0;y<B;y++){var U=[];for(E=0;E<S;E++){var b=null,M=null;A!=0&&(b=e.GPOS.readValueRecord(t,o,A),o+=2*x),d!=0&&(M=e.GPOS.readValueRecord(t,o,d),o+=2*p),U.push({val1:b,val2:M})}u.matrix.push(U)}}}else if(i==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(t,c.readUshort(t,o)+l),u.baseCoverage=e._lctf.readCoverage(t,c.readUshort(t,o+2)+l),u.markClassCount=c.readUshort(t,o+4),u.markArray=e.GPOS.readMarkArray(t,c.readUshort(t,o+6)+l),u.baseArray=e.GPOS.readBaseArray(t,c.readUshort(t,o+8)+l,u.markClassCount);else if(i==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(t,c.readUshort(t,o)+l),u.mark2Coverage=e._lctf.readCoverage(t,c.readUshort(t,o+2)+l),u.markClassCount=c.readUshort(t,o+4),u.mark1Array=e.GPOS.readMarkArray(t,c.readUshort(t,o+6)+l),u.mark2Array=e.GPOS.readBaseArray(t,c.readUshort(t,o+8)+l,u.markClassCount);else{if(i==9&&u.fmt==1){var D=c.readUshort(t,o);o+=2;var N=c.readUint(t,o);if(o+=4,a.ltype==9)a.ltype=D;else if(a.ltype!=D)throw"invalid extension substitution";return e.GPOS.subt(t,a.ltype,l+N)}console.debug("unsupported GPOS table LookupType",i,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(t,i,o){var a=e._bin,c=[];return c.push(1&o?a.readShort(t,i):0),i+=1&o?2:0,c.push(2&o?a.readShort(t,i):0),i+=2&o?2:0,c.push(4&o?a.readShort(t,i):0),i+=4&o?2:0,c.push(8&o?a.readShort(t,i):0),i+=8&o?2:0,c},e.GPOS.readBaseArray=function(t,i,o){var a=e._bin,c=[],l=i,u=a.readUshort(t,i);i+=2;for(var f=0;f<u;f++){for(var A=[],d=0;d<o;d++)A.push(e.GPOS.readAnchorRecord(t,l+a.readUshort(t,i))),i+=2;c.push(A)}return c},e.GPOS.readMarkArray=function(t,i){var o=e._bin,a=[],c=i,l=o.readUshort(t,i);i+=2;for(var u=0;u<l;u++){var f=e.GPOS.readAnchorRecord(t,o.readUshort(t,i+2)+c);f.markClass=o.readUshort(t,i),a.push(f),i+=4}return a},e.GPOS.readAnchorRecord=function(t,i){var o=e._bin,a={};return a.fmt=o.readUshort(t,i),a.x=o.readShort(t,i+2),a.y=o.readShort(t,i+4),a},e.GSUB={},e.GSUB.parse=function(t,i,o,a){return e._lctf.parse(t,i,o,a,e.GSUB.subt)},e.GSUB.subt=function(t,i,o,a){var c=e._bin,l=o,u={};if(u.fmt=c.readUshort(t,o),o+=2,i!=1&&i!=2&&i!=4&&i!=5&&i!=6)return null;if(i==1||i==2||i==4||i==5&&u.fmt<=2||i==6&&u.fmt<=2){var f=c.readUshort(t,o);o+=2,u.coverage=e._lctf.readCoverage(t,l+f)}if(i==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=c.readShort(t,o),o+=2;else if(u.fmt==2){var A=c.readUshort(t,o);o+=2,u.newg=c.readUshorts(t,o,A),o+=2*u.newg.length}}else if(i==2&&u.fmt==1){A=c.readUshort(t,o),o+=2,u.seqs=[];for(var d=0;d<A;d++){var x=c.readUshort(t,o)+l;o+=2;var p=c.readUshort(t,x);u.seqs.push(c.readUshorts(t,x+2,p))}}else if(i==4)for(u.vals=[],A=c.readUshort(t,o),o+=2,d=0;d<A;d++){var v=c.readUshort(t,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(t,l+v))}else if(i==5&&u.fmt==2){if(u.fmt==2){var y=c.readUshort(t,o);o+=2,u.cDef=e._lctf.readClassDef(t,l+y),u.scset=[];var g=c.readUshort(t,o);for(o+=2,d=0;d<g;d++){var m=c.readUshort(t,o);o+=2,u.scset.push(m==0?null:e.GSUB.readSubClassSet(t,l+m))}}}else if(i==6&&u.fmt==3){if(u.fmt==3){for(d=0;d<3;d++){A=c.readUshort(t,o),o+=2;for(var _=[],E=0;E<A;E++)_.push(e._lctf.readCoverage(t,l+c.readUshort(t,o+2*E)));o+=2*A,d==0&&(u.backCvg=_),d==1&&(u.inptCvg=_),d==2&&(u.ahedCvg=_)}A=c.readUshort(t,o),o+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(t,o,A)}}else{if(i==7&&u.fmt==1){var C=c.readUshort(t,o);o+=2;var w=c.readUint(t,o);if(o+=4,a.ltype==9)a.ltype=C;else if(a.ltype!=C)throw"invalid extension substitution";return e.GSUB.subt(t,a.ltype,l+w)}console.debug("unsupported GSUB table LookupType",i,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(t,i){var o=e._bin.readUshort,a=i,c=[],l=o(t,i);i+=2;for(var u=0;u<l;u++){var f=o(t,i);i+=2,c.push(e.GSUB.readSubClassRule(t,a+f))}return c},e.GSUB.readSubClassRule=function(t,i){var o=e._bin.readUshort,a={},c=o(t,i),l=o(t,i+=2);i+=2,a.input=[];for(var u=0;u<c-1;u++)a.input.push(o(t,i)),i+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(t,i,l),a},e.GSUB.readSubstLookupRecords=function(t,i,o){for(var a=e._bin.readUshort,c=[],l=0;l<o;l++)c.push(a(t,i),a(t,i+2)),i+=4;return c},e.GSUB.readChainSubClassSet=function(t,i){var o=e._bin,a=i,c=[],l=o.readUshort(t,i);i+=2;for(var u=0;u<l;u++){var f=o.readUshort(t,i);i+=2,c.push(e.GSUB.readChainSubClassRule(t,a+f))}return c},e.GSUB.readChainSubClassRule=function(t,i){for(var o=e._bin,a={},c=["backtrack","input","lookahead"],l=0;l<c.length;l++){var u=o.readUshort(t,i);i+=2,l==1&&u--,a[c[l]]=o.readUshorts(t,i,u),i+=2*a[c[l]].length}return u=o.readUshort(t,i),i+=2,a.subst=o.readUshorts(t,i,2*u),i+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(t,i){var o=e._bin,a=i,c=[],l=o.readUshort(t,i);i+=2;for(var u=0;u<l;u++){var f=o.readUshort(t,i);i+=2,c.push(e.GSUB.readLigature(t,a+f))}return c},e.GSUB.readLigature=function(t,i){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(t,i),i+=2;var c=o.readUshort(t,i);i+=2;for(var l=0;l<c-1;l++)a.chain.push(o.readUshort(t,i)),i+=2;return a},e.head={},e.head.parse=function(t,i,o){var a=e._bin,c={};return a.readFixed(t,i),i+=4,c.fontRevision=a.readFixed(t,i),i+=4,a.readUint(t,i),i+=4,a.readUint(t,i),i+=4,c.flags=a.readUshort(t,i),i+=2,c.unitsPerEm=a.readUshort(t,i),i+=2,c.created=a.readUint64(t,i),i+=8,c.modified=a.readUint64(t,i),i+=8,c.xMin=a.readShort(t,i),i+=2,c.yMin=a.readShort(t,i),i+=2,c.xMax=a.readShort(t,i),i+=2,c.yMax=a.readShort(t,i),i+=2,c.macStyle=a.readUshort(t,i),i+=2,c.lowestRecPPEM=a.readUshort(t,i),i+=2,c.fontDirectionHint=a.readShort(t,i),i+=2,c.indexToLocFormat=a.readShort(t,i),i+=2,c.glyphDataFormat=a.readShort(t,i),i+=2,c},e.hhea={},e.hhea.parse=function(t,i,o){var a=e._bin,c={};return a.readFixed(t,i),i+=4,c.ascender=a.readShort(t,i),i+=2,c.descender=a.readShort(t,i),i+=2,c.lineGap=a.readShort(t,i),i+=2,c.advanceWidthMax=a.readUshort(t,i),i+=2,c.minLeftSideBearing=a.readShort(t,i),i+=2,c.minRightSideBearing=a.readShort(t,i),i+=2,c.xMaxExtent=a.readShort(t,i),i+=2,c.caretSlopeRise=a.readShort(t,i),i+=2,c.caretSlopeRun=a.readShort(t,i),i+=2,c.caretOffset=a.readShort(t,i),i+=2,i+=8,c.metricDataFormat=a.readShort(t,i),i+=2,c.numberOfHMetrics=a.readUshort(t,i),i+=2,c},e.hmtx={},e.hmtx.parse=function(t,i,o,a){for(var c=e._bin,l={aWidth:[],lsBearing:[]},u=0,f=0,A=0;A<a.maxp.numGlyphs;A++)A<a.hhea.numberOfHMetrics&&(u=c.readUshort(t,i),i+=2,f=c.readShort(t,i),i+=2),l.aWidth.push(u),l.lsBearing.push(f);return l},e.kern={},e.kern.parse=function(t,i,o,a){var c=e._bin,l=c.readUshort(t,i);if(i+=2,l==1)return e.kern.parseV1(t,i-2,o,a);var u=c.readUshort(t,i);i+=2;for(var f={glyph1:[],rval:[]},A=0;A<u;A++){i+=2,o=c.readUshort(t,i),i+=2;var d=c.readUshort(t,i);i+=2;var x=d>>>8;if((x&=15)!=0)throw"unknown kern table format: "+x;i=e.kern.readFormat0(t,i,f)}return f},e.kern.parseV1=function(t,i,o,a){var c=e._bin;c.readFixed(t,i),i+=4;var l=c.readUint(t,i);i+=4;for(var u={glyph1:[],rval:[]},f=0;f<l;f++){c.readUint(t,i),i+=4;var A=c.readUshort(t,i);i+=2,c.readUshort(t,i),i+=2;var d=A>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;i=e.kern.readFormat0(t,i,u)}return u},e.kern.readFormat0=function(t,i,o){var a=e._bin,c=-1,l=a.readUshort(t,i);i+=2,a.readUshort(t,i),i+=2,a.readUshort(t,i),i+=2,a.readUshort(t,i),i+=2;for(var u=0;u<l;u++){var f=a.readUshort(t,i);i+=2;var A=a.readUshort(t,i);i+=2;var d=a.readShort(t,i);i+=2,f!=c&&(o.glyph1.push(f),o.rval.push({glyph2:[],vals:[]}));var x=o.rval[o.rval.length-1];x.glyph2.push(A),x.vals.push(d),c=f}return i},e.loca={},e.loca.parse=function(t,i,o,a){var c=e._bin,l=[],u=a.head.indexToLocFormat,f=a.maxp.numGlyphs+1;if(u==0)for(var A=0;A<f;A++)l.push(c.readUshort(t,i+(A<<1))<<1);if(u==1)for(A=0;A<f;A++)l.push(c.readUint(t,i+(A<<2)));return l},e.maxp={},e.maxp.parse=function(t,i,o){var a=e._bin,c={},l=a.readUint(t,i);return i+=4,c.numGlyphs=a.readUshort(t,i),i+=2,l==65536&&(c.maxPoints=a.readUshort(t,i),i+=2,c.maxContours=a.readUshort(t,i),i+=2,c.maxCompositePoints=a.readUshort(t,i),i+=2,c.maxCompositeContours=a.readUshort(t,i),i+=2,c.maxZones=a.readUshort(t,i),i+=2,c.maxTwilightPoints=a.readUshort(t,i),i+=2,c.maxStorage=a.readUshort(t,i),i+=2,c.maxFunctionDefs=a.readUshort(t,i),i+=2,c.maxInstructionDefs=a.readUshort(t,i),i+=2,c.maxStackElements=a.readUshort(t,i),i+=2,c.maxSizeOfInstructions=a.readUshort(t,i),i+=2,c.maxComponentElements=a.readUshort(t,i),i+=2,c.maxComponentDepth=a.readUshort(t,i),i+=2),c},e.name={},e.name.parse=function(t,i,o){var a=e._bin,c={};a.readUshort(t,i),i+=2;var l=a.readUshort(t,i);i+=2,a.readUshort(t,i);for(var u,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],A=i+=2,d=0;d<l;d++){var x=a.readUshort(t,i);i+=2;var p=a.readUshort(t,i);i+=2;var v=a.readUshort(t,i);i+=2;var y=a.readUshort(t,i);i+=2;var g=a.readUshort(t,i);i+=2;var m=a.readUshort(t,i);i+=2;var _,E=f[y],C=A+12*l+m;if(x==0)_=a.readUnicode(t,C,g/2);else if(x==3&&p==0)_=a.readUnicode(t,C,g/2);else if(p==0)_=a.readASCII(t,C,g);else if(p==1)_=a.readUnicode(t,C,g/2);else if(p==3)_=a.readUnicode(t,C,g/2);else{if(x!=1)throw"unknown encoding "+p+", platformID: "+x;_=a.readASCII(t,C,g),console.debug("reading unknown MAC encoding "+p+" as ASCII")}var w="p"+x+","+v.toString(16);c[w]==null&&(c[w]={}),c[w][E!==void 0?E:y]=_,c[w]._lang=v}for(var I in c)if(c[I].postScriptName!=null&&c[I]._lang==1033)return c[I];for(var I in c)if(c[I].postScriptName!=null&&c[I]._lang==0)return c[I];for(var I in c)if(c[I].postScriptName!=null&&c[I]._lang==3084)return c[I];for(var I in c)if(c[I].postScriptName!=null)return c[I];for(var I in c){u=I;break}return console.debug("returning name table with languageID "+c[u]._lang),c[u]},e["OS/2"]={},e["OS/2"].parse=function(t,i,o){var a=e._bin.readUshort(t,i);i+=2;var c={};if(a==0)e["OS/2"].version0(t,i,c);else if(a==1)e["OS/2"].version1(t,i,c);else if(a==2||a==3||a==4)e["OS/2"].version2(t,i,c);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(t,i,c)}return c},e["OS/2"].version0=function(t,i,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(t,i),i+=2,o.usWeightClass=a.readUshort(t,i),i+=2,o.usWidthClass=a.readUshort(t,i),i+=2,o.fsType=a.readUshort(t,i),i+=2,o.ySubscriptXSize=a.readShort(t,i),i+=2,o.ySubscriptYSize=a.readShort(t,i),i+=2,o.ySubscriptXOffset=a.readShort(t,i),i+=2,o.ySubscriptYOffset=a.readShort(t,i),i+=2,o.ySuperscriptXSize=a.readShort(t,i),i+=2,o.ySuperscriptYSize=a.readShort(t,i),i+=2,o.ySuperscriptXOffset=a.readShort(t,i),i+=2,o.ySuperscriptYOffset=a.readShort(t,i),i+=2,o.yStrikeoutSize=a.readShort(t,i),i+=2,o.yStrikeoutPosition=a.readShort(t,i),i+=2,o.sFamilyClass=a.readShort(t,i),i+=2,o.panose=a.readBytes(t,i,10),i+=10,o.ulUnicodeRange1=a.readUint(t,i),i+=4,o.ulUnicodeRange2=a.readUint(t,i),i+=4,o.ulUnicodeRange3=a.readUint(t,i),i+=4,o.ulUnicodeRange4=a.readUint(t,i),i+=4,o.achVendID=[a.readInt8(t,i),a.readInt8(t,i+1),a.readInt8(t,i+2),a.readInt8(t,i+3)],i+=4,o.fsSelection=a.readUshort(t,i),i+=2,o.usFirstCharIndex=a.readUshort(t,i),i+=2,o.usLastCharIndex=a.readUshort(t,i),i+=2,o.sTypoAscender=a.readShort(t,i),i+=2,o.sTypoDescender=a.readShort(t,i),i+=2,o.sTypoLineGap=a.readShort(t,i),i+=2,o.usWinAscent=a.readUshort(t,i),i+=2,o.usWinDescent=a.readUshort(t,i),i+=2},e["OS/2"].version1=function(t,i,o){var a=e._bin;return i=e["OS/2"].version0(t,i,o),o.ulCodePageRange1=a.readUint(t,i),i+=4,o.ulCodePageRange2=a.readUint(t,i),i+=4},e["OS/2"].version2=function(t,i,o){var a=e._bin;return i=e["OS/2"].version1(t,i,o),o.sxHeight=a.readShort(t,i),i+=2,o.sCapHeight=a.readShort(t,i),i+=2,o.usDefault=a.readUshort(t,i),i+=2,o.usBreak=a.readUshort(t,i),i+=2,o.usMaxContext=a.readUshort(t,i),i+=2},e["OS/2"].version5=function(t,i,o){var a=e._bin;return i=e["OS/2"].version2(t,i,o),o.usLowerOpticalPointSize=a.readUshort(t,i),i+=2,o.usUpperOpticalPointSize=a.readUshort(t,i),i+=2},e.post={},e.post.parse=function(t,i,o){var a=e._bin,c={};return c.version=a.readFixed(t,i),i+=4,c.italicAngle=a.readFixed(t,i),i+=4,c.underlinePosition=a.readShort(t,i),i+=2,c.underlineThickness=a.readShort(t,i),i+=2,c},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(t,i){var o=t.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var c=o.tables[a];if(c.format==0)return i>=c.map.length?0:c.map[i];if(c.format==4){for(var l=-1,u=0;u<c.endCount.length;u++)if(i<=c.endCount[u]){l=u;break}return l==-1||c.startCount[l]>i?0:65535&(c.idRangeOffset[l]!=0?c.glyphIdArray[i-c.startCount[l]+(c.idRangeOffset[l]>>1)-(c.idRangeOffset.length-l)]:i+c.idDelta[l])}if(c.format==12){if(i>c.groups[c.groups.length-1][1])return 0;for(u=0;u<c.groups.length;u++){var f=c.groups[u];if(f[0]<=i&&i<=f[1])return f[2]+(i-f[0])}return 0}throw"unknown cmap table format "+c.format},e.U.glyphToPath=function(t,i){var o={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[i]){var a=t.SVG.entries[i];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),t.SVG.entries[i]=a),a)}if(t.CFF){var c={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},l=t.CFF,u=t.CFF.Private;if(l.ROS){for(var f=0;l.FDSelect[f+2]<=i;)f+=2;u=l.FDArray[l.FDSelect[f+1]].Private}e.U._drawCFF(t.CFF.CharStrings[i],c,l,u,o)}else t.glyf&&e.U._drawGlyf(i,t,o);return o},e.U._drawGlyf=function(t,i,o){var a=i.glyf[t];a==null&&(a=i.glyf[t]=e.glyf._parseGlyf(i,t)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,i,o))},e.U._simpleGlyph=function(t,i){for(var o=0;o<t.noc;o++){for(var a=o==0?0:t.endPts[o-1]+1,c=t.endPts[o],l=a;l<=c;l++){var u=l==a?c:l-1,f=l==c?a:l+1,A=1&t.flags[l],d=1&t.flags[u],x=1&t.flags[f],p=t.xs[l],v=t.ys[l];if(l==a)if(A){if(!d){e.U.P.moveTo(i,p,v);continue}e.U.P.moveTo(i,t.xs[u],t.ys[u])}else d?e.U.P.moveTo(i,t.xs[u],t.ys[u]):e.U.P.moveTo(i,(t.xs[u]+p)/2,(t.ys[u]+v)/2);A?d&&e.U.P.lineTo(i,p,v):x?e.U.P.qcurveTo(i,p,v,t.xs[f],t.ys[f]):e.U.P.qcurveTo(i,p,v,(p+t.xs[f])/2,(v+t.ys[f])/2)}e.U.P.closePath(i)}},e.U._compoGlyph=function(t,i,o){for(var a=0;a<t.parts.length;a++){var c={cmds:[],crds:[]},l=t.parts[a];e.U._drawGlyf(l.glyphIndex,i,c);for(var u=l.m,f=0;f<c.crds.length;f+=2){var A=c.crds[f],d=c.crds[f+1];o.crds.push(A*u.a+d*u.b+u.tx),o.crds.push(A*u.c+d*u.d+u.ty)}for(f=0;f<c.cmds.length;f++)o.cmds.push(c.cmds[f])}},e.U._getGlyphClass=function(t,i){var o=e._lctf.getInterval(i,t);return o==-1?0:i[o+2]},e.U._applySubs=function(t,i,o,a){for(var c=t.length-i-1,l=0;l<o.tabs.length;l++)if(o.tabs[l]!=null){var u,f=o.tabs[l];if(!f.coverage||(u=e._lctf.coverageIndex(f.coverage,t[i]))!=-1){if(o.ltype==1)t[i],f.fmt==1?t[i]=t[i]+f.delta:t[i]=f.newg[u];else if(o.ltype==4)for(var A=f.vals[u],d=0;d<A.length;d++){var x=A[d],p=x.chain.length;if(!(p>c)){for(var v=!0,y=0,g=0;g<p;g++){for(;t[i+y+(1+g)]==-1;)y++;x.chain[g]!=t[i+y+(1+g)]&&(v=!1)}if(v){for(t[i]=x.nglyph,g=0;g<p+y;g++)t[i+g+1]=-1;break}}}else if(o.ltype==5&&f.fmt==2)for(var m=e._lctf.getInterval(f.cDef,t[i]),_=f.cDef[m+2],E=f.scset[_],C=0;C<E.length;C++){var w=E[C],I=w.input;if(!(I.length>c)){for(v=!0,g=0;g<I.length;g++){var B=e._lctf.getInterval(f.cDef,t[i+1+g]);if(m==-1&&f.cDef[B+2]!=I[g]){v=!1;break}}if(v){var S=w.substLookupRecords;for(d=0;d<S.length;d+=2)S[d],S[d+1]}}}else if(o.ltype==6&&f.fmt==3){if(!e.U._glsCovered(t,f.backCvg,i-f.backCvg.length)||!e.U._glsCovered(t,f.inptCvg,i)||!e.U._glsCovered(t,f.ahedCvg,i+f.inptCvg.length))continue;var U=f.lookupRec;for(C=0;C<U.length;C+=2){m=U[C];var b=a[U[C+1]];e.U._applySubs(t,i+m,b,a)}}}}},e.U._glsCovered=function(t,i,o){for(var a=0;a<i.length;a++)if(e._lctf.coverageIndex(i[a],t[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(t,i,o){for(var a={cmds:[],crds:[]},c=0,l=0;l<i.length;l++){var u=i[l];if(u!=-1){for(var f=l<i.length-1&&i[l+1]!=-1?i[l+1]:0,A=e.U.glyphToPath(t,u),d=0;d<A.crds.length;d+=2)a.crds.push(A.crds[d]+c),a.crds.push(A.crds[d+1]);for(o&&a.cmds.push(o),d=0;d<A.cmds.length;d++)a.cmds.push(A.cmds[d]);o&&a.cmds.push("X"),c+=t.hmtx.aWidth[u],l<i.length-1&&(c+=e.U.getPairAdjustment(t,u,f))}}return a},e.U.P={},e.U.P.moveTo=function(t,i,o){t.cmds.push("M"),t.crds.push(i,o)},e.U.P.lineTo=function(t,i,o){t.cmds.push("L"),t.crds.push(i,o)},e.U.P.curveTo=function(t,i,o,a,c,l,u){t.cmds.push("C"),t.crds.push(i,o,a,c,l,u)},e.U.P.qcurveTo=function(t,i,o,a,c){t.cmds.push("Q"),t.crds.push(i,o,a,c)},e.U.P.closePath=function(t){t.cmds.push("Z")},e.U._drawCFF=function(t,i,o,a,c){for(var l=i.stack,u=i.nStems,f=i.haveWidth,A=i.width,d=i.open,x=0,p=i.x,v=i.y,y=0,g=0,m=0,_=0,E=0,C=0,w=0,I=0,B=0,S=0,U={val:0,size:0};x<t.length;){e.CFF.getCharString(t,x,U);var b=U.val;if(x+=U.size,b=="o1"||b=="o18")l.length%2!=0&&!f&&(A=l.shift()+a.nominalWidthX),u+=l.length>>1,l.length=0,f=!0;else if(b=="o3"||b=="o23")l.length%2!=0&&!f&&(A=l.shift()+a.nominalWidthX),u+=l.length>>1,l.length=0,f=!0;else if(b=="o4")l.length>1&&!f&&(A=l.shift()+a.nominalWidthX,f=!0),d&&e.U.P.closePath(c),v+=l.pop(),e.U.P.moveTo(c,p,v),d=!0;else if(b=="o5")for(;l.length>0;)p+=l.shift(),v+=l.shift(),e.U.P.lineTo(c,p,v);else if(b=="o6"||b=="o7")for(var M=l.length,D=b=="o6",N=0;N<M;N++){var G=l.shift();D?p+=G:v+=G,D=!D,e.U.P.lineTo(c,p,v)}else if(b=="o8"||b=="o24"){M=l.length;for(var q=0;q+6<=M;)y=p+l.shift(),g=v+l.shift(),m=y+l.shift(),_=g+l.shift(),p=m+l.shift(),v=_+l.shift(),e.U.P.curveTo(c,y,g,m,_,p,v),q+=6;b=="o24"&&(p+=l.shift(),v+=l.shift(),e.U.P.lineTo(c,p,v))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(g=v,m=(y=p+l.shift())+l.shift(),S=_=g+l.shift(),C=_,I=v,p=(w=(E=(B=m+l.shift())+l.shift())+l.shift())+l.shift(),e.U.P.curveTo(c,y,g,m,_,B,S),e.U.P.curveTo(c,E,C,w,I,p,v)),b=="o1235"&&(y=p+l.shift(),g=v+l.shift(),m=y+l.shift(),_=g+l.shift(),B=m+l.shift(),S=_+l.shift(),E=B+l.shift(),C=S+l.shift(),w=E+l.shift(),I=C+l.shift(),p=w+l.shift(),v=I+l.shift(),l.shift(),e.U.P.curveTo(c,y,g,m,_,B,S),e.U.P.curveTo(c,E,C,w,I,p,v)),b=="o1236"&&(y=p+l.shift(),g=v+l.shift(),m=y+l.shift(),S=_=g+l.shift(),C=_,w=(E=(B=m+l.shift())+l.shift())+l.shift(),I=C+l.shift(),p=w+l.shift(),e.U.P.curveTo(c,y,g,m,_,B,S),e.U.P.curveTo(c,E,C,w,I,p,v)),b=="o1237"&&(y=p+l.shift(),g=v+l.shift(),m=y+l.shift(),_=g+l.shift(),B=m+l.shift(),S=_+l.shift(),E=B+l.shift(),C=S+l.shift(),w=E+l.shift(),I=C+l.shift(),Math.abs(w-p)>Math.abs(I-v)?p=w+l.shift():v=I+l.shift(),e.U.P.curveTo(c,y,g,m,_,B,S),e.U.P.curveTo(c,E,C,w,I,p,v));else if(b=="o14"){if(l.length>0&&!f&&(A=l.shift()+o.nominalWidthX,f=!0),l.length==4){var X=l.shift(),O=l.shift(),H=l.shift(),T=l.shift(),W=e.CFF.glyphBySE(o,H),j=e.CFF.glyphBySE(o,T);e.U._drawCFF(o.CharStrings[W],i,o,a,c),i.x=X,i.y=O,e.U._drawCFF(o.CharStrings[j],i,o,a,c)}d&&(e.U.P.closePath(c),d=!1)}else if(b=="o19"||b=="o20")l.length%2!=0&&!f&&(A=l.shift()+a.nominalWidthX),u+=l.length>>1,l.length=0,f=!0,x+=u+7>>3;else if(b=="o21")l.length>2&&!f&&(A=l.shift()+a.nominalWidthX,f=!0),v+=l.pop(),p+=l.pop(),d&&e.U.P.closePath(c),e.U.P.moveTo(c,p,v),d=!0;else if(b=="o22")l.length>1&&!f&&(A=l.shift()+a.nominalWidthX,f=!0),p+=l.pop(),d&&e.U.P.closePath(c),e.U.P.moveTo(c,p,v),d=!0;else if(b=="o25"){for(;l.length>6;)p+=l.shift(),v+=l.shift(),e.U.P.lineTo(c,p,v);y=p+l.shift(),g=v+l.shift(),m=y+l.shift(),_=g+l.shift(),p=m+l.shift(),v=_+l.shift(),e.U.P.curveTo(c,y,g,m,_,p,v)}else if(b=="o26")for(l.length%2&&(p+=l.shift());l.length>0;)y=p,g=v+l.shift(),p=m=y+l.shift(),v=(_=g+l.shift())+l.shift(),e.U.P.curveTo(c,y,g,m,_,p,v);else if(b=="o27")for(l.length%2&&(v+=l.shift());l.length>0;)g=v,m=(y=p+l.shift())+l.shift(),_=g+l.shift(),p=m+l.shift(),v=_,e.U.P.curveTo(c,y,g,m,_,p,v);else if(b=="o10"||b=="o29"){var L=b=="o10"?a:o;if(l.length==0)console.debug("error: empty stack");else{var z=l.pop(),F=L.Subrs[z+L.Bias];i.x=p,i.y=v,i.nStems=u,i.haveWidth=f,i.width=A,i.open=d,e.U._drawCFF(F,i,o,a,c),p=i.x,v=i.y,u=i.nStems,f=i.haveWidth,A=i.width,d=i.open}}else if(b=="o30"||b=="o31"){var R=l.length,Q=(q=0,b=="o31");for(q+=R-(M=-3&R);q<M;)Q?(g=v,m=(y=p+l.shift())+l.shift(),v=(_=g+l.shift())+l.shift(),M-q==5?(p=m+l.shift(),q++):p=m,Q=!1):(y=p,g=v+l.shift(),m=y+l.shift(),_=g+l.shift(),p=m+l.shift(),M-q==5?(v=_+l.shift(),q++):v=_,Q=!0),e.U.P.curveTo(c,y,g,m,_,p,v),q+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;l.push(b)}}}i.x=p,i.y=v,i.nStems=u,i.haveWidth=f,i.width=A,i.open=d};var n=e,r={Typr:n};return s.Typr=n,s.default=r,Object.defineProperty(s,"__esModule",{value:!0}),s}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function u2(){return function(s){var e=Uint8Array,n=Uint16Array,r=Uint32Array,t=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(b,M){for(var D=new n(31),N=0;N<31;++N)D[N]=M+=1<<b[N-1];var G=new r(D[30]);for(N=1;N<30;++N)for(var q=D[N];q<D[N+1];++q)G[q]=q-D[N]<<5|N;return[D,G]},c=a(t,2),l=c[0],u=c[1];l[28]=258,u[258]=28;for(var f=a(i,0)[0],A=new n(32768),d=0;d<32768;++d){var x=(43690&d)>>>1|(21845&d)<<1;x=(61680&(x=(52428&x)>>>2|(13107&x)<<2))>>>4|(3855&x)<<4,A[d]=((65280&x)>>>8|(255&x)<<8)>>>1}var p=function(b,M,D){for(var N=b.length,G=0,q=new n(M);G<N;++G)++q[b[G]-1];var X,O=new n(M);for(G=0;G<M;++G)O[G]=O[G-1]+q[G-1]<<1;{X=new n(1<<M);var H=15-M;for(G=0;G<N;++G)if(b[G])for(var T=G<<4|b[G],W=M-b[G],j=O[b[G]-1]++<<W,L=j|(1<<W)-1;j<=L;++j)X[A[j]>>>H]=T}return X},v=new e(288);for(d=0;d<144;++d)v[d]=8;for(d=144;d<256;++d)v[d]=9;for(d=256;d<280;++d)v[d]=7;for(d=280;d<288;++d)v[d]=8;var y=new e(32);for(d=0;d<32;++d)y[d]=5;var g=p(v,9),m=p(y,5),_=function(b){for(var M=b[0],D=1;D<b.length;++D)b[D]>M&&(M=b[D]);return M},E=function(b,M,D){var N=M/8|0;return(b[N]|b[N+1]<<8)>>(7&M)&D},C=function(b,M){var D=M/8|0;return(b[D]|b[D+1]<<8|b[D+2]<<16)>>(7&M)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(b,M,D){var N=new Error(M||w[b]);if(N.code=b,Error.captureStackTrace&&Error.captureStackTrace(N,I),!D)throw N;return N},B=function(b,M,D){var N=b.length;if(!N||D&&!D.l&&N<5)return M||new e(0);var G=!M||D,q=!D||D.i;D||(D={}),M||(M=new e(3*N));var X,O=function(Fe){var ct=M.length;if(Fe>ct){var $e=new e(Math.max(2*ct,Fe));$e.set(M),M=$e}},H=D.f||0,T=D.p||0,W=D.b||0,j=D.l,L=D.d,z=D.m,F=D.n,R=8*N;do{if(!j){D.f=H=E(b,T,1);var Q=E(b,T+1,3);if(T+=3,!Q){var J=b[(Y=((X=T)/8|0)+(7&X&&1)+4)-4]|b[Y-3]<<8,ie=Y+J;if(ie>N){q&&I(0);break}G&&O(W+J),M.set(b.subarray(Y,ie),W),D.b=W+=J,D.p=T=8*ie;continue}if(Q==1)j=g,L=m,z=9,F=5;else if(Q==2){var Z=E(b,T,31)+257,ee=E(b,T+10,15)+4,ge=Z+E(b,T+5,31)+1;T+=14;for(var pe=new e(ge),te=new e(19),ae=0;ae<ee;++ae)te[o[ae]]=E(b,T+3*ae,7);T+=3*ee;var de=_(te),se=(1<<de)-1,K=p(te,de);for(ae=0;ae<ge;){var Y,ne=K[E(b,T,se)];if(T+=15&ne,(Y=ne>>>4)<16)pe[ae++]=Y;else{var ve=0,Ee=0;for(Y==16?(Ee=3+E(b,T,3),T+=2,ve=pe[ae-1]):Y==17?(Ee=3+E(b,T,7),T+=3):Y==18&&(Ee=11+E(b,T,127),T+=7);Ee--;)pe[ae++]=ve}}var Ce=pe.subarray(0,Z),xe=pe.subarray(Z);z=_(Ce),F=_(xe),j=p(Ce,z),L=p(xe,F)}else I(1);if(T>R){q&&I(0);break}}G&&O(W+131072);for(var Oe=(1<<z)-1,De=(1<<F)-1,Re=T;;Re=T){var Pe=(ve=j[C(b,T)&Oe])>>>4;if((T+=15&ve)>R){q&&I(0);break}if(ve||I(2),Pe<256)M[W++]=Pe;else{if(Pe==256){Re=T,j=null;break}var ke=Pe-254;if(Pe>264){var Ke=t[ae=Pe-257];ke=E(b,T,(1<<Ke)-1)+l[ae],T+=Ke}var ot=L[C(b,T)&De],He=ot>>>4;if(ot||I(3),T+=15&ot,xe=f[He],He>3&&(Ke=i[He],xe+=C(b,T)&(1<<Ke)-1,T+=Ke),T>R){q&&I(0);break}G&&O(W+131072);for(var Le=W+ke;W<Le;W+=4)M[W]=M[W-xe],M[W+1]=M[W+1-xe],M[W+2]=M[W+2-xe],M[W+3]=M[W+3-xe];W=Le}}D.l=j,D.p=Re,D.b=W,j&&(H=1,D.m=z,D.d=L,D.n=F)}while(!H);return W==M.length?M:function(Fe,ct,$e){($e==null||$e>Fe.length)&&($e=Fe.length);var Ze=new(Fe instanceof n?n:Fe instanceof r?r:e)($e-ct);return Ze.set(Fe.subarray(ct,$e)),Ze}(M,0,W)},S=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(S,{stream:!0})}catch{}return s.convert_streams=function(b){var M=new DataView(b),D=0;function N(){var Z=M.getUint16(D);return D+=2,Z}function G(){var Z=M.getUint32(D);return D+=4,Z}function q(Z){J.setUint16(ie,Z),ie+=2}function X(Z){J.setUint32(ie,Z),ie+=4}for(var O={signature:G(),flavor:G(),length:G(),numTables:N(),reserved:N(),totalSfntSize:G(),majorVersion:N(),minorVersion:N(),metaOffset:G(),metaLength:G(),metaOrigLength:G(),privOffset:G(),privLength:G()},H=0;Math.pow(2,H)<=O.numTables;)H++;H--;for(var T=16*Math.pow(2,H),W=16*O.numTables-T,j=12,L=[],z=0;z<O.numTables;z++)L.push({tag:G(),offset:G(),compLength:G(),origLength:G(),origChecksum:G()}),j+=16;var F,R=new Uint8Array(12+16*L.length+L.reduce(function(Z,ee){return Z+ee.origLength+4},0)),Q=R.buffer,J=new DataView(Q),ie=0;return X(O.flavor),q(O.numTables),q(T),q(H),q(W),L.forEach(function(Z){X(Z.tag),X(Z.origChecksum),X(j),X(Z.origLength),Z.outOffset=j,(j+=Z.origLength)%4!=0&&(j+=4-j%4)}),L.forEach(function(Z){var ee,ge=b.slice(Z.offset,Z.offset+Z.compLength);if(Z.compLength!=Z.origLength){var pe=new Uint8Array(Z.origLength);ee=new Uint8Array(ge,2),B(ee,pe)}else pe=new Uint8Array(ge);R.set(pe,Z.outOffset);var te=0;(j=Z.outOffset+Z.origLength)%4!=0&&(te=4-j%4),R.set(new Uint8Array(te).buffer,Z.outOffset+Z.origLength),F=j+te}),Q.slice(0,F)},Object.defineProperty(s,"__esModule",{value:!0}),s}({}).convert_streams}function h2(s,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,i=2,o=4,a=8,c=16,l=32;let u;function f(w){if(!u){const I={R:i,L:t,D:o,C:c,U:l,T:a};u=new Map;for(let B in r){let S=0;r[B].split(",").forEach(U=>{let[b,M]=U.split("+");b=parseInt(b,36),M=M?parseInt(M,36):0,u.set(S+=b,I[B]);for(let D=M;D--;)u.set(++S,I[B])})}}return u.get(w)||l}const A=1,d=2,x=3,p=4,v=[null,"isol","init","fina","medi"];function y(w){const I=new Uint8Array(w.length);let B=l,S=A,U=-1;for(let b=0;b<w.length;b++){const M=w.codePointAt(b);let D=f(M)|0,N=A;D&a||(B&(t|o|c)?D&(i|o|c)?(N=x,(S===A||S===x)&&I[U]++):D&(t|l)&&(S===d||S===p)&&I[U]--:B&(i|l)&&(S===d||S===p)&&I[U]--,S=I[b]=N,B=D,U=b,M>65535&&b++)}return I}function g(w,I){const B=[];for(let U=0;U<I.length;U++){const b=I.codePointAt(U);b>65535&&U++,B.push(s.U.codeToGlyph(w,b))}const S=w.GSUB;if(S){const{lookupList:U,featureList:b}=S;let M;const D=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,N=[];b.forEach(G=>{if(D.test(G.tag))for(let q=0;q<G.tab.length;q++){if(N[G.tab[q]])continue;N[G.tab[q]]=!0;const X=U[G.tab[q]],O=/^(isol|init|fina|medi)$/.test(G.tag);O&&!M&&(M=y(I));for(let H=0;H<B.length;H++)(!M||!O||v[M[H]]===G.tag)&&s.U._applySubs(B,H,X,U)}})}return B}function m(w,I){const B=new Int16Array(I.length*3);let S=0;for(;S<I.length;S++){const D=I[S];if(D===-1)continue;B[S*3+2]=w.hmtx.aWidth[D];const N=w.GPOS;if(N){const G=N.lookupList;for(let q=0;q<G.length;q++){const X=G[q];for(let O=0;O<X.tabs.length;O++){const H=X.tabs[O];if(X.ltype===1){if(s._lctf.coverageIndex(H.coverage,D)!==-1&&H.pos){M(H.pos,S);break}}else if(X.ltype===2){let T=null,W=U();if(W!==-1){const j=s._lctf.coverageIndex(H.coverage,I[W]);if(j!==-1){if(H.fmt===1){const L=H.pairsets[j];for(let z=0;z<L.length;z++)L[z].gid2===D&&(T=L[z])}else if(H.fmt===2){const L=s.U._getGlyphClass(I[W],H.classDef1),z=s.U._getGlyphClass(D,H.classDef2);T=H.matrix[L][z]}if(T){T.val1&&M(T.val1,W),T.val2&&M(T.val2,S);break}}}}else if(X.ltype===4){const T=s._lctf.coverageIndex(H.markCoverage,D);if(T!==-1){const W=U(b),j=W===-1?-1:s._lctf.coverageIndex(H.baseCoverage,I[W]);if(j!==-1){const L=H.markArray[T],z=H.baseArray[j][L.markClass];B[S*3]=z.x-L.x+B[W*3]-B[W*3+2],B[S*3+1]=z.y-L.y+B[W*3+1];break}}}else if(X.ltype===6){const T=s._lctf.coverageIndex(H.mark1Coverage,D);if(T!==-1){const W=U();if(W!==-1){const j=I[W];if(_(w,j)===3){const L=s._lctf.coverageIndex(H.mark2Coverage,j);if(L!==-1){const z=H.mark1Array[T],F=H.mark2Array[L][z.markClass];B[S*3]=F.x-z.x+B[W*3]-B[W*3+2],B[S*3+1]=F.y-z.y+B[W*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const G=U();if(G!==-1){const q=w.kern.glyph1.indexOf(I[G]);if(q!==-1){const X=w.kern.rval[q].glyph2.indexOf(D);X!==-1&&(B[G*3+2]+=w.kern.rval[q].vals[X])}}}}return B;function U(D){for(let N=S-1;N>=0;N--)if(I[N]!==-1&&(!D||D(I[N])))return N;return-1}function b(D){return _(w,D)===1}function M(D,N){for(let G=0;G<3;G++)B[N*3+G]+=D[G]||0}}function _(w,I){const B=w.GDEF&&w.GDEF.glyphClassDef;return B?s.U._getGlyphClass(I,B):0}function E(...w){for(let I=0;I<w.length;I++)if(typeof w[I]=="number")return w[I]}function C(w){const I=Object.create(null),B=w["OS/2"],S=w.hhea,U=w.head.unitsPerEm,b=E(B&&B.sTypoAscender,S&&S.ascender,U),M={unitsPerEm:U,ascender:b,descender:E(B&&B.sTypoDescender,S&&S.descender,0),capHeight:E(B&&B.sCapHeight,b),xHeight:E(B&&B.sxHeight,b),lineGap:E(B&&B.sTypoLineGap,S&&S.lineGap),supportsCodePoint(D){return s.U.codeToGlyph(w,D)>0},forEachGlyph(D,N,G,q){let X=0;const O=1/M.unitsPerEm*N,H=g(w,D);let T=0;const W=m(w,H);return H.forEach((j,L)=>{if(j!==-1){let z=I[j];if(!z){const{cmds:F,crds:R}=s.U.glyphToPath(w,j);let Q="",J=0;for(let pe=0,te=F.length;pe<te;pe++){const ae=n[F[pe]];Q+=F[pe];for(let de=1;de<=ae;de++)Q+=(de>1?",":"")+R[J++]}let ie,Z,ee,ge;if(R.length){ie=Z=1/0,ee=ge=-1/0;for(let pe=0,te=R.length;pe<te;pe+=2){let ae=R[pe],de=R[pe+1];ae<ie&&(ie=ae),de<Z&&(Z=de),ae>ee&&(ee=ae),de>ge&&(ge=de)}}else ie=ee=Z=ge=0;z=I[j]={index:j,advanceWidth:w.hmtx.aWidth[j],xMin:ie,yMin:Z,xMax:ee,yMax:ge,path:Q}}q.call(null,z,X+W[L*3]*O,W[L*3+1]*O,T),X+=W[L*3+2]*O,G&&(X+=G*N)}T+=D.codePointAt(T)>65535?2:1}),X}};return M}return function(I){const B=new Uint8Array(I,0,4),S=s._bin.readASCII(B,0,4);if(S==="wOFF")I=e(I);else if(S==="wOF2")throw new Error("woff2 fonts not supported");return C(s.parse(I)[0])}}const f2=$r({name:"Typr Font Parser",dependencies:[l2,u2,h2],init(s,e,n){const r=s(),t=e();return n(r,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function A2(){return function(s){var e=function(){this.buckets=new Map};e.prototype.add=function(m){var _=m>>5;this.buckets.set(_,(this.buckets.get(_)||0)|1<<(31&m))},e.prototype.has=function(m){var _=this.buckets.get(m>>5);return _!==void 0&&(_&1<<(31&m))!=0},e.prototype.serialize=function(){var m=[];return this.buckets.forEach(function(_,E){m.push((+E).toString(36)+":"+_.toString(36))}),m.join(",")},e.prototype.deserialize=function(m){var _=this;this.buckets.clear(),m.split(",").forEach(function(E){var C=E.split(":");_.buckets.set(parseInt(C[0],36),parseInt(C[1],36))})};var n=Math.pow(2,8),r=n-1,t=~r;function i(m){var _=function(C){return C&t}(m).toString(16),E=function(C){return(C&t)+n-1}(m).toString(16);return"codepoint-index/plane"+(m>>16)+"/"+_+"-"+E+".json"}function o(m,_){var E=m&r,C=_.codePointAt(E/6|0);return((C=(C||48)-48)&1<<E%6)!=0}function a(m,_){var E;(E=m,E.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(C){return C.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(C){var w=C[0],I=C[1];I===void 0&&(I=w),_(w,I)})}function c(m,_){a(m,function(E,C){for(var w=E;w<=C;w++)_(w)})}var l={},u={},f=new WeakMap,A="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(m){var _=f.get(m);return _||(_=new e,c(m.ranges,function(E){return _.add(E)}),f.set(m,_)),_}var x,p=new Map;function v(m,_,E){return m[_]?_:m[E]?E:function(C){for(var w in C)return w}(m)}function y(m,_){var E=_;if(!m.includes(E)){E=1/0;for(var C=0;C<m.length;C++)Math.abs(m[C]-_)<Math.abs(E-_)&&(E=m[C])}return E}function g(m){return x||(x=new Set,c("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(_){x.add(_)})),x.has(m)}return s.CodePointSet=e,s.clearCache=function(){l={},u={}},s.getFontsForString=function(m,_){_===void 0&&(_={});var E,C=_.lang;C===void 0&&(C=new RegExp("\\p{Script=Hangul}","u").test(E=m)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(E)?"ja":"en");var w=_.category;w===void 0&&(w="sans-serif");var I=_.style;I===void 0&&(I="normal");var B=_.weight;B===void 0&&(B=400);var S=(_.dataUrl||A).replace(/\/$/g,""),U=new Map,b=new Uint8Array(m.length),M={},D={},N=new Array(m.length),G=new Map,q=!1;function X(T){var W=p.get(T);return W||(W=fetch(S+"/"+T).then(function(j){if(!j.ok)throw new Error(j.statusText);return j.json().then(function(L){if(!Array.isArray(L)||L[0]!==1)throw new Error("Incorrect schema version; need 1, got "+L[0]);return L[1]})}).catch(function(j){if(S!==A)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+S+'", trying default CDN. '+j.message),q=!0),S=A,p.delete(T),X(T);throw j}),p.set(T,W)),W}for(var O=function(T){var W=m.codePointAt(T),j=i(W);N[T]=j,l[j]||G.has(j)||G.set(j,X(j).then(function(L){l[j]=L})),W>65535&&(T++,H=T)},H=0;H<m.length;H++)O(H);return Promise.all(G.values()).then(function(){G.clear();for(var T=function(j){var L=m.codePointAt(j),z=null,F=l[N[j]],R=void 0;for(var Q in F){var J=D[Q];if(J===void 0&&(J=D[Q]=new RegExp(Q).test(C||"en")),J){for(var ie in R=Q,F[Q])if(o(L,F[Q][ie])){z=ie;break}break}}if(!z){e:for(var Z in F)if(Z!==R){for(var ee in F[Z])if(o(L,F[Z][ee])){z=ee;break e}}}z||(console.debug("No font coverage for U+"+L.toString(16)),z="latin"),N[j]=z,u[z]||G.has(z)||G.set(z,X("font-meta/"+z+".json").then(function(ge){u[z]=ge})),L>65535&&(j++,W=j)},W=0;W<m.length;W++)T(W);return Promise.all(G.values())}).then(function(){for(var T,W=null,j=0;j<m.length;j++){var L=m.codePointAt(j);if(W&&(g(L)||d(W).has(L)))b[j]=b[j-1];else{W=u[N[j]];var z=M[W.id];if(!z){var F=W.typeforms,R=v(F,w,"sans-serif"),Q=v(F[R],I,"normal"),J=y((T=F[R])===null||T===void 0?void 0:T[Q],B);z=M[W.id]=S+"/font-files/"+W.id+"/"+R+"."+Q+"."+J+".woff"}var ie=U.get(z);ie==null&&(ie=U.size,U.set(z,ie)),b[j]=ie}L>65535&&(j++,b[j]=b[j-1])}return{fontUrls:Array.from(U.keys()),chars:b}})},Object.defineProperty(s,"__esModule",{value:!0}),s}({})}function d2(s,e){const n=Object.create(null),r=Object.create(null);function t(o,a){const c=l=>{console.error(`Failure loading font ${o}`,l)};try{const l=new XMLHttpRequest;l.open("get",o,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)c(new Error(l.statusText));else if(l.status>0)try{const u=s(l.response);u.src=o,a(u)}catch(u){c(u)}},l.onerror=c,l.send()}catch(l){c(l)}}function i(o,a){let c=n[o];c?a(c):r[o]?r[o].push(a):(r[o]=[a],t(o,l=>{l.src=o,n[o]=l,r[o].forEach(u=>u(l)),delete r[o]}))}return function(o,a,{lang:c,fonts:l=[],style:u="normal",weight:f="normal",unicodeFontsURL:A}={}){const d=new Uint8Array(o.length),x=[];o.length||g();const p=new Map,v=[];if(u!=="italic"&&(u="normal"),typeof f!="number"&&(f=f==="bold"?700:400),l&&!Array.isArray(l)&&(l=[l]),l=l.slice().filter(_=>!_.lang||_.lang.test(c)).reverse(),l.length){let w=0;(function I(B=0){for(let S=B,U=o.length;S<U;S++){const b=o.codePointAt(S);if(w===1&&x[d[S-1]].supportsCodePoint(b)||S>0&&/\s/.test(o[S]))d[S]=d[S-1],w===2&&(v[v.length-1][1]=S);else for(let M=d[S],D=l.length;M<=D;M++)if(M===D){const N=w===2?v[v.length-1]:v[v.length]=[S,S];N[1]=S,w=2}else{d[S]=M;const{src:N,unicodeRange:G}=l[M];if(!G||m(b,G)){const q=n[N];if(!q){i(N,()=>{I(S)});return}if(q.supportsCodePoint(b)){let X=p.get(q);typeof X!="number"&&(X=x.length,x.push(q),p.set(q,X)),d[S]=X,w=1;break}}}b>65535&&S+1<U&&(d[S+1]=d[S],S++,w===2&&(v[v.length-1][1]=S))}y()})()}else v.push([0,o.length-1]),y();function y(){if(v.length){const _=v.map(E=>o.substring(E[0],E[1]+1)).join(`
`);e.getFontsForString(_,{lang:c||void 0,style:u,weight:f,dataUrl:A}).then(({fontUrls:E,chars:C})=>{const w=x.length;let I=0;v.forEach(S=>{for(let U=0,b=S[1]-S[0];U<=b;U++)d[S[0]+U]=C[I++]+w;I++});let B=0;E.forEach((S,U)=>{i(S,b=>{x[U+w]=b,++B===E.length&&g()})})})}else g()}function g(){a({chars:d,fonts:x})}function m(_,E){for(let C=0;C<E.length;C++){const[w,I=w]=E[C];if(w<=_&&_<=I)return!0}return!1}}}const m2=$r({name:"FontResolver",dependencies:[d2,f2,A2],init(s,e,n){return s(e,n())}});function p2(s,e){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",i=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:x,lang:p,fonts:v,style:y,weight:g,preResolvedFonts:m,unicodeFontsURL:_},E){const C=({chars:w,fonts:I})=>{let B,S;const U=[];for(let b=0;b<w.length;b++)w[b]!==S?(S=w[b],U.push(B={start:b,end:b,fontObj:I[w[b]]})):B.end=b;E(U)};m?C(m):s(x,C,{lang:p,fonts:v,style:y,weight:g,unicodeFontsURL:_})}function a({text:x="",font:p,lang:v,sdfGlyphSize:y=64,fontSize:g=400,fontWeight:m=1,fontStyle:_="normal",letterSpacing:E=0,lineHeight:C="normal",maxWidth:w=1/0,direction:I,textAlign:B="left",textIndent:S=0,whiteSpace:U="normal",overflowWrap:b="normal",anchorX:M=0,anchorY:D=0,metricsOnly:N=!1,unicodeFontsURL:G,preResolvedFonts:q=null,includeCaretPositions:X=!1,chunkedBoundsSize:O=8192,colorRanges:H=null},T){const W=f(),j={fontLoad:0,typesetting:0};x.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),x=x.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),g=+g,E=+E,w=+w,C=C||"normal",S=+S,o({text:x,lang:v,style:_,weight:m,fonts:typeof p=="string"?[{src:p}]:p,unicodeFontsURL:G,preResolvedFonts:q},L=>{j.fontLoad=f()-W;const z=isFinite(w);let F=null,R=null,Q=null,J=null,ie=null,Z=null,ee=null,ge=null,pe=0,te=0,ae=U!=="nowrap";const de=new Map,se=f();let K=S,Y=0,ne=new A;const ve=[ne];L.forEach(De=>{const{fontObj:Re}=De,{ascender:Pe,descender:ke,unitsPerEm:Ke,lineGap:ot,capHeight:He,xHeight:Le}=Re;let Fe=de.get(Re);if(!Fe){const ye=g/Ke,tt=C==="normal"?(Pe-ke+ot)*ye:C*g,hi=(tt-(Pe-ke)*ye)/2,gt=Math.min(tt,(Pe-ke)*ye),at=(Pe+ke)/2*ye+gt/2;Fe={index:de.size,src:Re.src,fontObj:Re,fontSizeMult:ye,unitsPerEm:Ke,ascender:Pe*ye,descender:ke*ye,capHeight:He*ye,xHeight:Le*ye,lineHeight:tt,baseline:-hi-Pe*ye,caretTop:at,caretBottom:at-gt},de.set(Re,Fe)}const{fontSizeMult:ct}=Fe,$e=x.slice(De.start,De.end+1);let Ze,lt;Re.forEachGlyph($e,g,E,(ye,tt,hi,gt)=>{tt+=Y,gt+=De.start,Ze=tt,lt=ye;const at=x.charAt(gt),Ft=ye.advanceWidth*ct,wt=ne.count;let Je;if("isEmpty"in ye||(ye.isWhitespace=!!at&&new RegExp(t).test(at),ye.canBreakAfter=!!at&&i.test(at),ye.isEmpty=ye.xMin===ye.xMax||ye.yMin===ye.yMax||r.test(at)),!ye.isWhitespace&&!ye.isEmpty&&te++,ae&&z&&!ye.isWhitespace&&tt+Ft+K>w&&wt){if(ne.glyphAt(wt-1).glyphObj.canBreakAfter)Je=new A,K=-tt;else for(let ri=wt;ri--;)if(ri===0&&b==="break-word"){Je=new A,K=-tt;break}else if(ne.glyphAt(ri).glyphObj.canBreakAfter){Je=ne.splitAt(ri+1);const ei=Je.glyphAt(0).x;K-=ei;for(let Lt=Je.count;Lt--;)Je.glyphAt(Lt).x-=ei;break}Je&&(ne.isSoftWrapped=!0,ne=Je,ve.push(ne),pe=w)}let It=ne.glyphAt(ne.count);It.glyphObj=ye,It.x=tt+K,It.y=hi,It.width=Ft,It.charIndex=gt,It.fontData=Fe,at===`
`&&(ne=new A,ve.push(ne),K=-(tt+Ft+E*g)+S)}),Y=Ze+lt.advanceWidth*ct+E*g});let Ee=0;ve.forEach(De=>{let Re=!0;for(let Pe=De.count;Pe--;){const ke=De.glyphAt(Pe);Re&&!ke.glyphObj.isWhitespace&&(De.width=ke.x+ke.width,De.width>pe&&(pe=De.width),Re=!1);let{lineHeight:Ke,capHeight:ot,xHeight:He,baseline:Le}=ke.fontData;Ke>De.lineHeight&&(De.lineHeight=Ke);const Fe=Le-De.baseline;Fe<0&&(De.baseline+=Fe,De.cap+=Fe,De.ex+=Fe),De.cap=Math.max(De.cap,De.baseline+ot),De.ex=Math.max(De.ex,De.baseline+He)}De.baseline-=Ee,De.cap-=Ee,De.ex-=Ee,Ee+=De.lineHeight});let Ce=0,xe=0;if(M&&(typeof M=="number"?Ce=-M:typeof M=="string"&&(Ce=-pe*(M==="left"?0:M==="center"?.5:M==="right"?1:l(M)))),D&&(typeof D=="number"?xe=-D:typeof D=="string"&&(xe=D==="top"?0:D==="top-baseline"?-ve[0].baseline:D==="top-cap"?-ve[0].cap:D==="top-ex"?-ve[0].ex:D==="middle"?Ee/2:D==="bottom"?Ee:D==="bottom-baseline"?-ve[ve.length-1].baseline:l(D)*Ee)),!N){const De=e.getEmbeddingLevels(x,I);F=new Uint16Array(te),R=new Uint8Array(te),Q=new Float32Array(te*2),J={},ee=[1/0,1/0,-1/0,-1/0],ge=[],X&&(Z=new Float32Array(x.length*4)),H&&(ie=new Uint8Array(te*3));let Re=0,Pe=-1,ke=-1,Ke,ot;if(ve.forEach((He,Le)=>{let{count:Fe,width:ct}=He;if(Fe>0){let $e=0;for(let gt=Fe;gt--&&He.glyphAt(gt).glyphObj.isWhitespace;)$e++;let Ze=0,lt=0;if(B==="center")Ze=(pe-ct)/2;else if(B==="right")Ze=pe-ct;else if(B==="justify"&&He.isSoftWrapped){let gt=0;for(let at=Fe-$e;at--;)He.glyphAt(at).glyphObj.isWhitespace&&gt++;lt=(pe-ct)/gt}if(lt||Ze){let gt=0;for(let at=0;at<Fe;at++){let Ft=He.glyphAt(at);const wt=Ft.glyphObj;Ft.x+=Ze+gt,lt!==0&&wt.isWhitespace&&at<Fe-$e&&(gt+=lt,Ft.width+=lt)}}const ye=e.getReorderSegments(x,De,He.glyphAt(0).charIndex,He.glyphAt(He.count-1).charIndex);for(let gt=0;gt<ye.length;gt++){const[at,Ft]=ye[gt];let wt=1/0,Je=-1/0;for(let It=0;It<Fe;It++)if(He.glyphAt(It).charIndex>=at){let ri=It,ei=It;for(;ei<Fe;ei++){let Lt=He.glyphAt(ei);if(Lt.charIndex>Ft)break;ei<Fe-$e&&(wt=Math.min(wt,Lt.x),Je=Math.max(Je,Lt.x+Lt.width))}for(let Lt=ri;Lt<ei;Lt++){const Mi=He.glyphAt(Lt);Mi.x=Je-(Mi.x+Mi.width-wt)}break}}let tt;const hi=gt=>tt=gt;for(let gt=0;gt<Fe;gt++){const at=He.glyphAt(gt);tt=at.glyphObj;const Ft=tt.index,wt=De.levels[at.charIndex]&1;if(wt){const Je=e.getMirroredCharacter(x[at.charIndex]);Je&&at.fontData.fontObj.forEachGlyph(Je,0,0,hi)}if(X){const{charIndex:Je,fontData:It}=at,ri=at.x+Ce,ei=at.x+at.width+Ce;Z[Je*4]=wt?ei:ri,Z[Je*4+1]=wt?ri:ei,Z[Je*4+2]=He.baseline+It.caretBottom+xe,Z[Je*4+3]=He.baseline+It.caretTop+xe;const Lt=Je-Pe;Lt>1&&u(Z,Pe,Lt),Pe=Je}if(H){const{charIndex:Je}=at;for(;Je>ke;)ke++,H.hasOwnProperty(ke)&&(ot=H[ke])}if(!tt.isWhitespace&&!tt.isEmpty){const Je=Re++,{fontSizeMult:It,src:ri,index:ei}=at.fontData,Lt=J[ri]||(J[ri]={});Lt[Ft]||(Lt[Ft]={path:tt.path,pathBounds:[tt.xMin,tt.yMin,tt.xMax,tt.yMax]});const Mi=at.x+Ce,Ti=at.y+He.baseline+xe;Q[Je*2]=Mi,Q[Je*2+1]=Ti;const Zi=Mi+tt.xMin*It,_i=Ti+tt.yMin*It,Di=Mi+tt.xMax*It,qe=Ti+tt.yMax*It;Zi<ee[0]&&(ee[0]=Zi),_i<ee[1]&&(ee[1]=_i),Di>ee[2]&&(ee[2]=Di),qe>ee[3]&&(ee[3]=qe),Je%O===0&&(Ke={start:Je,end:Je,rect:[1/0,1/0,-1/0,-1/0]},ge.push(Ke)),Ke.end++;const ti=Ke.rect;if(Zi<ti[0]&&(ti[0]=Zi),_i<ti[1]&&(ti[1]=_i),Di>ti[2]&&(ti[2]=Di),qe>ti[3]&&(ti[3]=qe),F[Je]=Ft,R[Je]=ei,H){const Cn=Je*3;ie[Cn]=ot>>16&255,ie[Cn+1]=ot>>8&255,ie[Cn+2]=ot&255}}}}}),Z){const He=x.length-Pe;He>1&&u(Z,Pe,He)}}const Oe=[];de.forEach(({index:De,src:Re,unitsPerEm:Pe,ascender:ke,descender:Ke,lineHeight:ot,capHeight:He,xHeight:Le})=>{Oe[De]={src:Re,unitsPerEm:Pe,ascender:ke,descender:Ke,lineHeight:ot,capHeight:He,xHeight:Le}}),j.typesetting=f()-se,T({glyphIds:F,glyphFontIndices:R,glyphPositions:Q,glyphData:J,fontData:Oe,caretPositions:Z,glyphColors:ie,chunkedBounds:ge,fontSize:g,topBaseline:xe+ve[0].baseline,blockBounds:[Ce,xe-Ee,Ce+pe,xe],visibleBounds:ee,timings:j})})}function c(x,p){a({...x,metricsOnly:!0},v=>{const[y,g,m,_]=v.blockBounds;p({width:m-y,height:_-g})})}function l(x){let p=x.match(/^([\d.]+)%$/),v=p?parseFloat(p[1]):NaN;return isNaN(v)?0:v/100}function u(x,p,v){const y=x[p*4],g=x[p*4+1],m=x[p*4+2],_=x[p*4+3],E=(g-y)/v;for(let C=0;C<v;C++){const w=(p+C)*4;x[w]=y+E*C,x[w+1]=y+E*(C+1),x[w+2]=m,x[w+3]=_}}function f(){return(self.performance||Date).now()}function A(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return A.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(x){let p=A.flyweight;return p.data=this.data,p.index=x,p},splitAt(x){let p=new A;return p.data=this.data.splice(x*d.length),p}},A.flyweight=d.reduce((x,p,v,y)=>(Object.defineProperty(x,p,{get(){return this.data[this.index*d.length+v]},set(g){this.data[this.index*d.length+v]=g}}),x),{data:null,index:0}),{typeset:a,measure:c}}const hr=()=>(self.performance||Date).now(),Ca=k1();let Vu;function g2(s,e,n,r,t,i,o,a,c,l,u=!0){return u?v2(s,e,n,r,t,i,o,a,c,l).then(null,f=>(Vu||(console.warn("WebGL SDF generation failed, falling back to JS",f),Vu=!0),Yu(s,e,n,r,t,i,o,a,c,l))):Yu(s,e,n,r,t,i,o,a,c,l)}const ta=[],y2=5;let hl=0;function O1(){const s=hr();for(;ta.length&&hr()-s<y2;)ta.shift()();hl=ta.length?setTimeout(O1,0):0}const v2=(...s)=>new Promise((e,n)=>{ta.push(()=>{const r=hr();try{Ca.webgl.generateIntoCanvas(...s),e({timing:hr()-r})}catch(t){n(t)}}),hl||(hl=setTimeout(O1,0))}),E2=4,x2=2e3,Wu={};let _2=0;function Yu(s,e,n,r,t,i,o,a,c,l){const u="TroikaTextSDFGenerator_JS_"+_2++%E2;let f=Wu[u];return f||(f=Wu[u]={workerModule:$r({name:u,workerId:u,dependencies:[k1,hr],init(A,d){const x=A().javascript.generate;return function(...p){const v=d();return{textureData:x(...p),timing:d()-v}}},getTransferables(A){return[A.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(s,e,n,r,t,i).then(({textureData:A,timing:d})=>{const x=hr(),p=new Uint8Array(A.length*4);for(let v=0;v<A.length;v++)p[v*4+l]=A[v];return Ca.webglUtils.renderImageData(o,p,a,c,s,e,1<<3-l),d+=hr()-x,--f.requests===0&&(f.idleTimer=setTimeout(()=>{$m(u)},x2)),{timing:d}})}function C2(s){s._warm||(Ca.webgl.isSupported(s),s._warm=!0)}const w2=Ca.webglUtils.resizeWebGLCanvasWithoutClearing,Os={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},I2=new Ve;function vr(){return(self.performance||Date).now()}const ju=Object.create(null);function N1(s,e){s=S2({},s);const n=vr(),r=[];if(s.font&&r.push({label:"user",src:M2(s.font)}),s.font=r,s.text=""+s.text,s.sdfGlyphSize=s.sdfGlyphSize||Os.sdfGlyphSize,s.unicodeFontsURL=s.unicodeFontsURL||Os.unicodeFontsURL,s.colorRanges!=null){let A={};for(let d in s.colorRanges)if(s.colorRanges.hasOwnProperty(d)){let x=s.colorRanges[d];typeof x!="number"&&(x=I2.set(x).getHex()),A[d]=x}s.colorRanges=A}Object.freeze(s);const{textureWidth:t,sdfExponent:i}=Os,{sdfGlyphSize:o}=s,a=t/o*4;let c=ju[o];if(!c){const A=document.createElement("canvas");A.width=t,A.height=o*256/a,c=ju[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:A,sdfTexture:new an(A,void 0,void 0,void 0,Bt,Bt),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,b2(c)}const{sdfTexture:l,sdfCanvas:u}=c;V1(s).then(A=>{const{glyphIds:d,glyphFontIndices:x,fontData:p,glyphPositions:v,fontSize:y,timings:g}=A,m=[],_=new Float32Array(d.length*4);let E=0,C=0;const w=vr(),I=p.map(M=>{let D=c.glyphsByFont.get(M.src);return D||c.glyphsByFont.set(M.src,D=new Map),D});d.forEach((M,D)=>{const N=x[D],{src:G,unitsPerEm:q}=p[N];let X=I[N].get(M);if(!X){const{path:j,pathBounds:L}=A.glyphData[G][M],z=Math.max(L[2]-L[0],L[3]-L[1])/o*(Os.sdfMargin*o+.5),F=c.glyphCount++,R=[L[0]-z,L[1]-z,L[2]+z,L[3]+z];I[N].set(M,X={path:j,atlasIndex:F,sdfViewBox:R}),m.push(X)}const{sdfViewBox:O}=X,H=v[C++],T=v[C++],W=y/q;_[E++]=H+O[0]*W,_[E++]=T+O[1]*W,_[E++]=H+O[2]*W,_[E++]=T+O[3]*W,d[D]=X.atlasIndex}),g.quads=(g.quads||0)+(vr()-w);const B=vr();g.sdf={};const S=u.height,U=Math.ceil(c.glyphCount/a),b=Math.pow(2,Math.ceil(Math.log2(U*o)));b>S&&(console.info(`Increasing SDF texture size ${S}->${b}`),w2(u,t,b),l.dispose()),Promise.all(m.map(M=>G1(M,c,s.gpuAccelerateSDF).then(({timing:D})=>{g.sdf[M.atlasIndex]=D}))).then(()=>{m.length&&!c.contextLost&&(H1(c),l.needsUpdate=!0),g.sdfTotal=vr()-B,g.total=vr()-n,e(Object.freeze({parameters:s,sdfTexture:l,sdfGlyphSize:o,sdfExponent:i,glyphBounds:_,glyphAtlasIndices:d,glyphColors:A.glyphColors,caretPositions:A.caretPositions,chunkedBounds:A.chunkedBounds,ascender:A.ascender,descender:A.descender,lineHeight:A.lineHeight,capHeight:A.capHeight,xHeight:A.xHeight,topBaseline:A.topBaseline,blockBounds:A.blockBounds,visibleBounds:A.visibleBounds,timings:A.timings}))})}),Promise.resolve().then(()=>{c.contextLost||C2(u)})}function G1({path:s,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:t,contextLost:i},o){if(i)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:c}=Os,l=Math.max(n[2]-n[0],n[3]-n[1]),u=Math.floor(e/4),f=u%(a/r)*r,A=Math.floor(u/(a/r))*r,d=e%4;return g2(r,r,s,n,l,c,t,f,A,d,o)}function b2(s){const e=s.sdfCanvas;e.addEventListener("webglcontextlost",n=>{console.log("Context Lost",n),n.preventDefault(),s.contextLost=!0}),e.addEventListener("webglcontextrestored",n=>{console.log("Context Restored",n),s.contextLost=!1;const r=[];s.glyphsByFont.forEach(t=>{t.forEach(i=>{r.push(G1(i,s,!0))})}),Promise.all(r).then(()=>{H1(s),s.sdfTexture.needsUpdate=!0})})}function B2({font:s,characters:e,sdfGlyphSize:n},r){let t=Array.isArray(e)?e.join(`
`):""+e;N1({font:s,sdfGlyphSize:n,text:t},r)}function S2(s,e){for(let n in e)e.hasOwnProperty(n)&&(s[n]=e[n]);return s}let Eo;function M2(s){return Eo||(Eo=typeof document>"u"?{}:document.createElement("a")),Eo.href=s,Eo.href}function H1(s){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:n}=s,{width:r,height:t}=e,i=s.sdfCanvas.getContext("webgl");let o=n.image.data;(!o||o.length!==r*t*4)&&(o=new Uint8Array(r*t*4),n.image={width:r,height:t,data:o},n.flipY=!1,n.isDataTexture=!0),i.readPixels(0,0,r,t,i.RGBA,i.UNSIGNED_BYTE,o)}}const T2=$r({name:"Typesetter",dependencies:[p2,m2,t2],init(s,e,n){return s(e,n())}}),V1=$r({name:"Typesetter",dependencies:[T2],init(s){return function(e){return new Promise(n=>{s.typeset(e,n)})}},getTransferables(s){const e=[];for(let n in s)s[n]&&s[n].buffer&&e.push(s[n].buffer);return e}});V1.onMainThread;const qu={};function D2(s){let e=qu[s];return e||(e=qu[s]=new yi(1,1,s,s).translate(.5,.5,0)),e}const R2="aTroikaGlyphBounds",Xu="aTroikaGlyphIndex",P2="aTroikaGlyphColor";class Q2 extends Il{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Oi,this.boundingBox=new Rt}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let n=D2(e);["position","normal","uv"].forEach(r=>{this.attributes[r]=n.attributes[r].clone()}),this.setIndex(n.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,n,r,t,i){this.updateAttributeData(R2,e,4),this.updateAttributeData(Xu,n,1),this.updateAttributeData(P2,i,3),this._blockBounds=r,this._chunkedBounds=t,this.instanceCount=n.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:n,boundingBox:r}=this;if(n){const{PI:t,floor:i,min:o,max:a,sin:c,cos:l}=Math,u=t/2,f=t*2,A=Math.abs(n),d=e[0]/A,x=e[2]/A,p=i((d+u)/f)!==i((x+u)/f)?-A:o(c(d)*A,c(x)*A),v=i((d-u)/f)!==i((x-u)/f)?A:a(c(d)*A,c(x)*A),y=i((d+t)/f)!==i((x+t)/f)?A*2:a(A-l(d)*A,A-l(x)*A);r.min.set(p,e[1],n<0?-y:0),r.max.set(v,e[3],n<0?0:y)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let n=this.getAttribute(Xu).count,r=this._chunkedBounds;if(r)for(let t=r.length;t--;){n=r[t].end;let i=r[t].rect;if(i[1]<e.w&&i[3]>e.y&&i[0]<e.z&&i[2]>e.x)break}this.instanceCount=n}updateAttributeData(e,n,r){const t=this.getAttribute(e);n?t&&t.array.length===n.length?(t.array.set(n),t.needsUpdate=!0):(this.setAttribute(e,new sa(n,r)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(e)}}const z2=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,F2=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,U2=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,k2=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function L2(s){const e=ul(s,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Te},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Li(0,0,0,0)},uTroikaClipRect:{value:new Li(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Te},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ve},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Ln},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:z2,vertexTransform:F2,fragmentDefs:U2,fragmentColorTransform:k2,customRewriter({vertexShader:n,fragmentShader:r}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(r)&&(r=r.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(n)||(n=n.replace(L1,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:n,fragmentShader:r}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const zl=new Jr({color:16777215,side:Jt,transparent:!0}),Ku=8421504,Zu=new Me,xo=new k,ac=new k,vs=[],O2=new k,cc="+x+y";function Ju(s){return Array.isArray(s)?s[0]:s}let W1=()=>{const s=new Qe(new yi(1,1),zl);return W1=()=>s,s},Y1=()=>{const s=new Qe(new yi(1,1,32,1),zl);return Y1=()=>s,s};const N2={type:"syncstart"},G2={type:"synccomplete"},j1=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],H2=j1.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let q1=class extends Qe{constructor(){const e=new Q2;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Ku,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=cc,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(N2),N1({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},n=>{this._isSyncing=!1,this._textRenderInfo=n,this.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(t=>t&&t())})),this.dispatchEvent(G2),e&&e()})))}onBeforeRender(e,n,r,t,i,o){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return L2(e)}get material(){let e=this._derivedMaterial;const n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=zl.clone());if((!e||!e.isDerivedFrom(n))&&(e=this._derivedMaterial=this.createDerivedMaterial(n),n.addEventListener("dispose",function r(){n.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function t(){e.removeEventListener("dispose",t),r.dispose()})),[r,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return Ju(this.material).getDepthMaterial()}get customDistanceMaterial(){return Ju(this.material).getDistanceMaterial()}_prepareForRender(e){const n=e.isTextOutlineMaterial,r=e.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:a,blockBounds:c}=t;r.uTroikaSDFTexture.value=a,r.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),r.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,r.uTroikaSDFExponent.value=t.sdfExponent,r.uTroikaTotalBounds.value.fromArray(c),r.uTroikaUseGlyphColors.value=!n&&!!t.glyphColors;let l=0,u=0,f=0,A,d,x,p=0,v=0;if(n){let{outlineWidth:g,outlineOffsetX:m,outlineOffsetY:_,outlineBlur:E,outlineOpacity:C}=this;l=this._parsePercent(g)||0,u=Math.max(0,this._parsePercent(E)||0),A=C,p=this._parsePercent(m)||0,v=this._parsePercent(_)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(x=this.strokeColor,r.uTroikaStrokeColor.value.set(x??Ku),d=this.strokeOpacity,d==null&&(d=1)),A=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(p,v),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=f,r.uTroikaStrokeOpacity.value=d,r.uTroikaFillOpacity.value=A??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let y=this.clipRect;if(y&&Array.isArray(y)&&y.length===4)r.uTroikaClipRect.value.fromArray(y);else{const g=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(c[0]-g,c[1]-g,c[2]+g,c[3]+g)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const i=n?this.outlineColor||0:this.color;if(i==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new Ve;(i!==a._input||typeof i=="object")&&a.set(a._input=i)}let o=this.orientation||cc;if(o!==e._orientation){let a=r.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let c=o!==cc&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(c){let[,l,u,f,A]=c;xo.set(0,0,0)[u]=l==="-"?1:-1,ac.set(0,0,0)[A]=f==="-"?-1:1,Zu.lookAt(O2,xo.cross(ac),ac),a.setFromMatrix4(Zu)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let n=e.match(/^(-?[\d.]+)%$/),r=n?parseFloat(n[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,n=new Te){n.copy(e);const r=this.curveRadius;return r&&(n.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),n}worldPositionToTextCoords(e,n=new Te){return xo.copy(e),this.localPositionToTextCoords(this.worldToLocal(xo),n)}raycast(e,n){const{textRenderInfo:r,curveRadius:t}=this;if(r){const i=r.blockBounds,o=t?Y1():W1(),a=o.geometry,{position:c,uv:l}=a.attributes;for(let u=0;u<l.count;u++){let f=i[0]+l.getX(u)*(i[2]-i[0]);const A=i[1]+l.getY(u)*(i[3]-i[1]);let d=0;t&&(d=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),c.setXYZ(u,f,A,d)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,vs.length=0,o.raycast(e,vs);for(let u=0;u<vs.length;u++)vs[u].object=this,n.push(vs[u])}}copy(e){const n=this.geometry;return super.copy(e),this.geometry=n,H2.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};j1.forEach(s=>{const e="_private_"+s;Object.defineProperty(q1.prototype,s,{get(){return this[e]},set(n){n!==this[e]&&(this[e]=n,this._needsSync=!0)}})});new Rt;new Ve;const uy=h.forwardRef(({sdfGlyphSize:s=64,anchorX:e="center",anchorY:n="middle",font:r,fontSize:t=1,children:i,characters:o,onSync:a,...c},l)=>{const u=re(({invalidate:x})=>x),[f]=h.useState(()=>new q1),[A,d]=h.useMemo(()=>{const x=[];let p="";return h.Children.forEach(i,v=>{typeof v=="string"||typeof v=="number"?p+=v:x.push(v)}),[x,p]},[i]);return Xn(()=>new Promise(x=>B2({font:r,characters:o},x)),["troika-text",r,o]),h.useLayoutEffect(()=>void f.sync(()=>{u(),a&&a(f)})),h.useEffect(()=>()=>f.dispose(),[f]),h.createElement("primitive",me({object:f,ref:l,font:r,text:d,anchorX:e,anchorY:n,fontSize:t,sdfGlyphSize:s},c),A)});let lc=null;async function V2(s){return typeof s=="string"?await(await fetch(s)).json():s}function W2(s){return lc||(lc=new am),lc.parse(s)}async function X1(s){const e=await V2(s);return W2(e)}function Fl(s){return Xn(X1,[s])}Fl.preload=s=>yA(X1,[s]);Fl.clear=s=>ma([s]);const Y2=["string","number"],j2=s=>{let e="";const n=[];return h.Children.forEach(s,r=>{Y2.includes(typeof r)?e+=r+"":n.push(r)}),[e,...n]},q2=h.forwardRef(({font:s,letterSpacing:e=0,lineHeight:n=1,size:r=1,height:t=.2,bevelThickness:i=.1,bevelSize:o=.01,bevelEnabled:a=!1,bevelOffset:c=0,bevelSegments:l=4,curveSegments:u=8,smooth:f,children:A,...d},x)=>{h.useMemo(()=>Gt({RenamedTextGeometry:$d}),[]);const p=h.useRef(null),v=Fl(s),y=h.useMemo(()=>({font:v,size:r,height:t,bevelThickness:i,bevelSize:o,bevelEnabled:a,bevelSegments:l,bevelOffset:c,curveSegments:u,letterSpacing:e,lineHeight:n}),[v,r,t,i,o,a,l,c,u,e,n]),[g,...m]=h.useMemo(()=>j2(A),[A]),_=h.useMemo(()=>[g,y],[g,y]);return h.useLayoutEffect(()=>{f&&(p.current.geometry=vA(p.current.geometry,f),p.current.geometry.computeVertexNormals())},[_,f]),h.useImperativeHandle(x,()=>p.current,[]),h.createElement("mesh",me({},d,{ref:p}),h.createElement("renamedTextGeometry",{args:_}),m)}),hy=()=>{try{var s=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&s.getContext("webgl2"))}catch{return!1}},fy=h.forwardRef(({children:s,multisamping:e=8,renderIndex:n=1,disableRender:r,disableGamma:t,disableRenderPass:i,depthBuffer:o=!0,stencilBuffer:a=!1,anisotropy:c=1,colorSpace:l,type:u,...f},A)=>{h.useMemo(()=>Gt({EffectComposer:qd,RenderPass:Zd,ShaderPass:sl}),[]);const d=h.useRef(null);h.useImperativeHandle(A,()=>d.current,[]);const{scene:x,camera:p,gl:v,size:y,viewport:g}=re(),[m]=h.useState(()=>{const E=new Vt(y.width,y.height,{type:u||zt,format:Wt,depthBuffer:o,stencilBuffer:a,anisotropy:c});return u===ni&&l!=null&&(E.texture.colorSpace=l),E.samples=e,E});h.useEffect(()=>{var E,C;(E=d.current)==null||E.setSize(y.width,y.height),(C=d.current)==null||C.setPixelRatio(g.dpr)},[v,y,g.dpr]),ze(()=>{var E;r||(E=d.current)==null||E.render()},n);const _=[];return i||_.push(h.createElement("renderPass",{key:"renderpass",attach:`passes-${_.length}`,args:[x,p]})),t||_.push(h.createElement("shaderPass",{attach:`passes-${_.length}`,key:"gammapass",args:[em]})),h.Children.forEach(s,E=>{E&&_.push(h.cloneElement(E,{key:_.length,attach:`passes-${_.length}`}))}),h.createElement("effectComposer",me({ref:d,args:[v,m]},f),_)});let $u=function(s){return s.Linear="linear",s.Radial="radial",s}({});function Ay({stops:s,colors:e,size:n=1024,width:r=16,type:t=$u.Linear,innerCircleRadius:i=0,outerCircleRadius:o="auto",...a}){const c=re(u=>u.gl),l=h.useMemo(()=>{const u=document.createElement("canvas"),f=u.getContext("2d");u.width=r,u.height=n;let A;if(t===$u.Linear)A=f.createLinearGradient(0,0,0,n);else{const p=u.width/2,v=u.height/2,y=o!=="auto"?Math.abs(Number(o)):Math.sqrt(p**2+v**2);A=f.createRadialGradient(p,v,Math.abs(i),p,v,y)}const d=new Ve;let x=s.length;for(;x--;)A.addColorStop(s[x],d.set(e[x]).getStyle());return f.save(),f.fillStyle=A,f.fillRect(0,0,r,n),f.restore(),u},[s]);return h.createElement("canvasTexture",me({colorSpace:c.outputColorSpace,args:[l],attach:"map"},a))}function ln(s,e,n,r){const t=class extends kt{constructor(o={}){const a=Object.entries(s);super({uniforms:a.reduce((c,[l,u])=>{const f=Xr.clone({[l]:{value:u}});return{...c,...f}},{}),vertexShader:e,fragmentShader:n}),this.key="",a.forEach(([c])=>Object.defineProperty(this,c,{get:()=>this.uniforms[c].value,set:l=>this.uniforms[c].value=l})),Object.assign(this,o),r&&r(this)}};return t.key=je.generateUUID(),t}const X2=()=>parseInt(pa.replace(/\D+/g,"")),mi=X2(),e0=ln({color:new Ve("white"),scale:new Te(1,1),imageBounds:new Te(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),K1=h.forwardRef(({children:s,color:e,segments:n=1,scale:r=1,zoom:t=1,grayscale:i=0,opacity:o=1,radius:a=0,texture:c,toneMapped:l,transparent:u,side:f,...A},d)=>{Gt({ImageMaterial:e0});const x=h.useRef(null),p=re(m=>m.size),v=Array.isArray(r)?[r[0],r[1]]:[r,r],y=[c.image.width,c.image.height],g=Math.max(p.width,p.height);return h.useImperativeHandle(d,()=>x.current,[]),h.useLayoutEffect(()=>{x.current.geometry.parameters&&x.current.material.scale.set(v[0]*x.current.geometry.parameters.width,v[1]*x.current.geometry.parameters.height)},[v[0],v[1]]),h.createElement("mesh",me({ref:x,scale:Array.isArray(r)?[...r,1]:r},A),h.createElement("planeGeometry",{args:[1,1,n,n]}),h.createElement("imageMaterial",{color:e,map:c,zoom:t,grayscale:i,opacity:o,scale:v,imageBounds:y,resolution:g,radius:a,toneMapped:l,transparent:u,side:f,key:e0.key}),s)}),K2=h.forwardRef(({url:s,...e},n)=>{const r=va(s);return h.createElement(K1,me({},e,{texture:r,ref:n}))}),Z2=h.forwardRef(({url:s,...e},n)=>h.createElement(K1,me({},e,{ref:n}))),my=h.forwardRef((s,e)=>{if(s.url)return h.createElement(K2,me({},s,{ref:e}));if(s.texture)return h.createElement(Z2,me({},s,{ref:e}));throw new Error("<Image /> requires a url or texture")}),J2=h.forwardRef(({threshold:s=15,geometry:e,...n},r)=>{const t=h.useRef(null);h.useImperativeHandle(r,()=>t.current,[]);const i=h.useMemo(()=>[0,0,0,1,0,0],[]),o=h.useRef(null),a=h.useRef(null);return h.useLayoutEffect(()=>{const c=t.current.parent,l=e??(c==null?void 0:c.geometry);if(!l||o.current===l&&a.current===s)return;o.current=l,a.current=s;const f=new EA(l,s).attributes.position.array;t.current.geometry.setPositions(f),t.current.geometry.attributes.instanceStart.needsUpdate=!0,t.current.geometry.attributes.instanceEnd.needsUpdate=!0,t.current.computeLineDistances()}),h.createElement(_n,me({segments:!0,points:i,ref:t,raycast:()=>null},n))}),t0=ln({screenspace:!1,color:new Ve("black"),opacity:1,thickness:.05,size:new Te},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function py({color:s="black",opacity:e=1,transparent:n=!1,screenspace:r=!1,toneMapped:t=!0,polygonOffset:i=!1,polygonOffsetFactor:o=0,renderOrder:a=0,thickness:c=.05,angle:l=Math.PI,clippingPlanes:u,...f}){const A=h.useRef(null),[d]=h.useState(()=>new t0({side:Kr})),{gl:x}=re(),p=x.getDrawingBufferSize(new Te);h.useMemo(()=>Gt({OutlinesMaterial:t0}),[]);const v=h.useRef(0),y=h.useRef(null);return h.useLayoutEffect(()=>{const g=A.current;if(!g)return;const m=g.parent;if(m&&m.geometry&&(v.current!==l||y.current!==m.geometry)){var _;v.current=l,y.current=m.geometry;let E=(_=g.children)==null?void 0:_[0];E&&(l&&E.geometry.dispose(),g.remove(E)),m.skeleton?(E=new xA,E.material=d,E.bind(m.skeleton,m.bindMatrix),g.add(E)):m.isInstancedMesh?(E=new Oh(m.geometry,d,m.count),E.instanceMatrix=m.instanceMatrix,g.add(E)):(E=new Qe,E.material=d,g.add(E)),E.geometry=l?Xh(m.geometry,l):m.geometry,E.morphTargetInfluences=m.morphTargetInfluences,E.morphTargetDictionary=m.morphTargetDictionary}}),h.useLayoutEffect(()=>{const g=A.current;if(!g)return;const m=g.children[0];if(m){m.renderOrder=a;const _=g.parent;ji(m,{morphTargetInfluences:_.morphTargetInfluences,morphTargetDictionary:_.morphTargetDictionary}),ji(m.material,{transparent:n,thickness:c,color:s,opacity:e,size:p,screenspace:r,toneMapped:t,polygonOffset:i,polygonOffsetFactor:o,clippingPlanes:u,clipping:u&&u.length>0})}}),h.useEffect(()=>()=>{const g=A.current;if(!g)return;const m=g.children[0];m&&(l&&m.geometry.dispose(),g.remove(m))},[]),h.createElement("group",me({ref:A},f))}var $2=Object.defineProperty,ep=(s,e,n)=>e in s?$2(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,pt=(s,e,n)=>(ep(s,typeof e!="symbol"?e+"":e,n),n);function uc(s,e,n,r,t){let i;if(s=s.subarray||s.slice?s:s.buffer,n=n.subarray||n.slice?n:n.buffer,s=e?s.subarray?s.subarray(e,t&&e+t):s.slice(e,t&&e+t):s,n.set)n.set(s,r);else for(i=0;i<s.length;i++)n[i+r]=s[i];return n}function tp(s){return s instanceof Float32Array?s:s instanceof ki?s.getAttribute("position").array:s.map(e=>{const n=Array.isArray(e);return e instanceof k?[e.x,e.y,e.z]:e instanceof Te?[e.x,e.y,0]:n&&e.length===3?[e[0],e[1],e[2]]:n&&e.length===2?[e[0],e[1],0]:e}).flat()}class ip extends ki{constructor(){super(),pt(this,"type","MeshLine"),pt(this,"isMeshLine",!0),pt(this,"positions",[]),pt(this,"previous",[]),pt(this,"next",[]),pt(this,"side",[]),pt(this,"width",[]),pt(this,"indices_array",[]),pt(this,"uvs",[]),pt(this,"counters",[]),pt(this,"widthCallback",null),pt(this,"_attributes"),pt(this,"_points",[]),pt(this,"points"),pt(this,"matrixWorld",new Me),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,n){if(e=tp(e),this._points=e,this.widthCallback=n??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof k)for(let r=0;r<e.length;r++){const t=e[r],i=r/(e.length-1);this.positions.push(t.x,t.y,t.z),this.positions.push(t.x,t.y,t.z),this.counters.push(i),this.counters.push(i)}else for(let r=0;r<e.length;r+=3){const t=r/(e.length-1);this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(t),this.counters.push(t)}this.process()}compareV3(e,n){const r=e*6,t=n*6;return this.positions[r]===this.positions[t]&&this.positions[r+1]===this.positions[t+1]&&this.positions[r+2]===this.positions[t+2]}copyV3(e){const n=e*6;return[this.positions[n],this.positions[n+1],this.positions[n+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let n,r;this.compareV3(0,e-1)?r=this.copyV3(e-2):r=this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(let t=0;t<e;t++){if(this.side.push(1),this.side.push(-1),this.widthCallback?n=this.widthCallback(t/(e-1)):n=1,this.width.push(n),this.width.push(n),this.uvs.push(t/(e-1),0),this.uvs.push(t/(e-1),1),t<e-1){r=this.copyV3(t),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);const i=t*2;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}t>0&&(r=this.copyV3(t),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]))}this.compareV3(e-1,0)?r=this.copyV3(1):r=this.copyV3(e-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new Nt(new Float32Array(this.positions),3),previous:new Nt(new Float32Array(this.previous),3),next:new Nt(new Float32Array(this.next),3),side:new Nt(new Float32Array(this.side),1),width:new Nt(new Float32Array(this.width),1),uv:new Nt(new Float32Array(this.uvs),2),index:new Nt(new Uint16Array(this.indices_array),1),counters:new Nt(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:n,z:r}){const t=this._attributes.position.array,i=this._attributes.previous.array,o=this._attributes.next.array,a=t.length;uc(t,0,i,0,a),uc(t,6,t,0,a-6),t[a-6]=e,t[a-5]=n,t[a-4]=r,t[a-3]=e,t[a-2]=n,t[a-1]=r,uc(t,6,o,0,a-6),o[a-6]=e,o[a-5]=n,o[a-4]=r,o[a-3]=e,o[a-2]=n,o[a-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const np=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,rp=parseInt(pa.replace(/\D+/g,"")),sp=rp>=154?"colorspace_fragment":"encodings_fragment",op=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${sp}>
  }
`;class ap extends kt{constructor(e){super({uniforms:{...il.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new Ve(16777215)},gradient:{value:[new Ve(16711680),new Ve(65280)]},opacity:{value:1},resolution:{value:new Te(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Te(1,1)}},vertexShader:np,fragmentShader:op}),pt(this,"lineWidth"),pt(this,"map"),pt(this,"useMap"),pt(this,"alphaMap"),pt(this,"useAlphaMap"),pt(this,"color"),pt(this,"gradient"),pt(this,"resolution"),pt(this,"sizeAttenuation"),pt(this,"dashArray"),pt(this,"dashOffset"),pt(this,"dashRatio"),pt(this,"useDash"),pt(this,"useGradient"),pt(this,"visibility"),pt(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(n){this.uniforms.lineWidth.value=n}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(n){this.uniforms.map.value=n}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(n){this.uniforms.useMap.value=n}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(n){this.uniforms.alphaMap.value=n}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(n){this.uniforms.useAlphaMap.value=n}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(n){this.uniforms.color.value=n}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(n){this.uniforms.gradient.value=n}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(n){this.uniforms.resolution.value.copy(n)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(n){this.uniforms.sizeAttenuation.value=n}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(n){this.uniforms.dashArray.value=n,this.useDash=n!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(n){this.uniforms.dashOffset.value=n}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(n){this.uniforms.dashRatio.value=n}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(n){this.uniforms.useDash.value=n}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(n){this.uniforms.useGradient.value=n}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(n){this.uniforms.visibility.value=n}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(n){this.uniforms.alphaTest.value=n}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(n){this.uniforms.repeat.value.copy(n)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const Z1={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},cp=(s,e=1)=>(s.set(s.subarray(e)),s.fill(-1/0,-e),s);function lp(s,e){const{length:n,local:r,decay:t,interval:i,stride:o}={...Z1,...e},a=h.useRef(null),[c]=h.useState(()=>new k);h.useLayoutEffect(()=>{s&&(a.current=Float32Array.from({length:n*10*3},(f,A)=>s.position.getComponent(A%3)))},[n,s]);const l=h.useRef(new k),u=h.useRef(0);return ze(()=>{if(s&&a.current){if(u.current===0){let f;r?f=s.position:(s.getWorldPosition(c),f=c);const A=1*t;for(let d=0;d<A;d++)f.distanceTo(l.current)<o||(cp(a.current,3),a.current.set(f.toArray(),a.current.length-3));l.current.copy(f)}u.current++,u.current=u.current%i}}),a}const gy=h.forwardRef((s,e)=>{const{children:n}=s,{width:r,length:t,decay:i,local:o,stride:a,interval:c}={...Z1,...s},{color:l="hotpink",attenuation:u,target:f}=s,A=re(_=>_.size),d=re(_=>_.scene),x=h.useRef(null),[p,v]=h.useState(null),y=lp(p,{length:t,decay:i,local:o,stride:a,interval:c});h.useEffect(()=>{const _=(f==null?void 0:f.current)||x.current.children.find(E=>E instanceof di);_&&v(_)},[y,f]);const g=h.useMemo(()=>new ip,[]),m=h.useMemo(()=>{var _,E;const C=new ap({lineWidth:.1*r,color:l,sizeAttenuation:1,resolution:new Te(A.width,A.height)});let w;if(n)if(Array.isArray(n))w=n.find(I=>{const B=I;return typeof B.type=="string"&&B.type==="meshLineMaterial"});else{const I=n;typeof I.type=="string"&&I.type==="meshLineMaterial"&&(w=I)}return typeof((_=w)==null?void 0:_.props)=="object"&&((E=w)==null?void 0:E.props)!==null&&C.setValues(w.props),C},[r,l,A,n]);return h.useEffect(()=>{m.uniforms.resolution.value.set(A.width,A.height)},[A]),ze(()=>{y.current&&g.setPoints(y.current,u)}),h.createElement("group",null,Ar(h.createElement("mesh",{ref:e,geometry:g,material:m}),d),h.createElement("group",{ref:x},n))});function up(s,e=16,n,r,t){const[i,o]=h.useState(()=>{const a=Array.from({length:e},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new sa(Float32Array.from(a),16)});return h.useLayoutEffect(()=>{if(typeof s.current>"u")return;const a=new fd(s.current);r&&a.setWeightAttribute(r),a.build();const c=new k,l=new k,u=new Ve,f=new di;s.current.updateMatrixWorld(!0);for(let A=0;A<e;A++)a.sample(c,l,u),typeof n=="function"?n({dummy:f,sampledMesh:s.current,position:c,normal:l,color:u},A):f.position.copy(c),f.updateMatrix(),t!=null&&t.current&&t.current.setMatrixAt(A,f.matrix),f.matrix.toArray(i.array,A*16);t!=null&&t.current&&(t.current.instanceMatrix.needsUpdate=!0),i.needsUpdate=!0,o(new sa(i.array,i.itemSize).copy(i))},[s,t,r,e,n]),i}function yy({children:s,weight:e,transform:n,instances:r,mesh:t,count:i=16,...o}){const a=h.useRef(null),c=h.useRef(null),l=h.useRef(null);return h.useLayoutEffect(()=>{var u,f;c.current=(u=r==null?void 0:r.current)!==null&&u!==void 0?u:a.current.children.find(A=>A.hasOwnProperty("instanceMatrix")),l.current=(f=t==null?void 0:t.current)!==null&&f!==void 0?f:a.current.children.find(A=>A.type==="Mesh")},[s,t==null?void 0:t.current,r==null?void 0:r.current]),up(l,i,n,e,c),h.createElement("group",me({ref:a},o),s)}const vy=({compute:s,name:e,...n})=>{const[r]=h.useState(()=>new Nt(new Float32Array(0),1)),t=h.useRef(null);return h.useLayoutEffect(()=>{if(t.current){var i;const o=(i=t.current.parent)!==null&&i!==void 0?i:t.current.__r3f.parent.object,a=s(o);t.current.copy(a)}},[s]),h.createElement("primitive",me({ref:t,object:r,attach:`attributes-${e}`},n))},Ul=h.createContext(null),Ey=h.forwardRef(({resolution:s=28,maxPolyCount:e=1e4,enableUvs:n=!1,enableColors:r=!1,children:t,...i},o)=>{const a=h.useRef(null);h.useImperativeHandle(o,()=>a.current,[]);const c=h.useMemo(()=>new nd(s,null,n,r,e),[s,e,n,r]),l=h.useMemo(()=>({getParent:()=>a}),[]);return ze(()=>{c.update(),c.reset()},-1),h.createElement(h.Fragment,null,h.createElement("primitive",me({object:c,ref:a},i),h.createElement(Ul.Provider,{value:l},t)))}),xy=h.forwardRef(({strength:s=.5,subtract:e=12,color:n,...r},t)=>{const{getParent:i}=h.useContext(Ul),o=h.useMemo(()=>i(),[i]),a=h.useRef(null);h.useImperativeHandle(t,()=>a.current,[]);const c=new k;return ze(l=>{!o.current||!a.current||(a.current.getWorldPosition(c),o.current.addBall(.5+c.x*.5,.5+c.y*.5,.5+c.z*.5,s,e,n))}),h.createElement("group",me({ref:a},r))}),_y=h.forwardRef(({planeType:s="x",strength:e=.5,subtract:n=12,...r},t)=>{const{getParent:i}=h.useContext(Ul),o=h.useMemo(()=>i(),[i]),a=h.useRef(null);h.useImperativeHandle(t,()=>a.current,[]);const c=h.useMemo(()=>s==="x"?"addPlaneX":s==="y"?"addPlaneY":"addPlaneZ",[s]);return ze(()=>{!o.current||!a.current||o.current[c](e,n)}),h.createElement("group",me({ref:a},r))});function hp(s){return Array.isArray(s)}function hc(s=[0,0,0]){return hp(s)?s:s instanceof k||s instanceof fr?[s.x,s.y,s.z]:[s,s,s]}const Cy=h.forwardRef(function({debug:e,depthTest:n=!1,polygonOffsetFactor:r=-10,map:t,mesh:i,children:o,position:a,rotation:c,scale:l,...u},f){const A=h.useRef(null);h.useImperativeHandle(f,()=>A.current);const d=h.useRef(null),x=h.useRef({position:new k,rotation:new fr,scale:new k(1,1,1)});return h.useLayoutEffect(()=>{const p=(i==null?void 0:i.current)||A.current.parent,v=A.current;if(!(p instanceof Qe))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(p){ji(x.current,{position:a,scale:l});const y=p.matrixWorld.clone();if(p.matrixWorld.identity(),!c||typeof c=="number"){const g=new di;g.position.copy(x.current.position);const m=p.geometry.attributes.position.array;p.geometry.attributes.normal===void 0&&p.geometry.computeVertexNormals();const _=p.geometry.attributes.normal.array;let E=1/0;new k;let C=new k;const w=g.position.x,I=g.position.y,B=g.position.z,S=m.length;let U=-1;for(let b=0;b<S;b+=3){const M=m[b],D=m[b+1],N=m[b+2],G=M-w,q=D-I,X=N-B,O=G*G+q*q+X*X;O<E&&(E=O,U=b)}C.fromArray(_,U),g.lookAt(g.position.clone().add(C)),g.rotateZ(Math.PI),g.rotateY(Math.PI),typeof c=="number"&&g.rotateZ(c),ji(x.current,{rotation:g.rotation})}else ji(x.current,{rotation:c});return v.geometry=new Jd(p,x.current.position,x.current.rotation,x.current.scale),p.matrixWorld=y,()=>{v.geometry.dispose()}}},[i,...hc(a),...hc(l),...hc(c)]),h.useLayoutEffect(()=>{d.current&&(ji(d.current,x.current),d.current.traverse(p=>p.raycast=()=>null))},[e]),h.createElement("mesh",me({ref:A,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":n,"material-map":t},u),o,e&&h.createElement("mesh",{ref:d},h.createElement("boxGeometry",null),h.createElement("meshNormalMaterial",{wireframe:!0}),h.createElement("axesHelper",null)))}),wy=h.forwardRef(function({src:e,skipFill:n,skipStrokes:r,fillMaterial:t,strokeMaterial:i,fillMeshProps:o,strokeMeshProps:a,...c},l){const u=Ei(ic,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),f=h.useMemo(()=>r?[]:u.paths.map(d=>{var x;return((x=d.userData)==null?void 0:x.style.stroke)===void 0||d.userData.style.stroke==="none"?null:d.subPaths.map(p=>ic.pointsToStroke(p.getPoints(),d.userData.style))}),[u,r]);h.useEffect(()=>()=>f.forEach(d=>d&&d.map(x=>x.dispose())),[f]);let A=0;return h.createElement("object3D",me({ref:l},c),h.createElement("object3D",{scale:[1,-1,1]},u.paths.map((d,x)=>{var p,v;return h.createElement(h.Fragment,{key:x},!n&&((p=d.userData)==null?void 0:p.style.fill)!==void 0&&d.userData.style.fill!=="none"&&ic.createShapes(d).map((y,g)=>h.createElement("mesh",me({key:g},o,{renderOrder:A++}),h.createElement("shapeGeometry",{args:[y]}),h.createElement("meshBasicMaterial",me({color:d.userData.style.fill,opacity:d.userData.style.fillOpacity,transparent:!0,side:Jt,depthWrite:!1},t)))),!r&&((v=d.userData)==null?void 0:v.style.stroke)!==void 0&&d.userData.style.stroke!=="none"&&d.subPaths.map((y,g)=>h.createElement("mesh",me({key:g,geometry:f[x][g]},a,{renderOrder:A++}),h.createElement("meshBasicMaterial",me({color:d.userData.style.stroke,opacity:d.userData.style.strokeOpacity,transparent:!0,side:Jt,depthWrite:!1},i)))))})))});function Iy({renderIndex:s=1,bgColor:e="black",fgColor:n="white",characters:r=" .:-+*=%@#",invert:t=!0,color:i=!1,resolution:o=.15}){const{size:a,gl:c,scene:l,camera:u}=re(),f=h.useMemo(()=>{const A=new rm(c,r,{invert:t,color:i,resolution:o});return A.domElement.style.position="absolute",A.domElement.style.top="0px",A.domElement.style.left="0px",A.domElement.style.pointerEvents="none",A},[r,t,i,o]);return h.useLayoutEffect(()=>{f.domElement.style.color=n,f.domElement.style.backgroundColor=e},[n,e]),h.useEffect(()=>(c.domElement.style.opacity="0",c.domElement.parentNode.appendChild(f.domElement),()=>{c.domElement.style.opacity="1",c.domElement.parentNode.removeChild(f.domElement)}),[f]),h.useEffect(()=>{f.setSize(a.width,a.height)},[f,a]),ze(A=>{f.render(l,u)},s),h.createElement(h.Fragment,null)}const i0=ln({alphaTest:0,viewport:new Te(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function fp(s){let e=null,n=0;function r(t,i=!1){const o=e.length/16,a=-1e-4;let c=-1/0,l=1/0;const u=new Float32Array(o),f=new Int32Array(u.buffer),A=new Int32Array(o);let d=0;for(let g=0;g<o;g++){const m=t[0]*e[g*16+12]+t[1]*e[g*16+13]+t[2]*e[g*16+14]+t[3];(i||m<0&&e[g*16+15]>a*m)&&(u[d]=m,A[d]=g,d++,m>c&&(c=m),m<l&&(l=m))}const x=(256*256-1)/(c-l),p=new Uint32Array(256*256);for(let g=0;g<d;g++)f[g]=(u[g]-l)*x|0,p[f[g]]++;const v=new Uint32Array(256*256);for(let g=1;g<256*256;g++)v[g]=v[g-1]+p[g-1];const y=new Uint32Array(d);for(let g=0;g<d;g++)y[v[f[g]]++]=A[g];return y}s.onmessage=t=>{if(t.data.method=="push"){n===0&&(e=new Float32Array(t.data.length));const i=new Float32Array(t.data.matrices);e.set(i,n),n+=i.length}else if(t.data.method=="sort"&&e!==null){const i=r(new Float32Array(t.data.view),t.data.hashed);s.postMessage({indices:i,key:t.data.key},[i.buffer])}}}class Ap extends Ks{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,n,r,t){const i={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",fp.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(o,a,c)=>pp(a,i,o,c),connect:o=>gp(i,o),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:r};dp(i).then(n).catch(o=>{t==null||t(o),i.manager.itemError(i.url)})}}async function dp(s){s.manager.itemStart(s.url);const e=await fetch(s.url);if(e.body===null)throw"Failed to fetch file";let n=e.headers.get("Content-Length");const r=n?parseInt(n):void 0;if(r==null)throw"Failed to get content length";s.stream=e.body.getReader(),s.totalDownloadBytes=r,s.numVertices=Math.floor(s.totalDownloadBytes/s.rowLength);const t=s.gl.getContext();let i=t.getParameter(t.MAX_TEXTURE_SIZE);return s.maxVertexes=i*i,s.numVertices>s.maxVertexes&&(s.numVertices=s.maxVertexes),s.bufferTextureWidth=i,s.bufferTextureHeight=Math.floor((s.numVertices-1)/i)+1,s.centerAndScaleData=new Float32Array(s.bufferTextureWidth*s.bufferTextureHeight*4),s.covAndColorData=new Uint32Array(s.bufferTextureWidth*s.bufferTextureHeight*4),s.centerAndScaleTexture=new Vn(s.centerAndScaleData,s.bufferTextureWidth,s.bufferTextureHeight,Wt,Tt),s.centerAndScaleTexture.needsUpdate=!0,s.covAndColorTexture=new Vn(s.covAndColorData,s.bufferTextureWidth,s.bufferTextureHeight,oa,lr),s.covAndColorTexture.internalFormat="RGBA32UI",s.covAndColorTexture.needsUpdate=!0,s}async function mp(s){s.loading=!0;let e=0,n=0;const r=[];let t=0;const i=s.totalDownloadBytes!==0;for(;;)try{const{value:o,done:a}=await s.stream.read();if(a)break;if(e+=o.length,s.totalDownloadBytes!=null){const l=e/s.totalDownloadBytes*100;if(s.onProgress&&l-t>1){const u=new ProgressEvent("progress",{lengthComputable:i,loaded:e,total:s.totalDownloadBytes});s.onProgress(u),t=l}}r.push(o);const c=e-n;if(s.totalDownloadBytes!=null&&c>s.rowLength*s.chunkSize){let l=Math.floor(c/s.rowLength);const u=new Uint8Array(c);let f=0;for(const x of r)u.set(x,f),f+=x.length;if(r.length=0,c>l*s.rowLength){const x=new Uint8Array(c-l*s.rowLength);x.set(u.subarray(c-x.length,c),0),r.push(x)}const A=new Uint8Array(l*s.rowLength);A.set(u.subarray(0,A.byteLength),0);const d=n0(s,A.buffer,l);if(s.worker.postMessage({method:"push",src:s.url,length:s.numVertices*16,matrices:d.buffer},[d.buffer]),n+=l*s.rowLength,s.onProgress){const x=new ProgressEvent("progress",{lengthComputable:i,loaded:s.totalDownloadBytes,total:s.totalDownloadBytes});s.onProgress(x)}}}catch(o){console.error(o);break}if(e-n>0){let o=new Uint8Array(r.reduce((u,f)=>u+f.length,0)),a=0;for(const u of r)o.set(u,a),a+=u.length;let c=Math.floor(o.byteLength/s.rowLength);const l=n0(s,o.buffer,c);s.worker.postMessage({method:"push",src:s.url,length:c*16,matrices:l.buffer},[l.buffer])}s.loaded=!0,s.manager.itemEnd(s.url)}function pp(s,e,n,r){if(s.updateMatrixWorld(),e.gl.getCurrentViewport(n.viewport),n.material.viewport.x=n.viewport.z,n.material.viewport.y=n.viewport.w,n.material.focal=n.viewport.w/2*Math.abs(s.projectionMatrix.elements[5]),n.ready){if(r&&n.sorted)return;n.ready=!1;const t=new Float32Array([n.modelViewMatrix.elements[2],-n.modelViewMatrix.elements[6],n.modelViewMatrix.elements[10],n.modelViewMatrix.elements[14]]);e.worker.postMessage({method:"sort",src:e.url,key:n.uuid,view:t.buffer,hashed:r},[t.buffer]),r&&e.loaded&&(n.sorted=!0)}}function gp(s,e){s.loading||mp(s),e.ready=!1,e.pm=new Me,e.vm1=new Me,e.vm2=new Me,e.viewport=new Li;let n=new Uint32Array(s.bufferTextureWidth*s.bufferTextureHeight);const r=new sa(n,1,!1);r.setUsage(Ai);const t=e.geometry=new Il,i=new Float32Array(6*3),o=new Nt(i,3);t.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,t.setAttribute("splatIndex",r),t.instanceCount=1;function a(l){if(e&&l.data.key===e.uuid){let u=new Uint32Array(l.data.indices);t.attributes.splatIndex.set(u),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=u.length,e.ready=!0}}s.worker.addEventListener("message",a);async function c(){for(;;){const l=s.gl.properties.get(s.centerAndScaleTexture),u=s.gl.properties.get(s.covAndColorTexture);if(l!=null&&l.__webglTexture&&u!=null&&u.__webglTexture&&s.loadedVertexCount>0)break;await new Promise(f=>setTimeout(f,10))}e.ready=!0}return c(),()=>s.worker.removeEventListener("message",a)}function n0(s,e,n){const r=s.gl.getContext();if(s.loadedVertexCount+n>s.maxVertexes&&(n=s.maxVertexes-s.loadedVertexCount),n<=0)throw"Failed to parse file";const t=new Uint8Array(e),i=new Float32Array(e),o=new Float32Array(n*16),a=new Uint8Array(s.covAndColorData.buffer),c=new Int16Array(s.covAndColorData.buffer);for(let l=0;l<n;l++){const u=new st(-(t[32*l+28+1]-128)/128,(t[32*l+28+2]-128)/128,(t[32*l+28+3]-128)/128,-(t[32*l+28+0]-128)/128);u.invert();const f=new k(i[8*l+0],i[8*l+1],-i[8*l+2]),A=new k(i[8*l+3+0],i[8*l+3+1],i[8*l+3+2]),d=new Me;d.makeRotationFromQuaternion(u),d.transpose(),d.scale(A);const x=d.clone();d.transpose(),d.premultiply(x),d.setPosition(f);const p=[0,1,2,5,6,10];let v=0;for(let m=0;m<p.length;m++)Math.abs(d.elements[p[m]])>v&&(v=Math.abs(d.elements[p[m]]));let y=s.loadedVertexCount*4+l*4;s.centerAndScaleData[y+0]=f.x,s.centerAndScaleData[y+1]=-f.y,s.centerAndScaleData[y+2]=f.z,s.centerAndScaleData[y+3]=v/32767,y=s.loadedVertexCount*8+l*4*2;for(let m=0;m<p.length;m++)c[y+m]=d.elements[p[m]]*32767/v;y=s.loadedVertexCount*16+(l*4+3)*4;const g=new Ve(t[32*l+24+0]/255,t[32*l+24+1]/255,t[32*l+24+2]/255);g.convertSRGBToLinear(),a[y+0]=g.r*255,a[y+1]=g.g*255,a[y+2]=g.b*255,a[y+3]=t[32*l+24+3],d.elements[15]=Math.max(A.x,A.y,A.z)*t[32*l+24+3]/255;for(let m=0;m<16;m++)o[l*16+m]=d.elements[m]}for(;n>0;){let l=0,u=0;const f=s.loadedVertexCount%s.bufferTextureWidth,A=Math.floor(s.loadedVertexCount/s.bufferTextureWidth);s.loadedVertexCount%s.bufferTextureWidth!=0?(l=Math.min(s.bufferTextureWidth,f+n)-f,u=1):Math.floor(n/s.bufferTextureWidth)>0?(l=s.bufferTextureWidth,u=Math.floor(n/s.bufferTextureWidth)):(l=n%s.bufferTextureWidth,u=1);const d=s.gl.properties.get(s.centerAndScaleTexture);r.bindTexture(r.TEXTURE_2D,d.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,f,A,l,u,r.RGBA,r.FLOAT,s.centerAndScaleData,s.loadedVertexCount*4);const x=s.gl.properties.get(s.covAndColorTexture);r.bindTexture(r.TEXTURE_2D,x.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,f,A,l,u,r.RGBA_INTEGER,r.UNSIGNED_INT,s.covAndColorData,s.loadedVertexCount*4),s.gl.resetState(),s.loadedVertexCount+=l*u,n-=l*u}return o}function by({src:s,toneMapped:e=!1,alphaTest:n=0,alphaHash:r=!1,chunkSize:t=25e3,...i}){Gt({SplatMaterial:i0});const o=h.useRef(null),a=re(u=>u.gl),c=re(u=>u.camera),l=Ei(Ap,s,u=>{u.gl=a,u.chunkSize=t});return h.useLayoutEffect(()=>l.connect(o.current),[s]),ze(()=>l.update(o.current,c,r)),h.createElement("mesh",me({ref:o,frustumCulled:!1},i),h.createElement("splatMaterial",{key:`${s}/${n}/${r}${i0.key}`,transparent:!r,depthTest:!0,alphaTest:r?0:n,centerAndScaleTexture:l.centerAndScaleTexture,covAndColorTexture:l.covAndColorTexture,depthWrite:r?!0:n>0,blending:r?_A:Zh,blendSrcAlpha:Kh,alphaHash:!!r,toneMapped:e}))}function Bi(s,e,n){const r=re(A=>A.size),t=re(A=>A.viewport),i=typeof s=="number"?s:r.width*t.dpr,o=typeof e=="number"?e:r.height*t.dpr,a=(typeof s=="number"?n:s)||{},{samples:c=0,depth:l,...u}=a,f=h.useMemo(()=>{const A=new Vt(i,o,{minFilter:Bt,magFilter:Bt,type:zt,...u});return l&&(A.depthTexture=new bl(i,o,Tt)),A.samples=c,A},[]);return h.useLayoutEffect(()=>{f.setSize(i,o),c&&(f.samples=c)},[c,f,i,o]),h.useEffect(()=>()=>f.dispose(),[]),f}const By=({children:s,width:e,height:n,...r})=>{const t=Bi(e,n,r);return h.createElement(h.Fragment,null,s==null?void 0:s(t))},yp=s=>typeof s=="function",vp=h.forwardRef(({envMap:s,resolution:e=256,frames:n=1/0,children:r,makeDefault:t,...i},o)=>{const a=re(({set:v})=>v),c=re(({camera:v})=>v),l=re(({size:v})=>v),u=h.useRef(null);h.useImperativeHandle(o,()=>u.current,[]);const f=h.useRef(null),A=Bi(e);h.useLayoutEffect(()=>{i.manual||u.current.updateProjectionMatrix()},[l,i]),h.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),h.useLayoutEffect(()=>{if(t){const v=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:v}))}},[u,t,a]);let d=0,x=null;const p=yp(r);return ze(v=>{p&&(n===1/0||d<n)&&(f.current.visible=!1,v.gl.setRenderTarget(A),x=v.scene.background,s&&(v.scene.background=s),v.gl.render(v.scene,u.current),v.scene.background=x,v.gl.setRenderTarget(null),f.current.visible=!0,d++)}),h.createElement(h.Fragment,null,h.createElement("orthographicCamera",me({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},i),!p&&r),h.createElement("group",{ref:f},p&&r(A.texture)))}),Ep=s=>typeof s=="function",Sy=h.forwardRef(({envMap:s,resolution:e=256,frames:n=1/0,makeDefault:r,children:t,...i},o)=>{const a=re(({set:v})=>v),c=re(({camera:v})=>v),l=re(({size:v})=>v),u=h.useRef(null);h.useImperativeHandle(o,()=>u.current,[]);const f=h.useRef(null),A=Bi(e);h.useLayoutEffect(()=>{i.manual||(u.current.aspect=l.width/l.height)},[l,i]),h.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let d=0,x=null;const p=Ep(t);return ze(v=>{p&&(n===1/0||d<n)&&(f.current.visible=!1,v.gl.setRenderTarget(A),x=v.scene.background,s&&(v.scene.background=s),v.gl.render(v.scene,u.current),v.scene.background=x,v.gl.setRenderTarget(null),f.current.visible=!0,d++)}),h.useLayoutEffect(()=>{if(r){const v=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:v}))}},[u,r,a]),h.createElement(h.Fragment,null,h.createElement("perspectiveCamera",me({ref:u},i),!p&&t),h.createElement("group",{ref:f},p&&t(A.texture)))});function xp({resolution:s=256,near:e=.1,far:n=1e3,envMap:r,fog:t}={}){const i=re(({gl:A})=>A),o=re(({scene:A})=>A),a=h.useMemo(()=>{const A=new ga(s);return A.texture.type=zt,A},[s]);h.useEffect(()=>()=>{a.dispose()},[a]);const c=h.useMemo(()=>new Jh(e,n,a),[e,n,a]);let l,u;const f=h.useCallback(()=>{l=o.fog,u=o.background,o.background=r||u,o.fog=t||l,c.update(i,o),o.fog=l,o.background=u},[i,o,c]);return{fbo:a,camera:c,update:f}}function My({children:s,frames:e=1/0,resolution:n,near:r,far:t,envMap:i,fog:o,...a}){const c=h.useRef(null),{fbo:l,camera:u,update:f}=xp({resolution:n,near:r,far:t,envMap:i,fog:o});let A=0;return ze(()=>{c.current&&(e===1/0||A<e)&&(c.current.visible=!1,f(),c.current.visible=!0,A++)}),h.createElement("group",a,h.createElement("primitive",{object:u}),h.createElement("group",{ref:c},s==null?void 0:s(l.texture)))}const Ty=h.forwardRef((s,e)=>{const{camera:n,onChange:r,makeDefault:t,...i}=s,o=re(A=>A.camera),a=re(A=>A.invalidate),c=re(A=>A.get),l=re(A=>A.set),u=n||o,f=h.useMemo(()=>new Md(u),[u]);return h.useEffect(()=>{const A=d=>{a(),r&&r(d)};return f==null||f.addEventListener==null||f.addEventListener("change",A),()=>f==null||f.removeEventListener==null?void 0:f.removeEventListener("change",A)},[r,f,a]),ze(()=>f==null?void 0:f.update(),-1),h.useEffect(()=>{const A=f;return A==null||A.connect(),()=>A==null?void 0:A.dispose()},[f]),h.useEffect(()=>{if(t){const A=c().controls;return l({controls:f}),()=>l({controls:A})}},[t,f]),f?h.createElement("primitive",me({ref:e,object:f},i)):null}),Dy=h.forwardRef(({domElement:s,...e},n)=>{const{onChange:r,makeDefault:t,...i}=e,o=re(x=>x.invalidate),a=re(x=>x.camera),c=re(x=>x.gl),l=re(x=>x.events),u=re(x=>x.get),f=re(x=>x.set),A=s||l.connected||c.domElement,d=h.useMemo(()=>new kd(a),[a]);return h.useEffect(()=>(d.connect(A),()=>void d.dispose()),[A,d,o]),h.useEffect(()=>{const x=p=>{o(),r&&r(p)};return d.addEventListener==null||d.addEventListener("change",x),()=>d.removeEventListener==null?void 0:d.removeEventListener("change",x)},[r,o]),h.useEffect(()=>{if(t){const x=u().controls;return f({controls:d}),()=>f({controls:x})}},[t,d]),ze((x,p)=>d.update(p)),h.createElement("primitive",me({ref:n,object:d,args:[a,A]},i))}),Ry=h.forwardRef((s={enableDamping:!0},e)=>{const{domElement:n,camera:r,makeDefault:t,onChange:i,onStart:o,onEnd:a,...c}=s,l=re(g=>g.invalidate),u=re(g=>g.camera),f=re(g=>g.gl),A=re(g=>g.events),d=re(g=>g.set),x=re(g=>g.get),p=n||A.connected||f.domElement,v=r||u,y=h.useMemo(()=>new CA(v),[v]);return h.useEffect(()=>{y.connect(p);const g=m=>{l(),i&&i(m)};return y.addEventListener("change",g),o&&y.addEventListener("start",o),a&&y.addEventListener("end",a),()=>{y.dispose(),y.removeEventListener("change",g),o&&y.removeEventListener("start",o),a&&y.removeEventListener("end",a)}},[i,o,a,y,l,p]),h.useEffect(()=>{if(t){const g=x().controls;return d({controls:y}),()=>d({controls:g})}},[t,y]),ze(()=>y.update(),-1),h.createElement("primitive",me({ref:e,object:y,enableDamping:!0},c))}),Py=h.forwardRef(({makeDefault:s,camera:e,domElement:n,regress:r,onChange:t,onStart:i,onEnd:o,...a},c)=>{const{invalidate:l,camera:u,gl:f,events:A,set:d,get:x,performance:p,viewport:v}=re(),y=e||u,g=n||A.connected||f.domElement,m=h.useMemo(()=>new Rd(y),[y]);return ze(()=>{m.enabled&&m.update()},-1),h.useEffect(()=>(m.connect(g),()=>void m.dispose()),[g,r,m,l]),h.useEffect(()=>{const _=E=>{l(),r&&p.regress(),t&&t(E)};return m.addEventListener("change",_),i&&m.addEventListener("start",i),o&&m.addEventListener("end",o),()=>{i&&m.removeEventListener("start",i),o&&m.removeEventListener("end",o),m.removeEventListener("change",_)}},[t,i,o,m,l]),h.useEffect(()=>{m.handleResize()},[v]),h.useEffect(()=>{if(s){const _=x().controls;return d({controls:m}),()=>d({controls:_})}},[s,m]),h.createElement("primitive",me({ref:c,object:m},a))}),Qy=h.forwardRef(({camera:s,makeDefault:e,regress:n,domElement:r,onChange:t,onStart:i,onEnd:o,...a},c)=>{const l=re(m=>m.invalidate),u=re(m=>m.camera),f=re(m=>m.gl),A=re(m=>m.events),d=re(m=>m.set),x=re(m=>m.get),p=re(m=>m.performance),v=s||u,y=r||A.connected||f.domElement,g=h.useMemo(()=>new zd(v),[v]);return ze(()=>{g.enabled&&g.update()},-1),h.useEffect(()=>(g.connect(y),()=>void g.dispose()),[y,n,g,l]),h.useEffect(()=>{const m=_=>{l(),n&&p.regress(),t&&t(_)};return g.addEventListener("change",m),i&&g.addEventListener("start",i),o&&g.addEventListener("end",o),()=>{g.removeEventListener("change",m),i&&g.removeEventListener("start",i),o&&g.removeEventListener("end",o)}},[t,i,o]),h.useEffect(()=>{if(e){const m=x().controls;return d({controls:g}),()=>d({controls:m})}},[e,g]),h.createElement("primitive",me({ref:c,object:g},a))}),zy=h.forwardRef(({children:s,domElement:e,onChange:n,onMouseDown:r,onMouseUp:t,onObjectChange:i,object:o,makeDefault:a,camera:c,enabled:l,axis:u,mode:f,translationSnap:A,rotationSnap:d,scaleSnap:x,space:p,size:v,showX:y,showY:g,showZ:m,..._},E)=>{const C=re(T=>T.controls),w=re(T=>T.gl),I=re(T=>T.events),B=re(T=>T.camera),S=re(T=>T.invalidate),U=re(T=>T.get),b=re(T=>T.set),M=c||B,D=e||I.connected||w.domElement,N=h.useMemo(()=>new yd(M,D),[M,D]),G=h.useRef(null);h.useLayoutEffect(()=>(o?N.attach(o instanceof di?o:o.current):G.current instanceof di&&N.attach(G.current),()=>void N.detach()),[o,s,N]),h.useEffect(()=>{if(C){const T=W=>C.enabled=!W.value;return N.addEventListener("dragging-changed",T),()=>N.removeEventListener("dragging-changed",T)}},[N,C]);const q=h.useRef(void 0),X=h.useRef(void 0),O=h.useRef(void 0),H=h.useRef(void 0);return h.useLayoutEffect(()=>void(q.current=n),[n]),h.useLayoutEffect(()=>void(X.current=r),[r]),h.useLayoutEffect(()=>void(O.current=t),[t]),h.useLayoutEffect(()=>void(H.current=i),[i]),h.useEffect(()=>{const T=z=>{S(),q.current==null||q.current(z)},W=z=>X.current==null?void 0:X.current(z),j=z=>O.current==null?void 0:O.current(z),L=z=>H.current==null?void 0:H.current(z);return N.addEventListener("change",T),N.addEventListener("mouseDown",W),N.addEventListener("mouseUp",j),N.addEventListener("objectChange",L),()=>{N.removeEventListener("change",T),N.removeEventListener("mouseDown",W),N.removeEventListener("mouseUp",j),N.removeEventListener("objectChange",L)}},[S,N]),h.useEffect(()=>{if(a){const T=U().controls;return b({controls:N}),()=>b({controls:T})}},[a,N]),h.createElement(h.Fragment,null,h.createElement("primitive",{ref:E,object:N,enabled:l,axis:u,mode:f,translationSnap:A,rotationSnap:d,scaleSnap:x,space:p,size:v,showX:y,showY:g,showZ:m}),h.createElement("group",me({ref:G},_),s))}),Fy=h.forwardRef(({domElement:s,selector:e,onChange:n,onLock:r,onUnlock:t,enabled:i=!0,makeDefault:o,...a},c)=>{const{camera:l,...u}=a,f=re(E=>E.setEvents),A=re(E=>E.gl),d=re(E=>E.camera),x=re(E=>E.invalidate),p=re(E=>E.events),v=re(E=>E.get),y=re(E=>E.set),g=l||d,m=s||p.connected||A.domElement,_=h.useMemo(()=>new bd(g),[g]);return h.useEffect(()=>{if(i){_.connect(m);const E=v().events.compute;return f({compute(C,w){const I=w.size.width/2,B=w.size.height/2;w.pointer.set(I/w.size.width*2-1,-(B/w.size.height)*2+1),w.raycaster.setFromCamera(w.pointer,w.camera)}}),()=>{_.disconnect(),f({compute:E})}}},[i,_]),h.useEffect(()=>{const E=I=>{x(),n&&n(I)};_.addEventListener("change",E),r&&_.addEventListener("lock",r),t&&_.addEventListener("unlock",t);const C=()=>_.lock(),w=e?Array.from(document.querySelectorAll(e)):[document];return w.forEach(I=>I&&I.addEventListener("click",C)),()=>{_.removeEventListener("change",E),r&&_.removeEventListener("lock",r),t&&_.removeEventListener("unlock",t),w.forEach(I=>I?I.removeEventListener("click",C):void 0)}},[n,r,t,e,_,x]),h.useEffect(()=>{if(o){const E=v().controls;return y({controls:_}),()=>y({controls:E})}},[o,_]),h.createElement("primitive",me({ref:c,object:_},u))}),Uy=h.forwardRef(({domElement:s,makeDefault:e,...n},r)=>{const t=re(f=>f.camera),i=re(f=>f.gl),o=re(f=>f.events),a=re(f=>f.get),c=re(f=>f.set),l=s||o.connected||i.domElement,[u]=h.useState(()=>new md(t,l));return h.useEffect(()=>{if(e){const f=a().controls;return c({controls:u}),()=>c({controls:f})}},[e,u]),ze((f,A)=>{u.update(A)},-1),u?h.createElement("primitive",me({ref:r,object:u},n)):null});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Qt={LEFT:1,RIGHT:2,MIDDLE:4},ce=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Er={NONE:0,IN:1,OUT:-1};function tr(s){return s.isPerspectiveCamera}function kn(s){return s.isOrthographicCamera}const xr=Math.PI*2,r0=Math.PI/2,J1=1e-5,Es=Math.PI/180;function sn(s,e,n){return Math.max(e,Math.min(n,s))}function bt(s,e=J1){return Math.abs(s)<e}function yt(s,e,n=J1){return bt(s-e,n)}function s0(s,e){return Math.round(s/e)*e}function xs(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function _s(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function _o(s,e,n,r,t=1/0,i){r=Math.max(1e-4,r);const o=2/r,a=o*i,c=1/(1+a+.48*a*a+.235*a*a*a);let l=s-e;const u=e,f=t*r;l=sn(l,-f,f),e=s-l;const A=(n.value+o*l)*i;n.value=(n.value-o*A)*c;let d=e+(l+A)*c;return u-s>0==d>u&&(d=u,n.value=(d-u)/i),d}function o0(s,e,n,r,t=1/0,i,o){r=Math.max(1e-4,r);const a=2/r,c=a*i,l=1/(1+c+.48*c*c+.235*c*c*c);let u=e.x,f=e.y,A=e.z,d=s.x-u,x=s.y-f,p=s.z-A;const v=u,y=f,g=A,m=t*r,_=m*m,E=d*d+x*x+p*p;if(E>_){const N=Math.sqrt(E);d=d/N*m,x=x/N*m,p=p/N*m}u=s.x-d,f=s.y-x,A=s.z-p;const C=(n.x+a*d)*i,w=(n.y+a*x)*i,I=(n.z+a*p)*i;n.x=(n.x-a*C)*l,n.y=(n.y-a*w)*l,n.z=(n.z-a*I)*l,o.x=u+(d+C)*l,o.y=f+(x+w)*l,o.z=A+(p+I)*l;const B=v-s.x,S=y-s.y,U=g-s.z,b=o.x-v,M=o.y-y,D=o.z-g;return B*b+S*M+U*D>0&&(o.x=v,o.y=y,o.z=g,n.x=(o.x-v)/i,n.y=(o.y-y)/i,n.z=(o.z-g)/i),o}function fc(s,e){e.set(0,0),s.forEach(n=>{e.x+=n.clientX,e.y+=n.clientY}),e.x/=s.length,e.y/=s.length}function Ac(s,e){return kn(s)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class _p{constructor(){this._listeners={}}addEventListener(e,n){const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const t=this._listeners[e];if(t!==void 0){const i=t.indexOf(n);i!==-1&&t.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const r=this._listeners[e.type];if(r!==void 0){e.target=this;const t=r.slice(0);for(let i=0,o=t.length;i<o;i++)t[i].call(this,e)}}}var dc;const Cp="2.10.0",Co=1/8,wp=/Mac/.test((dc=globalThis==null?void 0:globalThis.navigator)===null||dc===void 0?void 0:dc.platform);let Ye,a0,wo,mc,bi,nt,ht,_r,Cs,An,dn,ir,c0,l0,Vi,ws,Cr,u0,pc,h0,gc,yc,Io,vc=class fl extends _p{static install(e){Ye=e.THREE,a0=Object.freeze(new Ye.Vector3(0,0,0)),wo=Object.freeze(new Ye.Vector3(0,1,0)),mc=Object.freeze(new Ye.Vector3(0,0,1)),bi=new Ye.Vector2,nt=new Ye.Vector3,ht=new Ye.Vector3,_r=new Ye.Vector3,Cs=new Ye.Vector3,An=new Ye.Vector3,dn=new Ye.Vector3,ir=new Ye.Vector3,c0=new Ye.Vector3,l0=new Ye.Vector3,Vi=new Ye.Spherical,ws=new Ye.Spherical,Cr=new Ye.Box3,u0=new Ye.Box3,pc=new Ye.Sphere,h0=new Ye.Quaternion,gc=new Ye.Quaternion,yc=new Ye.Matrix4,Io=new Ye.Raycaster}static get ACTION(){return ce}constructor(e,n){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ce.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Er.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Ye.Vector3,this._focalOffsetVelocity=new Ye.Vector3,this._zoomVelocity={value:0},this._truckInternal=(y,g,m,_)=>{let E,C;if(tr(this._camera)){const w=nt.copy(this._camera.position).sub(this._target),I=this._camera.getEffectiveFOV()*Es,B=w.length()*Math.tan(I*.5);E=this.truckSpeed*y*B/this._elementRect.height,C=this.truckSpeed*g*B/this._elementRect.height}else if(kn(this._camera)){const w=this._camera;E=this.truckSpeed*y*(w.right-w.left)/w.zoom/this._elementRect.width,C=this.truckSpeed*g*(w.top-w.bottom)/w.zoom/this._elementRect.height}else return;_?(m?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(E,0,!0),this.forward(-C,!0)):m?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y+C,this._focalOffsetEnd.z,!0):this.truck(E,C,!0)},this._rotateInternal=(y,g)=>{const m=xr*this.azimuthRotateSpeed*y/this._elementRect.height,_=xr*this.polarRotateSpeed*g/this._elementRect.height;this.rotate(m,_,!0)},this._dollyInternal=(y,g,m)=>{const _=Math.pow(.95,-y*this.dollySpeed),E=this._sphericalEnd.radius,C=this._sphericalEnd.radius*_,w=sn(C,this.minDistance,this.maxDistance),I=w-C;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(C,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(I,!0),this._dollyToNoClamp(w,!0)):this._dollyToNoClamp(w,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?C:w)-E,this._dollyControlCoord.set(g,m)),this._lastDollyDirection=Math.sign(-y)},this._zoomInternal=(y,g,m)=>{const _=Math.pow(.95,y*this.dollySpeed),E=this._zoom,C=this._zoom*_;this.zoomTo(C,!0),this.dollyToCursor&&(this._changedZoom+=C-E,this._dollyControlCoord.set(g,m))},typeof Ye>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Ye.Quaternion().setFromUnitVectors(this._camera.up,wo),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ce.NONE,this._target=new Ye.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Ye.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Ye.Spherical().setFromVector3(nt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Ye.Vector3,new Ye.Vector3,new Ye.Vector3,new Ye.Vector3],this._updateNearPlaneCorners(),this._boundary=new Ye.Box3(new Ye.Vector3(-1/0,-1/0,-1/0),new Ye.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Ye.Vector2,this.mouseButtons={left:ce.ROTATE,middle:ce.DOLLY,right:ce.TRUCK,wheel:tr(this._camera)?ce.DOLLY:kn(this._camera)?ce.ZOOM:ce.NONE},this.touches={one:ce.TOUCH_ROTATE,two:tr(this._camera)?ce.TOUCH_DOLLY_TRUCK:kn(this._camera)?ce.TOUCH_ZOOM_TRUCK:ce.NONE,three:ce.TOUCH_TRUCK};const r=new Ye.Vector2,t=new Ye.Vector2,i=new Ye.Vector2,o=y=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),E=y.clientX/_.width,C=y.clientY/_.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const g=y.pointerType!=="mouse"?null:(y.buttons&Qt.LEFT)===Qt.LEFT?Qt.LEFT:(y.buttons&Qt.MIDDLE)===Qt.MIDDLE?Qt.MIDDLE:(y.buttons&Qt.RIGHT)===Qt.RIGHT?Qt.RIGHT:null;if(g!==null){const _=this._findPointerByMouseButton(g);_&&this._disposePointer(_)}if((y.buttons&Qt.LEFT)===Qt.LEFT&&this._lockedPointer)return;const m={pointerId:y.pointerId,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:g};this._activePointers.push(m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,A(y)},a=y=>{y.cancelable&&y.preventDefault();const g=y.pointerId,m=this._lockedPointer||this._findPointerById(g);if(m){if(m.clientX=y.clientX,m.clientY=y.clientY,m.deltaX=y.movementX,m.deltaY=y.movementY,this._state=0,y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(y.buttons&Qt.LEFT)===Qt.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(y.buttons&Qt.MIDDLE)===Qt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(y.buttons&Qt.RIGHT)===Qt.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},c=y=>{const g=this._findPointerById(y.pointerId);if(!(g&&g===this._lockedPointer)){if(g&&this._disposePointer(g),y.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ce.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ce.NONE;x()}};let l=-1;const u=y=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ce.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),w=y.clientX/C.width,I=y.clientY/C.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}if(y.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ce.ROTATE||this.mouseButtons.wheel===ce.TRUCK){const C=performance.now();l-C<1e3&&this._getClientRect(this._elementRect),l=C}const g=wp?-1:-3,m=y.deltaMode===1?y.deltaY/g:y.deltaY/(g*10),_=this.dollyToCursor?(y.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(y.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ce.ROTATE:{this._rotateInternal(y.deltaX,y.deltaY),this._isUserControllingRotate=!0;break}case ce.TRUCK:{this._truckInternal(y.deltaX,y.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case ce.SCREEN_PAN:{this._truckInternal(y.deltaX,y.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case ce.OFFSET:{this._truckInternal(y.deltaX,y.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case ce.DOLLY:{this._dollyInternal(-m,_,E),this._isUserControllingDolly=!0;break}case ce.ZOOM:{this._zoomInternal(-m,_,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},f=y=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===fl.ACTION.NONE){const g=y instanceof PointerEvent?y.pointerId:0,m=this._findPointerById(g);m&&this._disposePointer(m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}y.preventDefault()}},A=y=>{if(!this._enabled)return;if(fc(this._activePointers,bi),this._getClientRect(this._elementRect),r.copy(bi),t.copy(bi),this._activePointers.length>=2){const m=bi.x-this._activePointers[1].clientX,_=bi.y-this._activePointers[1].clientY,E=Math.sqrt(m*m+_*_);i.set(0,E);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,w=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;t.set(C,w)}if(this._state=0,!y)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in y&&y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(y.buttons&Qt.LEFT)===Qt.LEFT&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Qt.MIDDLE)===Qt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Qt.RIGHT)===Qt.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ce.ROTATE)===ce.ROTATE||(this._state&ce.TOUCH_ROTATE)===ce.TOUCH_ROTATE||(this._state&ce.TOUCH_DOLLY_ROTATE)===ce.TOUCH_DOLLY_ROTATE||(this._state&ce.TOUCH_ZOOM_ROTATE)===ce.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ce.TRUCK)===ce.TRUCK||(this._state&ce.SCREEN_PAN)===ce.SCREEN_PAN||(this._state&ce.TOUCH_TRUCK)===ce.TOUCH_TRUCK||(this._state&ce.TOUCH_SCREEN_PAN)===ce.TOUCH_SCREEN_PAN||(this._state&ce.TOUCH_DOLLY_TRUCK)===ce.TOUCH_DOLLY_TRUCK||(this._state&ce.TOUCH_DOLLY_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN||(this._state&ce.TOUCH_ZOOM_TRUCK)===ce.TOUCH_ZOOM_TRUCK||(this._state&ce.TOUCH_ZOOM_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ce.DOLLY)===ce.DOLLY||(this._state&ce.TOUCH_DOLLY)===ce.TOUCH_DOLLY||(this._state&ce.TOUCH_DOLLY_TRUCK)===ce.TOUCH_DOLLY_TRUCK||(this._state&ce.TOUCH_DOLLY_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN||(this._state&ce.TOUCH_DOLLY_OFFSET)===ce.TOUCH_DOLLY_OFFSET||(this._state&ce.TOUCH_DOLLY_ROTATE)===ce.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ce.ZOOM)===ce.ZOOM||(this._state&ce.TOUCH_ZOOM)===ce.TOUCH_ZOOM||(this._state&ce.TOUCH_ZOOM_TRUCK)===ce.TOUCH_ZOOM_TRUCK||(this._state&ce.TOUCH_ZOOM_SCREEN_PAN)===ce.TOUCH_ZOOM_SCREEN_PAN||(this._state&ce.TOUCH_ZOOM_OFFSET)===ce.TOUCH_ZOOM_OFFSET||(this._state&ce.TOUCH_ZOOM_ROTATE)===ce.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ce.OFFSET)===ce.OFFSET||(this._state&ce.TOUCH_OFFSET)===ce.TOUCH_OFFSET||(this._state&ce.TOUCH_DOLLY_OFFSET)===ce.TOUCH_DOLLY_OFFSET||(this._state&ce.TOUCH_ZOOM_OFFSET)===ce.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,fc(this._activePointers,bi);const g=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,m=g?-g.deltaX:t.x-bi.x,_=g?-g.deltaY:t.y-bi.y;if(t.copy(bi),((this._state&ce.ROTATE)===ce.ROTATE||(this._state&ce.TOUCH_ROTATE)===ce.TOUCH_ROTATE||(this._state&ce.TOUCH_DOLLY_ROTATE)===ce.TOUCH_DOLLY_ROTATE||(this._state&ce.TOUCH_ZOOM_ROTATE)===ce.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(m,_),this._isUserControllingRotate=!0),(this._state&ce.DOLLY)===ce.DOLLY||(this._state&ce.ZOOM)===ce.ZOOM){const E=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0,w=this.dollyDragInverted?-1:1;(this._state&ce.DOLLY)===ce.DOLLY?(this._dollyInternal(w*_*Co,E,C),this._isUserControllingDolly=!0):(this._zoomInternal(w*_*Co,E,C),this._isUserControllingZoom=!0)}if((this._state&ce.TOUCH_DOLLY)===ce.TOUCH_DOLLY||(this._state&ce.TOUCH_ZOOM)===ce.TOUCH_ZOOM||(this._state&ce.TOUCH_DOLLY_TRUCK)===ce.TOUCH_DOLLY_TRUCK||(this._state&ce.TOUCH_ZOOM_TRUCK)===ce.TOUCH_ZOOM_TRUCK||(this._state&ce.TOUCH_DOLLY_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN||(this._state&ce.TOUCH_ZOOM_SCREEN_PAN)===ce.TOUCH_ZOOM_SCREEN_PAN||(this._state&ce.TOUCH_DOLLY_OFFSET)===ce.TOUCH_DOLLY_OFFSET||(this._state&ce.TOUCH_ZOOM_OFFSET)===ce.TOUCH_ZOOM_OFFSET||(this._state&ce.TOUCH_DOLLY_ROTATE)===ce.TOUCH_DOLLY_ROTATE||(this._state&ce.TOUCH_ZOOM_ROTATE)===ce.TOUCH_ZOOM_ROTATE){const E=bi.x-this._activePointers[1].clientX,C=bi.y-this._activePointers[1].clientY,w=Math.sqrt(E*E+C*C),I=i.y-w;i.set(0,w);const B=this.dollyToCursor?(t.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(t.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ce.TOUCH_DOLLY)===ce.TOUCH_DOLLY||(this._state&ce.TOUCH_DOLLY_ROTATE)===ce.TOUCH_DOLLY_ROTATE||(this._state&ce.TOUCH_DOLLY_TRUCK)===ce.TOUCH_DOLLY_TRUCK||(this._state&ce.TOUCH_DOLLY_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN||(this._state&ce.TOUCH_DOLLY_OFFSET)===ce.TOUCH_DOLLY_OFFSET?(this._dollyInternal(I*Co,B,S),this._isUserControllingDolly=!0):(this._zoomInternal(I*Co,B,S),this._isUserControllingZoom=!0)}((this._state&ce.TRUCK)===ce.TRUCK||(this._state&ce.TOUCH_TRUCK)===ce.TOUCH_TRUCK||(this._state&ce.TOUCH_DOLLY_TRUCK)===ce.TOUCH_DOLLY_TRUCK||(this._state&ce.TOUCH_ZOOM_TRUCK)===ce.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(m,_,!1,!1),this._isUserControllingTruck=!0),((this._state&ce.SCREEN_PAN)===ce.SCREEN_PAN||(this._state&ce.TOUCH_SCREEN_PAN)===ce.TOUCH_SCREEN_PAN||(this._state&ce.TOUCH_DOLLY_SCREEN_PAN)===ce.TOUCH_DOLLY_SCREEN_PAN||(this._state&ce.TOUCH_ZOOM_SCREEN_PAN)===ce.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(m,_,!1,!0),this._isUserControllingTruck=!0),((this._state&ce.OFFSET)===ce.OFFSET||(this._state&ce.TOUCH_OFFSET)===ce.TOUCH_OFFSET||(this._state&ce.TOUCH_DOLLY_OFFSET)===ce.TOUCH_DOLLY_OFFSET||(this._state&ce.TOUCH_ZOOM_OFFSET)===ce.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(m,_,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},x=()=>{fc(this._activePointers,bi),t.copy(bi),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",p),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),A())},this.unlockPointer=()=>{var y,g,m;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(y=this._domElement)===null||y===void 0||y.ownerDocument.exitPointerLock(),(g=this._domElement)===null||g===void 0||g.ownerDocument.removeEventListener("pointerlockchange",p),(m=this._domElement)===null||m===void 0||m.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};const p=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=y=>{this._domElement=y,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",p),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==ce.NONE&&(this._state=ce.NONE,this._activePointers.length=0,x())},n&&this.connect(n),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=sn(e.width,0,1),this._interactiveArea.height=sn(e.height,0,1),this._interactiveArea.x=sn(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=sn(e.y,0,1-this._interactiveArea.height)}addEventListener(e,n){super.addEventListener(e,n)}removeEventListener(e,n){super.removeEventListener(e,n)}rotate(e,n,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+n,r)}rotateAzimuthTo(e,n=!1){return this.rotateTo(e,this._sphericalEnd.phi,n)}rotatePolarTo(e,n=!1){return this.rotateTo(this._sphericalEnd.theta,e,n)}rotateTo(e,n,r=!1){this._isUserControllingRotate=!1;const t=sn(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=sn(n,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=t,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!r||yt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&yt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,n=!1){return this.dollyTo(this._sphericalEnd.radius-e,n)}dollyTo(e,n=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Er.NONE,this._changedDolly=0,this._dollyToNoClamp(sn(e,this.minDistance,this.maxDistance),n)}_dollyToNoClamp(e,n=!1){const r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=yt(o,this._spherical.radius);if(!(r>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,n||(this._spherical.radius=this._sphericalEnd.radius);const i=!n||yt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,n=!1){this._targetEnd.add(this._getCameraDirection(Cs).multiplyScalar(e)),n||this._target.copy(this._targetEnd);const r=!n||yt(this._target.x,this._targetEnd.x,this.restThreshold)&&yt(this._target.y,this._targetEnd.y,this.restThreshold)&&yt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,n=!1){return this.zoomTo(this._zoomEnd+e,n)}zoomTo(e,n=!1){this._isUserControllingZoom=!1,this._zoomEnd=sn(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,n||(this._zoom=this._zoomEnd);const r=!n||yt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,n,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,n,r)}truck(e,n,r=!1){this._camera.updateMatrix(),An.setFromMatrixColumn(this._camera.matrix,0),dn.setFromMatrixColumn(this._camera.matrix,1),An.multiplyScalar(e),dn.multiplyScalar(-n);const t=nt.copy(An).add(dn),i=ht.copy(this._targetEnd).add(t);return this.moveTo(i.x,i.y,i.z,r)}forward(e,n=!1){nt.setFromMatrixColumn(this._camera.matrix,0),nt.crossVectors(this._camera.up,nt),nt.multiplyScalar(e);const r=ht.copy(this._targetEnd).add(nt);return this.moveTo(r.x,r.y,r.z,n)}elevate(e,n=!1){return nt.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+nt.x,this._targetEnd.y+nt.y,this._targetEnd.z+nt.z,n)}moveTo(e,n,r,t=!1){this._isUserControllingTruck=!1;const i=nt.set(e,n,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,t||this._target.copy(this._targetEnd);const o=!t||yt(this._target.x,this._targetEnd.x,this.restThreshold)&&yt(this._target.y,this._targetEnd.y,this.restThreshold)&&yt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,n,r,t=!1){const a=nt.set(e,n,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,t)}fitToBox(e,n,{cover:r=!1,paddingLeft:t=0,paddingRight:i=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],l=e.isBox3?Cr.copy(e):Cr.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=s0(this._sphericalEnd.theta,r0),f=s0(this._sphericalEnd.phi,r0);c.push(this.rotateTo(u,f,n));const A=nt.setFromSpherical(this._sphericalEnd).normalize(),d=h0.setFromUnitVectors(A,mc),x=yt(Math.abs(A.y),1);x&&d.multiply(gc.setFromAxisAngle(wo,u)),d.multiply(this._yAxisUpSpaceInverse);const p=u0.makeEmpty();ht.copy(l.min).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.min).setX(l.max.x).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.min).setY(l.max.y).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.max).setZ(l.min.z).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.min).setZ(l.max.z).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.max).setY(l.min.y).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.max).setX(l.min.x).applyQuaternion(d),p.expandByPoint(ht),ht.copy(l.max).applyQuaternion(d),p.expandByPoint(ht),p.min.x-=t,p.min.y-=o,p.max.x+=i,p.max.y+=a,d.setFromUnitVectors(mc,A),x&&d.premultiply(gc.invert()),d.premultiply(this._yAxisUpSpace);const v=p.getSize(nt),y=p.getCenter(ht).applyQuaternion(d);if(tr(this._camera)){const g=this.getDistanceToFitBox(v.x,v.y,v.z,r);c.push(this.moveTo(y.x,y.y,y.z,n)),c.push(this.dollyTo(g,n)),c.push(this.setFocalOffset(0,0,0,n))}else if(kn(this._camera)){const g=this._camera,m=g.right-g.left,_=g.top-g.bottom,E=r?Math.max(m/v.x,_/v.y):Math.min(m/v.x,_/v.y);c.push(this.moveTo(y.x,y.y,y.z,n)),c.push(this.zoomTo(E,n)),c.push(this.setFocalOffset(0,0,0,n))}return Promise.all(c)}fitToSphere(e,n){const r=[],i="isObject3D"in e?fl.createBoundingSphere(e,pc):pc.copy(e);if(r.push(this.moveTo(i.center.x,i.center.y,i.center.z,n)),tr(this._camera)){const o=this.getDistanceToFitSphere(i.radius);r.push(this.dollyTo(o,n))}else if(kn(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*i.radius,l=Math.min(o/c,a/c);r.push(this.zoomTo(l,n))}return r.push(this.setFocalOffset(0,0,0,n)),Promise.all(r)}setLookAt(e,n,r,t,i,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Er.NONE,this._changedDolly=0;const c=ht.set(t,i,o),l=nt.set(e,n,r);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(l.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||yt(this._target.x,this._targetEnd.x,this.restThreshold)&&yt(this._target.y,this._targetEnd.y,this.restThreshold)&&yt(this._target.z,this._targetEnd.z,this.restThreshold)&&yt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&yt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&yt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,n,r,t,i,o,a,c,l,u,f,A,d,x=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Er.NONE,this._changedDolly=0;const p=nt.set(t,i,o),v=ht.set(e,n,r);Vi.setFromVector3(v.sub(p).applyQuaternion(this._yAxisUpSpace));const y=_r.set(u,f,A),g=ht.set(a,c,l);ws.setFromVector3(g.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(y,d));const m=ws.theta-Vi.theta,_=ws.phi-Vi.phi,E=ws.radius-Vi.radius;this._sphericalEnd.set(Vi.radius+E*d,Vi.phi+_*d,Vi.theta+m*d),this.normalizeRotations(),this._needsUpdate=!0,x||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const C=!x||yt(this._target.x,this._targetEnd.x,this.restThreshold)&&yt(this._target.y,this._targetEnd.y,this.restThreshold)&&yt(this._target.z,this._targetEnd.z,this.restThreshold)&&yt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&yt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&yt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(C)}setPosition(e,n,r,t=!1){return this.setLookAt(e,n,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,t)}setTarget(e,n,r,t=!1){const i=this.getPosition(nt),o=this.setLookAt(i.x,i.y,i.z,e,n,r,t);return this._sphericalEnd.phi=sn(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,n,r,t=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,n,r),this._needsUpdate=!0,t||this._focalOffset.copy(this._focalOffsetEnd);const i=!t||yt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&yt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&yt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,n,r){this._camera.updateMatrixWorld(),An.setFromMatrixColumn(this._camera.matrixWorldInverse,0),dn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ir.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const t=nt.set(e,n,r),i=t.distanceTo(this._camera.position),o=t.sub(this._camera.position);An.multiplyScalar(o.x),dn.multiplyScalar(o.y),ir.multiplyScalar(o.z),nt.copy(An).add(dn).add(ir),nt.z=nt.z+i,this.dollyTo(i,!1),this.setFocalOffset(-nt.x,nt.y,-nt.z,!1),this.moveTo(e,n,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,n,r,t){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Ye.Vector4,typeof e=="number"?this._viewport.set(e,n,r,t):this._viewport.copy(e)}getDistanceToFitBox(e,n,r,t=!1){if(Ac(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const i=e/n,o=this._camera.getEffectiveFOV()*Es,a=this._camera.aspect;return((t?i>a:i<a)?n:e/a)*.5/Math.tan(o*.5)+r*.5}getDistanceToFitSphere(e){if(Ac(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const n=this._camera.getEffectiveFOV()*Es,r=Math.atan(Math.tan(n*.5)*this._camera.aspect)*2,t=1<this._camera.aspect?n:r;return e/Math.sin(t*.5)}getTarget(e,n=!0){return(e&&e.isVector3?e:new Ye.Vector3).copy(n?this._targetEnd:this._target)}getPosition(e,n=!0){return(e&&e.isVector3?e:new Ye.Vector3).setFromSpherical(n?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(n?this._targetEnd:this._target)}getSpherical(e,n=!0){return(e||new Ye.Spherical).copy(n?this._sphericalEnd:this._spherical)}getFocalOffset(e,n=!0){return(e&&e.isVector3?e:new Ye.Vector3).copy(n?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%xr,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=xr),this._spherical.theta+=xr*Math.round((this._sphericalEnd.theta-this._spherical.theta)/xr)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!yt(this._camera.up.x,this._cameraUp0.x)||!yt(this._camera.up.y,this._cameraUp0.y)||!yt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const r=this.getPosition(nt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}const n=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(n)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,wo),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=nt.subVectors(this._target,this._camera.position).normalize(),n=ht.crossVectors(e,this._camera.up);this._camera.up.crossVectors(n,e).normalize(),this._camera.updateMatrixWorld();const r=this.getPosition(nt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){const n=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,t=this._sphericalEnd.radius-this._spherical.radius,i=c0.subVectors(this._targetEnd,this._target),o=l0.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(bt(n))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=_o(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,f,1/0,e),this._needsUpdate=!0}if(bt(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const f=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=_o(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,f,1/0,e),this._needsUpdate=!0}if(bt(t))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const f=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=_o(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,f,this.maxSpeed,e),this._needsUpdate=!0}if(bt(i.x)&&bt(i.y)&&bt(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const f=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;o0(this._target,this._targetEnd,this._targetVelocity,f,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(bt(o.x)&&bt(o.y)&&bt(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const f=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;o0(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,f,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(bt(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const f=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=_o(this._zoom,this._zoomEnd,this._zoomVelocity,f,1/0,e)}if(this.dollyToCursor){if(tr(this._camera)&&this._changedDolly!==0){const f=this._spherical.radius-this._lastDistance,A=this._camera,d=this._getCameraDirection(Cs),x=nt.copy(d).cross(A.up).normalize();x.lengthSq()===0&&(x.x=1);const p=ht.crossVectors(x,d),v=this._sphericalEnd.radius*Math.tan(A.getEffectiveFOV()*Es*.5),g=(this._sphericalEnd.radius-f-this._sphericalEnd.radius)/this._sphericalEnd.radius,m=_r.copy(this._targetEnd).add(x.multiplyScalar(this._dollyControlCoord.x*v*A.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*v)),_=nt.copy(this._targetEnd).lerp(m,g),E=this._lastDollyDirection===Er.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===Er.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||C)){this._sphericalEnd.radius-=f,this._spherical.radius-=f;const I=ht.copy(d).multiplyScalar(-f);_.add(I)}this._boundary.clampPoint(_,_);const w=ht.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(w),this._changedDolly-=f,bt(this._changedDolly)&&(this._changedDolly=0)}else if(kn(this._camera)&&this._changedZoom!==0){const f=this._zoom-this._lastZoom,A=this._camera,d=nt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(A.near+A.far)/(A.near-A.far)).unproject(A),x=ht.set(0,0,-1).applyQuaternion(A.quaternion),p=_r.copy(d).add(x.multiplyScalar(-d.dot(A.up))),y=-(this._zoom-f-this._zoom)/this._zoom,g=this._getCameraDirection(Cs),m=this._targetEnd.dot(g),_=nt.copy(this._targetEnd).lerp(p,y),E=_.dot(g),C=g.multiplyScalar(E-m);_.sub(C),this._boundary.clampPoint(_,_);const w=ht.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(w),this._changedZoom-=f,bt(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!bt(this._focalOffset.x)||!bt(this._focalOffset.y)||!bt(this._focalOffset.z))&&(An.setFromMatrixColumn(this._camera.matrix,0),dn.setFromMatrixColumn(this._camera.matrix,1),ir.setFromMatrixColumn(this._camera.matrix,2),An.multiplyScalar(this._focalOffset.x),dn.multiplyScalar(-this._focalOffset.y),ir.multiplyScalar(this._focalOffset.z),nt.copy(An).add(dn).add(ir),this._camera.position.add(nt),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),nt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),bt(n,this.restThreshold)&&bt(r,this.restThreshold)&&bt(t,this.restThreshold)&&bt(i.x,this.restThreshold)&&bt(i.y,this.restThreshold)&&bt(i.z,this.restThreshold)&&bt(o.x,this.restThreshold)&&bt(o.y,this.restThreshold)&&bt(o.z,this.restThreshold)&&bt(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:xs(this.maxDistance),minZoom:this.minZoom,maxZoom:xs(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:xs(this.maxPolarAngle),minAzimuthAngle:xs(this.minAzimuthAngle),maxAzimuthAngle:xs(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:nt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,n=!1){const r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=_s(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=_s(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=_s(r.maxPolarAngle),this.minAzimuthAngle=_s(r.minAzimuthAngle),this.maxAzimuthAngle=_s(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],n),Vi.setFromVector3(nt.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Vi.theta,Vi.phi,n),this.dollyTo(Vi.radius,n),this.zoomTo(r.zoom,n),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],n),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Cp),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(n=>n.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(n=>n.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,n,r){const t=n.lengthSq();if(t===0)return e;const i=ht.copy(n).add(e),a=this._boundary.clampPoint(i,_r).sub(i),c=a.lengthSq();if(c===0)return e.add(n);if(c===t)return e;if(r===0)return e.add(n).add(a);{const l=1+r*c/n.dot(a);return e.add(ht.copy(n).multiplyScalar(l)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(tr(this._camera)){const e=this._camera,n=e.near,r=e.getEffectiveFOV()*Es,t=Math.tan(r*.5)*n,i=t*e.aspect;this._nearPlaneCorners[0].set(-i,-t,0),this._nearPlaneCorners[1].set(i,-t,0),this._nearPlaneCorners[2].set(i,t,0),this._nearPlaneCorners[3].set(-i,t,0)}else if(kn(this._camera)){const e=this._camera,n=1/e.zoom,r=e.left*n,t=e.right*n,i=e.top*n,o=e.bottom*n;this._nearPlaneCorners[0].set(r,i,0),this._nearPlaneCorners[1].set(t,i,0),this._nearPlaneCorners[2].set(t,o,0),this._nearPlaneCorners[3].set(r,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Ac(this._camera,"_collisionTest"))return e;const r=this._getTargetDirection(Cs);yc.lookAt(a0,r,this._camera.up);for(let t=0;t<4;t++){const i=ht.copy(this._nearPlaneCorners[t]);i.applyMatrix4(yc);const o=_r.addVectors(this._target,i);Io.set(o,r),Io.far=this._spherical.radius+1;const a=Io.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const n=this._domElement.getBoundingClientRect();return e.x=n.left,e.y=n.top,this._viewport?(e.x+=this._viewport.x,e.y+=n.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=n.width,e.height=n.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(n=>{const r=()=>{this.removeEventListener("rest",r),n()};this.addEventListener("rest",r)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,n=new Ye.Sphere){const r=n,t=r.center;Cr.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Cr.expandByObject(o)}),Cr.getCenter(t);let i=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const u=c.attributes.position;for(let f=0,A=u.count;f<A;f++)nt.fromBufferAttribute(u,f),i=Math.max(i,t.distanceToSquared(nt))}),r.radius=Math.sqrt(i),r}};const ky=h.forwardRef((s,e)=>{h.useMemo(()=>{const E={Box3:Rt,MathUtils:{clamp:je.clamp},Matrix4:Me,Quaternion:st,Raycaster:fa,Sphere:Oi,Spherical:_l,Vector2:Te,Vector3:k,Vector4:Li};vc.install({THREE:E}),Gt({CameraControlsImpl:vc})},[]);const{camera:n,domElement:r,makeDefault:t,onStart:i,onEnd:o,onChange:a,regress:c,...l}=s,u=re(E=>E.camera),f=re(E=>E.gl),A=re(E=>E.invalidate),d=re(E=>E.events),x=re(E=>E.setEvents),p=re(E=>E.set),v=re(E=>E.get),y=re(E=>E.performance),g=n||u,m=r||d.connected||f.domElement,_=h.useMemo(()=>new vc(g),[g]);return ze((E,C)=>{_.enabled&&_.update(C)},-1),h.useEffect(()=>(_.connect(m),()=>void _.disconnect()),[m,_]),h.useEffect(()=>{const E=I=>{A(),c&&y.regress(),a&&a(I)},C=I=>{i&&i(I)},w=I=>{o&&o(I)};return _.addEventListener("update",E),_.addEventListener("controlstart",C),_.addEventListener("controlend",w),_.addEventListener("control",E),_.addEventListener("transitionstart",E),_.addEventListener("wake",E),()=>{_.removeEventListener("update",E),_.removeEventListener("controlstart",C),_.removeEventListener("controlend",w),_.removeEventListener("control",E),_.removeEventListener("transitionstart",E),_.removeEventListener("wake",E)}},[_,i,o,A,x,c,a]),h.useEffect(()=>{if(t){const E=v().controls;return p({controls:_}),()=>p({controls:E})}},[t,_]),h.createElement("primitive",me({ref:e,object:_},l))}),Ip=s=>(s==null?void 0:s.current)instanceof di,$1=h.createContext(null);function bp(){const s=h.useContext($1);if(!s)throw new Error("useMotion hook must be used in a MotionPathControls component.");return s}function Bp({points:s=50,color:e="black"}){const{path:n}=bp(),[r,t]=h.useState([]),i=h.useMemo(()=>new Jr({color:e}),[e]),o=h.useMemo(()=>new Nh(.025,16,16),[]),a=h.useRef([]);return h.useEffect(()=>{n.curves!==a.current&&(t(n.getPoints(s)),a.current=n.curves)}),r.map((c,l)=>h.createElement("mesh",{key:l,material:i,geometry:o,position:[c.x,c.y,c.z]}))}const Ly=h.forwardRef(({children:s,curves:e=[],debug:n=!1,debugColor:r="black",object:t,focus:i,loop:o=!0,offset:a=void 0,smooth:c=!1,eps:l=1e-5,damping:u=.1,focusDamping:f=.1,maxSpeed:A=1/0,...d},x)=>{const{camera:p}=re(),v=h.useRef(null),y=h.useRef(a??0),g=h.useMemo(()=>new wA,[]),m=h.useMemo(()=>({focus:i,object:(t==null?void 0:t.current)instanceof di?t:{current:p},path:g,current:y.current,offset:y.current,point:new k,tangent:new k,next:new k}),[i,t]),_=IA(v);h.useLayoutEffect(()=>{const C=_.current;g.curves=[];const w=e.length>0?e:C.children.map(I=>I.object);for(let I=0;I<w.length;I++)g.add(w[I]);if(c){const I=g.getPoints(typeof c=="number"?c:1),B=new Yh(I);g.curves=[B]}g.updateArcLengths()}),h.useImperativeHandle(x,()=>Object.assign(v.current,{motion:m}),[m]),h.useLayoutEffect(()=>{y.current=oo.repeat(y.current,1)},[a]);const E=h.useMemo(()=>new k,[]);return ze((C,w)=>{const I=m.offset;if(Yn.damp(y,"current",a!==void 0?a:m.current,u,w,A,void 0,l),m.offset=o?oo.repeat(y.current,1):oo.clamp(y.current,0,1),g.getCurveLengths().length>0){g.getPointAt(m.offset,m.point),g.getTangentAt(m.offset,m.tangent).normalize(),g.getPointAt(oo.repeat(y.current-(I-m.offset),1),m.next);const B=(t==null?void 0:t.current)instanceof di?t.current:p;B.position.copy(m.point),i&&Yn.dampLookAt(B,Ip(i)?i.current.getWorldPosition(E):i,f,w,A,void 0,l)}}),h.createElement("group",me({ref:v},d),h.createElement($1.Provider,{value:m},s,n&&h.createElement(Bp,{color:r})))});function Sp({defaultScene:s,defaultCamera:e,renderPriority:n=1}){const{gl:r,scene:t,camera:i}=re();let o;return ze(()=>{o=r.autoClear,n===1&&(r.autoClear=!0,r.render(s,e)),r.autoClear=!1,r.clearDepth(),r.render(t,i),r.autoClear=o},n),h.createElement("group",{onPointerOver:()=>null})}function Mp({children:s,renderPriority:e=1}){const{scene:n,camera:r}=re(),[t]=h.useState(()=>new Kn);return h.createElement(h.Fragment,null,Ar(h.createElement(h.Fragment,null,s,h.createElement(Sp,{defaultScene:n,defaultCamera:r,renderPriority:e})),t,{events:{priority:e+1}}))}const ef=h.createContext({}),kl=()=>h.useContext(ef),Tp=2*Math.PI,Ec=new di,f0=new Me,[wr,xc]=[new st,new st],A0=new k,d0=new k,Dp=s=>"minPolarAngle"in s,m0=s=>"getTarget"in s,Oy=({alignment:s="bottom-right",margin:e=[80,80],renderPriority:n=1,onUpdate:r,onTarget:t,children:i})=>{const o=re(C=>C.size),a=re(C=>C.camera),c=re(C=>C.controls),l=re(C=>C.invalidate),u=h.useRef(null),f=h.useRef(null),A=h.useRef(!1),d=h.useRef(0),x=h.useRef(new k(0,0,0)),p=h.useRef(new k(0,0,0));h.useEffect(()=>{p.current.copy(a.up),Ec.up.copy(a.up)},[a]);const v=h.useCallback(C=>{A.current=!0,(c||t)&&(x.current=(t==null?void 0:t())||(m0(c)?c.getTarget(x.current):c==null?void 0:c.target)),d.current=a.position.distanceTo(A0),wr.copy(a.quaternion),d0.copy(C).multiplyScalar(d.current).add(A0),Ec.lookAt(d0),xc.copy(Ec.quaternion),l()},[c,a,t,l]);ze((C,w)=>{if(f.current&&u.current){var I;if(A.current)if(wr.angleTo(xc)<.01)A.current=!1,Dp(c)&&a.up.copy(p.current);else{const B=w*Tp;wr.rotateTowards(xc,B),a.position.set(0,0,1).applyQuaternion(wr).multiplyScalar(d.current).add(x.current),a.up.set(0,1,0).applyQuaternion(wr).normalize(),a.quaternion.copy(wr),m0(c)&&c.setPosition(a.position.x,a.position.y,a.position.z),r?r():c&&c.update(w),l()}f0.copy(a.matrix).invert(),(I=u.current)==null||I.quaternion.setFromRotationMatrix(f0)}});const y=h.useMemo(()=>({tweenCamera:v}),[v]),[g,m]=e,_=s.endsWith("-center")?0:s.endsWith("-left")?-o.width/2+g:o.width/2-g,E=s.startsWith("center-")?0:s.startsWith("top-")?o.height/2-m:-o.height/2+m;return h.createElement(Mp,{renderPriority:n},h.createElement(ef.Provider,{value:y},h.createElement(vp,{makeDefault:!0,ref:f,position:[0,0,200]}),h.createElement("group",{ref:u,position:[_,E,0]},i)))},Ns={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},Rp=["Right","Left","Top","Bottom","Front","Back"],tf=s=>new k(...s).multiplyScalar(.38),Pp=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(tf),Qp=[.25,.25,.25],nf=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(tf),zp=nf.map(s=>s.toArray().map(e=>e==0?.5:.25)),Fp=({hover:s,index:e,font:n="20px Inter var, Arial, sans-serif",faces:r=Rp,color:t=Ns.bg,hoverColor:i=Ns.hover,textColor:o=Ns.text,strokeColor:a=Ns.stroke,opacity:c=1})=>{const l=re(f=>f.gl),u=h.useMemo(()=>{const f=document.createElement("canvas");f.width=128,f.height=128;const A=f.getContext("2d");return A.fillStyle=t,A.fillRect(0,0,f.width,f.height),A.strokeStyle=a,A.strokeRect(0,0,f.width,f.height),A.font=n,A.textAlign="center",A.fillStyle=o,A.fillText(r[e].toUpperCase(),64,76),new $h(f)},[e,r,n,t,o,a]);return h.createElement("meshBasicMaterial",{map:u,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,attach:`material-${e}`,color:s?i:"white",transparent:!0,opacity:c})},Up=s=>{const{tweenCamera:e}=kl(),[n,r]=h.useState(null),t=a=>{a.stopPropagation(),r(null)},i=a=>{a.stopPropagation(),e(a.face.normal)},o=a=>{a.stopPropagation(),r(Math.floor(a.faceIndex/2))};return h.createElement("mesh",{onPointerOut:t,onPointerMove:o,onClick:s.onClick||i},[...Array(6)].map((a,c)=>h.createElement(Fp,me({key:c,index:c,hover:n===c},s))),h.createElement("boxGeometry",null))},p0=({onClick:s,dimensions:e,position:n,hoverColor:r=Ns.hover})=>{const{tweenCamera:t}=kl(),[i,o]=h.useState(!1),a=u=>{u.stopPropagation(),o(!1)},c=u=>{u.stopPropagation(),o(!0)},l=u=>{u.stopPropagation(),t(n)};return h.createElement("mesh",{scale:1.01,position:n,onPointerOver:c,onPointerOut:a,onClick:s||l},h.createElement("meshBasicMaterial",{color:i?r:"white",transparent:!0,opacity:.6,visible:i}),h.createElement("boxGeometry",{args:e}))},Ny=s=>h.createElement("group",{scale:[60,60,60]},h.createElement(Up,s),nf.map((e,n)=>h.createElement(p0,me({key:n,position:e,dimensions:zp[n]},s))),Pp.map((e,n)=>h.createElement(p0,me({key:n,position:e,dimensions:Qp},s))));function _c({scale:s=[.8,.05,.05],color:e,rotation:n}){return h.createElement("group",{rotation:n},h.createElement("mesh",{position:[.4,0,0]},h.createElement("boxGeometry",{args:s}),h.createElement("meshBasicMaterial",{color:e,toneMapped:!1})))}function Ir({onClick:s,font:e,disabled:n,arcStyle:r,label:t,labelColor:i,axisHeadScale:o=1,...a}){const c=re(p=>p.gl),l=h.useMemo(()=>{const p=document.createElement("canvas");p.width=64,p.height=64;const v=p.getContext("2d");return v.beginPath(),v.arc(32,32,16,0,2*Math.PI),v.closePath(),v.fillStyle=r,v.fill(),t&&(v.font=e,v.textAlign="center",v.fillStyle=i,v.fillText(t,32,41)),new $h(p)},[r,t,i,e]),[u,f]=h.useState(!1),A=(t?1:.75)*(u?1.2:1)*o,d=p=>{p.stopPropagation(),f(!0)},x=p=>{p.stopPropagation(),f(!1)};return h.createElement("sprite",me({scale:A,onPointerOver:n?void 0:d,onPointerOut:n?void 0:s||x},a),h.createElement("spriteMaterial",{map:l,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:t?1:.75,toneMapped:!1}))}const Gy=({hideNegativeAxes:s,hideAxisHeads:e,disabled:n,font:r="18px Inter var, Arial, sans-serif",axisColors:t=["#ff2060","#20df80","#2080ff"],axisHeadScale:i=1,axisScale:o,labels:a=["X","Y","Z"],labelColor:c="#000",onClick:l,...u})=>{const[f,A,d]=t,{tweenCamera:x}=kl(),p={font:r,disabled:n,labelColor:c,onClick:l,axisHeadScale:i,onPointerDown:n?void 0:v=>{x(v.object.position),v.stopPropagation()}};return h.createElement("group",me({scale:40},u),h.createElement(_c,{color:f,rotation:[0,0,0],scale:o}),h.createElement(_c,{color:A,rotation:[0,0,Math.PI/2],scale:o}),h.createElement(_c,{color:d,rotation:[0,-Math.PI/2,0],scale:o}),!e&&h.createElement(h.Fragment,null,h.createElement(Ir,me({arcStyle:f,position:[1,0,0],label:a[0]},p)),h.createElement(Ir,me({arcStyle:A,position:[0,1,0],label:a[1]},p)),h.createElement(Ir,me({arcStyle:d,position:[0,0,1],label:a[2]},p)),!s&&h.createElement(h.Fragment,null,h.createElement(Ir,me({arcStyle:f,position:[-1,0,0]},p)),h.createElement(Ir,me({arcStyle:A,position:[0,-1,0]},p)),h.createElement(Ir,me({arcStyle:d,position:[0,0,-1]},p)))))},kp=ln({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new Ve,sectionColor:new Ve,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new k,worldPlanePosition:new k},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Hy=h.forwardRef(({args:s,cellColor:e="#000000",sectionColor:n="#2080ff",cellSize:r=.5,sectionSize:t=1,followCamera:i=!1,infiniteGrid:o=!1,fadeDistance:a=100,fadeStrength:c=1,fadeFrom:l=1,cellThickness:u=.5,sectionThickness:f=1,side:A=Kr,...d},x)=>{Gt({GridMaterial:kp});const p=h.useRef(null);h.useImperativeHandle(x,()=>p.current,[]);const v=new qn,y=new k(0,1,0),g=new k(0,0,0);ze(E=>{v.setFromNormalAndCoplanarPoint(y,g).applyMatrix4(p.current.matrixWorld);const C=p.current.material,w=C.uniforms.worldCamProjPosition,I=C.uniforms.worldPlanePosition;v.projectPoint(E.camera.position,w.value),I.value.set(0,0,0).applyMatrix4(p.current.matrixWorld)});const m={cellSize:r,sectionSize:t,cellColor:e,sectionColor:n,cellThickness:u,sectionThickness:f},_={fadeDistance:a,fadeStrength:c,fadeFrom:l,infiniteGrid:o,followCamera:i};return h.createElement("mesh",me({ref:p,frustumCulled:!1},d),h.createElement("gridMaterial",me({transparent:!0,"extensions-derivatives":!0,side:A},m,_)),h.createElement("planeGeometry",{args:s}))});function rf(s,{path:e}){const[n]=Ei(Bl,[s],r=>r.setPath(e));return n}rf.preload=(s,{path:e})=>Ei.preload(Bl,[s],n=>n.setPath(e));function Vy({children:s,files:e,...n}){const r=rf(e,{...n});return h.createElement(h.Fragment,null,s==null?void 0:s(r))}const sf="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function Ll(s,e=`${sf}/basis/`){const n=re(t=>t.gl),r=Ei(Pl,gu(s)?Object.values(s):s,t=>{t.detectSupport(n),t.setTranscoderPath(e)});if(h.useEffect(()=>{(Array.isArray(r)?r:[r]).forEach(n.initTexture)},[n,r]),gu(s)){const t=Object.keys(s),i={};return t.forEach(o=>Object.assign(i,{[o]:r[t.indexOf(o)]})),i}else return r}Ll.preload=(s,e=`${sf}/basis/`)=>Ei.preload(Pl,s,n=>{n.setTranscoderPath(e)});Ll.clear=s=>Ei.clear(Pl,s);const Wy=({children:s,input:e,basisPath:n})=>{const r=Ll(e,n);return h.createElement(h.Fragment,null,s==null?void 0:s(r))},ia=(s,e)=>{if(Array.isArray(s))return s[0];{const n=e??Object.keys(s)[0];return s[n][0]}},Lp=s=>{for(let e=3;e<s.length;e+=4)if(s[e]!==0)return!1;return!0};function Ol(s,e,n,r,t,i){const o=h.useRef(re(b=>b.viewport)),a=h.useRef(null),c=h.useRef(0),l=.1,u=h.useRef(s),f=h.useRef(e),A=h.useRef(n),[d,x]=h.useState(null),[p,v]=h.useState(new an),y=h.useMemo(()=>new aa,[]),[g,m]=h.useState(null),_=h.useCallback((b,M,D)=>{const N=M*(o.current.aspect>b/M?o.current.width/b:o.current.height/M),q=b*(o.current.aspect>b/M?o.current.width/b:o.current.height/M)*D,X=N*D,O=1;let H=Math.min(O,q),T=Math.min(O,X);return q>O&&(H=O,T=X/q*O),new k(H,T,1)},[]),E=h.useCallback((b,M)=>{if(b.image){const D=document.createElement("canvas"),N=D.getContext("2d",i);if(!N)throw new Error("Failed to get 2d context");D.width=b.image.width,D.height=b.image.height,N.drawImage(b.image,0,0);const G=b.image.width,q=b.image.height,X=Math.round(Math.sqrt(M*(G/q))),O=Math.round(M/X),H=G/X,T=q/O,W=[];for(let j=0;j<O;j++)for(let L=0;L<X;L++){if(j*X+L>=M){W.push({row:j,col:L});continue}const F=N.getImageData(L*H,j*T,H,T).data;Lp(F)&&W.push({row:j,col:L})}return{rows:O,columns:X,frameWidth:H,frameHeight:T,emptyFrames:W}}else return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},[i]),C=h.useCallback(b=>{const M=D=>{let N=null;for(const q of D){const{w:X,h:O}=q.frame,H=X*O;(!N||H>N.area)&&(N={w:X,h:O,area:H})}return D.map(q=>{const{w:X,h:O}=q.frame,H=X*O,T=N?H===N.area?1:Math.sqrt(H/N.area):1;return{...q,scaleRatio:T}})};if(Array.isArray(b))return M(b);{const D={};for(const N in b)D[N]=M(b[N]);return D}},[]),w=h.useCallback(()=>{const b={},M=a.current,D=A.current;if(M)if(D&&Array.isArray(M.frames)){for(let N=0;N<D.length;N++){b[D[N]]=[];for(const G of M.frames){const q=G.frame,X=G.sourceSize.w,O=G.sourceSize.h;typeof G.filename=="string"&&G.filename.toLowerCase().indexOf(D[N].toLowerCase())!==-1&&b[D[N]].push({...G,frame:q,sourceSize:{w:X,h:O}})}}for(const N in b){const G=C(b[N]);Array.isArray(G)&&(b[N]=G)}return b}else if(D&&typeof M.frames=="object"){for(let N=0;N<D.length;N++){b[D[N]]=[];for(const G in M.frames){const q=M.frames[G],X=q.frame,O=q.sourceSize.w,H=q.sourceSize.h;typeof G=="string"&&G.toLowerCase().indexOf(D[N].toLowerCase())!==-1&&b[D[N]].push({...q,frame:X,sourceSize:{w:O,h:H}})}}for(const N in b){const G=C(b[N]);Array.isArray(G)&&(b[N]=G)}return b}else{let N=[];return M!=null&&M.frames&&(Array.isArray(M.frames)?N=M.frames.map(G=>({...G,x:G.frame.x,y:G.frame.y,w:G.frame.w,h:G.frame.h})):N=Object.values(M.frames).flat().map(G=>({...G,x:G.frame.x,y:G.frame.y,w:G.frame.w,h:G.frame.h}))),C(N)}return[]},[C,a]),I=h.useCallback((b,M)=>{let D=new k(1,1,1);if(b===null){if(M&&r){const N=M.image.width,G=M.image.height;c.current=r;const{rows:q,columns:X,frameWidth:O,frameHeight:H,emptyFrames:T}=E(M,r),W={frames:[],meta:{version:"1.0",size:{w:N,h:G},rows:q,columns:X,frameWidth:O,frameHeight:H,scale:"1"}};for(let j=0;j<q;j++)for(let L=0;L<X;L++)(T??[]).some(F=>F.row===j&&F.col===L)||Array.isArray(W.frames)&&W.frames.push({frame:{x:L*O,y:j*H,w:O,h:H},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:O,h:H},sourceSize:{w:O,h:H}});D=_(O,H,l),a.current=W}a.current&&a.current.frames&&(a.current.frames=C(a.current.frames))}else if(M){a.current=b,a.current.frames=w(),c.current=Array.isArray(b.frames)?b.frames.length:Object.keys(b.frames).length;const{w:N,h:G}=ia(b.frames).sourceSize;D=_(N,G,l)}x(a.current),"encoding"in M?M.encoding=3001:"colorSpace"in M&&(M.colorSpace=e1),v(M),m({spriteTexture:M,spriteData:a.current,aspect:D})},[E,r,w,_,C]),B=h.useCallback((b,M,D)=>{const N=fetch(b).then(q=>q.json()),G=new Promise(q=>{y.load(M,q)});Promise.all([N,G]).then(q=>{D(q[0],q[1])})},[y]),S=h.useCallback(b=>{if(!b&&!u.current)throw new Error("Either textureUrl or input must be provided");const M=b??u.current;if(!M)throw new Error("A valid texture URL must be provided");y.load(M,D=>I(null,D))},[y,I]),U=h.useCallback((b,M)=>{M&&b?B(M,b,I):S(b)},[B,S,I]);return h.useLayoutEffect(()=>{f.current&&u.current?B(f.current,u.current,I):u.current&&S();const b=u.current;return()=>{b&&Ei.clear(aa,b)}},[B,S,I]),h.useLayoutEffect(()=>{t==null||t(p,d??null)},[p,d,t]),{spriteObj:g,loadJsonAndTexture:U}}Ol.preload=s=>Ei.preload(aa,s);Ol.clear=s=>Ei.clear(aa,s);function of(s,e,...n){const r=h.useRef(null),t=re(i=>i.scene);return h.useLayoutEffect(()=>{let i;if(s&&s!=null&&s.current&&e&&(r.current=i=new e(s.current,...n)),i)return i.traverse(o=>o.raycast=()=>null),t.add(i),()=>{r.current=void 0,t.remove(i),i.dispose==null||i.dispose()}},[t,e,s,...n]),ze(()=>{var i;return void((i=r.current)==null||i.update==null?void 0:i.update())}),r}const Yy=({type:s,args:e=[]})=>{const n=h.useRef(null),r=h.useRef(null);return h.useLayoutEffect(()=>{r.current=n.current.parent}),of(r,s,...e),h.createElement("object3D",{ref:n})};var na={exports:{}},Op=na.exports,g0;function Np(){return g0||(g0=1,function(s,e){(function(n,r){s.exports=r()})(Op,function(){var n=function(){function r(d){return o.appendChild(d.dom),d}function t(d){for(var x=0;x<o.children.length;x++)o.children[x].style.display=x===d?"block":"none";i=d}var i=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),t(++i%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new n.Panel("FPS","#0ff","#002")),f=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var A=r(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:o,addPanel:r,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(f.update(d-a,200),d>c+1e3&&(u.update(1e3*l/(d-c),100),c=d,l=0,A)){var x=performance.memory;A.update(x.usedJSHeapSize/1048576,x.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:t}};return n.Panel=function(r,t,i){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,f=48*l,A=3*l,d=2*l,x=3*l,p=15*l,v=74*l,y=30*l,g=document.createElement("canvas");g.width=u,g.height=f,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*l+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,u,f),m.fillStyle=t,m.fillText(r,A,d),m.fillRect(x,p,v,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(x,p,v,y),{dom:g,update:function(_,E){o=Math.min(o,_),a=Math.max(a,_),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,u,p),m.fillStyle=t,m.fillText(c(_)+" "+r+" ("+c(o)+"-"+c(a)+")",A,d),m.drawImage(g,x+l,p,v-l,y,x,p,v-l,y),m.fillRect(x+v-l,p,l,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(x+v-l,p,l,c((1-_/E)*y))}}},n})}(na)),na.exports}var Gp=Np();const Hp=bA(Gp);function Vp(s,e=[],n){const[r,t]=h.useState();return h.useLayoutEffect(()=>{const i=s();return t(i),()=>void 0},e),r}function jy({showPanel:s=0,className:e,parent:n}){const r=Vp(()=>new Hp,[]);return h.useEffect(()=>{if(r){const t=n&&n.current||document.body;r.showPanel(s),t==null||t.appendChild(r.dom);const i=(e??"").split(" ").filter(c=>c);i.length&&r.dom.classList.add(...i);const o=t1(()=>r.begin()),a=Sl(()=>r.end());return()=>{i.length&&r.dom.classList.remove(...i),t==null||t.removeChild(r.dom),o(),a()}}},[n,r,e,s]),null}class Wp{constructor(e,n,r){this.name=e,this.fg=n,this.bg=r,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let n;const r=this.fg;switch(this.fg.toLowerCase()){case"#0ff":n="#006666";break;case"#0f0":n="#006600";break;case"#ff0":n="#666600";break;case"#e1e1e1":n="#666666";break;default:n=this.bg;break}return e.addColorStop(0,n),e.addColorStop(1,r),e}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,n,r,t,i=0){if(!this.context||!this.gradient)return;const o=Math.min(1/0,e),a=Math.max(r,e);t=Math.max(t,n),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(i)} ${this.name} (${o.toFixed(i)}-${parseFloat(a.toFixed(i))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);const c=this.GRAPH_HEIGHT-(1-n/t)*this.GRAPH_HEIGHT;c>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-c,this.PR,c))}}const af=class Nr{constructor({trackGPU:e=!1,logsPerSecond:n=30,samplesLog:r=60,samplesGraph:t=10,precision:i=2,minimal:o=!1,horizontal:a=!0,mode:c=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=l=>{l.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=c,this.horizontal=a,this.minimal=o,this.trackGPU=e,this.samplesLog=r,this.samplesGraph=t,this.precision=i,this.logsPerSecond=n,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new Nr.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new Nr.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}this.handleThreeRenderer(e)||await this.handleWebGPURenderer(e)||this.initializeWebGL(e)}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0):!1}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new Nr.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new Nr.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new Nr.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,n){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=n*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=n*e.HEIGHT/e.PR+"px"))}addPanel(e,n){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,n)),e}showPanel(e){for(let n=0;n<this.dom.children.length;n++){const r=this.dom.children[n];r.style.display=n===e?"block":"none"}this.mode=e}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,n)=>{if(this.gl){const r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),t=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(r&&!t){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(n,1)}}}))}endInternal(){this.frames++;const e=(performance||Date).now(),n=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){const r=Math.round(this.frames*1e3/n);this.addToAverage(r,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,n){n.logs.push(e),n.logs.length>this.samplesLog&&n.logs.shift(),n.graph.push(e),n.graph.length>this.samplesGraph&&n.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,n,r){if(window.performance&&n&&this.isRunningCPUProfiling){window.performance.mark(n);const t=performance.measure(r,e,n);this.totalCpuDuration+=t.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,n,r=2){if(n.logs.length>0){let t=0,i=.01;for(let c=0;c<n.logs.length;c++)t+=n.logs[c],n.logs[c]>i&&(i=n.logs[c]);let o=0,a=.01;for(let c=0;c<n.graph.length;c++)o+=n.graph[c],n.graph[c]>a&&(a=n.graph[c]);e&&e.update(t/Math.min(n.logs.length,this.samplesLog),o/Math.min(n.graph.length,this.samplesGraph),i,a,r)}}get domElement(){return this.dom}patchThreeRenderer(e){const n=e.render,r=this;e.render=function(t,i){r.begin(),n.call(this,t,i),r.end()},this.threeRendererPatched=!0}};af.Panel=Wp;let Yp=af;const qy=h.forwardRef(function({className:e,parent:n,id:r,clearStatsGlStyle:t,...i},o){const a=re(l=>l.gl),c=h.useMemo(()=>{const l=new Yp({...i});return l.init(a),l},[a]);return h.useImperativeHandle(o,()=>c.domElement,[c]),h.useEffect(()=>{if(c){const l=n&&n.current||document.body;l==null||l.appendChild(c.domElement),c.domElement.querySelectorAll("canvas").forEach(A=>{A.style.removeProperty("position")}),r&&(c.domElement.id=r),t&&c.domElement.removeAttribute("style"),c.domElement.removeAttribute("style");const u=(e??"").split(" ").filter(A=>A);u.length&&c.domElement.classList.add(...u);const f=Sl(()=>c.update());return()=>{u.length&&c.domElement.classList.remove(...u),l==null||l.removeChild(c.domElement),f()}}},[n,c,e,r,t]),null});function Xy({size:s=256,frames:e=1/0}={}){const n=re(u=>u.viewport.dpr),{width:r,height:t}=re(u=>u.size),i=s||r*n,o=s||t*n,a=h.useMemo(()=>{const u=new bl(i,o);return u.format=i1,u.type=Ml,{depthTexture:u}},[i,o]);let c=0;const l=Bi(i,o,a);return ze(u=>{(e===1/0||c<e)&&(u.gl.setRenderTarget(l),u.gl.render(u.scene,u.camera),u.gl.setRenderTarget(null),c++)}),l.depthTexture}function Ky(s,e,n=1){const r=re(o=>o.viewport),t=e*(r.aspect>s/e?r.width/s:r.height/e);return[s*(r.aspect>s/e?r.width/s:r.height/e)*n,t*n,1]}function Zy(s,e){const n=re(t=>t.pointer),[r]=h.useState(()=>{const t=new fa;return e&&ji(t,e),function(i,o){t.setFromCamera(n,s instanceof n1?s:s.current);const a=this.constructor.prototype.raycast.bind(this);a&&a(t,o)}});return r}function Cc(s,e,n,r){return new(n||(n=Promise))(function(t,i){function o(l){try{c(r.next(l))}catch(u){i(u)}}function a(l){try{c(r.throw(l))}catch(u){i(u)}}function c(l){var u;l.done?t(l.value):(u=l.value,u instanceof n?u:new n(function(f){f(u)})).then(o,a)}c((r=r.apply(s,[])).next())})}const jp=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function y0(s){return s=s.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const cf=typeof window>"u",pn=(()=>{if(cf)return;const{userAgent:s,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(s),t=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:t,isMobile:/android/i.test(s)||r||t,isSafari12:/Version\/12.+Safari/.test(s),isFirefox:/Firefox/.test(s)}})();function qp(s,e,n){if(!n)return[e];const r=function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,f=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,A=l.createShader(35633),d=l.createShader(35632),x=l.createProgram();if(!(d&&A&&x))return;l.shaderSource(A,u),l.shaderSource(d,f),l.compileShader(A),l.compileShader(d),l.attachShader(x,A),l.attachShader(x,d),l.linkProgram(x),l.detachShader(x,A),l.detachShader(x,d),l.deleteShader(A),l.deleteShader(d),l.useProgram(x);const p=l.createBuffer();l.bindBuffer(34962,p),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const v=l.getAttribLocation(x,"aPosition");l.vertexAttribPointer(v,3,5126,!1,0,0),l.enableVertexAttribArray(v),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const y=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,y),l.deleteProgram(x),l.deleteBuffer(p),y.join("")}(s),t="801621810",i="8016218135",o="80162181161",a=pn!=null&&pn.isIpad?[["a7",o,12],["a8",i,15],["a8x",i,15],["a9",i,15],["a9x",i,15],["a10",i,15],["a10x",i,15],["a12",t,15],["a12x",t,15],["a12z",t,15],["a14",t,15],["a15",t,15],["m1",t,15],["m2",t,15]]:[["a7",o,12],["a8",i,12],["a9",i,15],["a10",i,15],["a11",t,15],["a12",t,15],["a13",t,15],["a14",t,15],["a15",t,15],["a16",t,15],["a17",t,15]];let c;return r==="80162181255"?c=a.filter(([,,l])=>l>=14):(c=a.filter(([,l])=>l===r),c.length||(c=a)),c.map(([l])=>`apple ${l} gpu`)}let v0=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const wc=[],E0=[];function Xp(s,e){if(s===e)return 0;const n=s;s.length>e.length&&(s=e,e=n);let r=s.length,t=e.length;for(;r>0&&s.charCodeAt(~-r)===e.charCodeAt(~-t);)r--,t--;let i,o=0;for(;o<r&&s.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,t-=o,r===0)return t;let a,c,l=0,u=0,f=0;for(;u<r;)E0[u]=s.charCodeAt(o+u),wc[u]=++u;for(;f<t;)for(i=e.charCodeAt(o+f),a=f++,l=f,u=0;u<r;u++)c=i===E0[u]?a:a+1,a=wc[u],l=wc[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function Kp(s){return s!=null}const Zp=({mobileTiers:s=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:t=!1,benchmarksURL:i="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>Cc(void 0,void 0,void 0,function*(){const o={};if(cf)return{tier:0,type:"SSR"};const{isIpad:a=!!(pn!=null&&pn.isIpad),isMobile:c=!!(pn!=null&&pn.isMobile),screenSize:l=window.screen,loadBenchmarks:u=E=>Cc(void 0,void 0,void 0,function*(){const C=yield fetch(`${i}/${E}`).then(w=>w.json());if(parseInt(C.shift().split(".")[0],10)<4)throw new v0("Detect GPU benchmark data is out of date. Please update to version 4x");return C})}=n;let{renderer:f}=n;const A=(E,C,w,I,B)=>({device:B,fps:I,gpu:w,isMobile:c,tier:E,type:C});let d,x="";if(f)f=y0(f),d=[f];else{const E=r||function(w,I=!1){const B={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:I,powerPreference:"high-performance",stencil:!1};w&&delete B.powerPreference;const S=window.document.createElement("canvas"),U=S.getContext("webgl",B)||S.getContext("experimental-webgl",B);return U??void 0}(pn==null?void 0:pn.isSafari12,t);if(!E)return A(0,"WEBGL_UNSUPPORTED");const C=pn!=null&&pn.isFirefox?null:E.getExtension("WEBGL_debug_renderer_info");if(f=C?E.getParameter(C.UNMASKED_RENDERER_WEBGL):E.getParameter(E.RENDERER),!f)return A(1,"FALLBACK");x=f,f=y0(f),d=function(w,I,B){return I==="apple gpu"?qp(w,I,B):[I]}(E,f,c)}const p=(yield Promise.all(d.map(function(E){var C;return Cc(this,void 0,void 0,function*(){const w=(j=>{const L=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const z of L)if(j.includes(z))return z})(E);if(!w)return;const I=`${c?"m":"d"}-${w}${a?"-ipad":""}.json`,B=o[I]=(C=o[I])!==null&&C!==void 0?C:u(I);let S;try{S=yield B}catch(j){if(j instanceof v0)throw j;return}const U=function(j){var L;const z=(j=j.replace(/\([^)]+\)/,"")).match(/\d+/)||j.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(L=z==null?void 0:z.join("").replace(/\W|amd/g,""))!==null&&L!==void 0?L:""}(E);let b=S.filter(([,j])=>j===U);b.length||(b=S.filter(([j])=>j.includes(E)));const M=b.length;if(M===0)return;const D=E.split(/[.,()\[\]/\s]/g).sort().filter((j,L,z)=>L===0||j!==z[L-1]).join(" ");let N,[G,,,,q]=M>1?b.map(j=>[j,Xp(D,j[2])]).sort(([,j],[,L])=>j-L)[0][0]:b[0],X=Number.MAX_VALUE;const{devicePixelRatio:O}=window,H=l.width*O*l.height*O;for(const j of q){const[L,z]=j,F=L*z,R=Math.abs(H-F);R<X&&(X=R,N=j)}if(!N)return;const[,,T,W]=N;return[X,T,G,W]})}))).filter(Kp).sort(([E=Number.MAX_VALUE,C],[w=Number.MAX_VALUE,I])=>E===w?C-I:E-w);if(!p.length){const E=jp.find(C=>f.includes(C));return E?A(0,"BLOCKLISTED",E):A(1,"FALLBACK",`${f} (${x})`)}const[,v,y,g]=p[0];if(v===-1)return A(0,"BLOCKLISTED",y,v,g);const m=c?s:e;let _=0;for(let E=0;E<m.length;E++)v>=m[E]&&(_=E);return A(_,"BENCHMARK",y,v,g)}),Jp=s=>Xn(()=>Zp(s),["useDetectGPU"]);function $y({children:s,...e}){const n=Jp(e);return h.createElement(h.Fragment,null,s==null?void 0:s(n))}const lf=0,$p=1,wa=2,x0=2,Ic=1.25,_0=1,Gn=6*4+4+4,Ia=65535,e3=Math.pow(2,-24),bc=Symbol("SKIP_GENERATION");function uf(s){return s.index?s.index.count:s.attributes.position.count}function es(s){return uf(s)/3}function hf(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function t3(s,e){if(!s.index){const n=s.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,t=hf(n,r);s.setIndex(new Nt(t,1));for(let i=0;i<n;i++)t[i]=i}}function ff(s,e){const n=es(s),r=e||s.drawRange,t=r.start/3,i=(r.start+r.count)/3,o=Math.max(0,t),a=Math.min(n,i)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function Af(s,e){if(!s.groups||!s.groups.length)return ff(s,e);const n=[],r=new Set,t=e||s.drawRange,i=t.start/3,o=(t.start+t.count)/3;for(const c of s.groups){const l=c.start/3,u=(c.start+c.count)/3;r.add(Math.max(i,l)),r.add(Math.min(o,u))}const a=Array.from(r.values()).sort((c,l)=>c-l);for(let c=0;c<a.length-1;c++){const l=a[c],u=a[c+1];n.push({offset:Math.floor(l),count:Math.floor(u-l)})}return n}function i3(s,e){const n=es(s),r=Af(s,e).sort((o,a)=>o.offset-a.offset),t=r[r.length-1];t.count=Math.min(n-t.offset,t.count);let i=0;return r.forEach(({count:o})=>i+=o),n!==i}function Bc(s,e,n,r,t){let i=1/0,o=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,f=1/0,A=1/0,d=1/0,x=-1/0,p=-1/0,v=-1/0;for(let y=e*6,g=(e+n)*6;y<g;y+=6){const m=s[y+0],_=s[y+1],E=m-_,C=m+_;E<i&&(i=E),C>c&&(c=C),m<f&&(f=m),m>x&&(x=m);const w=s[y+2],I=s[y+3],B=w-I,S=w+I;B<o&&(o=B),S>l&&(l=S),w<A&&(A=w),w>p&&(p=w);const U=s[y+4],b=s[y+5],M=U-b,D=U+b;M<a&&(a=M),D>u&&(u=D),U<d&&(d=U),U>v&&(v=U)}r[0]=i,r[1]=o,r[2]=a,r[3]=c,r[4]=l,r[5]=u,t[0]=f,t[1]=A,t[2]=d,t[3]=x,t[4]=p,t[5]=v}function n3(s,e=null,n=null,r=null){const t=s.attributes.position,i=s.index?s.index.array:null,o=es(s),a=t.normalized;let c;e===null?(c=new Float32Array(o*6),n=0,r=o):(c=e,n=n||0,r=r||o);const l=t.array,u=t.offset||0;let f=3;t.isInterleavedBufferAttribute&&(f=t.data.stride);const A=["getX","getY","getZ"];for(let d=n;d<n+r;d++){const x=d*3,p=d*6;let v=x+0,y=x+1,g=x+2;i&&(v=i[v],y=i[y],g=i[g]),a||(v=v*f+u,y=y*f+u,g=g*f+u);for(let m=0;m<3;m++){let _,E,C;a?(_=t[A[m]](v),E=t[A[m]](y),C=t[A[m]](g)):(_=l[v+m],E=l[y+m],C=l[g+m]);let w=_;E<w&&(w=E),C<w&&(w=C);let I=_;E>I&&(I=E),C>I&&(I=C);const B=(I-w)/2,S=m*2;c[p+S+0]=w+B,c[p+S+1]=B+(Math.abs(w)+B)*e3}}return c}function Ut(s,e,n){return n.min.x=e[s],n.min.y=e[s+1],n.min.z=e[s+2],n.max.x=e[s+3],n.max.y=e[s+4],n.max.z=e[s+5],n}function C0(s){let e=-1,n=-1/0;for(let r=0;r<3;r++){const t=s[r+3]-s[r];t>n&&(n=t,e=r)}return e}function w0(s,e){e.set(s)}function I0(s,e,n){let r,t;for(let i=0;i<3;i++){const o=i+3;r=s[i],t=e[i],n[i]=r<t?r:t,r=s[o],t=e[o],n[o]=r>t?r:t}}function bo(s,e,n){for(let r=0;r<3;r++){const t=e[s+2*r],i=e[s+2*r+1],o=t-i,a=t+i;o<n[r]&&(n[r]=o),a>n[r+3]&&(n[r+3]=a)}}function Is(s){const e=s[3]-s[0],n=s[4]-s[1],r=s[5]-s[2];return 2*(e*n+n*r+r*e)}const Mn=32,r3=(s,e)=>s.candidate-e.candidate,zn=new Array(Mn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Bo=new Float32Array(6);function s3(s,e,n,r,t,i){let o=-1,a=0;if(i===lf)o=C0(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(i===$p)o=C0(s),o!==-1&&(a=o3(n,r,t,o));else if(i===wa){const c=Is(s);let l=Ic*t;const u=r*6,f=(r+t)*6;for(let A=0;A<3;A++){const d=e[A],v=(e[A+3]-d)/Mn;if(t<Mn/4){const y=[...zn];y.length=t;let g=0;for(let _=u;_<f;_+=6,g++){const E=y[g];E.candidate=n[_+2*A],E.count=0;const{bounds:C,leftCacheBounds:w,rightCacheBounds:I}=E;for(let B=0;B<3;B++)I[B]=1/0,I[B+3]=-1/0,w[B]=1/0,w[B+3]=-1/0,C[B]=1/0,C[B+3]=-1/0;bo(_,n,C)}y.sort(r3);let m=t;for(let _=0;_<m;_++){const E=y[_];for(;_+1<m&&y[_+1].candidate===E.candidate;)y.splice(_+1,1),m--}for(let _=u;_<f;_+=6){const E=n[_+2*A];for(let C=0;C<m;C++){const w=y[C];E>=w.candidate?bo(_,n,w.rightCacheBounds):(bo(_,n,w.leftCacheBounds),w.count++)}}for(let _=0;_<m;_++){const E=y[_],C=E.count,w=t-E.count,I=E.leftCacheBounds,B=E.rightCacheBounds;let S=0;C!==0&&(S=Is(I)/c);let U=0;w!==0&&(U=Is(B)/c);const b=_0+Ic*(S*C+U*w);b<l&&(o=A,l=b,a=E.candidate)}}else{for(let m=0;m<Mn;m++){const _=zn[m];_.count=0,_.candidate=d+v+m*v;const E=_.bounds;for(let C=0;C<3;C++)E[C]=1/0,E[C+3]=-1/0}for(let m=u;m<f;m+=6){let C=~~((n[m+2*A]-d)/v);C>=Mn&&(C=Mn-1);const w=zn[C];w.count++,bo(m,n,w.bounds)}const y=zn[Mn-1];w0(y.bounds,y.rightCacheBounds);for(let m=Mn-2;m>=0;m--){const _=zn[m],E=zn[m+1];I0(_.bounds,E.rightCacheBounds,_.rightCacheBounds)}let g=0;for(let m=0;m<Mn-1;m++){const _=zn[m],E=_.count,C=_.bounds,I=zn[m+1].rightCacheBounds;E!==0&&(g===0?w0(C,Bo):I0(C,Bo,Bo)),g+=E;let B=0,S=0;g!==0&&(B=Is(Bo)/c);const U=t-g;U!==0&&(S=Is(I)/c);const b=_0+Ic*(B*g+S*U);b<l&&(o=A,l=b,a=_.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:o,pos:a}}function o3(s,e,n,r){let t=0;for(let i=e,o=e+n;i<o;i++)t+=s[i*6+r*2];return t/n}class Sc{constructor(){this.boundingData=new Float32Array(6)}}function a3(s,e,n,r,t,i){let o=r,a=r+t-1;const c=i.pos,l=i.axis*2;for(;;){for(;o<=a&&n[o*6+l]<c;)o++;for(;o<=a&&n[a*6+l]>=c;)a--;if(o<a){for(let u=0;u<3;u++){let f=e[o*3+u];e[o*3+u]=e[a*3+u],e[a*3+u]=f}for(let u=0;u<6;u++){let f=n[o*6+u];n[o*6+u]=n[a*6+u],n[a*6+u]=f}o++,a--}else return o}}function c3(s,e,n,r,t,i){let o=r,a=r+t-1;const c=i.pos,l=i.axis*2;for(;;){for(;o<=a&&n[o*6+l]<c;)o++;for(;o<=a&&n[a*6+l]>=c;)a--;if(o<a){let u=s[o];s[o]=s[a],s[a]=u;for(let f=0;f<6;f++){let A=n[o*6+f];n[o*6+f]=n[a*6+f],n[a*6+f]=A}o++,a--}else return o}}function vi(s,e){return e[s+15]===65535}function Si(s,e){return e[s+6]}function Fi(s,e){return e[s+14]}function qi(s){return s+8}function Ui(s,e){return e[s+6]}function Nl(s,e){return e[s+7]}let df,Gs,ra,mf;const l3=Math.pow(2,32);function Al(s){return"count"in s?1:1+Al(s.left)+Al(s.right)}function u3(s,e,n){return df=new Float32Array(n),Gs=new Uint32Array(n),ra=new Uint16Array(n),mf=new Uint8Array(n),dl(s,e)}function dl(s,e){const n=s/4,r=s/2,t="count"in e,i=e.boundingData;for(let o=0;o<6;o++)df[n+o]=i[o];if(t)if(e.buffer){const o=e.buffer;mf.set(new Uint8Array(o),s);for(let a=s,c=s+o.byteLength;a<c;a+=Gn){const l=a/2;vi(l,ra)||(Gs[a/4+6]+=n)}return s+o.byteLength}else{const o=e.offset,a=e.count;return Gs[n+6]=o,ra[r+14]=a,ra[r+15]=Ia,s+Gn}else{const o=e.left,a=e.right,c=e.splitAxis;let l;if(l=dl(s+Gn,o),l/4>l3)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Gs[n+6]=l/4,l=dl(l,a),Gs[n+7]=c,l}}function h3(s,e){const n=(s.index?s.index.count:s.attributes.position.count)/3,r=n>2**16,t=r?4:2,i=e?new SharedArrayBuffer(n*t):new ArrayBuffer(n*t),o=r?new Uint32Array(i):new Uint16Array(i);for(let a=0,c=o.length;a<c;a++)o[a]=a;return o}function f3(s,e,n,r,t){const{maxDepth:i,verbose:o,maxLeafTris:a,strategy:c,onProgress:l,indirect:u}=t,f=s._indirectBuffer,A=s.geometry,d=A.index?A.index.array:null,x=u?c3:a3,p=es(A),v=new Float32Array(6);let y=!1;const g=new Sc;return Bc(e,n,r,g.boundingData,v),_(g,n,r,v),g;function m(E){l&&l(E/p)}function _(E,C,w,I=null,B=0){if(!y&&B>=i&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(A))),w<=a||B>=i)return m(C+w),E.offset=C,E.count=w,E;const S=s3(E.boundingData,I,e,C,w,c);if(S.axis===-1)return m(C+w),E.offset=C,E.count=w,E;const U=x(f,d,e,C,w,S);if(U===C||U===C+w)m(C+w),E.offset=C,E.count=w;else{E.splitAxis=S.axis;const b=new Sc,M=C,D=U-C;E.left=b,Bc(e,M,D,b.boundingData,v),_(b,M,D,v,B+1);const N=new Sc,G=U,q=w-D;E.right=N,Bc(e,G,q,N.boundingData,v),_(N,G,q,v,B+1)}return E}}function A3(s,e){const n=s.geometry;e.indirect&&(s._indirectBuffer=h3(n,e.useSharedArrayBuffer),i3(n,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||t3(n,e);const r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,t=n3(n),i=e.indirect?ff(n,e.range):Af(n,e.range);s._roots=i.map(o=>{const a=f3(s,t,o.offset,o.count,e),c=Al(a),l=new r(Gn*c);return u3(0,a,l),l})}class Rn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,n){let r=1/0,t=-1/0;for(let i=0,o=e.length;i<o;i++){const c=e[i][n];r=c<r?c:r,t=c>t?c:t}this.min=r,this.max=t}setFromPoints(e,n){let r=1/0,t=-1/0;for(let i=0,o=n.length;i<o;i++){const a=n[i],c=e.dot(a);r=c<r?c:r,t=c>t?c:t}this.min=r,this.max=t}isSeparated(e){return this.min>e.max||e.min>this.max}}Rn.prototype.setFromBox=function(){const s=new k;return function(n,r){const t=r.min,i=r.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){s.x=t.x*c+i.x*(1-c),s.y=t.y*l+i.y*(1-l),s.z=t.z*u+i.z*(1-u);const f=n.dot(s);o=Math.min(f,o),a=Math.max(f,a)}this.min=o,this.max=a}}();const d3=function(){const s=new k,e=new k,n=new k;return function(t,i,o){const a=t.start,c=s,l=i.start,u=e;n.subVectors(a,l),s.subVectors(t.end,t.start),e.subVectors(i.end,i.start);const f=n.dot(u),A=u.dot(c),d=u.dot(u),x=n.dot(c),v=c.dot(c)*d-A*A;let y,g;v!==0?y=(f*A-x*d)/v:y=0,g=(f+y*A)/d,o.x=y,o.y=g}}(),Gl=function(){const s=new Te,e=new k,n=new k;return function(t,i,o,a){d3(t,i,s);let c=s.x,l=s.y;if(c>=0&&c<=1&&l>=0&&l<=1){t.at(c,o),i.at(l,a);return}else if(c>=0&&c<=1){l<0?i.at(0,a):i.at(1,a),t.closestPointToPoint(a,!0,o);return}else if(l>=0&&l<=1){c<0?t.at(0,o):t.at(1,o),i.closestPointToPoint(o,!0,a);return}else{let u;c<0?u=t.start:u=t.end;let f;l<0?f=i.start:f=i.end;const A=e,d=n;if(t.closestPointToPoint(f,!0,e),i.closestPointToPoint(u,!0,n),A.distanceToSquared(f)<=d.distanceToSquared(u)){o.copy(A),a.copy(f);return}else{o.copy(u),a.copy(d);return}}}}(),m3=function(){const s=new k,e=new k,n=new qn,r=new xn;return function(i,o){const{radius:a,center:c}=i,{a:l,b:u,c:f}=o;if(r.start=l,r.end=u,r.closestPointToPoint(c,!0,s).distanceTo(c)<=a||(r.start=l,r.end=f,r.closestPointToPoint(c,!0,s).distanceTo(c)<=a)||(r.start=u,r.end=f,r.closestPointToPoint(c,!0,s).distanceTo(c)<=a))return!0;const p=o.getPlane(n);if(Math.abs(p.distanceToPoint(c))<=a){const y=p.projectPoint(c,e);if(o.containsPoint(y))return!0}return!1}}(),p3=1e-15;function Mc(s){return Math.abs(s)<p3}class cn extends ar{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new k),this.satBounds=new Array(4).fill().map(()=>new Rn),this.points=[this.a,this.b,this.c],this.sphere=new Oi,this.plane=new qn,this.needsUpdate=!0}intersectsSphere(e){return m3(e,this)}update(){const e=this.a,n=this.b,r=this.c,t=this.points,i=this.satAxes,o=this.satBounds,a=i[0],c=o[0];this.getNormal(a),c.setFromPoints(a,t);const l=i[1],u=o[1];l.subVectors(e,n),u.setFromPoints(l,t);const f=i[2],A=o[2];f.subVectors(n,r),A.setFromPoints(f,t);const d=i[3],x=o[3];d.subVectors(r,e),x.setFromPoints(d,t),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}cn.prototype.closestPointToSegment=function(){const s=new k,e=new k,n=new xn;return function(t,i=null,o=null){const{start:a,end:c}=t,l=this.points;let u,f=1/0;for(let A=0;A<3;A++){const d=(A+1)%3;n.start.copy(l[A]),n.end.copy(l[d]),Gl(n,t,s,e),u=s.distanceToSquared(e),u<f&&(f=u,i&&i.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),u=a.distanceToSquared(s),u<f&&(f=u,i&&i.copy(s),o&&o.copy(a)),this.closestPointToPoint(c,s),u=c.distanceToSquared(s),u<f&&(f=u,i&&i.copy(s),o&&o.copy(c)),Math.sqrt(f)}}();cn.prototype.intersectsTriangle=function(){const s=new cn,e=new Array(3),n=new Array(3),r=new Rn,t=new Rn,i=new k,o=new k,a=new k,c=new k,l=new k,u=new xn,f=new xn,A=new xn,d=new k;function x(p,v,y){const g=p.points;let m=0,_=-1;for(let E=0;E<3;E++){const{start:C,end:w}=u;C.copy(g[E]),w.copy(g[(E+1)%3]),u.delta(o);const I=Mc(v.distanceToPoint(C));if(Mc(v.normal.dot(o))&&I){y.copy(u),m=2;break}const B=v.intersectLine(u,d);if(!B&&I&&d.copy(C),(B||I)&&!Mc(d.distanceTo(w))){if(m<=1)(m===1?y.start:y.end).copy(d),I&&(_=m);else if(m>=2){(_===1?y.start:y.end).copy(d),m=2;break}if(m++,m===2&&_===-1)break}}return m}return function(v,y=null,g=!1){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(s.copy(v),s.update(),v=s);const m=this.plane,_=v.plane;if(Math.abs(m.normal.dot(_.normal))>1-1e-10){const E=this.satBounds,C=this.satAxes;n[0]=v.a,n[1]=v.b,n[2]=v.c;for(let B=0;B<4;B++){const S=E[B],U=C[B];if(r.setFromPoints(U,n),S.isSeparated(r))return!1}const w=v.satBounds,I=v.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let B=0;B<4;B++){const S=w[B],U=I[B];if(r.setFromPoints(U,e),S.isSeparated(r))return!1}for(let B=0;B<4;B++){const S=C[B];for(let U=0;U<4;U++){const b=I[U];if(i.crossVectors(S,b),r.setFromPoints(i,e),t.setFromPoints(i,n),r.isSeparated(t))return!1}}return y&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const E=x(this,_,f);if(E===1&&v.containsPoint(f.end))return y&&(y.start.copy(f.end),y.end.copy(f.end)),!0;if(E!==2)return!1;const C=x(v,m,A);if(C===1&&this.containsPoint(A.end))return y&&(y.start.copy(A.end),y.end.copy(A.end)),!0;if(C!==2)return!1;if(f.delta(a),A.delta(c),a.dot(c)<0){let M=A.start;A.start=A.end,A.end=M}const w=f.start.dot(a),I=f.end.dot(a),B=A.start.dot(a),S=A.end.dot(a),U=I<B,b=w<S;return w!==S&&B!==I&&U===b?!1:(y&&(l.subVectors(f.start,A.start),l.dot(a)>0?y.start.copy(f.start):y.start.copy(A.start),l.subVectors(f.end,A.end),l.dot(a)<0?y.end.copy(f.end):y.end.copy(A.end)),!0)}}}();cn.prototype.distanceToPoint=function(){const s=new k;return function(n){return this.closestPointToPoint(n,s),n.distanceTo(s)}}();cn.prototype.distanceToTriangle=function(){const s=new k,e=new k,n=["a","b","c"],r=new xn,t=new xn;return function(o,a=null,c=null){const l=a||c?r:null;if(this.intersectsTriangle(o,l))return(a||c)&&(a&&l.getCenter(a),c&&l.getCenter(c)),0;let u=1/0;for(let f=0;f<3;f++){let A;const d=n[f],x=o[d];this.closestPointToPoint(x,s),A=x.distanceToSquared(s),A<u&&(u=A,a&&a.copy(s),c&&c.copy(x));const p=this[d];o.closestPointToPoint(p,s),A=p.distanceToSquared(s),A<u&&(u=A,a&&a.copy(p),c&&c.copy(s))}for(let f=0;f<3;f++){const A=n[f],d=n[(f+1)%3];r.set(this[A],this[d]);for(let x=0;x<3;x++){const p=n[x],v=n[(x+1)%3];t.set(o[p],o[v]),Gl(r,t,s,e);const y=s.distanceToSquared(e);y<u&&(u=y,a&&a.copy(s),c&&c.copy(e))}}return Math.sqrt(u)}}();class xi{constructor(e,n,r){this.isOrientedBox=!0,this.min=new k,this.max=new k,this.matrix=new Me,this.invMatrix=new Me,this.points=new Array(8).fill().map(()=>new k),this.satAxes=new Array(3).fill().map(()=>new k),this.satBounds=new Array(3).fill().map(()=>new Rn),this.alignedSatBounds=new Array(3).fill().map(()=>new Rn),this.needsUpdate=!1,e&&this.min.copy(e),n&&this.max.copy(n),r&&this.matrix.copy(r)}set(e,n,r){this.min.copy(e),this.max.copy(n),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}xi.prototype.update=function(){return function(){const e=this.matrix,n=this.min,r=this.max,t=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let f=0;f<=1;f++){const A=1*l|2*u|4*f,d=t[A];d.x=l?r.x:n.x,d.y=u?r.y:n.y,d.z=f?r.z:n.z,d.applyMatrix4(e)}const i=this.satBounds,o=this.satAxes,a=t[0];for(let l=0;l<3;l++){const u=o[l],f=i[l],A=1<<l,d=t[A];u.subVectors(a,d),f.setFromPoints(u,t)}const c=this.alignedSatBounds;c[0].setFromPointsField(t,"x"),c[1].setFromPointsField(t,"y"),c[2].setFromPointsField(t,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();xi.prototype.intersectsBox=function(){const s=new Rn;return function(n){this.needsUpdate&&this.update();const r=n.min,t=n.max,i=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=r.x,s.max=t.x,a[0].isSeparated(s)||(s.min=r.y,s.max=t.y,a[1].isSeparated(s))||(s.min=r.z,s.max=t.z,a[2].isSeparated(s)))return!1;for(let c=0;c<3;c++){const l=o[c],u=i[c];if(s.setFromBox(l,n),u.isSeparated(s))return!1}return!0}}();xi.prototype.intersectsTriangle=function(){const s=new cn,e=new Array(3),n=new Rn,r=new Rn,t=new k;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,c=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let A=0;A<3;A++){const d=a[A],x=c[A];if(n.setFromPoints(x,e),d.isSeparated(n))return!1}const l=o.satBounds,u=o.satAxes,f=this.points;for(let A=0;A<3;A++){const d=l[A],x=u[A];if(n.setFromPoints(x,f),d.isSeparated(n))return!1}for(let A=0;A<3;A++){const d=c[A];for(let x=0;x<4;x++){const p=u[x];if(t.crossVectors(d,p),n.setFromPoints(t,e),r.setFromPoints(t,f),n.isSeparated(r))return!1}}return!0}}();xi.prototype.closestPointToPoint=function(){return function(e,n){return this.needsUpdate&&this.update(),n.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),n}}();xi.prototype.distanceToPoint=function(){const s=new k;return function(n){return this.closestPointToPoint(n,s),n.distanceTo(s)}}();xi.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new xn),n=new Array(12).fill().map(()=>new xn),r=new k,t=new k;return function(o,a=0,c=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||l)&&(o.getCenter(t),this.closestPointToPoint(t,r),o.closestPointToPoint(r,t),c&&c.copy(r),l&&l.copy(t)),0;const u=a*a,f=o.min,A=o.max,d=this.points;let x=1/0;for(let v=0;v<8;v++){const y=d[v];t.copy(y).clamp(f,A);const g=y.distanceToSquared(t);if(g<x&&(x=g,c&&c.copy(y),l&&l.copy(t),g<u))return Math.sqrt(g)}let p=0;for(let v=0;v<3;v++)for(let y=0;y<=1;y++)for(let g=0;g<=1;g++){const m=(v+1)%3,_=(v+2)%3,E=y<<m|g<<_,C=1<<v|y<<m|g<<_,w=d[E],I=d[C];e[p].set(w,I);const S=s[v],U=s[m],b=s[_],M=n[p],D=M.start,N=M.end;D[S]=f[S],D[U]=y?f[U]:A[U],D[b]=g?f[b]:A[U],N[S]=A[S],N[U]=y?f[U]:A[U],N[b]=g?f[b]:A[U],p++}for(let v=0;v<=1;v++)for(let y=0;y<=1;y++)for(let g=0;g<=1;g++){t.x=v?A.x:f.x,t.y=y?A.y:f.y,t.z=g?A.z:f.z,this.closestPointToPoint(t,r);const m=t.distanceToSquared(r);if(m<x&&(x=m,c&&c.copy(r),l&&l.copy(t),m<u))return Math.sqrt(m)}for(let v=0;v<12;v++){const y=e[v];for(let g=0;g<12;g++){const m=n[g];Gl(y,m,r,t);const _=r.distanceToSquared(t);if(_<x&&(x=_,c&&c.copy(r),l&&l.copy(t),_<u))return Math.sqrt(_)}}return Math.sqrt(x)}}();class Hl{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class g3 extends Hl{constructor(){super(()=>new cn)}}const Xi=new g3;class y3{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let n=null;this.setBuffer=r=>{n&&e.push(n),n=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{n=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Dt=new y3;let Nn,Yr;const br=[],So=new Hl(()=>new Rt);function v3(s,e,n,r,t,i){Nn=So.getPrimitive(),Yr=So.getPrimitive(),br.push(Nn,Yr),Dt.setBuffer(s._roots[e]);const o=ml(0,s.geometry,n,r,t,i);Dt.clearBuffer(),So.releasePrimitive(Nn),So.releasePrimitive(Yr),br.pop(),br.pop();const a=br.length;return a>0&&(Yr=br[a-1],Nn=br[a-2]),o}function ml(s,e,n,r,t=null,i=0,o=0){const{float32Array:a,uint16Array:c,uint32Array:l}=Dt;let u=s*2;if(vi(u,c)){const A=Si(s,l),d=Fi(u,c);return Ut(s,a,Nn),r(A,d,!1,o,i+s,Nn)}else{let S=function(b){const{uint16Array:M,uint32Array:D}=Dt;let N=b*2;for(;!vi(N,M);)b=qi(b),N=b*2;return Si(b,D)},U=function(b){const{uint16Array:M,uint32Array:D}=Dt;let N=b*2;for(;!vi(N,M);)b=Ui(b,D),N=b*2;return Si(b,D)+Fi(N,M)};const A=qi(s),d=Ui(s,l);let x=A,p=d,v,y,g,m;if(t&&(g=Nn,m=Yr,Ut(x,a,g),Ut(p,a,m),v=t(g),y=t(m),y<v)){x=d,p=A;const b=v;v=y,y=b,g=m}g||(g=Nn,Ut(x,a,g));const _=vi(x*2,c),E=n(g,_,v,o+1,i+x);let C;if(E===x0){const b=S(x),D=U(x)-b;C=r(b,D,!0,o+1,i+x,g)}else C=E&&ml(x,e,n,r,t,i,o+1);if(C)return!0;m=Yr,Ut(p,a,m);const w=vi(p*2,c),I=n(m,w,y,o+1,i+p);let B;if(I===x0){const b=S(p),D=U(p)-b;B=r(b,D,!0,o+1,i+p,m)}else B=I&&ml(p,e,n,r,t,i,o+1);return!!B}}const bs=new k,Tc=new k;function E3(s,e,n={},r=0,t=1/0){const i=r*r,o=t*t;let a=1/0,c=null;if(s.shapecast({boundsTraverseOrder:u=>(bs.copy(e).clamp(u.min,u.max),bs.distanceToSquared(e)),intersectsBounds:(u,f,A)=>A<a&&A<o,intersectsTriangle:(u,f)=>{u.closestPointToPoint(e,bs);const A=e.distanceToSquared(bs);return A<a&&(Tc.copy(bs),a=A,c=f),A<i}}),a===1/0)return null;const l=Math.sqrt(a);return n.point?n.point.copy(Tc):n.point=Tc.clone(),n.distance=l,n.faceIndex=c,n}const x3=parseInt(pa)>=169,nr=new k,rr=new k,sr=new k,Mo=new Te,To=new Te,Do=new Te,b0=new k,B0=new k,S0=new k,Bs=new k;function _3(s,e,n,r,t,i,o,a){let c;if(i===Kr?c=s.intersectTriangle(r,n,e,!0,t):c=s.intersectTriangle(e,n,r,i!==Jt,t),c===null)return null;const l=s.origin.distanceTo(t);return l<o||l>a?null:{distance:l,point:t.clone()}}function C3(s,e,n,r,t,i,o,a,c,l,u){nr.fromBufferAttribute(e,i),rr.fromBufferAttribute(e,o),sr.fromBufferAttribute(e,a);const f=_3(s,nr,rr,sr,Bs,c,l,u);if(f){const A=new k;ar.getBarycoord(Bs,nr,rr,sr,A),r&&(Mo.fromBufferAttribute(r,i),To.fromBufferAttribute(r,o),Do.fromBufferAttribute(r,a),f.uv=ar.getInterpolation(Bs,nr,rr,sr,Mo,To,Do,new Te)),t&&(Mo.fromBufferAttribute(t,i),To.fromBufferAttribute(t,o),Do.fromBufferAttribute(t,a),f.uv1=ar.getInterpolation(Bs,nr,rr,sr,Mo,To,Do,new Te)),n&&(b0.fromBufferAttribute(n,i),B0.fromBufferAttribute(n,o),S0.fromBufferAttribute(n,a),f.normal=ar.getInterpolation(Bs,nr,rr,sr,b0,B0,S0,new k),f.normal.dot(s.direction)>0&&f.normal.multiplyScalar(-1));const d={a:i,b:o,c:a,normal:new k,materialIndex:0};ar.getNormal(nr,rr,sr,d.normal),f.face=d,f.faceIndex=i,x3&&(f.barycoord=A)}return f}function ba(s,e,n,r,t,i,o){const a=r*3;let c=a+0,l=a+1,u=a+2;const f=s.index;s.index&&(c=f.getX(c),l=f.getX(l),u=f.getX(u));const{position:A,normal:d,uv:x,uv1:p}=s.attributes,v=C3(n,A,d,x,p,c,l,u,e,i,o);return v?(v.faceIndex=r,t&&t.push(v),v):null}function Yt(s,e,n,r){const t=s.a,i=s.b,o=s.c;let a=e,c=e+1,l=e+2;n&&(a=n.getX(a),c=n.getX(c),l=n.getX(l)),t.x=r.getX(a),t.y=r.getY(a),t.z=r.getZ(a),i.x=r.getX(c),i.y=r.getY(c),i.z=r.getZ(c),o.x=r.getX(l),o.y=r.getY(l),o.z=r.getZ(l)}function w3(s,e,n,r,t,i,o,a){const{geometry:c,_indirectBuffer:l}=s;for(let u=r,f=r+t;u<f;u++)ba(c,e,n,u,i,o,a)}function I3(s,e,n,r,t,i,o){const{geometry:a,_indirectBuffer:c}=s;let l=1/0,u=null;for(let f=r,A=r+t;f<A;f++){let d;d=ba(a,e,n,f,null,i,o),d&&d.distance<l&&(u=d,l=d.distance)}return u}function b3(s,e,n,r,t,i,o){const{geometry:a}=n,{index:c}=a,l=a.attributes.position;for(let u=s,f=e+s;u<f;u++){let A;if(A=u,Yt(o,A*3,c,l),o.needsUpdate=!0,r(o,A,t,i))return!0}return!1}function B3(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=s.geometry,r=n.index?n.index.array:null,t=n.attributes.position;let i,o,a,c,l=0;const u=s._roots;for(let A=0,d=u.length;A<d;A++)i=u[A],o=new Uint32Array(i),a=new Uint16Array(i),c=new Float32Array(i),f(0,l),l+=i.byteLength;function f(A,d,x=!1){const p=A*2;if(a[p+15]===Ia){const y=o[A+6],g=a[p+14];let m=1/0,_=1/0,E=1/0,C=-1/0,w=-1/0,I=-1/0;for(let B=3*y,S=3*(y+g);B<S;B++){let U=r[B];const b=t.getX(U),M=t.getY(U),D=t.getZ(U);b<m&&(m=b),b>C&&(C=b),M<_&&(_=M),M>w&&(w=M),D<E&&(E=D),D>I&&(I=D)}return c[A+0]!==m||c[A+1]!==_||c[A+2]!==E||c[A+3]!==C||c[A+4]!==w||c[A+5]!==I?(c[A+0]=m,c[A+1]=_,c[A+2]=E,c[A+3]=C,c[A+4]=w,c[A+5]=I,!0):!1}else{const y=A+8,g=o[A+6],m=y+d,_=g+d;let E=x,C=!1,w=!1;e?E||(C=e.has(m),w=e.has(_),E=!C&&!w):(C=!0,w=!0);const I=E||C,B=E||w;let S=!1;I&&(S=f(y,d,E));let U=!1;B&&(U=f(g,d,E));const b=S||U;if(b)for(let M=0;M<3;M++){const D=y+M,N=g+M,G=c[D],q=c[D+3],X=c[N],O=c[N+3];c[A+M]=G<X?G:X,c[A+M+3]=q>O?q:O}return b}}}function jn(s,e,n,r,t){let i,o,a,c,l,u;const f=1/n.direction.x,A=1/n.direction.y,d=1/n.direction.z,x=n.origin.x,p=n.origin.y,v=n.origin.z;let y=e[s],g=e[s+3],m=e[s+1],_=e[s+3+1],E=e[s+2],C=e[s+3+2];return f>=0?(i=(y-x)*f,o=(g-x)*f):(i=(g-x)*f,o=(y-x)*f),A>=0?(a=(m-p)*A,c=(_-p)*A):(a=(_-p)*A,c=(m-p)*A),i>c||a>o||((a>i||isNaN(i))&&(i=a),(c<o||isNaN(o))&&(o=c),d>=0?(l=(E-v)*d,u=(C-v)*d):(l=(C-v)*d,u=(E-v)*d),i>u||l>o)?!1:((l>i||i!==i)&&(i=l),(u<o||o!==o)&&(o=u),i<=t&&o>=r)}function S3(s,e,n,r,t,i,o,a){const{geometry:c,_indirectBuffer:l}=s;for(let u=r,f=r+t;u<f;u++){let A=l?l[u]:u;ba(c,e,n,A,i,o,a)}}function M3(s,e,n,r,t,i,o){const{geometry:a,_indirectBuffer:c}=s;let l=1/0,u=null;for(let f=r,A=r+t;f<A;f++){let d;d=ba(a,e,n,c?c[f]:f,null,i,o),d&&d.distance<l&&(u=d,l=d.distance)}return u}function T3(s,e,n,r,t,i,o){const{geometry:a}=n,{index:c}=a,l=a.attributes.position;for(let u=s,f=e+s;u<f;u++){let A;if(A=n.resolveTriangleIndex(u),Yt(o,A*3,c,l),o.needsUpdate=!0,r(o,A,t,i))return!0}return!1}function D3(s,e,n,r,t,i,o){Dt.setBuffer(s._roots[e]),pl(0,s,n,r,t,i,o),Dt.clearBuffer()}function pl(s,e,n,r,t,i,o){const{float32Array:a,uint16Array:c,uint32Array:l}=Dt,u=s*2;if(vi(u,c)){const A=Si(s,l),d=Fi(u,c);w3(e,n,r,A,d,t,i,o)}else{const A=qi(s);jn(A,a,r,i,o)&&pl(A,e,n,r,t,i,o);const d=Ui(s,l);jn(d,a,r,i,o)&&pl(d,e,n,r,t,i,o)}}const R3=["x","y","z"];function P3(s,e,n,r,t,i){Dt.setBuffer(s._roots[e]);const o=gl(0,s,n,r,t,i);return Dt.clearBuffer(),o}function gl(s,e,n,r,t,i){const{float32Array:o,uint16Array:a,uint32Array:c}=Dt;let l=s*2;if(vi(l,a)){const f=Si(s,c),A=Fi(l,a);return I3(e,n,r,f,A,t,i)}else{const f=Nl(s,c),A=R3[f],x=r.direction[A]>=0;let p,v;x?(p=qi(s),v=Ui(s,c)):(p=Ui(s,c),v=qi(s));const g=jn(p,o,r,t,i)?gl(p,e,n,r,t,i):null;if(g){const E=g.point[A];if(x?E<=o[v+f]:E>=o[v+f+3])return g}const _=jn(v,o,r,t,i)?gl(v,e,n,r,t,i):null;return g&&_?g.distance<=_.distance?g:_:g||_||null}}const Ro=new Rt,Br=new cn,Sr=new cn,Ss=new Me,M0=new xi,Po=new xi;function Q3(s,e,n,r){Dt.setBuffer(s._roots[e]);const t=yl(0,s,n,r);return Dt.clearBuffer(),t}function yl(s,e,n,r,t=null){const{float32Array:i,uint16Array:o,uint32Array:a}=Dt;let c=s*2;if(t===null&&(n.boundingBox||n.computeBoundingBox(),M0.set(n.boundingBox.min,n.boundingBox.max,r),t=M0),vi(c,o)){const u=e.geometry,f=u.index,A=u.attributes.position,d=n.index,x=n.attributes.position,p=Si(s,a),v=Fi(c,o);if(Ss.copy(r).invert(),n.boundsTree)return Ut(s,i,Po),Po.matrix.copy(Ss),Po.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:g=>Po.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(r),g.b.applyMatrix4(r),g.c.applyMatrix4(r),g.needsUpdate=!0;for(let m=p*3,_=(v+p)*3;m<_;m+=3)if(Yt(Sr,m,f,A),Sr.needsUpdate=!0,g.intersectsTriangle(Sr))return!0;return!1}});for(let y=p*3,g=(v+p)*3;y<g;y+=3){Yt(Br,y,f,A),Br.a.applyMatrix4(Ss),Br.b.applyMatrix4(Ss),Br.c.applyMatrix4(Ss),Br.needsUpdate=!0;for(let m=0,_=d.count;m<_;m+=3)if(Yt(Sr,m,d,x),Sr.needsUpdate=!0,Br.intersectsTriangle(Sr))return!0}}else{const u=s+8,f=a[s+6];return Ut(u,i,Ro),!!(t.intersectsBox(Ro)&&yl(u,e,n,r,t)||(Ut(f,i,Ro),t.intersectsBox(Ro)&&yl(f,e,n,r,t)))}}const Qo=new Me,Dc=new xi,Ms=new xi,z3=new k,F3=new k,U3=new k,k3=new k;function L3(s,e,n,r={},t={},i=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Dc.set(e.boundingBox.min,e.boundingBox.max,n),Dc.needsUpdate=!0;const a=s.geometry,c=a.attributes.position,l=a.index,u=e.attributes.position,f=e.index,A=Xi.getPrimitive(),d=Xi.getPrimitive();let x=z3,p=F3,v=null,y=null;t&&(v=U3,y=k3);let g=1/0,m=null,_=null;return Qo.copy(n).invert(),Ms.matrix.copy(Qo),s.shapecast({boundsTraverseOrder:E=>Dc.distanceToBox(E),intersectsBounds:(E,C,w)=>w<g&&w<o?(C&&(Ms.min.copy(E.min),Ms.max.copy(E.max),Ms.needsUpdate=!0),!0):!1,intersectsRange:(E,C)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:I=>Ms.distanceToBox(I),intersectsBounds:(I,B,S)=>S<g&&S<o,intersectsRange:(I,B)=>{for(let S=I,U=I+B;S<U;S++){Yt(d,3*S,f,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(let b=E,M=E+C;b<M;b++){Yt(A,3*b,l,c),A.needsUpdate=!0;const D=A.distanceToTriangle(d,x,v);if(D<g&&(p.copy(x),y&&y.copy(v),g=D,m=b,_=S),D<i)return!0}}}});{const w=es(e);for(let I=0,B=w;I<B;I++){Yt(d,3*I,f,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(let S=E,U=E+C;S<U;S++){Yt(A,3*S,l,c),A.needsUpdate=!0;const b=A.distanceToTriangle(d,x,v);if(b<g&&(p.copy(x),y&&y.copy(v),g=b,m=S,_=I),b<i)return!0}}}}}),Xi.releasePrimitive(A),Xi.releasePrimitive(d),g===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=g,r.faceIndex=m,t&&(t.point?t.point.copy(y):t.point=y.clone(),t.point.applyMatrix4(Qo),p.applyMatrix4(Qo),t.distance=p.sub(t.point).length(),t.faceIndex=_),r)}function O3(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=s.geometry,r=n.index?n.index.array:null,t=n.attributes.position;let i,o,a,c,l=0;const u=s._roots;for(let A=0,d=u.length;A<d;A++)i=u[A],o=new Uint32Array(i),a=new Uint16Array(i),c=new Float32Array(i),f(0,l),l+=i.byteLength;function f(A,d,x=!1){const p=A*2;if(a[p+15]===Ia){const y=o[A+6],g=a[p+14];let m=1/0,_=1/0,E=1/0,C=-1/0,w=-1/0,I=-1/0;for(let B=y,S=y+g;B<S;B++){const U=3*s.resolveTriangleIndex(B);for(let b=0;b<3;b++){let M=U+b;M=r?r[M]:M;const D=t.getX(M),N=t.getY(M),G=t.getZ(M);D<m&&(m=D),D>C&&(C=D),N<_&&(_=N),N>w&&(w=N),G<E&&(E=G),G>I&&(I=G)}}return c[A+0]!==m||c[A+1]!==_||c[A+2]!==E||c[A+3]!==C||c[A+4]!==w||c[A+5]!==I?(c[A+0]=m,c[A+1]=_,c[A+2]=E,c[A+3]=C,c[A+4]=w,c[A+5]=I,!0):!1}else{const y=A+8,g=o[A+6],m=y+d,_=g+d;let E=x,C=!1,w=!1;e?E||(C=e.has(m),w=e.has(_),E=!C&&!w):(C=!0,w=!0);const I=E||C,B=E||w;let S=!1;I&&(S=f(y,d,E));let U=!1;B&&(U=f(g,d,E));const b=S||U;if(b)for(let M=0;M<3;M++){const D=y+M,N=g+M,G=c[D],q=c[D+3],X=c[N],O=c[N+3];c[A+M]=G<X?G:X,c[A+M+3]=q>O?q:O}return b}}}function N3(s,e,n,r,t,i,o){Dt.setBuffer(s._roots[e]),vl(0,s,n,r,t,i,o),Dt.clearBuffer()}function vl(s,e,n,r,t,i,o){const{float32Array:a,uint16Array:c,uint32Array:l}=Dt,u=s*2;if(vi(u,c)){const A=Si(s,l),d=Fi(u,c);S3(e,n,r,A,d,t,i,o)}else{const A=qi(s);jn(A,a,r,i,o)&&vl(A,e,n,r,t,i,o);const d=Ui(s,l);jn(d,a,r,i,o)&&vl(d,e,n,r,t,i,o)}}const G3=["x","y","z"];function H3(s,e,n,r,t,i){Dt.setBuffer(s._roots[e]);const o=El(0,s,n,r,t,i);return Dt.clearBuffer(),o}function El(s,e,n,r,t,i){const{float32Array:o,uint16Array:a,uint32Array:c}=Dt;let l=s*2;if(vi(l,a)){const f=Si(s,c),A=Fi(l,a);return M3(e,n,r,f,A,t,i)}else{const f=Nl(s,c),A=G3[f],x=r.direction[A]>=0;let p,v;x?(p=qi(s),v=Ui(s,c)):(p=Ui(s,c),v=qi(s));const g=jn(p,o,r,t,i)?El(p,e,n,r,t,i):null;if(g){const E=g.point[A];if(x?E<=o[v+f]:E>=o[v+f+3])return g}const _=jn(v,o,r,t,i)?El(v,e,n,r,t,i):null;return g&&_?g.distance<=_.distance?g:_:g||_||null}}const zo=new Rt,Mr=new cn,Tr=new cn,Ts=new Me,T0=new xi,Fo=new xi;function V3(s,e,n,r){Dt.setBuffer(s._roots[e]);const t=xl(0,s,n,r);return Dt.clearBuffer(),t}function xl(s,e,n,r,t=null){const{float32Array:i,uint16Array:o,uint32Array:a}=Dt;let c=s*2;if(t===null&&(n.boundingBox||n.computeBoundingBox(),T0.set(n.boundingBox.min,n.boundingBox.max,r),t=T0),vi(c,o)){const u=e.geometry,f=u.index,A=u.attributes.position,d=n.index,x=n.attributes.position,p=Si(s,a),v=Fi(c,o);if(Ts.copy(r).invert(),n.boundsTree)return Ut(s,i,Fo),Fo.matrix.copy(Ts),Fo.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:g=>Fo.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(r),g.b.applyMatrix4(r),g.c.applyMatrix4(r),g.needsUpdate=!0;for(let m=p,_=v+p;m<_;m++)if(Yt(Tr,3*e.resolveTriangleIndex(m),f,A),Tr.needsUpdate=!0,g.intersectsTriangle(Tr))return!0;return!1}});for(let y=p,g=v+p;y<g;y++){const m=e.resolveTriangleIndex(y);Yt(Mr,3*m,f,A),Mr.a.applyMatrix4(Ts),Mr.b.applyMatrix4(Ts),Mr.c.applyMatrix4(Ts),Mr.needsUpdate=!0;for(let _=0,E=d.count;_<E;_+=3)if(Yt(Tr,_,d,x),Tr.needsUpdate=!0,Mr.intersectsTriangle(Tr))return!0}}else{const u=s+8,f=a[s+6];return Ut(u,i,zo),!!(t.intersectsBox(zo)&&xl(u,e,n,r,t)||(Ut(f,i,zo),t.intersectsBox(zo)&&xl(f,e,n,r,t)))}}const Uo=new Me,Rc=new xi,Ds=new xi,W3=new k,Y3=new k,j3=new k,q3=new k;function X3(s,e,n,r={},t={},i=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Rc.set(e.boundingBox.min,e.boundingBox.max,n),Rc.needsUpdate=!0;const a=s.geometry,c=a.attributes.position,l=a.index,u=e.attributes.position,f=e.index,A=Xi.getPrimitive(),d=Xi.getPrimitive();let x=W3,p=Y3,v=null,y=null;t&&(v=j3,y=q3);let g=1/0,m=null,_=null;return Uo.copy(n).invert(),Ds.matrix.copy(Uo),s.shapecast({boundsTraverseOrder:E=>Rc.distanceToBox(E),intersectsBounds:(E,C,w)=>w<g&&w<o?(C&&(Ds.min.copy(E.min),Ds.max.copy(E.max),Ds.needsUpdate=!0),!0):!1,intersectsRange:(E,C)=>{if(e.boundsTree){const w=e.boundsTree;return w.shapecast({boundsTraverseOrder:I=>Ds.distanceToBox(I),intersectsBounds:(I,B,S)=>S<g&&S<o,intersectsRange:(I,B)=>{for(let S=I,U=I+B;S<U;S++){const b=w.resolveTriangleIndex(S);Yt(d,3*b,f,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(let M=E,D=E+C;M<D;M++){const N=s.resolveTriangleIndex(M);Yt(A,3*N,l,c),A.needsUpdate=!0;const G=A.distanceToTriangle(d,x,v);if(G<g&&(p.copy(x),y&&y.copy(v),g=G,m=M,_=S),G<i)return!0}}}})}else{const w=es(e);for(let I=0,B=w;I<B;I++){Yt(d,3*I,f,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(let S=E,U=E+C;S<U;S++){const b=s.resolveTriangleIndex(S);Yt(A,3*b,l,c),A.needsUpdate=!0;const M=A.distanceToTriangle(d,x,v);if(M<g&&(p.copy(x),y&&y.copy(v),g=M,m=S,_=I),M<i)return!0}}}}}),Xi.releasePrimitive(A),Xi.releasePrimitive(d),g===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=g,r.faceIndex=m,t&&(t.point?t.point.copy(y):t.point=y.clone(),t.point.applyMatrix4(Uo),p.applyMatrix4(Uo),t.distance=p.sub(t.point).length(),t.faceIndex=_),r)}function K3(){return typeof SharedArrayBuffer<"u"}const Ys=new Dt.constructor,ua=new Dt.constructor,On=new Hl(()=>new Rt),Dr=new Rt,Rr=new Rt,Pc=new Rt,Qc=new Rt;let zc=!1;function Z3(s,e,n,r){if(zc)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");zc=!0;const t=s._roots,i=e._roots;let o,a=0,c=0;const l=new Me().copy(n).invert();for(let u=0,f=t.length;u<f;u++){Ys.setBuffer(t[u]),c=0;const A=On.getPrimitive();Ut(0,Ys.float32Array,A),A.applyMatrix4(l);for(let d=0,x=i.length;d<x&&(ua.setBuffer(i[d]),o=on(0,0,n,l,r,a,c,0,0,A),ua.clearBuffer(),c+=i[d].length,!o);d++);if(On.releasePrimitive(A),Ys.clearBuffer(),a+=t[u].length,o)break}return zc=!1,o}function on(s,e,n,r,t,i=0,o=0,a=0,c=0,l=null,u=!1){let f,A;u?(f=ua,A=Ys):(f=Ys,A=ua);const d=f.float32Array,x=f.uint32Array,p=f.uint16Array,v=A.float32Array,y=A.uint32Array,g=A.uint16Array,m=s*2,_=e*2,E=vi(m,p),C=vi(_,g);let w=!1;if(C&&E)u?w=t(Si(e,y),Fi(e*2,g),Si(s,x),Fi(s*2,p),c,o+e,a,i+s):w=t(Si(s,x),Fi(s*2,p),Si(e,y),Fi(e*2,g),a,i+s,c,o+e);else if(C){const I=On.getPrimitive();Ut(e,v,I),I.applyMatrix4(n);const B=qi(s),S=Ui(s,x);Ut(B,d,Dr),Ut(S,d,Rr);const U=I.intersectsBox(Dr),b=I.intersectsBox(Rr);w=U&&on(e,B,r,n,t,o,i,c,a+1,I,!u)||b&&on(e,S,r,n,t,o,i,c,a+1,I,!u),On.releasePrimitive(I)}else{const I=qi(e),B=Ui(e,y);Ut(I,v,Pc),Ut(B,v,Qc);const S=l.intersectsBox(Pc),U=l.intersectsBox(Qc);if(S&&U)w=on(s,I,n,r,t,i,o,a,c+1,l,u)||on(s,B,n,r,t,i,o,a,c+1,l,u);else if(S)if(E)w=on(s,I,n,r,t,i,o,a,c+1,l,u);else{const b=On.getPrimitive();b.copy(Pc).applyMatrix4(n);const M=qi(s),D=Ui(s,x);Ut(M,d,Dr),Ut(D,d,Rr);const N=b.intersectsBox(Dr),G=b.intersectsBox(Rr);w=N&&on(I,M,r,n,t,o,i,c,a+1,b,!u)||G&&on(I,D,r,n,t,o,i,c,a+1,b,!u),On.releasePrimitive(b)}else if(U)if(E)w=on(s,B,n,r,t,i,o,a,c+1,l,u);else{const b=On.getPrimitive();b.copy(Qc).applyMatrix4(n);const M=qi(s),D=Ui(s,x);Ut(M,d,Dr),Ut(D,d,Rr);const N=b.intersectsBox(Dr),G=b.intersectsBox(Rr);w=N&&on(B,M,r,n,t,o,i,c,a+1,b,!u)||G&&on(B,D,r,n,t,o,i,c,a+1,b,!u),On.releasePrimitive(b)}}return w}const ko=new xi,D0=new Rt,J3={strategy:lf,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Ba{static serialize(e,n={}){n={cloneBuffers:!0,...n};const r=e.geometry,t=e._roots,i=e._indirectBuffer,o=r.getIndex();let a;return n.cloneBuffers?a={roots:t.map(c=>c.slice()),index:o?o.array.slice():null,indirectBuffer:i?i.slice():null}:a={roots:t,index:o?o.array:null,indirectBuffer:i},a}static deserialize(e,n,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};const{index:t,roots:i,indirectBuffer:o}=e,a=new Ba(n,{...r,[bc]:!0});if(a._roots=i,a._indirectBuffer=o||null,r.setIndex){const c=n.getIndex();if(c===null){const l=new Nt(e.index,1,!1);n.setIndex(l)}else c.array!==t&&(c.array.set(t),c.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,n={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(n=Object.assign({...J3,[bc]:!1},n),n.useSharedArrayBuffer&&!K3())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,n[bc]||(A3(this,n),!e.boundingBox&&n.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Rt))),this.resolveTriangleIndex=n.indirect?r=>this._indirectBuffer[r]:r=>r}refit(e=null){return(this.indirect?O3:B3)(this,e)}traverse(e,n=0){const r=this._roots[n],t=new Uint32Array(r),i=new Uint16Array(r);o(0);function o(a,c=0){const l=a*2,u=i[l+15]===Ia;if(u){const f=t[a+6],A=i[l+14];e(c,u,new Float32Array(r,a*4,6),f,A)}else{const f=a+Gn/4,A=t[a+6],d=t[a+7];e(c,u,new Float32Array(r,a*4,6),d)||(o(f,c+1),o(A,c+1))}}}raycast(e,n=ca,r=0,t=1/0){const i=this._roots,o=this.geometry,a=[],c=n.isMaterial,l=Array.isArray(n),u=o.groups,f=c?n.side:n,A=this.indirect?N3:D3;for(let d=0,x=i.length;d<x;d++){const p=l?n[u[d].materialIndex].side:f,v=a.length;if(A(this,d,p,e,a,r,t),l){const y=u[d].materialIndex;for(let g=v,m=a.length;g<m;g++)a[g].face.materialIndex=y}}return a}raycastFirst(e,n=ca,r=0,t=1/0){const i=this._roots,o=this.geometry,a=n.isMaterial,c=Array.isArray(n);let l=null;const u=o.groups,f=a?n.side:n,A=this.indirect?H3:P3;for(let d=0,x=i.length;d<x;d++){const p=c?n[u[d].materialIndex].side:f,v=A(this,d,p,e,r,t);v!=null&&(l==null||v.distance<l.distance)&&(l=v,c&&(v.face.materialIndex=u[d].materialIndex))}return l}intersectsGeometry(e,n){let r=!1;const t=this._roots,i=this.indirect?V3:Q3;for(let o=0,a=t.length;o<a&&(r=i(this,o,e,n),!r);o++);return r}shapecast(e){const n=Xi.getPrimitive(),r=this.indirect?T3:b3;let{boundsTraverseOrder:t,intersectsBounds:i,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const f=o;o=(A,d,x,p,v)=>f(A,d,x,p,v)?!0:r(A,d,this,a,x,p,n)}else o||(a?o=(f,A,d,x)=>r(f,A,this,a,d,x,n):o=(f,A,d)=>d);let c=!1,l=0;const u=this._roots;for(let f=0,A=u.length;f<A;f++){const d=u[f];if(c=v3(this,f,i,o,t,l),c)break;l+=d.byteLength}return Xi.releasePrimitive(n),c}bvhcast(e,n,r){let{intersectsRanges:t,intersectsTriangles:i}=r;const o=Xi.getPrimitive(),a=this.geometry.index,c=this.geometry.attributes.position,l=this.indirect?x=>{const p=this.resolveTriangleIndex(x);Yt(o,p*3,a,c)}:x=>{Yt(o,x*3,a,c)},u=Xi.getPrimitive(),f=e.geometry.index,A=e.geometry.attributes.position,d=e.indirect?x=>{const p=e.resolveTriangleIndex(x);Yt(u,p*3,f,A)}:x=>{Yt(u,x*3,f,A)};if(i){const x=(p,v,y,g,m,_,E,C)=>{for(let w=y,I=y+g;w<I;w++){d(w),u.a.applyMatrix4(n),u.b.applyMatrix4(n),u.c.applyMatrix4(n),u.needsUpdate=!0;for(let B=p,S=p+v;B<S;B++)if(l(B),o.needsUpdate=!0,i(o,u,B,w,m,_,E,C))return!0}return!1};if(t){const p=t;t=function(v,y,g,m,_,E,C,w){return p(v,y,g,m,_,E,C,w)?!0:x(v,y,g,m,_,E,C,w)}}else t=x}return Z3(this,e,n,t)}intersectsBox(e,n){return ko.set(e.min,e.max,n),ko.needsUpdate=!0,this.shapecast({intersectsBounds:r=>ko.intersectsBox(r),intersectsTriangle:r=>ko.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:n=>e.intersectsBox(n),intersectsTriangle:n=>n.intersectsSphere(e)})}closestPointToGeometry(e,n,r={},t={},i=0,o=1/0){return(this.indirect?X3:L3)(this,e,n,r,t,i,o)}closestPointToPoint(e,n={},r=0,t=1/0){return E3(this,e,n,r,t)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(r=>{Ut(0,new Float32Array(r),D0),e.union(D0)}),e}}function R0(s,e,n){return s===null?null:(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(n.ray.origin),s.object=e,s)}const Lo=new Zs,P0=new k,Q0=new Me,$3=Qe.prototype.raycast,eg=BA.prototype.raycast,z0=new k,ci=new Qe,Oo=[];function pf(s,e){this.isBatchedMesh?tg.call(this,s,e):ig.call(this,s,e)}function tg(s,e){if(this.boundsTrees){const n=this.boundsTrees,r=this._drawInfo||this._instanceInfo,t=this._drawRanges||this._geometryInfo,i=this.matrixWorld;ci.material=this.material,ci.geometry=this.geometry;const o=ci.geometry.boundsTree,a=ci.geometry.drawRange;ci.geometry.boundingSphere===null&&(ci.geometry.boundingSphere=new Oi);for(let c=0,l=r.length;c<l;c++){if(!this.getVisibleAt(c))continue;const u=r[c].geometryIndex;if(ci.geometry.boundsTree=n[u],this.getMatrixAt(c,ci.matrixWorld).premultiply(i),!ci.geometry.boundsTree){this.getBoundingBoxAt(u,ci.geometry.boundingBox),this.getBoundingSphereAt(u,ci.geometry.boundingSphere);const f=t[u];ci.geometry.setDrawRange(f.start,f.count)}ci.raycast(s,Oo);for(let f=0,A=Oo.length;f<A;f++){const d=Oo[f];d.object=this,d.batchId=c,e.push(d)}Oo.length=0}ci.geometry.boundsTree=o,ci.geometry.drawRange=a,ci.material=null,ci.geometry=null}else eg.call(this,s,e)}function ig(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;Q0.copy(this.matrixWorld).invert(),Lo.copy(s.ray).applyMatrix4(Q0),z0.setFromMatrixScale(this.matrixWorld),P0.copy(Lo.direction).multiply(z0);const n=P0.length(),r=s.near/n,t=s.far/n,i=this.geometry.boundsTree;if(s.firstHitOnly===!0){const o=R0(i.raycastFirst(Lo,this.material,r,t),this,s);o&&e.push(o)}else{const o=i.raycast(Lo,this.material,r,t);for(let a=0,c=o.length;a<c;a++){const l=R0(o[a],this,s);l&&e.push(l)}}}else $3.call(this,s,e)}function gf(s={}){return this.boundsTree=new Ba(this,s),this.boundsTree}function yf(){this.boundsTree=null}function ng(s){switch(s){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function rg(s){switch(s){case 1:return En;case 2:return Gr;case 3:return Wt;case 4:return Wt}}function F0(s){switch(s){case 1:return SA;case 2:return s1;case 3:return oa;case 4:return oa}}class vf extends Vn{constructor(){super(),this.minFilter=Mt,this.magFilter=Mt,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const n=this.overrideItemSize,r=e.itemSize,t=e.count;if(n!==null){if(r*t%n!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=n,e.count=t*r/n}const i=e.itemSize,o=e.count,a=e.normalized,c=e.array.constructor,l=c.BYTES_PER_ELEMENT;let u=this._forcedType,f=i;if(u===null)switch(c){case Float32Array:u=Tt;break;case Uint8Array:case Uint16Array:case Uint32Array:u=lr;break;case Int8Array:case Int16Array:case Int32Array:u=$o;break}let A,d,x,p,v=ng(i);switch(u){case Tt:x=1,d=rg(i),a&&l===1?(p=c,v+="8",c===Uint8Array?A=ni:(A=nl,v+="_SNORM")):(p=Float32Array,v+="32F",A=Tt);break;case $o:v+=l*8+"I",x=a?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,d=F0(i),l===1?(p=Int8Array,A=nl):l===2?(p=Int16Array,A=r1):(p=Int32Array,A=$o);break;case lr:v+=l*8+"UI",x=a?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,d=F0(i),l===1?(p=Uint8Array,A=ni):l===2?(p=Uint16Array,A=Ml):(p=Uint32Array,A=lr);break}f===3&&(d===Wt||d===oa)&&(f=4);const y=Math.ceil(Math.sqrt(o))||1,g=f*y*y,m=new p(g),_=e.normalized;e.normalized=!1;for(let E=0;E<o;E++){const C=f*E;m[C]=e.getX(E)/x,i>=2&&(m[C+1]=e.getY(E)/x),i>=3&&(m[C+2]=e.getZ(E)/x,f===4&&(m[C+3]=1)),i>=4&&(m[C+3]=e.getW(E)/x)}e.normalized=_,this.internalFormat=v,this.format=d,this.type=A,this.image.width=y,this.image.height=y,this.image.data=m,this.needsUpdate=!0,this.dispose(),e.itemSize=r,e.count=t}}class sg extends vf{constructor(){super(),this._forcedType=lr}}class og extends vf{constructor(){super(),this._forcedType=Tt}}class Ef{constructor(){this.index=new sg,this.position=new og,this.bvhBounds=new Vn,this.bvhContents=new Vn,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:n}=e;if(cg(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(n.attributes.position),e.indirect){const r=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==r.length)if(n.index)this._cachedIndexAttr=n.index.clone();else{const t=hf(uf(n));this._cachedIndexAttr=new Nt(t,1,!1)}ag(n,r,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(n.index)}dispose(){const{index:e,position:n,bvhBounds:r,bvhContents:t}=this;e&&e.dispose(),n&&n.dispose(),r&&r.dispose(),t&&t.dispose()}}function ag(s,e,n){const r=n.array,t=s.index?s.index.array:null;for(let i=0,o=e.length;i<o;i++){const a=3*i,c=3*e[i];for(let l=0;l<3;l++)r[a+l]=t?t[c+l]:c+l}}function cg(s,e,n){const r=s._roots;if(r.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const t=r[0],i=new Uint16Array(t),o=new Uint32Array(t),a=new Float32Array(t),c=t.byteLength/Gn,l=2*Math.ceil(Math.sqrt(c/2)),u=new Float32Array(4*l*l),f=Math.ceil(Math.sqrt(c)),A=new Uint32Array(2*f*f);for(let d=0;d<c;d++){const x=d*Gn/4,p=x*2,v=x;for(let y=0;y<3;y++)u[8*d+0+y]=a[v+0+y],u[8*d+4+y]=a[v+3+y];if(vi(p,i)){const y=Fi(p,i),g=Si(x,o),m=4294901760|y;A[d*2+0]=m,A[d*2+1]=g}else{const y=4*Ui(x,o)/Gn,g=Nl(x,o);A[d*2+0]=g,A[d*2+1]=y}}e.image.data=u,e.image.width=l,e.image.height=l,e.format=Wt,e.type=Tt,e.internalFormat="RGBA32F",e.minFilter=Mt,e.magFilter=Mt,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),n.image.data=A,n.image.width=f,n.image.height=f,n.format=s1,n.type=lr,n.internalFormat="RG32UI",n.minFilter=Mt,n.magFilter=Mt,n.generateMipmaps=!1,n.needsUpdate=!0,n.dispose()}const lg=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,ug=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,hg=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,fg=hg,Ag=`
	${lg}
	${ug}
`,U0=s=>s.isMesh;function e6(s,e){e={strategy:wa,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...e},h.useEffect(()=>{if(s.current){s.current.raycast=pf;const n=s.current.geometry;return n.computeBoundsTree=gf,n.disposeBoundsTree=yf,n.computeBoundsTree(e),()=>{n.boundsTree&&n.disposeBoundsTree()}}},[s,JSON.stringify(e)])}const t6=h.forwardRef(({enabled:s=!0,firstHitOnly:e=!1,children:n,strategy:r=wa,verbose:t=!1,setBoundingBox:i=!0,maxDepth:o=40,maxLeafTris:a=10,indirect:c=!1,...l},u)=>{const f=h.useRef(null),A=re(d=>d.raycaster);return h.useImperativeHandle(u,()=>f.current,[]),h.useEffect(()=>{if(s){const d={strategy:r,verbose:t,setBoundingBox:i,maxDepth:o,maxLeafTris:a,indirect:c},x=f.current;return A.firstHitOnly=e,x.traverse(p=>{U0(p)&&!p.geometry.boundsTree&&p.raycast===Qe.prototype.raycast&&(p.raycast=pf,p.geometry.computeBoundsTree=gf,p.geometry.disposeBoundsTree=yf,p.geometry.computeBoundsTree(d))}),()=>{delete A.firstHitOnly,x.traverse(p=>{U0(p)&&p.geometry.boundsTree&&(p.geometry.disposeBoundsTree(),p.raycast=Qe.prototype.raycast)})}}},[]),h.createElement("group",me({ref:f},l),n)});function i6(...s){const e=h.useRef([]);return e.current=s.map(n=>h.useContext(n)),h.useMemo(()=>({children:n})=>s.reduceRight((r,t,i)=>h.createElement(t.Provider,{value:e.current[i],children:r}),n),[])}function dg(s){const e=h.useRef(null),n=h.useRef(!1),r=h.useRef(!1),t=h.useRef(s);return h.useLayoutEffect(()=>void(t.current=s),[s]),h.useEffect(()=>{const i=e.current;if(i){const o=t1(()=>(n.current=!1,!0)),a=i.onBeforeRender;i.onBeforeRender=()=>n.current=!0;const c=Sl(()=>(n.current!==r.current&&(t.current==null||t.current(r.current=n.current)),!0));return()=>{i.onBeforeRender=a,o(),c()}}},[]),e}const mg=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,pg=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,gg=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,yg=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function vg(s,e,n){s.defines.BOX_PROJECTED_ENV_MAP=!0,s.uniforms.envMapPosition={value:e},s.uniforms.envMapSize={value:n},s.vertexShader=`
  varying vec3 vWorldPosition;
  ${s.vertexShader.replace("#include <worldpos_vertex>",mg)}`,s.fragmentShader=`
    ${pg}
    ${s.fragmentShader.replace("#include <envmap_physical_pars_fragment>",Wr.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${gg}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${yg}
        `)}`}function n6(s=new k,e=new k){const[n]=h.useState(()=>({position:new k,size:new k}));ji(n,{position:s,size:e});const r=h.useRef(null),t=h.useMemo(()=>({ref:r,onBeforeCompile:i=>vg(i,n.position,n.size),customProgramCacheKey:()=>JSON.stringify(n.position.toArray())+JSON.stringify(n.size.toArray())}),[...n.position.toArray(),...n.size.toArray()]);return h.useLayoutEffect(()=>void(r.current.needsUpdate=!0),[n]),t}const k0=new Rt,No=new k,r6=({anchor:s,...e})=>{const n=h.useRef(null),r=h.useRef(null);return h.useEffect(()=>{var t;(t=n.current)!=null&&(t=t.parent)!=null&&t.parent&&(r.current=n.current.parent,n.current.parent.parent.add(n.current))},[]),ze(()=>{r.current&&(k0.setFromObject(r.current),k0.getSize(No),n.current.position.set(r.current.position.x+No.x*(Array.isArray(s)?s[0]:s.x)/2,r.current.position.y+No.y*(Array.isArray(s)?s[1]:s.y)/2,r.current.position.z+No.z*(Array.isArray(s)?s[2]:s.z)/2))}),h.createElement("group",me({ref:n},e))};function Eg(s,e,n=.9){return e*n+s*(1-n)}const xg=s=>Math.sqrt(1-Math.pow(s-1,2));class _g{constructor({size:e=256,maxAge:n=750,radius:r=.3,intensity:t=.2,interpolate:i=0,smoothing:o=0,minForce:a=.3,blend:c="screen",ease:l=xg}={}){this.size=e,this.maxAge=n,this.radius=r,this.intensity=t,this.ease=l,this.interpolate=i,this.smoothing=o,this.minForce=a,this.blend=c,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(e===null)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new an(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((n,r)=>{n.age+=e*1e3,n.age>this.maxAge&&this.trail.splice(r,1)}),this.trail.length||(this.force=0),this.trail.forEach(n=>{this.drawTouch(n)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const n=this.trail[this.trail.length-1];if(n){const r=n.x-e.x,t=n.y-e.y,i=r*r+t*t,o=Math.max(this.minForce,Math.min(i*1e4,1));if(this.force=Eg(o,this.force,this.smoothing),this.interpolate){const a=Math.ceil(i/Math.pow(this.radius*.5/this.interpolate,2));if(a>1)for(let c=1;c<a;c++)this.trail.push({x:n.x-r/a*c,y:n.y-t/a*c,age:0,force:o})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const n={x:e.x*this.size,y:(1-e.y)*this.size};let r=1;e.age<this.maxAge*.3?r=this.ease(e.age/(this.maxAge*.3)):r=this.ease(1-(e.age-this.maxAge*.3)/(this.maxAge*.7)),r*=e.force,this.ctx.globalCompositeOperation=this.blend;const t=this.size*this.radius*r,i=this.ctx.createRadialGradient(n.x,n.y,Math.max(0,t*.25),n.x,n.y,Math.max(0,t));i.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),i.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(n.x,n.y,Math.max(0,t),0,Math.PI*2),this.ctx.fill()}}function Cg(s={}){const{size:e,maxAge:n,radius:r,intensity:t,interpolate:i,smoothing:o,minForce:a,blend:c,ease:l}=s,u=h.useMemo(()=>new _g(s),[e,n,r,t,i,o,a,c,l]);ze((A,d)=>void u.update(d));const f=h.useCallback(A=>u.addTouch(A.uv),[u]);return[u.texture,f]}const s6=({children:s,...e})=>{const n=Cg(e);return h.createElement(h.Fragment,null,s==null?void 0:s(n))},o6=h.forwardRef(({font:s,color:e="#cbcbcb",bevelSize:n=.04,debug:r=!1,children:t,...i},o)=>{const[a,c]=h.useState(0),l=h.useCallback((A=1)=>c(a+A),[a]),u=h.useCallback((A=1)=>c(a-A),[a]),f=h.useMemo(()=>({incr:l,decr:u}),[l,u]);return h.useImperativeHandle(o,()=>f,[f]),h.createElement("group",i,h.createElement(h.Suspense,{fallback:null},h.createElement(o1,{top:!0,cacheKey:JSON.stringify({counter:a,font:s})},h.createElement(q2,{bevelEnabled:!0,bevelSize:n,font:s},r?h.createElement("meshNormalMaterial",{wireframe:!0}):h.createElement("meshStandardMaterial",{color:e}),a))),t)}),js=(s,e)=>{s.updateRanges[0]=e};function wg(s){return typeof s=="function"}const L0=new Me,O0=new Me,Go=[],Rs=new Qe;class Ig extends Aa{constructor(){super(),this.color=new Ve("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,n){const r=this.instance.current;if(!r||!r.geometry||!r.material)return;Rs.geometry=r.geometry;const t=r.matrixWorld,i=r.userData.instances.indexOf(this.instanceKey);if(!(i===-1||i>r.count)){r.getMatrixAt(i,L0),O0.multiplyMatrices(t,L0),Rs.matrixWorld=O0,r.material instanceof MA?Rs.material.side=r.material.side:Rs.material.side=r.material[0].side,Rs.raycast(e,Go);for(let o=0,a=Go.length;o<a;o++){const c=Go[o];c.instanceId=i,c.object=this,n.push(c)}Go.length=0}}}const xf=h.createContext(null),N0=new Me,G0=new Me,bg=new Me,H0=new k,V0=new st,W0=new k,Bg=s=>s.isInstancedBufferAttribute,Vl=h.forwardRef(({context:s,children:e,...n},r)=>{h.useMemo(()=>Gt({PositionMesh:Ig}),[]);const t=h.useRef(null);h.useImperativeHandle(r,()=>t.current,[]);const{subscribe:i,getParent:o}=h.useContext(s||xf);return h.useLayoutEffect(()=>i(t),[]),h.createElement("positionMesh",me({instance:o(),instanceKey:t,ref:t},n),e)}),Wl=h.forwardRef(({context:s,children:e,range:n,limit:r=1e3,frames:t=1/0,...i},o)=>{const[{localContext:a,instance:c}]=h.useState(()=>{const g=h.createContext(null);return{localContext:g,instance:h.forwardRef((m,_)=>h.createElement(Vl,me({context:g},m,{ref:_})))}}),l=h.useRef(null);h.useImperativeHandle(o,()=>l.current,[]);const[u,f]=h.useState([]),[[A,d]]=h.useState(()=>{const g=new Float32Array(r*16);for(let m=0;m<r;m++)bg.identity().toArray(g,m*16);return[g,new Float32Array([...new Array(r*3)].map(()=>1))]});h.useEffect(()=>{l.current.instanceMatrix.needsUpdate=!0});let x=0,p=0;const v=h.useRef([]);h.useLayoutEffect(()=>{v.current=Object.entries(l.current.geometry.attributes).filter(([g,m])=>Bg(m))}),ze(()=>{if(t===1/0||x<t){l.current.updateMatrix(),l.current.updateMatrixWorld(),N0.copy(l.current.matrixWorld).invert(),p=Math.min(r,n!==void 0?n:r,u.length),l.current.count=p,js(l.current.instanceMatrix,{start:0,count:p*16}),js(l.current.instanceColor,{start:0,count:p*3});for(let g=0;g<u.length;g++){const m=u[g].current;m.matrixWorld.decompose(H0,V0,W0),G0.compose(H0,V0,W0).premultiply(N0),G0.toArray(A,g*16),l.current.instanceMatrix.needsUpdate=!0,m.color.toArray(d,g*3),l.current.instanceColor.needsUpdate=!0}x++}});const y=h.useMemo(()=>({getParent:()=>l,subscribe:g=>(f(m=>[...m,g]),()=>f(m=>m.filter(_=>_.current!==g.current)))}),[]);return h.createElement("instancedMesh",me({userData:{instances:u,limit:r,frames:t},matrixAutoUpdate:!1,ref:l,args:[null,null,0],raycast:()=>null},i),h.createElement("instancedBufferAttribute",{attach:"instanceMatrix",args:[A,16],usage:Ai}),h.createElement("instancedBufferAttribute",{attach:"instanceColor",args:[d,3],usage:Ai}),wg(e)?h.createElement(a.Provider,{value:y},e(c)):s?h.createElement(s.Provider,{value:y},e):h.createElement(xf.Provider,{value:y},e))}),a6=h.forwardRef(function({meshes:e,children:n,...r},t){const i=Array.isArray(e);if(!i)for(const c of Object.keys(e))e[c].isMesh||delete e[c];const o=c=>i?n(...c):n(Object.keys(e).filter(l=>e[l].isMesh).reduce((l,u,f)=>({...l,[u]:c[f]}),{})),a=(i?e:Object.values(e)).map(({geometry:c,material:l})=>h.createElement(Wl,me({key:c.uuid,geometry:c,material:l},r)));return h.createElement("group",{ref:t},_f(o,a))});function _f(s,e,n=[]){if(!e[0])return s(n);function r(t){return _f(s,e.slice(1),n.concat([t]))}return typeof e[0]=="function"?e[0]({results:n,render:r}):h.cloneElement(e[0],{children:r})}function c6(){const s=h.createContext(null);return[h.forwardRef((e,n)=>h.createElement(Wl,me({ref:n,context:s},e))),h.forwardRef((e,n)=>h.createElement(Vl,me({ref:n,context:s},e)))]}const l6=h.forwardRef(({name:s,defaultValue:e,normalized:n,usage:r=Ai},t)=>{const i=h.useRef(null);h.useImperativeHandle(t,()=>i.current,[]),h.useLayoutEffect(()=>{const a=i.current.__r3f.parent.object;a.geometry.attributes[s]=i.current;const c=Array.isArray(e)?e:[e],l=Array.from({length:a.userData.limit},()=>c).flat();return i.current.array=new Float32Array(l),i.current.itemSize=c.length,i.current.count=l.length/i.current.itemSize,()=>{delete a.geometry.attributes[s]}},[s]);let o=0;return ze(()=>{const a=i.current.__r3f.parent.object;if(a.userData.frames===1/0||o<a.userData.frames){for(let c=0;c<a.userData.instances.length;c++){const u=a.userData.instances[c].current[s];u!==void 0&&(i.current.set(Array.isArray(u)?u:typeof u.toArray=="function"?u.toArray():[u],c*i.current.itemSize),i.current.needsUpdate=!0)}o++}}),h.createElement("instancedBufferAttribute",{ref:i,usage:r,normalized:n})}),Cf=h.createContext(null);function u6(){return h.useContext(Cf)}function Sg(s){return s!==null&&"meta"in s&&"frames"in s}const Y0=new yi(1,1),h6=h.forwardRef(({startFrame:s=0,endFrame:e,fps:n=30,frameName:r="",textureDataURL:t,textureImageURL:i,loop:o=!1,numberOfFrames:a=1,autoPlay:c=!0,animationNames:l,onStart:u,onEnd:f,onLoopEnd:A,onFrame:d,play:x,pause:p=!1,flipX:v=!1,alphaTest:y=0,children:g,asSprite:m=!1,offset:_,playBackwards:E=!1,resetOnEnd:C=!1,maxItems:w=1,instanceItems:I=[[0,0,0]],spriteDataset:B,canvasRenderingContext2DSettings:S,roundFramePosition:U=!1,meshProps:b={},...M},D)=>{const N=h.useRef(new Aa),G=h.useRef(null),q=h.useRef(null),X=h.useRef(null),O=h.useRef(window.performance.now()),H=h.useRef(s),T=h.useRef(r),W=n>0?1e3/n:0,[j,L]=h.useState(new an),z=h.useRef(0),[F,R]=h.useState(new k(1,1,1)),Q=v?-1:1,J=h.useRef(p),ie=h.useRef(_),Z=h.useRef(!1),{spriteObj:ee,loadJsonAndTexture:ge}=Ol(null,null,l,a,void 0,S),pe=h.useRef(r),te=h.useCallback((ve,Ee)=>{if(Ee===null)a&&(z.current=a,E&&(H.current=a-1),G.current=Ee);else{var Ce,xe;G.current=Ee,G.current&&Array.isArray(G.current.frames)?z.current=G.current.frames.length:G.current&&typeof G.current=="object"&&pe.current?z.current=G.current.frames[pe.current].length:z.current=0,E&&(H.current=z.current-1);const{w:Oe,h:De}=ia((Ce=(xe=G.current)==null?void 0:xe.frames)!==null&&Ce!==void 0?Ce:[],pe.current).sourceSize,Re=se(Oe,De);R(Re),q.current&&(q.current.map=ve)}L(ve)},[a,E]),ae=h.useCallback(()=>{if(!G.current)return;const{meta:{size:ve},frames:Ee}=G.current,{w:Ce,h:xe}=Array.isArray(Ee)?Ee[0].sourceSize:r?Ee[r]?Ee[r][0].sourceSize:{w:0,h:0}:{w:0,h:0};q.current&&q.current.map&&(q.current.map.wrapS=q.current.map.wrapT=Wn,q.current.map.center.set(0,0),q.current.map.repeat.set(1*Q/(ve.w/Ce),1/(ve.h/xe)));const De=1/((ve.h-1)/xe);q.current&&q.current.map&&(q.current.map.offset.x=0,q.current.map.offset.y=1-De),u&&u({currentFrameName:r??"",currentFrame:H.current})},[Q,r,u]),de=h.useMemo(()=>({current:ie.current,offset:ie.current,imageUrl:i,hasEnded:!1,ref:D}),[i,D]);h.useImperativeHandle(D,()=>N.current,[]),h.useLayoutEffect(()=>{ie.current=_},[_]);const se=(ve,Ee)=>{var Ce;const xe=new k,Oe=Ee/ve;return xe.set(1,Oe,1),(Ce=X.current)==null||Ce.scale.copy(xe),xe};h.useEffect(()=>{if(B){var ve;te(B==null||(ve=B.spriteTexture)==null?void 0:ve.clone(),B.spriteData)}else i&&t&&ge(i,t)},[ge,B,t,i,te]),h.useEffect(()=>{if(ee){var ve;te(ee==null||(ve=ee.spriteTexture)==null?void 0:ve.clone(),ee==null?void 0:ee.spriteData)}},[ee,te]),h.useEffect(()=>{if(de.hasEnded=!1,G.current&&E===!0){var ve;H.current=((ve=G.current.frames.length)!==null&&ve!==void 0?ve:0)-1}else H.current=0},[E,de]),h.useLayoutEffect(()=>{ae()},[j,v,ae]),h.useEffect(()=>{c&&(J.current=!1)},[c]),h.useLayoutEffect(()=>{if(T.current!==r&&r&&(H.current=0,T.current=r,de.hasEnded=!1,W<=0&&(H.current=e||s||0),G.current)){const{w:ve,h:Ee}=ia(G.current.frames,r).sourceSize,Ce=se(ve,Ee);R(Ce)}},[r,W,de,e,s]);const K=()=>{if(!Sg(G.current))return;const{meta:{size:ve},frames:Ee}=G.current,{w:Ce,h:xe}=ia(Ee,r).sourceSize,Oe=Array.isArray(Ee)?Ee:r?Ee[r]:[],De=e||Oe.length-1;var Re=_===void 0?de.current:_;if(W<=0){H.current=e||s||0,Y(Ce,xe,ve,Oe);return}const Pe=window.performance.now(),ke=Pe-O.current;if(!(ke<=W)){var Ke=E?H.current<0:H.current>De,ot=E?H.current===De:H.current===0,He=E?H.current<0:H.current>=De;if(Ke){if(H.current=o?s??0:0,E&&(H.current=De),o?A==null||A({currentFrameName:r??"",currentFrame:H.current}):(f==null||f({currentFrameName:r??"",currentFrame:H.current}),de.hasEnded=!C,C&&(J.current=!0)),!o)return}else ot&&(u==null||u({currentFrameName:r??"",currentFrame:H.current}));Re!==void 0&&He?Z.current===!1&&(f==null||f({currentFrameName:r??"",currentFrame:H.current}),Z.current=!0):Z.current=!1,!(ke<=W)&&(O.current=Pe-ke%W,Y(Ce,xe,ve,Oe))}},Y=(ve,Ee,Ce,xe)=>{var Oe=_===void 0?de.current:_;const De=H.current;let Re=0,Pe=0;se(ve,Ee);const ke=U?Math.round((Ce.w-1)/ve):(Ce.w-1)/ve,Ke=U?Math.round((Ce.h-1)/Ee):(Ce.h-1)/Ee;if(!xe[De])return;const{frame:{x:ot,y:He},sourceSize:{w:Le,h:Fe}}=xe[De],ct=1/ke,$e=1/Ke;if(q.current&&q.current.map&&(Re=Q>0?ct*(ot/Le):ct*(ot/Le)-q.current.map.repeat.x,Pe=Math.abs(1-$e)-$e*(He/Fe),q.current.map.offset.x=Re,q.current.map.offset.y=Pe),Oe!=null){let Ze=Math.floor(Oe*xe.length);Ze=Math.max(0,Math.min(Ze,xe.length-1)),isNaN(Ze)&&(Ze=0),H.current=Ze}else E?H.current-=1:H.current+=1};ze((ve,Ee)=>{var Ce,xe;!((Ce=G.current)!=null&&Ce.frames)||!((xe=q.current)!=null&&xe.map)||J.current||!de.hasEnded&&(c||x)&&(K(),d==null||d({currentFrameName:T.current,currentFrame:H.current}))});function ne(ve=new k(1,1,1),Ee=1){if(typeof Ee=="number")return ve.multiplyScalar(Ee);if(Array.isArray(Ee))return ve.multiply(new k(...Ee));if(Ee instanceof k)return ve.multiply(Ee)}return h.createElement("group",me({},M,{ref:N,scale:ne(F,M.scale)}),h.createElement(Cf.Provider,{value:de},m&&h.createElement(Nm,null,h.createElement("mesh",me({ref:X,scale:1,geometry:Y0},b),h.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Jt,ref:q,map:j,transparent:!0,alphaTest:y??0}))),!m&&h.createElement(Wl,me({geometry:Y0,limit:w??1},b),h.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Jt,ref:q,map:j,transparent:!0,alphaTest:y??0}),(I??[0]).map((ve,Ee)=>h.createElement(Vl,me({key:Ee,ref:(I==null?void 0:I.length)===1?X:null,position:ve,scale:1},b)))),g))}),f6=h.forwardRef(({children:s,curve:e},n)=>{const[r]=h.useState(()=>new Kn),[t,i]=h.useState(),o=h.useRef(null);return h.useLayoutEffect(()=>{o.current=new id(r.children[0]),i(o.current.object3D)},[s]),h.useEffect(()=>{var a;e&&((a=o.current)==null||a.updateCurve(0,e))},[e]),h.useImperativeHandle(n,()=>o.current),h.createElement(h.Fragment,null,Ar(s,r),t&&h.createElement("primitive",{object:t}))});var Mg=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class Tg extends a1{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${Mg}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const A6=h.forwardRef(({speed:s=1,...e},n)=>{const[r]=h.useState(()=>new Tg);return ze(t=>r&&(r.time=t.clock.elapsedTime*s)),h.createElement("primitive",me({object:r,ref:n,attach:"material"},e))});class Dg extends c1{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const d6=h.forwardRef(({speed:s=1,...e},n)=>{const[r]=h.useState(()=>new Dg);return ze(t=>r&&(r.time=t.clock.elapsedTime*s)),h.createElement("primitive",me({object:r,ref:n,attach:"material"},e))});class Rg extends kt{constructor(e=new Te){super({uniforms:{inputBuffer:new Qi(null),depthBuffer:new Qi(null),resolution:new Qi(new Te),texelSize:new Qi(new Te),halfTexelSize:new Qi(new Te),kernel:new Qi(0),scale:new Qi(1),cameraNear:new Qi(0),cameraFar:new Qi(1),minDepthThreshold:new Qi(0),maxDepthThreshold:new Qi(1),depthScale:new Qi(0),depthToBlurRatioBias:new Qi(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:Cl,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,n){this.uniforms.texelSize.value.set(e,n),this.uniforms.halfTexelSize.value.set(e,n).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class Pg{constructor({gl:e,resolution:n,width:r=500,height:t=500,minDepthThreshold:i=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:c=.25}){this.renderToScreen=!1,this.renderTargetA=new Vt(n,n,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1,type:zt}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Rg,this.convolutionMaterial.setTexelSize(1/r,1/t),this.convolutionMaterial.setResolution(new Te(r,t)),this.scene=new Kn,this.camera=new n1,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=c,this.convolutionMaterial.defines.USE_DEPTH=a>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),f=new ki;f.setAttribute("position",new Nt(l,3)),f.setAttribute("uv",new Nt(u,2)),this.screen=new Qe(f,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,n,r){const t=this.scene,i=this.camera,o=this.renderTargetA,a=this.renderTargetB;let c=this.convolutionMaterial,l=c.uniforms;l.depthBuffer.value=n.depthTexture;const u=c.kernel;let f=n,A,d,x;for(d=0,x=u.length-1;d<x;++d)A=(d&1)===0?o:a,l.kernel.value=u[d],l.inputBuffer.value=f.texture,e.setRenderTarget(A),e.render(t,i),f=A;l.kernel.value=u[d],l.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(t,i)}}let Qg=class extends c1{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var n;(n=e.defines)!=null&&n.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const p6=h.forwardRef(({mixBlur:s=0,mixStrength:e=1,resolution:n=256,blur:r=[0,0],minDepthThreshold:t=.9,maxDepthThreshold:i=1,depthScale:o=0,depthToBlurRatioBias:a=.25,mirror:c=0,distortion:l=1,mixContrast:u=1,distortionMap:f,reflectorOffset:A=0,...d},x)=>{Gt({MeshReflectorMaterialImpl:Qg});const p=re(({gl:T})=>T),v=re(({camera:T})=>T),y=re(({scene:T})=>T);r=Array.isArray(r)?r:[r,r];const g=r[0]+r[1]>0,m=h.useRef(null);h.useImperativeHandle(x,()=>m.current,[]);const[_]=h.useState(()=>new qn),[E]=h.useState(()=>new k),[C]=h.useState(()=>new k),[w]=h.useState(()=>new k),[I]=h.useState(()=>new Me),[B]=h.useState(()=>new k(0,0,-1)),[S]=h.useState(()=>new Li),[U]=h.useState(()=>new k),[b]=h.useState(()=>new k),[M]=h.useState(()=>new Li),[D]=h.useState(()=>new Me),[N]=h.useState(()=>new Zt),G=h.useCallback(()=>{var T;const W=m.current.parent||((T=m.current)==null||(T=T.__r3f.parent)==null?void 0:T.object);if(!W||(C.setFromMatrixPosition(W.matrixWorld),w.setFromMatrixPosition(v.matrixWorld),I.extractRotation(W.matrixWorld),E.set(0,0,1),E.applyMatrix4(I),C.addScaledVector(E,A),U.subVectors(C,w),U.dot(E)>0))return;U.reflect(E).negate(),U.add(C),I.extractRotation(v.matrixWorld),B.set(0,0,-1),B.applyMatrix4(I),B.add(w),b.subVectors(C,B),b.reflect(E).negate(),b.add(C),N.position.copy(U),N.up.set(0,1,0),N.up.applyMatrix4(I),N.up.reflect(E),N.lookAt(b),N.far=v.far,N.updateMatrixWorld(),N.projectionMatrix.copy(v.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(N.projectionMatrix),D.multiply(N.matrixWorldInverse),D.multiply(W.matrixWorld),_.setFromNormalAndCoplanarPoint(E,C),_.applyMatrix4(N.matrixWorldInverse),S.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const j=N.projectionMatrix;M.x=(Math.sign(S.x)+j.elements[8])/j.elements[0],M.y=(Math.sign(S.y)+j.elements[9])/j.elements[5],M.z=-1,M.w=(1+j.elements[10])/j.elements[14],S.multiplyScalar(2/S.dot(M)),j.elements[2]=S.x,j.elements[6]=S.y,j.elements[10]=S.z+1,j.elements[14]=S.w},[v,A]),[q,X,O,H]=h.useMemo(()=>{const T={minFilter:Bt,magFilter:Bt,type:zt},W=new Vt(n,n,T);W.depthBuffer=!0,W.depthTexture=new bl(n,n),W.depthTexture.format=i1,W.depthTexture.type=Ml;const j=new Vt(n,n,T),L=new Pg({gl:p,resolution:n,width:r[0],height:r[1],minDepthThreshold:t,maxDepthThreshold:i,depthScale:o,depthToBlurRatioBias:a}),z={mirror:c,textureMatrix:D,mixBlur:s,tDiffuse:W.texture,tDepth:W.depthTexture,tDiffuseBlur:j.texture,hasBlur:g,mixStrength:e,minDepthThreshold:t,maxDepthThreshold:i,depthScale:o,depthToBlurRatioBias:a,distortion:l,distortionMap:f,mixContrast:u,"defines-USE_BLUR":g?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":f?"":void 0};return[W,j,L,z]},[p,r,D,n,c,g,s,e,t,i,o,a,l,f,u]);return ze(()=>{var T;const W=m.current.parent||((T=m.current)==null||(T=T.__r3f.parent)==null?void 0:T.object);if(!W)return;W.visible=!1;const j=p.xr.enabled,L=p.shadowMap.autoUpdate;G(),p.xr.enabled=!1,p.shadowMap.autoUpdate=!1,p.setRenderTarget(q),p.state.buffers.depth.setMask(!0),p.autoClear||p.clear(),p.render(y,N),g&&O.render(p,q,X),p.xr.enabled=j,p.shadowMap.autoUpdate=L,W.visible=!0,p.setRenderTarget(null)}),h.createElement("meshReflectorMaterialImpl",me({attach:"material",key:"key"+H["defines-USE_BLUR"]+H["defines-USE_DEPTH"]+H["defines-USE_DISTORTION"],ref:m},H,d))}),zg=ln({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new Ef,color:new Ve("white"),opacity:1,resolution:new Te,viewMatrixInverse:new Me,projectionMatrixInverse:new Me},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${fg}
  ${Ag}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),Fg=s=>s&&s.isCubeTexture;function g6({aberrationStrength:s=0,fastChroma:e=!0,envMap:n,...r}){Gt({MeshRefractionMaterial:zg});const t=h.useRef(null),{size:i}=re(),o=h.useMemo(()=>{var a,c;const l={},u=Fg(n),A=((a=u?(c=n.image[0])==null?void 0:c.width:n.image.width)!==null&&a!==void 0?a:1024)/4,d=Math.floor(Math.log2(A)),x=Math.pow(2,d),p=3*Math.max(x,16*7),v=4*x;return u&&(l.ENVMAP_TYPE_CUBEM=""),l.CUBEUV_TEXEL_WIDTH=`${1/p}`,l.CUBEUV_TEXEL_HEIGHT=`${1/v}`,l.CUBEUV_MAX_MIP=`${d}.0`,s>0&&(l.CHROMATIC_ABERRATIONS=""),e&&(l.FAST_CHROMA=""),l},[s,e]);return h.useLayoutEffect(()=>{var a;const c=(a=t.current)==null||(a=a.__r3f)==null||(a=a.parent)==null||(a=a.object)==null?void 0:a.geometry;c&&(t.current.bvh=new Ef,t.current.bvh.updateFrom(new Ba(c.clone().toNonIndexed(),{strategy:wa})))},[]),ze(({camera:a})=>{t.current.viewMatrixInverse=a.matrixWorld,t.current.projectionMatrixInverse=a.projectionMatrixInverse}),h.createElement("meshRefractionMaterial",me({key:JSON.stringify(o),defines:o,ref:t,resolution:[i.width,i.height],aberrationStrength:s,envMap:n},r))}const Yl=ln({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class Ug extends a1{constructor(e=6,n=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new Ve("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),n?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(r=>Object.defineProperty(this,r,{get:()=>this.uniforms[r].value,set:t=>this.uniforms[r].value=t}))}}const y6=h.forwardRef(({buffer:s,transmissionSampler:e=!1,backside:n=!1,side:r=ca,transmission:t=1,thickness:i=0,backsideThickness:o=0,backsideEnvMapIntensity:a=1,samples:c=10,resolution:l,backsideResolution:u,background:f,anisotropy:A,anisotropicBlur:d,...x},p)=>{Gt({MeshTransmissionMaterial:Ug});const v=h.useRef(null),[y]=h.useState(()=>new Yl),g=Bi(u||l),m=Bi(l);let _,E,C,w;return ze(I=>{if(v.current.time=I.clock.elapsedTime,v.current.buffer===m.texture&&!e){var B;w=(B=v.current.__r3f.parent)==null?void 0:B.object,w&&(C=I.gl.toneMapping,_=I.scene.background,E=v.current.envMapIntensity,I.gl.toneMapping=TA,f&&(I.scene.background=f),w.material=y,n&&(I.gl.setRenderTarget(g),I.gl.render(I.scene,I.camera),w.material=v.current,w.material.buffer=g.texture,w.material.thickness=o,w.material.side=Kr,w.material.envMapIntensity=a),I.gl.setRenderTarget(m),I.gl.render(I.scene,I.camera),w.material=v.current,w.material.thickness=i,w.material.side=r,w.material.buffer=m.texture,w.material.envMapIntensity=E,I.scene.background=_,I.gl.setRenderTarget(null),I.gl.toneMapping=C)}}),h.useImperativeHandle(p,()=>v.current,[]),h.createElement("meshTransmissionMaterial",me({args:[c,e],ref:v},x,{buffer:s||m.texture,_transmission:t,anisotropicBlur:d??A,transmission:e?t:0,thickness:i,side:r}))}),v6=h.forwardRef((s,e)=>(Gt({DiscardMaterialImpl:Yl}),h.createElement("discardMaterialImpl",me({ref:e},s))));function E6(s){const e=h.useRef(null);return h.useLayoutEffect(()=>{const n=e.current.parent,r=n==null?void 0:n.geometry;if(r){const t=n.material;n.material=e.current.__r3f.children.map(o=>o.object);const i=[...r.groups];return r.clearGroups(),n.material.forEach((o,a)=>{a<n.material.length-1&&(o.depthWrite=!1),r.addGroup(0,1/0,a)}),()=>{n.material=t,r.groups=i}}}),h.createElement("group",me({ref:e},s))}const Fc=mi>=154?"opaque_fragment":"output_fragment";class kg extends DA{constructor(e){super(e),this.onBeforeCompile=(n,r)=>{const{isWebGL2:t}=r.capabilities;n.fragmentShader=n.fragmentShader.replace(`#include <${Fc}>`,`
        ${t?`#include <${Fc}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Fc}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const x6=h.forwardRef((s,e)=>{const[n]=h.useState(()=>new kg(null));return h.createElement("primitive",me({},s,{object:n,ref:e,attach:"material"}))}),Lg=({focus:s=0,size:e=25,samples:n=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${e})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${s});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${n}; i ++) {
    offset = (vogelDiskSample(j, ${n}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${n}; i++) {
    vogelSample = vogelDiskSample(j, ${n}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${e}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${n}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function j0(s,e,n){e.traverse(r=>{r.material&&(s.properties.remove(r.material),r.material.dispose==null||r.material.dispose())}),s.info.programs.length=0,s.compile(e,n)}function _6({focus:s=0,samples:e=10,size:n=25}){const r=re(o=>o.gl),t=re(o=>o.scene),i=re(o=>o.camera);return h.useEffect(()=>{const o=Wr.shadowmap_pars_fragment;return Wr.shadowmap_pars_fragment=Wr.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+Lg({size:n,samples:e,focus:s})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),j0(r,t,i),()=>{Wr.shadowmap_pars_fragment=o,j0(r,t,i)}},[s,n,e]),null}function $t(s,e){const n=s+"Geometry";return h.forwardRef(({args:r,children:t,...i},o)=>{const a=h.useRef(null);return h.useImperativeHandle(o,()=>a.current),h.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),h.createElement("mesh",me({ref:a},i),h.createElement(n,{attach:"geometry",args:r}),t)})}const C6=$t("box"),w6=$t("circle"),I6=$t("cone"),b6=$t("cylinder"),B6=$t("sphere"),S6=$t("plane"),M6=$t("tube"),T6=$t("torus"),D6=$t("torusKnot"),R6=$t("tetrahedron"),P6=$t("ring"),Q6=$t("polyhedron"),z6=$t("icosahedron"),F6=$t("octahedron"),U6=$t("dodecahedron"),k6=$t("extrude"),L6=$t("lathe"),O6=$t("capsule"),N6=$t("shape",({geometry:s})=>{const e=s.attributes.position,n=new Rt().setFromBufferAttribute(e),r=new k;n.getSize(r);const t=[];let i=0,o=0,a=0,c=0;for(let l=0;l<e.count;l++)i=e.getX(l),o=e.getY(l),a=(i-n.min.x)/r.x,c=(o-n.min.y)/r.y,t.push(a,c);s.setAttribute("uv",new Ki(t,2))}),mn=1e-5;function Og(s,e,n){const r=new Wh,t=n-mn;return r.absarc(mn,mn,mn,-Math.PI/2,-Math.PI,!0),r.absarc(mn,e-t*2,mn,Math.PI,Math.PI/2,!0),r.absarc(s-t*2,e-t*2,mn,Math.PI/2,0,!0),r.absarc(s-t*2,mn,mn,0,-Math.PI/2,!0),r}const G6=h.forwardRef(function({args:[e=1,n=1,r=1]=[],radius:t=.05,steps:i=1,smoothness:o=4,bevelSegments:a=4,creaseAngle:c=.4,children:l,...u},f){const A=h.useMemo(()=>Og(e,n,t),[e,n,t]),d=h.useMemo(()=>({depth:r-t*2,bevelEnabled:!0,bevelSegments:a*2,steps:i,bevelSize:t-mn,bevelThickness:t,curveSegments:o}),[r,t,o]),x=h.useRef(null);return h.useLayoutEffect(()=>{x.current&&(x.current.center(),Xh(x.current,c))},[A,d]),h.createElement("mesh",me({ref:f},u),h.createElement("extrudeGeometry",{ref:x,args:[A,d]}),l)});function Ng(){const s=new ki,e=new Float32Array([-1,-1,3,-1,-1,3]);return s.boundingSphere=new Oi,s.boundingSphere.set(new k,1/0),s.setAttribute("position",new Nt(e,2)),s}const H6=h.forwardRef(function({children:e,...n},r){const t=h.useMemo(Ng,[]);return h.createElement("mesh",me({ref:r,geometry:t,frustumCulled:!1},n),e)}),V6=h.forwardRef(({children:s,width:e,height:n,depth:r,box3:t,precise:i=!0,...o},a)=>{const c=h.useRef(null),l=h.useRef(null),u=h.useRef(null);return h.useLayoutEffect(()=>{l.current.matrixWorld.identity();let f=t||new Rt().setFromObject(u.current,i);const A=f.max.x-f.min.x,d=f.max.y-f.min.y,x=f.max.z-f.min.z;let p=Math.max(A,d,x);e&&(p=A),n&&(p=d),r&&(p=x),l.current.scale.setScalar(1/p)},[e,n,r,t,i]),h.useImperativeHandle(a,()=>c.current,[]),h.createElement("group",me({ref:c},o),h.createElement("group",{ref:l},h.createElement("group",{ref:u},s)))});var Yi=function(s){return s[s.NONE=0]="NONE",s[s.START=1]="START",s[s.ACTIVE=2]="ACTIVE",s}(Yi||{});const Pr=s=>s&&s.isOrthographicCamera,Gg=s=>s&&s.isBox3,Hg=s=>1-Math.exp(-5*s)+.007*s,wf=h.createContext(null);function Vg({children:s,maxDuration:e=1,margin:n=1.2,observe:r,fit:t,clip:i,interpolateFunc:o=Hg,onFit:a}){const c=h.useRef(null),{camera:l,size:u,invalidate:f}=re(),A=re(E=>E.controls),d=h.useRef(a);d.current=a;const x=h.useRef({camPos:new k,camRot:new st,camZoom:1}),p=h.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),v=h.useRef(Yi.NONE),y=h.useRef(0),[g]=h.useState(()=>new Rt),m=h.useMemo(()=>{function E(){const C=g.getSize(new k),w=g.getCenter(new k),I=Math.max(C.x,C.y,C.z),B=Pr(l)?I*4:I/(2*Math.atan(Math.PI*l.fov/360)),S=Pr(l)?I*4:B/l.aspect,U=n*Math.max(B,S);return{box:g,size:C,center:w,distance:U}}return{getSize:E,refresh(C){if(Gg(C))g.copy(C);else{const w=C||c.current;if(!w)return this;w.updateWorldMatrix(!0,!0),g.setFromObject(w)}if(g.isEmpty()){const w=l.position.length()||10;g.setFromCenterAndSize(new k,new k(w,w,w))}return x.current.camPos.copy(l.position),x.current.camRot.copy(l.quaternion),Pr(l)&&(x.current.camZoom=l.zoom),p.current.camPos=void 0,p.current.camRot=void 0,p.current.camZoom=void 0,p.current.camUp=void 0,p.current.target=void 0,this},reset(){const{center:C,distance:w}=E(),I=l.position.clone().sub(C).normalize();p.current.camPos=C.clone().addScaledVector(I,w),p.current.target=C.clone();const B=new Me().lookAt(p.current.camPos,p.current.target,l.up);return p.current.camRot=new st().setFromRotationMatrix(B),v.current=Yi.START,y.current=0,this},moveTo(C){return p.current.camPos=Array.isArray(C)?new k(...C):C.clone(),v.current=Yi.START,y.current=0,this},lookAt({target:C,up:w}){p.current.target=Array.isArray(C)?new k(...C):C.clone(),w?p.current.camUp=Array.isArray(w)?new k(...w):w.clone():p.current.camUp=l.up.clone();const I=new Me().lookAt(p.current.camPos||l.position,p.current.target,p.current.camUp);return p.current.camRot=new st().setFromRotationMatrix(I),v.current=Yi.START,y.current=0,this},to({position:C,target:w}){return this.moveTo(C).lookAt({target:w})},fit(){if(!Pr(l))return this.reset();let C=0,w=0;const I=[new k(g.min.x,g.min.y,g.min.z),new k(g.min.x,g.max.y,g.min.z),new k(g.min.x,g.min.y,g.max.z),new k(g.min.x,g.max.y,g.max.z),new k(g.max.x,g.max.y,g.max.z),new k(g.max.x,g.max.y,g.min.z),new k(g.max.x,g.min.y,g.max.z),new k(g.max.x,g.min.y,g.min.z)],B=p.current.camPos||l.position,S=p.current.target||(A==null?void 0:A.target),U=p.current.camUp||l.up,b=S?new Me().lookAt(B,S,U).setPosition(B).invert():l.matrixWorldInverse;for(const N of I)N.applyMatrix4(b),C=Math.max(C,Math.abs(N.y)),w=Math.max(w,Math.abs(N.x));C*=2,w*=2;const M=(l.top-l.bottom)/C,D=(l.right-l.left)/w;return p.current.camZoom=Math.min(M,D)/n,v.current=Yi.START,y.current=0,d.current&&d.current(this.getSize()),this},clip(){const{distance:C}=E();return l.near=C/100,l.far=C*100,l.updateProjectionMatrix(),A&&(A.maxDistance=C*10,A.update()),f(),this}}},[g,l,A,n,f]);h.useLayoutEffect(()=>{if(A){const E=()=>{if(A&&p.current.target&&v.current!==Yi.NONE){const C=new k().setFromMatrixColumn(l.matrix,2),w=x.current.camPos.distanceTo(A.target),I=(p.current.camPos||x.current.camPos).distanceTo(p.current.target),B=(1-y.current)*w+y.current*I;A.target.copy(l.position).addScaledVector(C,-B),A.update()}v.current=Yi.NONE};return A.addEventListener("start",E),()=>A.removeEventListener("start",E)}},[A]);const _=h.useRef(0);return h.useLayoutEffect(()=>{(r||_.current++===0)&&(m.refresh(),t&&m.reset().fit(),i&&m.clip())},[u,i,t,r,l,A]),ze((E,C)=>{if(v.current===Yi.START)v.current=Yi.ACTIVE,f();else if(v.current===Yi.ACTIVE){if(y.current+=C/e,y.current>=1)p.current.camPos&&l.position.copy(p.current.camPos),p.current.camRot&&l.quaternion.copy(p.current.camRot),p.current.camUp&&l.up.copy(p.current.camUp),p.current.camZoom&&Pr(l)&&(l.zoom=p.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix(),A&&p.current.target&&(A.target.copy(p.current.target),A.update()),v.current=Yi.NONE;else{const w=o(y.current);p.current.camPos&&l.position.lerpVectors(x.current.camPos,p.current.camPos,w),p.current.camRot&&l.quaternion.slerpQuaternions(x.current.camRot,p.current.camRot,w),p.current.camUp&&l.up.set(0,1,0).applyQuaternion(l.quaternion),p.current.camZoom&&Pr(l)&&(l.zoom=(1-w)*x.current.camZoom+w*p.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix()}f()}}),h.createElement("group",{ref:c},h.createElement(wf.Provider,{value:m},s))}function Wg(){return h.useContext(wf)}const W6=h.forwardRef(({intensity:s=1,decay:e,decayRate:n=.65,maxYaw:r=.1,maxPitch:t=.1,maxRoll:i=.1,yawFrequency:o=.1,pitchFrequency:a=.1,rollFrequency:c=.1},l)=>{const u=re(g=>g.camera),f=re(g=>g.controls),A=h.useRef(s),d=h.useRef(u.rotation.clone()),[x]=h.useState(()=>new Wa),[p]=h.useState(()=>new Wa),[v]=h.useState(()=>new Wa),y=()=>{(A.current<0||A.current>1)&&(A.current=A.current<0?0:1)};return h.useImperativeHandle(l,()=>({getIntensity:()=>A.current,setIntensity:g=>{A.current=g,y()}}),[]),h.useEffect(()=>{if(f){const g=()=>void(d.current=u.rotation.clone());return f.addEventListener("change",g),g(),()=>void f.removeEventListener("change",g)}},[u,f]),ze((g,m)=>{const _=Math.pow(A.current,2),E=r*_*x.noise(g.clock.elapsedTime*o,1),C=t*_*p.noise(g.clock.elapsedTime*a,1),w=i*_*v.noise(g.clock.elapsedTime*c,1);u.rotation.set(d.current.x+C,d.current.y+E,d.current.z+w),e&&A.current>0&&(A.current-=n*m,y())}),null}),If=(s,e,n)=>{let r;switch(s){case ni:r=new Uint8ClampedArray(e*n*4);break;case zt:r=new Uint16Array(e*n*4);break;case lr:r=new Uint32Array(e*n*4);break;case nl:r=new Int8Array(e*n*4);break;case r1:r=new Int16Array(e*n*4);break;case $o:r=new Int32Array(e*n*4);break;case Tt:r=new Float32Array(e*n*4);break;default:throw new Error("Unsupported data type")}return r};let Ho;const Yg=(s,e,n,r)=>{if(Ho!==void 0)return Ho;const t=new Vt(1,1,r);e.setRenderTarget(t);const i=new Qe(new yi,new Jr({color:16777215}));e.render(i,n),e.setRenderTarget(null);const o=If(s,t.width,t.height);return e.readRenderTargetPixels(t,0,0,t.width,t.height,o),t.dispose(),i.geometry.dispose(),i.material.dispose(),Ho=o[0]!==0,Ho};class jl{constructor(e){var n,r,t,i,o,a,c,l,u,f,A,d,x,p,v,y;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(m){throw this._renderer.setRenderTarget(null),m}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const g={format:Wt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(r=e.renderTargetOptions)===null||r===void 0?void 0:r.anisotropy:1,generateMipmaps:((t=e.renderTargetOptions)===null||t===void 0?void 0:t.generateMipmaps)!==void 0?(i=e.renderTargetOptions)===null||i===void 0?void 0:i.generateMipmaps:!1,magFilter:((o=e.renderTargetOptions)===null||o===void 0?void 0:o.magFilter)!==void 0?(a=e.renderTargetOptions)===null||a===void 0?void 0:a.magFilter:Bt,minFilter:((c=e.renderTargetOptions)===null||c===void 0?void 0:c.minFilter)!==void 0?(l=e.renderTargetOptions)===null||l===void 0?void 0:l.minFilter:Bt,samples:((u=e.renderTargetOptions)===null||u===void 0?void 0:u.samples)!==void 0?(f=e.renderTargetOptions)===null||f===void 0?void 0:f.samples:void 0,wrapS:((A=e.renderTargetOptions)===null||A===void 0?void 0:A.wrapS)!==void 0?(d=e.renderTargetOptions)===null||d===void 0?void 0:d.wrapS:vn,wrapT:((x=e.renderTargetOptions)===null||x===void 0?void 0:x.wrapT)!==void 0?(p=e.renderTargetOptions)===null||p===void 0?void 0:p.wrapT:vn};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=jl.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Kn,this._camera=new fi,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Yg(this._type,this._renderer,this._camera,g)){let m;switch(this._type){case zt:m=this._renderer.extensions.has("EXT_color_buffer_float")?Tt:void 0;break}m!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Tt}`),this._type=m):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Qe(new yi,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Vt(this.width,this.height,g),this._renderTarget.texture.mapping=((v=e.renderTargetOptions)===null||v===void 0?void 0:v.mapping)!==void 0?(y=e.renderTargetOptions)===null||y===void 0?void 0:y.mapping:la}static instantiateRenderer(){const e=new RA;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=If(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const n=new Vn(this.toArray(),this.width,this.height,Wt,this._type,(e==null?void 0:e.mapping)||la,(e==null?void 0:e.wrapS)||vn,(e==null?void 0:e.wrapT)||vn,(e==null?void 0:e.magFilter)||Bt,(e==null?void 0:e.minFilter)||Bt,(e==null?void 0:e.anisotropy)||1,rl);return n.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof kt&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof an&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof an&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const jg=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,qg=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Xg extends kt{constructor({gamma:e,offsetHdr:n,offsetSdr:r,gainMapMin:t,gainMapMax:i,maxDisplayBoost:o,hdrCapacityMin:a,hdrCapacityMax:c,sdr:l,gainMap:u}){super({name:"GainMapDecoderMaterial",vertexShader:jg,fragmentShader:qg,uniforms:{sdr:{value:l},gainMap:{value:u},gamma:{value:new k(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new k().fromArray(n)},offsetSdr:{value:new k().fromArray(r)},gainMapMin:{value:new k().fromArray(t)},gainMapMax:{value:new k().fromArray(i)},weightFactor:{value:(Math.log2(o)-a)/(c-a)}},blending:Cl,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=a,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const n=this.uniforms.gamma.value;n.x=1/e[0],n.y=1/e[1],n.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class bf extends Error{}class Bf extends Error{}const Ps=(s,e,n)=>{const r=new RegExp(`${e}="([^"]*)"`,"i").exec(s);if(r)return r[1];const t=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(s);if(t){const i=t[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return i&&i.length===3?i.map(o=>o.replace(/<\/?rdf:li>/g,"")):t[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${e} in gainmap metadata`)},Kg=s=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(s):e=s.toString();let n=e.indexOf("<x:xmpmeta");for(;n!==-1;){const r=e.indexOf("x:xmpmeta>",n),t=e.slice(n,r+10);try{const i=Ps(t,"hdrgm:GainMapMin","0"),o=Ps(t,"hdrgm:GainMapMax"),a=Ps(t,"hdrgm:Gamma","1"),c=Ps(t,"hdrgm:OffsetSDR","0.015625"),l=Ps(t,"hdrgm:OffsetHDR","0.015625"),u=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(t),f=u?u[1]:"0",A=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(t);if(!A)throw new Error("Incomplete gainmap metadata");const d=A[1];return{gainMapMin:Array.isArray(i)?i.map(x=>parseFloat(x)):[parseFloat(i),parseFloat(i),parseFloat(i)],gainMapMax:Array.isArray(o)?o.map(x=>parseFloat(x)):[parseFloat(o),parseFloat(o),parseFloat(o)],gamma:Array.isArray(a)?a.map(x=>parseFloat(x)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetSdr:Array.isArray(c)?c.map(x=>parseFloat(x)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetHdr:Array.isArray(l)?l.map(x=>parseFloat(x)):[parseFloat(l),parseFloat(l),parseFloat(l)],hdrCapacityMin:parseFloat(f),hdrCapacityMax:parseFloat(d)}}catch{}n=e.indexOf("<x:xmpmeta",r)}};class Zg{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((n,r)=>{const t=this.options.debug,i=new DataView(e.buffer);if(i.getUint16(0)!==65496){r(new Error("Not a valid jpeg"));return}const o=i.byteLength;let a=2,c=0,l;for(;a<o;){if(++c>250){r(new Error(`Found no marker after ${c} loops `));return}if(i.getUint8(a)!==255){r(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${i.getUint8(a).toString(16)}`));return}if(l=i.getUint8(a+1),t&&console.log(`Marker: ${l.toString(16)}`),l===226){t&&console.log("Found APP2 marker (0xffe2)");const u=a+4;if(i.getUint32(u)===1297106432){const f=u+4;let A;if(i.getUint16(f)===18761)A=!1;else if(i.getUint16(f)===19789)A=!0;else{r(new Error("No valid endianness marker found in TIFF header"));return}if(i.getUint16(f+2,!A)!==42){r(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const d=i.getUint32(f+4,!A);if(d<8){r(new Error("Not valid TIFF data! (First offset less than 8)"));return}const x=f+d,p=i.getUint16(x,!A),v=x+2;let y=0;for(let E=v;E<v+12*p;E+=12)i.getUint16(E,!A)===45057&&(y=i.getUint32(E+8,!A));const m=x+2+p*12+4,_=[];for(let E=m;E<m+y*16;E+=16){const C={MPType:i.getUint32(E,!A),size:i.getUint32(E+4,!A),dataOffset:i.getUint32(E+8,!A),dependantImages:i.getUint32(E+12,!A),start:-1,end:-1,isFII:!1};C.dataOffset?(C.start=f+C.dataOffset,C.isFII=!1):(C.start=0,C.isFII=!0),C.end=C.start+C.size,_.push(C)}if(this.options.extractNonFII&&_.length){const E=new Blob([i]),C=[];for(const w of _){if(w.isFII&&!this.options.extractFII)continue;const I=E.slice(w.start,w.end+1,"image/jpeg");C.push(I)}n(C)}}}a+=2+i.getUint16(a+2)}})}}const Jg=async s=>{const e=Kg(s);if(!e)throw new Bf("Gain map XMP metadata not found");const r=await new Zg({extractFII:!0,extractNonFII:!0}).extract(s);if(r.length!==2)throw new bf("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:e}},q0=s=>new Promise((e,n)=>{const r=document.createElement("img");r.onload=()=>{e(r)},r.onerror=t=>{n(t)},r.src=URL.createObjectURL(s)});class Sf extends Ks{constructor(e,n){super(n),e&&(this._renderer=e),this._internalLoadingManager=new PA}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Xg({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new an,sdr:new an});return new jl({width:16,height:16,type:zt,colorSpace:rl,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,n,r,t){const i=t?new Blob([t],{type:"image/jpeg"}):void 0,o=new Blob([r],{type:"image/jpeg"});let a,c,l=!1;if(typeof createImageBitmap>"u"){const A=await Promise.all([i?q0(i):Promise.resolve(void 0),q0(o)]);c=A[0],a=A[1],l=!0}else{const A=await Promise.all([i?createImageBitmap(i,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);c=A[0],a=A[1]}const u=new an(c||new ImageData(2,2),la,vn,vn,Bt,pu,Wt,ni,1,rl);u.flipY=l,u.needsUpdate=!0;const f=new an(a,la,vn,vn,Bt,pu,Wt,ni,1,e1);f.flipY=l,f.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=u,e.material.sdr=f,e.material.gainMapMin=n.gainMapMin,e.material.gainMapMax=n.gainMapMax,e.material.offsetHdr=n.offsetHdr,e.material.offsetSdr=n.offsetSdr,e.material.gamma=n.gamma,e.material.hdrCapacityMin=n.hdrCapacityMin,e.material.hdrCapacityMax=n.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class $g extends Sf{load([e,n,r],t,i,o){const a=this.prepareQuadRenderer();let c,l,u;const f=async()=>{if(c&&l&&u){try{await this.render(a,u,c,l)}catch(B){this.manager.itemError(e),this.manager.itemError(n),this.manager.itemError(r),typeof o=="function"&&o(B),a.disposeOnDemandRenderer();return}typeof t=="function"&&t(a),this.manager.itemEnd(e),this.manager.itemEnd(n),this.manager.itemEnd(r),a.disposeOnDemandRenderer()}};let A=!0,d=0,x=0,p=!0,v=0,y=0,g=!0,m=0,_=0;const E=()=>{if(typeof i=="function"){const B=d+v+m,S=x+y+_,U=A&&p&&g;i(new ProgressEvent("progress",{lengthComputable:U,loaded:S,total:B}))}};this.manager.itemStart(e),this.manager.itemStart(n),this.manager.itemStart(r);const C=new Dn(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(e,async B=>{if(typeof B=="string")throw new Error("Invalid sdr buffer");c=B,await f()},B=>{A=B.lengthComputable,x=B.loaded,d=B.total,E()},B=>{this.manager.itemError(e),typeof o=="function"&&o(B)});const w=new Dn(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(n,async B=>{if(typeof B=="string")throw new Error("Invalid gainmap buffer");l=B,await f()},B=>{p=B.lengthComputable,y=B.loaded,v=B.total,E()},B=>{this.manager.itemError(n),typeof o=="function"&&o(B)});const I=new Dn(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(r,async B=>{if(typeof B!="string")throw new Error("Invalid metadata string");u=JSON.parse(B),await f()},B=>{g=B.lengthComputable,_=B.loaded,m=B.total,E()},B=>{this.manager.itemError(r),typeof o=="function"&&o(B)}),a}}class e4 extends Sf{load(e,n,r,t){const i=this.prepareQuadRenderer(),o=new Dn(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async a=>{if(typeof a=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const c=new Uint8Array(a);let l,u,f;try{const A=await Jg(c);l=A.sdr,u=A.gainMap,f=A.metadata}catch(A){if(A instanceof Bf||A instanceof bf)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),f={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},l=c;else throw A}try{await this.render(i,f,l,u)}catch(A){this.manager.itemError(e),typeof t=="function"&&t(A),i.disposeOnDemandRenderer();return}typeof n=="function"&&n(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},r,a=>{this.manager.itemError(e),typeof t=="function"&&t(a)}),i}}const Xs={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Mf="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",qr=s=>Array.isArray(s),ql=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Sa({files:s=ql,path:e="",preset:n=void 0,colorSpace:r=void 0,extensions:t}={}){n&&(Xl(n),s=Xs[n],e=Mf);const i=qr(s),{extension:o,isCubemap:a}=Kl(s),c=Zl(o);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+s);const l=re(d=>d.gl);h.useLayoutEffect(()=>{if(o!=="webp"&&o!=="jpg"&&o!=="jpeg")return;function d(){Ei.clear(c,i?[s]:s)}l.domElement.addEventListener("webglcontextlost",d,{once:!0})},[s,l.domElement]);const u=Ei(c,i?[s]:s,d=>{(o==="webp"||o==="jpg"||o==="jpeg")&&d.setRenderer(l),d.setPath==null||d.setPath(e),t&&t(d)});let f=i?u[0]:u;if(o==="jpg"||o==="jpeg"||o==="webp"){var A;f=(A=f.renderTarget)==null?void 0:A.texture}return f.mapping=a?Hh:QA,f.colorSpace=r??(a?"srgb":"srgb-linear"),f}const t4={files:ql,path:"",preset:void 0,extensions:void 0};Sa.preload=s=>{const e={...t4,...s};let{files:n,path:r=""}=e;const{preset:t,extensions:i}=e;t&&(Xl(t),n=Xs[t],r=Mf);const{extension:o}=Kl(n);if(o==="webp"||o==="jpg"||o==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const a=Zl(o);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+n);Ei.preload(a,qr(n)?[n]:n,c=>{c.setPath==null||c.setPath(r),i&&i(c)})};const i4={files:ql,preset:void 0};Sa.clear=s=>{const e={...i4,...s};let{files:n}=e;const{preset:r}=e;r&&(Xl(r),n=Xs[r]);const{extension:t}=Kl(n),i=Zl(t);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+n);Ei.clear(i,qr(n)?[n]:n)};function Xl(s){if(!(s in Xs))throw new Error("Preset must be one of: "+Object.keys(Xs).join(", "))}function Kl(s){var e;const n=qr(s)&&s.length===6,r=qr(s)&&s.length===3&&s.some(o=>o.endsWith("json")),t=qr(s)?s[0]:s;return{extension:n?"cube":r?"webp":t.startsWith("data:application/exr")?"exr":t.startsWith("data:application/hdr")?"hdr":t.startsWith("data:image/jpeg")?"jpg":(e=t.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:n,isGainmap:r}}function Zl(s){return s==="cube"?Bl:s==="hdr"?Qm:s==="exr"?zm:s==="jpg"||s==="jpeg"?e4:s==="webp"?$g:null}const n4=s=>s.current&&s.current.isScene,r4=s=>n4(s)?s.current:s;function Jl(s,e,n,r,t={}){var i,o,a,c;t={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...t};const l=r4(e||n),u=l.background,f=l.environment,A={backgroundBlurriness:l.backgroundBlurriness,backgroundIntensity:l.backgroundIntensity,backgroundRotation:(i=(o=l.backgroundRotation)==null||o.clone==null?void 0:o.clone())!==null&&i!==void 0?i:[0,0,0],environmentIntensity:l.environmentIntensity,environmentRotation:(a=(c=l.environmentRotation)==null||c.clone==null?void 0:c.clone())!==null&&a!==void 0?a:[0,0,0]};return s!=="only"&&(l.environment=r),s&&(l.background=r),ji(l,t),()=>{s!=="only"&&(l.environment=f),s&&(l.background=u),ji(l,A)}}function $l({scene:s,background:e=!1,map:n,...r}){const t=re(i=>i.scene);return h.useLayoutEffect(()=>{if(n)return Jl(e,s,t,n,r)}),null}function Tf({background:s=!1,scene:e,blur:n,backgroundBlurriness:r,backgroundIntensity:t,backgroundRotation:i,environmentIntensity:o,environmentRotation:a,...c}){const l=Sa(c),u=re(f=>f.scene);return h.useLayoutEffect(()=>Jl(s,e,u,l,{backgroundBlurriness:n??r,backgroundIntensity:t,backgroundRotation:i,environmentIntensity:o,environmentRotation:a})),h.useEffect(()=>()=>{l.dispose()},[l]),null}function s4({children:s,near:e=.1,far:n=1e3,resolution:r=256,frames:t=1,map:i,background:o=!1,blur:a,backgroundBlurriness:c,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:f,environmentRotation:A,scene:d,files:x,path:p,preset:v=void 0,extensions:y}){const g=re(I=>I.gl),m=re(I=>I.scene),_=h.useRef(null),[E]=h.useState(()=>new Kn),C=h.useMemo(()=>{const I=new ga(r);return I.texture.type=zt,I},[r]);h.useEffect(()=>()=>{C.dispose()},[C]),h.useLayoutEffect(()=>{if(t===1){const I=g.autoClear;g.autoClear=!0,_.current.update(g,E),g.autoClear=I}return Jl(o,d,m,C.texture,{backgroundBlurriness:a??c,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:f,environmentRotation:A})},[s,E,C.texture,d,m,o,t,g]);let w=1;return ze(()=>{if(t===1/0||w<t){const I=g.autoClear;g.autoClear=!0,_.current.update(g,E),g.autoClear=I,w++}}),h.createElement(h.Fragment,null,Ar(h.createElement(h.Fragment,null,s,h.createElement("cubeCamera",{ref:_,args:[e,n,C]}),x||v?h.createElement(Tf,{background:!0,files:x,preset:v,path:p,extensions:y}):i?h.createElement($l,{background:!0,map:i,extensions:y}):null),E))}function o4(s){var e,n,r,t;const i=Sa(s),o=s.map||i;h.useMemo(()=>Gt({GroundProjectedEnvImpl:hd}),[]),h.useEffect(()=>()=>{i.dispose()},[i]);const a=h.useMemo(()=>[o],[o]),c=(e=s.ground)==null?void 0:e.height,l=(n=s.ground)==null?void 0:n.radius,u=(r=(t=s.ground)==null?void 0:t.scale)!==null&&r!==void 0?r:1e3;return h.createElement(h.Fragment,null,h.createElement($l,me({},s,{map:o})),h.createElement("groundProjectedEnvImpl",{args:a,scale:u,height:c,radius:l}))}function a4(s){return s.ground?h.createElement(o4,s):s.map?h.createElement($l,s):s.children?h.createElement(s4,s):h.createElement(Tf,s)}const c4=h.forwardRef(({scale:s=10,frames:e=1/0,opacity:n=1,width:r=1,height:t=1,blur:i=1,near:o=0,far:a=10,resolution:c=512,smooth:l=!0,color:u="#000000",depthWrite:f=!1,renderOrder:A,...d},x)=>{const p=h.useRef(null),v=re(D=>D.scene),y=re(D=>D.gl),g=h.useRef(null);r=r*(Array.isArray(s)?s[0]:s||1),t=t*(Array.isArray(s)?s[1]:s||1);const[m,_,E,C,w,I,B]=h.useMemo(()=>{const D=new Vt(c,c),N=new Vt(c,c);N.texture.generateMipmaps=D.texture.generateMipmaps=!1;const G=new yi(r,t).rotateX(Math.PI/2),q=new Qe(G),X=new jh;X.depthTest=X.depthWrite=!1,X.onBeforeCompile=T=>{T.uniforms={...T.uniforms,ucolor:{value:new Ve(u)}},T.fragmentShader=T.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),T.fragmentShader=T.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const O=new kt(tm),H=new kt(im);return H.depthTest=O.depthTest=!1,[D,G,X,q,O,H,N]},[c,r,t,s,u]),S=D=>{C.visible=!0,C.material=w,w.uniforms.tDiffuse.value=m.texture,w.uniforms.h.value=D*1/256,y.setRenderTarget(B),y.render(C,g.current),C.material=I,I.uniforms.tDiffuse.value=B.texture,I.uniforms.v.value=D*1/256,y.setRenderTarget(m),y.render(C,g.current),C.visible=!1};let U=0,b,M;return ze(()=>{g.current&&(e===1/0||U<e)&&(U++,b=v.background,M=v.overrideMaterial,p.current.visible=!1,v.background=null,v.overrideMaterial=E,y.setRenderTarget(m),y.render(v,g.current),S(i),l&&S(i*.4),y.setRenderTarget(null),p.current.visible=!0,v.overrideMaterial=M,v.background=b)}),h.useImperativeHandle(x,()=>p.current,[]),h.createElement("group",me({"rotation-x":Math.PI/2},d,{ref:p}),h.createElement("mesh",{renderOrder:A,geometry:_,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},h.createElement("meshBasicMaterial",{transparent:!0,map:m.texture,opacity:n,depthWrite:f})),h.createElement("orthographicCamera",{ref:g,args:[-r/2,r/2,t/2,-t/2,o,a]}))});function l4(s){return s.isLight}function u4(s){return!!s.geometry}const Df=h.createContext(null),h4=ln({color:new Ve,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),f4=h.forwardRef(({children:s,temporal:e,frames:n=40,limit:r=1/0,blend:t=20,scale:i=10,opacity:o=1,alphaTest:a=.75,color:c="black",colorBlend:l=2,resolution:u=1024,toneMapped:f=!0,...A},d)=>{Gt({SoftShadowMaterial:h4});const x=re(C=>C.gl),p=re(C=>C.scene),v=re(C=>C.camera),y=re(C=>C.invalidate),g=h.useRef(null),m=h.useRef(null),[_]=h.useState(()=>new d4(x,p,u));h.useLayoutEffect(()=>{_.configure(g.current)},[]);const E=h.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,n),blend:Math.max(2,n===1/0?t:n),count:0,getMesh:()=>g.current,reset:()=>{_.clear();const C=g.current.material;C.opacity=0,C.alphaTest=0,E.count=0},update:(C=1)=>{const w=g.current.material;E.temporal?(w.opacity=Math.min(o,w.opacity+o/E.blend),w.alphaTest=Math.min(a,w.alphaTest+a/E.blend)):(w.opacity=o,w.alphaTest=a),m.current.visible=!0,_.prepare();for(let I=0;I<C;I++)E.lights.forEach(B=>B.update()),_.update(v,E.blend);m.current.visible=!1,_.finish()}}),[_,v,p,e,n,t,o,a]);return h.useLayoutEffect(()=>{E.reset(),!E.temporal&&E.frames!==1/0&&E.update(E.blend)}),h.useImperativeHandle(d,()=>E,[E]),ze(()=>{(E.temporal||E.frames===1/0)&&E.count<E.frames&&E.count<r&&(y(),E.update(),E.count++)}),h.createElement("group",A,h.createElement("group",{traverse:()=>null,ref:m},h.createElement(Df.Provider,{value:E},s)),h.createElement("mesh",{receiveShadow:!0,ref:g,scale:i,rotation:[-Math.PI/2,0,0]},h.createElement("planeGeometry",null),h.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:f,color:c,blend:l,map:_.progressiveLightMap2.texture})))}),A4=h.forwardRef(({castShadow:s=!0,bias:e=.001,mapSize:n=512,size:r=5,near:t=.5,far:i=500,frames:o=1,position:a=[0,0,0],radius:c=1,amount:l=8,intensity:u=mi>=155?Math.PI:1,ambient:f=.5,...A},d)=>{const x=h.useRef(null),p=new k(...a).length(),v=h.useContext(Df),y=h.useCallback(()=>{let m;if(x.current)for(let _=0;_<x.current.children.length;_++)if(m=x.current.children[_],Math.random()>f)m.position.set(a[0]+je.randFloatSpread(c),a[1]+je.randFloatSpread(c),a[2]+je.randFloatSpread(c));else{let E=Math.acos(2*Math.random()-1)-Math.PI/2,C=2*Math.PI*Math.random();m.position.set(Math.cos(E)*Math.cos(C)*p,Math.abs(Math.cos(E)*Math.sin(C)*p),Math.sin(E)*p)}},[c,f,p,...a]),g=h.useMemo(()=>({update:y}),[y]);return h.useImperativeHandle(d,()=>g,[g]),h.useLayoutEffect(()=>{var m;const _=x.current;return v&&((m=v.lights)==null||m.set(_.uuid,g)),()=>{var E;return void(v==null||(E=v.lights)==null?void 0:E.delete(_.uuid))}},[v,g]),h.createElement("group",me({ref:x},A),Array.from({length:l},(m,_)=>h.createElement("directionalLight",{key:_,castShadow:s,"shadow-bias":e,"shadow-mapSize":[n,n],intensity:u/l},h.createElement("orthographicCamera",{attach:"shadow-camera",args:[-r,r,r,-r,t,i]}))))});class d4{constructor(e,n,r=1024){this.renderer=e,this.res=r,this.scene=n,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new Ve,this.clearAlpha=0;const t={type:zt,magFilter:Mt,minFilter:Mt};this.progressiveLightMap1=new Vt(this.res,this.res,t),this.progressiveLightMap2=new Vt(this.res,this.res,t),this.discardMat=new Yl,this.targetMat=new l1({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=i=>{i.vertexShader=`varying vec2 vUv;
`+i.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const o=i.fragmentShader.indexOf("void main() {");i.fragmentShader=`varying vec2 vUv;
`+i.fragmentShader.slice(0,o)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+i.fragmentShader.slice(o-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,i.uniforms.previousShadowMap=this.previousShadowMap,i.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{u4(e)?this.meshes.push({object:e,material:e.material}):l4(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,n=100){if(!this.object)return;this.averagingWindow.value=n,this.object.material=this.targetMat;const r=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,t=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,i=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(r),this.previousShadowMap.value=t.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=i}}const m4={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function p4({radius:s,adjustCamera:e}){const n=Wg();return h.useEffect(()=>{e&&n.refresh().clip().fit()},[s,e]),null}function Y6({children:s,center:e,adjustCamera:n=!0,intensity:r=.5,shadows:t="contact",environment:i="city",preset:o="rembrandt",...a}){var c,l,u,f,A,d,x,p;const v=typeof o=="string"?m4[o]:o,[{radius:y,height:g},m]=h.useState({radius:0,width:0,height:0,depth:0}),_=(c=t==null?void 0:t.bias)!==null&&c!==void 0?c:-1e-4,E=(l=t==null?void 0:t.normalBias)!==null&&l!==void 0?l:0,C=(u=t==null?void 0:t.size)!==null&&u!==void 0?u:1024,w=(f=t==null?void 0:t.offset)!==null&&f!==void 0?f:0,I=t==="contact"||(t==null?void 0:t.type)==="contact",B=t==="accumulative"||(t==null?void 0:t.type)==="accumulative",S={...typeof t=="object"?t:{}},U=i?typeof i=="string"?{preset:i}:i:null,b=h.useCallback(M=>{const{width:D,height:N,depth:G,boundingSphere:q}=M;m({radius:q.radius,width:D,height:N,depth:G}),e!=null&&e.onCentered&&e.onCentered(M)},[]);return h.createElement(h.Fragment,null,h.createElement("ambientLight",{intensity:r/3}),h.createElement("spotLight",{penumbra:1,position:[v.main[0]*y,v.main[1]*y,v.main[2]*y],intensity:r*2,castShadow:!!t,"shadow-bias":_,"shadow-normalBias":E,"shadow-mapSize":C}),h.createElement("pointLight",{position:[v.fill[0]*y,v.fill[1]*y,v.fill[2]*y],intensity:r}),h.createElement(Vg,me({fit:!!n,clip:!!n,margin:Number(n),observe:!0},a),h.createElement(p4,{radius:y,adjustCamera:n}),h.createElement(o1,me({},e,{position:[0,w/2,0],onCentered:b}),s)),h.createElement("group",{position:[0,-g/2-w/2,0]},I&&h.createElement(c4,me({scale:y*4,far:y,blur:2},S)),B&&h.createElement(f4,me({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:y*4},S),h.createElement(A4,{amount:(A=S.amount)!==null&&A!==void 0?A:8,radius:(d=S.radius)!==null&&d!==void 0?d:y,ambient:(x=S.ambient)!==null&&x!==void 0?x:.5,intensity:(p=S.intensity)!==null&&p!==void 0?p:1,position:[v.main[0]*y,v.main[1]*y,v.main[2]*y],size:y*4,bias:-_,mapSize:C}))),i&&h.createElement(a4,U))}const g4=s=>s===0?0:Math.pow(2,10*s-10);function j6({children:s,floor:e=.25,segments:n=20,receiveShadow:r,...t}){const i=h.useRef(null);return h.useLayoutEffect(()=>{let o=0;const a=n/n/2,c=i.current.attributes.position;for(let l=0;l<n+1;l++)for(let u=0;u<n+1;u++)c.setXYZ(o++,l/n-a+(l===0?-e:0),u/n-a,g4(l/n));c.needsUpdate=!0,i.current.computeVertexNormals()},[n,e]),h.createElement("group",t,h.createElement("mesh",{receiveShadow:r,rotation:[-Math.PI/2,0,Math.PI/2]},h.createElement("planeGeometry",{ref:i,args:[1,1,n,n]}),s))}const q6=h.forwardRef(({fog:s=!1,renderOrder:e,depthWrite:n=!1,colorStop:r=0,color:t="black",opacity:i=.5,...o},a)=>{const c=h.useMemo(()=>{const l=document.createElement("canvas");l.width=128,l.height=128;const u=l.getContext("2d"),f=u.createRadialGradient(l.width/2,l.height/2,0,l.width/2,l.height/2,l.width/2);return f.addColorStop(r,new Ve(t).getStyle()),f.addColorStop(1,"rgba(0,0,0,0)"),u.fillStyle=f,u.fillRect(0,0,l.width,l.height),l},[t,r]);return h.createElement("mesh",me({renderOrder:e,ref:a,"rotation-x":-Math.PI/2},o),h.createElement("planeGeometry",null),h.createElement("meshBasicMaterial",{transparent:!0,opacity:i,fog:s,depthWrite:n,side:Jt},h.createElement("canvasTexture",{attach:"map",args:[c]})))});function X0(s=ca){const e={value:new Me};return Object.assign(new UA({side:s}),{viewMatrix:e,onBeforeCompile:n=>{n.uniforms.viewMatrix=e,n.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+n.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}const y4=ln({causticsTexture:null,causticsTextureB:null,color:new Ve,lightProjMatrix:new Me,lightViewMatrix:new Me},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),v4=ln({cameraMatrixWorld:new Me,cameraProjectionMatrixInv:new Me,normalTexture:null,depthTexture:null,lightDir:new k(0,1,0),lightPlaneNormal:new k(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new Me,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),K0={depth:!0,minFilter:Bt,magFilter:Bt,type:ni},Z0={minFilter:wl,magFilter:Bt,type:Tt,generateMipmaps:!0},X6=h.forwardRef(({debug:s,children:e,frames:n=1,ior:r=1.1,color:t="white",causticsOnly:i=!1,backside:o=!1,backsideIOR:a=1.1,worldRadius:c=.3125,intensity:l=.05,resolution:u=2024,lightSource:f=[5,5,5],...A},d)=>{Gt({CausticsProjectionMaterial:y4});const x=h.useRef(null),p=h.useRef(null),v=h.useRef(null),y=h.useRef(null),g=re(F=>F.gl),m=of(s&&p,zA),_=Bi(u,u,K0),E=Bi(u,u,K0),C=Bi(u,u,Z0),w=Bi(u,u,Z0),[I]=h.useState(()=>X0()),[B]=h.useState(()=>X0(Kr)),[S]=h.useState(()=>new v4),[U]=h.useState(()=>new Tn(S));h.useLayoutEffect(()=>{x.current.updateWorldMatrix(!1,!0)});let b=0;const M=new k,D=new Gh,N=new Me,G=new qn,q=new k,X=new k,O=new Rt,H=new k,T=[],W=[],j=[],L=[],z=new k;for(let F=0;F<8;F++)T.push(new k),W.push(new k),j.push(new k),L.push(new k);return ze(()=>{if(n===1/0||b++<n){var F,R;Array.isArray(f)?q.fromArray(f).normalize():q.copy(x.current.worldToLocal(f.current.getWorldPosition(M)).normalize()),X.copy(q).multiplyScalar(-1),(F=v.current.parent)==null||F.matrixWorld.identity(),O.setFromObject(v.current,!0),T[0].set(O.min.x,O.min.y,O.min.z),T[1].set(O.min.x,O.min.y,O.max.z),T[2].set(O.min.x,O.max.y,O.min.z),T[3].set(O.min.x,O.max.y,O.max.z),T[4].set(O.max.x,O.min.y,O.min.z),T[5].set(O.max.x,O.min.y,O.max.z),T[6].set(O.max.x,O.max.y,O.min.z),T[7].set(O.max.x,O.max.y,O.max.z);for(let K=0;K<8;K++)W[K].copy(T[K]);O.getCenter(H),T.map(K=>K.sub(H));const Q=G.set(X,0);T.map((K,Y)=>Q.projectPoint(K,j[Y]));const J=j.reduce((K,Y)=>K.add(Y),M.set(0,0,0)).divideScalar(j.length),ie=j.map(K=>K.distanceTo(J)).reduce((K,Y)=>Math.max(K,Y)),Z=T.map(K=>K.dot(q)).reduce((K,Y)=>Math.max(K,Y));p.current.position.copy(z.copy(q).multiplyScalar(Z).add(H)),p.current.lookAt(v.current.localToWorld(H));const ee=N.lookAt(p.current.position,H,M.set(0,1,0));p.current.left=-ie,p.current.right=ie,p.current.top=ie,p.current.bottom=-ie;const ge=M.set(0,ie,0).applyMatrix4(ee),pe=(p.current.position.y+ge.y)/q.y;p.current.near=.1,p.current.far=pe,p.current.updateProjectionMatrix(),p.current.updateMatrixWorld();const te=W.map((K,Y)=>K.add(L[Y].copy(q).multiplyScalar(-K.y/q.y))),ae=te.reduce((K,Y)=>K.add(Y),M.set(0,0,0)).divideScalar(te.length),de=2*te.map(K=>Math.hypot(K.x-ae.x,K.z-ae.z)).reduce((K,Y)=>Math.max(K,Y));y.current.scale.setScalar(de),y.current.position.copy(ae),s&&((R=m.current)==null||R.update()),B.viewMatrix.value=I.viewMatrix.value=p.current.matrixWorldInverse;const se=D.setFromProjectionMatrix(N.multiplyMatrices(p.current.projectionMatrix,p.current.matrixWorldInverse)).planes[4];S.cameraMatrixWorld=p.current.matrixWorld,S.cameraProjectionMatrixInv=p.current.projectionMatrixInverse,S.lightDir=X,S.lightPlaneNormal=se.normal,S.lightPlaneConstant=se.constant,S.near=p.current.near,S.far=p.current.far,S.resolution=u,S.size=ie,S.intensity=l,S.worldRadius=c,v.current.visible=!0,g.setRenderTarget(_),g.clear(),v.current.overrideMaterial=I,g.render(v.current,p.current),g.setRenderTarget(E),g.clear(),o&&(v.current.overrideMaterial=B,g.render(v.current,p.current)),v.current.overrideMaterial=null,S.ior=r,y.current.material.lightProjMatrix=p.current.projectionMatrix,y.current.material.lightViewMatrix=p.current.matrixWorldInverse,S.normalTexture=_.texture,S.depthTexture=_.depthTexture,g.setRenderTarget(C),g.clear(),U.render(g),S.ior=a,S.normalTexture=E.texture,S.depthTexture=E.depthTexture,g.setRenderTarget(w),g.clear(),o&&U.render(g),g.setRenderTarget(null),i&&(v.current.visible=!1)}}),h.useImperativeHandle(d,()=>x.current,[]),h.createElement("group",me({ref:x},A),h.createElement("scene",{ref:v},h.createElement("orthographicCamera",{ref:p,up:[0,1,0]}),e),h.createElement("mesh",{renderOrder:2,ref:y,"rotation-x":-Math.PI/2},h.createElement("planeGeometry",null),h.createElement("causticsProjectionMaterial",{transparent:!0,color:t,causticsTexture:C.texture,causticsTextureB:w.texture,blending:Zh,blendSrc:Kh,blendDst:FA,depthWrite:!1}),s&&h.createElement(J2,null,h.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))});class E4 extends kt{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new k(0,0,0)},lightColor:{value:new Ve("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new Te(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}var x4=`#define GLSLIFY 1
varying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}`;const _4=s=>s==null?void 0:s.isSpotLight;function C4({opacity:s=1,radiusTop:e,radiusBottom:n,depthBuffer:r,color:t="white",distance:i=5,angle:o=.15,attenuation:a=5,anglePower:c=5}){const l=h.useRef(null),u=re(v=>v.size),f=re(v=>v.camera),A=re(v=>v.viewport.dpr),[d]=h.useState(()=>new E4),[x]=h.useState(()=>new k);e=e===void 0?.1:e,n=n===void 0?o*7:n,ze(()=>{d.uniforms.spotPosition.value.copy(l.current.getWorldPosition(x)),l.current.lookAt(l.current.parent.target.getWorldPosition(x))});const p=h.useMemo(()=>{const v=new Wi(e,n,i,128,64,!0);return v.applyMatrix4(new Me().makeTranslation(0,-i/2,0)),v.applyMatrix4(new Me().makeRotationX(-Math.PI/2)),v},[i,e,n]);return h.createElement(h.Fragment,null,h.createElement("mesh",{ref:l,geometry:p,raycast:()=>null},h.createElement("primitive",{object:d,attach:"material","uniforms-opacity-value":s,"uniforms-lightColor-value":t,"uniforms-attenuation-value":a,"uniforms-anglePower-value":c,"uniforms-depth-value":r,"uniforms-cameraNear-value":f.near,"uniforms-cameraFar-value":f.far,"uniforms-resolution-value":r?[u.width*A,u.height*A]:[0,0]})))}function Rf(s,e,n,r,t){const[[i,o]]=h.useState(()=>[new k,new k]);h.useLayoutEffect(()=>{if(_4(s.current))s.current.shadow.mapSize.set(n,r),s.current.shadow.needsUpdate=!0;else throw new Error("SpotlightShadow must be a child of a SpotLight")},[s,n,r]),ze(()=>{if(!s.current)return;const a=s.current.position,c=s.current.target.position;o.copy(c).sub(a);var l=o.length();o.normalize().multiplyScalar(l*t),i.copy(a).add(o),e.current.position.copy(i),e.current.lookAt(s.current.target.position)})}function w4({distance:s=.4,alphaTest:e=.5,map:n,shader:r=x4,width:t=512,height:i=512,scale:o=1,children:a,...c}){const l=h.useRef(null),u=c.spotlightRef,f=c.debug;Rf(u,l,t,i,s);const A=h.useMemo(()=>new Vt(t,i,{format:Wt,stencilBuffer:!1}),[t,i]),d=h.useRef({uShadowMap:{value:n},uTime:{value:0}});h.useEffect(()=>void(d.current.uShadowMap.value=n),[n]);const x=h.useMemo(()=>new Tn(new kt({uniforms:d.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:r})),[r]);return h.useEffect(()=>()=>{x.material.dispose(),x.dispose()},[x]),h.useEffect(()=>()=>A.dispose(),[A]),ze(({gl:p},v)=>{d.current.uTime.value+=v,p.setRenderTarget(A),x.render(p),p.setRenderTarget(null)}),h.createElement(h.Fragment,null,h.createElement("mesh",{ref:l,scale:o,castShadow:!0},h.createElement("planeGeometry",null),h.createElement("meshBasicMaterial",{transparent:!0,side:Jt,alphaTest:e,alphaMap:A.texture,"alphaMap-wrapS":Wn,"alphaMap-wrapT":Wn,opacity:f?1:0},a)))}function I4({distance:s=.4,alphaTest:e=.5,map:n,width:r=512,height:t=512,scale:i,children:o,...a}){const c=h.useRef(null),l=a.spotlightRef,u=a.debug;return Rf(l,c,r,t,s),h.createElement(h.Fragment,null,h.createElement("mesh",{ref:c,scale:i,castShadow:!0},h.createElement("planeGeometry",null),h.createElement("meshBasicMaterial",{transparent:!0,side:Jt,alphaTest:e,alphaMap:n,"alphaMap-wrapS":Wn,"alphaMap-wrapT":Wn,opacity:u?1:0},o)))}function K6(s){return s.shader?h.createElement(w4,s):h.createElement(I4,s)}const Z6=h.forwardRef(({opacity:s=1,radiusTop:e,radiusBottom:n,depthBuffer:r,color:t="white",distance:i=5,angle:o=.15,attenuation:a=5,anglePower:c=5,volumetric:l=!0,debug:u=!1,children:f,...A},d)=>{const x=h.useRef(null);return h.useImperativeHandle(d,()=>x.current,[]),h.createElement("group",null,u&&x.current&&h.createElement("spotLightHelper",{args:[x.current]}),h.createElement("spotLight",me({ref:x,angle:o,color:t,distance:i,castShadow:!0},A),l&&h.createElement(C4,{debug:u,opacity:s,radiusTop:e,radiusBottom:n,depthBuffer:r,color:t,distance:i,angle:o,attenuation:a,anglePower:c})),f&&h.cloneElement(f,{spotlightRef:x,debug:u}))}),J6=h.forwardRef(({light:s,args:e,map:n,toneMapped:r=!1,color:t="white",form:i="rect",intensity:o=1,scale:a=1,target:c=[0,0,0],children:l,...u},f)=>{const A=h.useRef(null);return h.useImperativeHandle(f,()=>A.current,[]),h.useLayoutEffect(()=>{!l&&!u.material&&(ji(A.current.material,{color:t}),A.current.material.color.multiplyScalar(o))},[t,o,l,u.material]),h.useLayoutEffect(()=>{u.rotation||A.current.quaternion.identity(),c&&!u.rotation&&(typeof c=="boolean"?A.current.lookAt(0,0,0):A.current.lookAt(Array.isArray(c)?new k(...c):c))},[c,u.rotation]),a=Array.isArray(a)&&a.length===2?[a[0],a[1],1]:a,h.createElement("mesh",me({ref:A,scale:a},u),i==="circle"?h.createElement("ringGeometry",{args:e||[0,.5,64]}):i==="ring"?h.createElement("ringGeometry",{args:e||[.25,.5,64]}):i==="rect"||i==="plane"?h.createElement("planeGeometry",{args:e||[1,1]}):i==="box"?h.createElement("boxGeometry",{args:e||[1,1,1]}):h.createElement(i,{args:e}),l||h.createElement("meshBasicMaterial",{toneMapped:r,map:n,side:Jt}),s&&h.createElement("pointLight",me({castShadow:!0},s)))});function b4(s,e,n=new k){const r=Math.PI*(s-.5),t=2*Math.PI*(e-.5);return n.x=Math.cos(t),n.y=Math.sin(r),n.z=Math.sin(t),n}const $6=h.forwardRef(({inclination:s=.6,azimuth:e=.1,distance:n=1e3,mieCoefficient:r=.005,mieDirectionalG:t=.8,rayleigh:i=.5,turbidity:o=10,sunPosition:a=b4(s,e),...c},l)=>{const u=h.useMemo(()=>new k().setScalar(n),[n]),[f]=h.useState(()=>new ld);return h.createElement("primitive",me({object:f,ref:l,"material-uniforms-mieCoefficient-value":r,"material-uniforms-mieDirectionalG-value":t,"material-uniforms-rayleigh-value":i,"material-uniforms-sunPosition-value":a,"material-uniforms-turbidity-value":o,scale:u},c))});class B4 extends kt{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const S4=s=>new k().setFromSpherical(new _l(s,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),ev=h.forwardRef(({radius:s=100,depth:e=50,count:n=5e3,saturation:r=0,factor:t=4,fade:i=!1,speed:o=1},a)=>{const c=h.useRef(null),[l,u,f]=h.useMemo(()=>{const d=[],x=[],p=Array.from({length:n},()=>(.5+.5*Math.random())*t),v=new Ve;let y=s+e;const g=e/n;for(let m=0;m<n;m++)y-=g*Math.random(),d.push(...S4(y).toArray()),v.setHSL(m/n,r,.9),x.push(v.r,v.g,v.b);return[new Float32Array(d),new Float32Array(x),new Float32Array(p)]},[n,e,t,s,r]);ze(d=>c.current&&(c.current.uniforms.time.value=d.clock.elapsedTime*o));const[A]=h.useState(()=>new B4);return h.createElement("points",{ref:a},h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",args:[l,3]}),h.createElement("bufferAttribute",{attach:"attributes-color",args:[u,3]}),h.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]})),h.createElement("primitive",{ref:c,object:A,attach:"material",blending:kA,"uniforms-fade-value":i,depthWrite:!1,transparent:!0,vertexColors:!0}))}),M4="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",J0=new Me,Vo=new k,Wo=new st,$0=new k,eh=new st,Qs=new k,eu=h.createContext(null),T4=h.forwardRef(({children:s,material:e=l1,texture:n=M4,range:r,limit:t=200,frustumCulled:i,...o},a)=>{var c,l;const u=h.useMemo(()=>class extends e{constructor(){super();const I=parseInt(pa.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=B=>{B.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+B.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),B.fragmentShader=`varying float vOpacity;
              `+B.fragmentShader.replace(`#include <${I}>`,`#include <${I}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[e]);Gt({CloudMaterial:u});const f=h.useRef(null),A=h.useRef([]),d=h.useMemo(()=>new Float32Array(Array.from({length:t},()=>1)),[t]),x=h.useMemo(()=>new Float32Array(Array.from({length:t},()=>[1,1,1]).flat()),[t]),p=va(n);let v=0,y=0,g;const m=new st,_=new k(0,0,1),E=new k;ze((I,B)=>{for(v=I.clock.elapsedTime,J0.copy(f.current.matrixWorld).invert(),I.camera.matrixWorld.decompose($0,eh,Qs),y=0;y<A.current.length;y++)g=A.current[y],g.ref.current.matrixWorld.decompose(Vo,Wo,Qs),Vo.add(E.copy(g.position).applyQuaternion(Wo).multiply(Qs)),Wo.copy(eh).multiply(m.setFromAxisAngle(_,g.rotation+=B*g.rotationFactor)),Qs.multiplyScalar(g.volume+(1+Math.sin(v*g.density*g.speed))/2*g.growth),g.matrix.compose(Vo,Wo,Qs).premultiply(J0),g.dist=Vo.distanceTo($0);for(A.current.sort((S,U)=>U.dist-S.dist),y=0;y<A.current.length;y++)g=A.current[y],d[y]=g.opacity*(g.dist<g.fade-1?g.dist/g.fade:1),f.current.setMatrixAt(y,g.matrix),f.current.setColorAt(y,g.color);f.current.geometry.attributes.cloudOpacity.needsUpdate=!0,f.current.instanceMatrix.needsUpdate=!0,f.current.instanceColor&&(f.current.instanceColor.needsUpdate=!0)}),h.useLayoutEffect(()=>{const I=Math.min(t,r!==void 0?r:t,A.current.length);f.current.count=I,js(f.current.instanceMatrix,{start:0,count:I*16}),f.current.instanceColor&&js(f.current.instanceColor,{start:0,count:I*3}),js(f.current.geometry.attributes.cloudOpacity,{start:0,count:I})});let C=[(c=p.image.width)!==null&&c!==void 0?c:1,(l=p.image.height)!==null&&l!==void 0?l:1];const w=Math.max(C[0],C[1]);return C=[C[0]/w,C[1]/w],h.createElement("group",me({ref:a},o),h.createElement(eu.Provider,{value:A},s,h.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:f,args:[null,null,t],frustumCulled:i},h.createElement("instancedBufferAttribute",{usage:Ai,attach:"instanceColor",args:[x,3]}),h.createElement("planeGeometry",{args:[...C]},h.createElement("instancedBufferAttribute",{usage:Ai,attach:"attributes-cloudOpacity",args:[d,1]})),h.createElement("cloudMaterial",{key:e.name,map:p,transparent:!0,depthWrite:!1}))))}),th=h.forwardRef(({opacity:s=1,speed:e=0,bounds:n=[5,1,1],segments:r=20,color:t="#ffffff",fade:i=10,volume:o=6,smallestVolume:a=.25,distribute:c=null,growth:l=4,concentrate:u="inside",seed:f=Math.random(),...A},d)=>{function x(){const m=Math.sin(f++)*1e4;return m-Math.floor(m)}const p=h.useContext(eu),v=h.useRef(null),y=h.useId(),g=h.useMemo(()=>[...new Array(r)].map((m,_)=>({segments:r,bounds:new k(1,1,1),position:new k,uuid:y,index:_,ref:v,dist:0,matrix:new Me,color:new Ve,rotation:_*(Math.PI/r)})),[r,y]);return h.useLayoutEffect(()=>{g.forEach((m,_)=>{ji(m,{volume:o,color:t,speed:e,growth:l,opacity:s,fade:i,bounds:n,density:Math.max(.5,x()),rotationFactor:Math.max(.2,.5*x())*e});const E=c==null?void 0:c(m,_);if(E||r>1){var C;m.position.copy(m.bounds).multiply((C=E==null?void 0:E.point)!==null&&C!==void 0?C:{x:x()*2-1,y:x()*2-1,z:x()*2-1})}const w=Math.abs(m.position.x),I=Math.abs(m.position.y),B=Math.abs(m.position.z),S=Math.max(w,I,B);m.length=1,w===S&&(m.length-=w/m.bounds.x),I===S&&(m.length-=I/m.bounds.y),B===S&&(m.length-=B/m.bounds.z),m.volume=((E==null?void 0:E.volume)!==void 0?E.volume:Math.max(Math.max(0,a),u==="random"?x():u==="inside"?m.length:1-m.length))*o})},[u,n,i,t,s,l,o,f,r,e]),h.useLayoutEffect(()=>{const m=g;return p.current=[...p.current,...m],()=>{p.current=p.current.filter(_=>_.uuid!==y)}},[g]),h.useImperativeHandle(d,()=>v.current,[]),h.createElement("group",me({ref:v},A))}),tv=h.forwardRef((s,e)=>h.useContext(eu)?h.createElement(th,me({ref:e},s)):h.createElement(T4,null,h.createElement(th,me({ref:e},s))));class D4 extends kt{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}const Pf=s=>s&&s.constructor===Float32Array,R4=s=>[s.r,s.g,s.b],Qf=s=>s instanceof Te||s instanceof k||s instanceof Li,zf=s=>Array.isArray(s)?s:Qf(s)?s.toArray():[s,s,s];function zs(s,e,n){return h.useMemo(()=>{if(e!==void 0){if(Pf(e))return e;if(e instanceof Ve){const r=Array.from({length:s*3},()=>R4(e)).flat();return Float32Array.from(r)}else if(Qf(e)||Array.isArray(e)){const r=Array.from({length:s*3},()=>zf(e)).flat();return Float32Array.from(r)}return Float32Array.from({length:s},()=>e)}return Float32Array.from({length:s},n)},[e])}const iv=h.forwardRef(({noise:s=1,count:e=100,speed:n=1,opacity:r=1,scale:t=1,size:i,color:o,children:a,...c},l)=>{h.useMemo(()=>Gt({SparklesImplMaterial:D4}),[]);const u=h.useRef(null),f=re(m=>m.viewport.dpr),A=zf(t),d=h.useMemo(()=>Float32Array.from(Array.from({length:e},()=>A.map(je.randFloatSpread)).flat()),[e,...A]),x=zs(e,i,Math.random),p=zs(e,r),v=zs(e,n),y=zs(e*3,s),g=zs(o===void 0?e*3:e,Pf(o)?o:new Ve(o),()=>1);return ze(m=>{u.current&&u.current.material&&(u.current.material.time=m.clock.elapsedTime)}),h.useImperativeHandle(l,()=>u.current,[]),h.createElement("points",me({key:`particle-${e}-${JSON.stringify(t)}`},c,{ref:u}),h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),h.createElement("bufferAttribute",{attach:"attributes-size",args:[x,1]}),h.createElement("bufferAttribute",{attach:"attributes-opacity",args:[p,1]}),h.createElement("bufferAttribute",{attach:"attributes-speed",args:[v,1]}),h.createElement("bufferAttribute",{attach:"attributes-color",args:[g,3]}),h.createElement("bufferAttribute",{attach:"attributes-noise",args:[y,3]})),a||h.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:f,depthWrite:!1}))});function P4(s){switch(s){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}const Q4="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",z4="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function F4(s=0,e=1024,n){const r=Xn(()=>fetch(Q4).then(u=>u.json()),["matcapList"]),t=r[0],i=h.useMemo(()=>Object.keys(r).length,[]),a=`${h.useMemo(()=>typeof s=="string"?s:typeof s=="number"?r[s]:null,[s])||t}${P4(e)}.png`,c=`${z4}/${e}/${a}`;return[va(c,n),c,i]}const nv=({children:s,id:e,format:n,onLoad:r})=>{const t=F4(e,n,r);return h.createElement(h.Fragment,null,s==null?void 0:s(t))},U4="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",k4="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function L4(s=0,e={},n){const{repeat:r=[1,1],anisotropy:t=1,offset:i=[0,0]}=e,o=Xn(()=>fetch(k4).then(A=>A.json()),["normalsList"]),a=h.useMemo(()=>Object.keys(o).length,[]),c=o[0],l=o[s]||c,u=`${U4}/normals/${l}`,f=va(u,n);return h.useLayoutEffect(()=>{f&&(f.wrapS=f.wrapT=Wn,f.repeat=new Te(r[0],r[1]),f.offset=new Te(i[0],i[1]),f.anisotropy=t)},[f,t,r,i]),[f,u,a]}const rv=({children:s,id:e,onLoad:n,...r})=>{const t=L4(e,r,n);return h.createElement(h.Fragment,null,s==null?void 0:s(t))},Hn={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new Ve("#ff0000"),backfaceStroke:new Ve("#0000ff"),fill:new Ve("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},O4=ln(Hn.uniforms,Hn.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,Hn.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function N4(s,e){s.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...e},n.vertexShader=n.vertexShader.replace("void main() {",`
		  ${Hn.vertex}
		  void main() {
			initWireframe();
		`),n.fragmentShader=n.fragmentShader.replace("void main() {",`
		  ${Hn.fragment}
		  void main() {
		`),n.fragmentShader=n.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},s.side=Jt,s.transparent=!0}function G4(s,e){h.useEffect(()=>{var n;return void(s.fillOpacity.value=(n=e.fillOpacity)!==null&&n!==void 0?n:s.fillOpacity.value)},[e.fillOpacity]),h.useEffect(()=>{var n;return void(s.fillMix.value=(n=e.fillMix)!==null&&n!==void 0?n:s.fillMix.value)},[e.fillMix]),h.useEffect(()=>{var n;return void(s.strokeOpacity.value=(n=e.strokeOpacity)!==null&&n!==void 0?n:s.strokeOpacity.value)},[e.strokeOpacity]),h.useEffect(()=>{var n;return void(s.thickness.value=(n=e.thickness)!==null&&n!==void 0?n:s.thickness.value)},[e.thickness]),h.useEffect(()=>void(s.colorBackfaces.value=!!e.colorBackfaces),[e.colorBackfaces]),h.useEffect(()=>void(s.dash.value=!!e.dash),[e.dash]),h.useEffect(()=>void(s.dashInvert.value=!!e.dashInvert),[e.dashInvert]),h.useEffect(()=>{var n;return void(s.dashRepeats.value=(n=e.dashRepeats)!==null&&n!==void 0?n:s.dashRepeats.value)},[e.dashRepeats]),h.useEffect(()=>{var n;return void(s.dashLength.value=(n=e.dashLength)!==null&&n!==void 0?n:s.dashLength.value)},[e.dashLength]),h.useEffect(()=>void(s.squeeze.value=!!e.squeeze),[e.squeeze]),h.useEffect(()=>{var n;return void(s.squeezeMin.value=(n=e.squeezeMin)!==null&&n!==void 0?n:s.squeezeMin.value)},[e.squeezeMin]),h.useEffect(()=>{var n;return void(s.squeezeMax.value=(n=e.squeezeMax)!==null&&n!==void 0?n:s.squeezeMax.value)},[e.squeezeMax]),h.useEffect(()=>void(s.stroke.value=e.stroke?new Ve(e.stroke):s.stroke.value),[e.stroke]),h.useEffect(()=>void(s.fill.value=e.fill?new Ve(e.fill):s.fill.value),[e.fill]),h.useEffect(()=>void(s.backfaceStroke.value=e.backfaceStroke?new Ve(e.backfaceStroke):s.backfaceStroke.value),[e.backfaceStroke])}function H4(s){return!!(s!=null&&s.geometry)}function V4(s){return!!(s!=null&&s.isBufferGeometry)}function W4(s){return!!(s!=null&&s.current)}function ih(s){return(s==null?void 0:s.current)!==void 0}function nh(s){return s.type==="WireframeGeometry"}function Y4(){const s={};for(const e in Hn.uniforms)s[e]={value:Hn.uniforms[e]};return s}function j4(s,e){const r=s.getAttribute("position").count,t=[];for(let i=0;i<r;i++){const o=i%2===0,a=e?1:0;o?t.push(0,0,1,0,1,0,1,0,a):t.push(0,1,0,0,0,1,1,0,a)}return new Nt(Float32Array.from(t),3)}function Ff(s){const e=W4(s)?s.current:s;if(V4(e))return e;{if(nh(e))throw new Error("Wireframe: WireframeGeometry is not supported.");const n=e.parent;if(H4(n)){if(nh(n.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return n.geometry}}}function Uf(s,e){if(s.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");const r=s.toNonIndexed();s.copy(r),s.setIndex(null)}const n=j4(s,e);s.setAttribute("barycentric",n)}function q4({geometry:s,simplify:e=!1,...n}){Gt({MeshWireframeMaterial:O4});const[r,t]=h.useState(null);h.useLayoutEffect(()=>{const o=Ff(s);if(!o)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");Uf(o,e),ih(s)&&t(o)},[e,s]);const i=ih(s)?r:s;return h.createElement(h.Fragment,null,i&&h.createElement("mesh",{geometry:i},h.createElement("meshWireframeMaterial",me({attach:"material",transparent:!0,side:Jt,polygonOffset:!0,polygonOffsetFactor:-4},n,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function X4({simplify:s=!1,...e}){const n=h.useRef(null),r=h.useMemo(()=>Y4(),[Hn.uniforms]);return G4(r,e),h.useLayoutEffect(()=>{const t=Ff(n);if(!t)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const i=t.clone();return Uf(t,s),()=>{t.copy(i),i.dispose()}},[s]),h.useLayoutEffect(()=>{const t=n.current.parent,i=t.material.clone();return N4(t.material,r),()=>{t.material.dispose(),t.material=i}},[]),h.createElement("object3D",{ref:n})}function sv({geometry:s,...e}){return s?h.createElement(q4,me({geometry:s},e)):h.createElement(X4,e)}function ov({opacity:s,alphaMap:e}){const n=h.useRef(null),r=h.useRef(null),t=h.useRef({value:1}),i=h.useRef({value:null}),o=h.useRef({value:!1});return h.useLayoutEffect(()=>{n.current.onBeforeCompile=r.current.onBeforeCompile=a=>{const c=a.fragmentShader.indexOf("void main");let l="",u,f=c;for(;u!==`
`&&f<c+100;)u=a.fragmentShader.charAt(f),l+=u,f++;l=l.trim(),a.vertexShader=a.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),a.fragmentShader=a.fragmentShader.replace(l,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),a.uniforms.uShadowOpacity=t.current,a.uniforms.uAlphaMap=i.current,a.uniforms.uHasAlphaMap=o.current}},[]),ze(()=>{var a;const c=(a=n.current.__r3f)==null||(a=a.parent)==null?void 0:a.object;if(c){const l=c.material;l&&(t.current.value=s??l.opacity,e===!1?(i.current.value=null,o.current.value=!1):(i.current.value=e||l.alphaMap,o.current.value=!!i.current.value))}}),h.createElement(h.Fragment,null,h.createElement("meshDepthMaterial",{ref:n,attach:"customDepthMaterial",depthPacking:qh}),h.createElement("meshDistanceMaterial",{ref:r,attach:"customDistanceMaterial"}))}const rh=new Me,Uc=new Zs,sh=new Oi,K4=new k;class Z4 extends Aa{constructor(){super(),this.size=0,this.color=new Ve("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,n){var r,t;const i=this.instance.current;if(!i||!i.geometry)return;const o=i.userData.instances.indexOf(this.instanceKey);if(o===-1||o>i.geometry.drawRange.count)return;const a=(r=(t=e.params.Points)==null?void 0:t.threshold)!==null&&r!==void 0?r:1;if(sh.set(this.getWorldPosition(K4),a),e.ray.intersectsSphere(sh)===!1)return;rh.copy(i.matrixWorld).invert(),Uc.copy(e.ray).applyMatrix4(rh);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,u=Uc.distanceSqToPoint(this.position);if(u<l){const f=new k;Uc.closestPointToPoint(this.position,f),f.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(f);if(A<e.near||A>e.far)return;n.push({distance:A,distanceToRay:Math.sqrt(u),point:f,index:o,face:null,object:this})}}}let or,Fs;const kf=h.createContext(null),oh=new Me,ah=new k,J4=h.forwardRef(({children:s,range:e,limit:n=1e3,...r},t)=>{const i=h.useRef(null);h.useImperativeHandle(t,()=>i.current,[]);const[o,a]=h.useState([]),[[c,l,u]]=h.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);h.useEffect(()=>{i.current.geometry.attributes.position.needsUpdate=!0}),ze(()=>{for(i.current.updateMatrix(),i.current.updateMatrixWorld(),oh.copy(i.current.matrixWorld).invert(),i.current.geometry.drawRange.count=Math.min(n,e!==void 0?e:n,o.length),or=0;or<o.length;or++)Fs=o[or].current,Fs.getWorldPosition(ah).applyMatrix4(oh),ah.toArray(c,or*3),i.current.geometry.attributes.position.needsUpdate=!0,Fs.matrixWorldNeedsUpdate=!0,Fs.color.toArray(l,or*3),i.current.geometry.attributes.color.needsUpdate=!0,u.set([Fs.size],or),i.current.geometry.attributes.size.needsUpdate=!0});const f=h.useMemo(()=>({getParent:()=>i,subscribe:A=>(a(d=>[...d,A]),()=>a(d=>d.filter(x=>x.current!==A.current)))}),[]);return h.createElement("points",me({userData:{instances:o},matrixAutoUpdate:!1,ref:i,raycast:()=>null},r),h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3],usage:Ai}),h.createElement("bufferAttribute",{attach:"attributes-color",args:[l,3],usage:Ai}),h.createElement("bufferAttribute",{attach:"attributes-size",args:[u,1],usage:Ai})),h.createElement(kf.Provider,{value:f},s))}),av=h.forwardRef(({children:s,...e},n)=>{h.useMemo(()=>Gt({PositionPoint:Z4}),[]);const r=h.useRef(null);h.useImperativeHandle(n,()=>r.current,[]);const{subscribe:t,getParent:i}=h.useContext(kf);return h.useLayoutEffect(()=>t(r),[]),h.createElement("positionPoint",me({instance:i(),instanceKey:r,ref:r},e),s)}),$4=h.forwardRef(({children:s,positions:e,colors:n,sizes:r,stride:t=3,...i},o)=>{const a=h.useRef(null);return h.useImperativeHandle(o,()=>a.current,[]),ze(()=>{const c=a.current.geometry.attributes;c.position.needsUpdate=!0,n&&(c.color.needsUpdate=!0),r&&(c.size.needsUpdate=!0)}),h.createElement("points",me({ref:a},i),h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",args:[e,t],usage:Ai}),n&&h.createElement("bufferAttribute",{attach:"attributes-color",args:[n,t],count:n.length/t,usage:Ai}),r&&h.createElement("bufferAttribute",{attach:"attributes-size",args:[r,1],count:r.length/t,usage:Ai})),s)}),cv=h.forwardRef((s,e)=>s.positions instanceof Float32Array?h.createElement($4,me({},s,{ref:e})):h.createElement(J4,me({},s,{ref:e}))),Lf=h.createContext(null),lv=h.forwardRef((s,e)=>{h.useMemo(()=>Gt({SegmentObject:e5}),[]);const{limit:n=1e3,lineWidth:r=1,children:t,...i}=s,[o,a]=h.useState([]),[c]=h.useState(()=>new z1),[l]=h.useState(()=>new _a),[u]=h.useState(()=>new xa),[f]=h.useState(()=>new Te(512,512)),[A]=h.useState(()=>Array(n*6).fill(0)),[d]=h.useState(()=>Array(n*6).fill(0)),x=h.useMemo(()=>({subscribe:p=>(a(v=>[...v,p]),()=>a(v=>v.filter(y=>y.current!==p.current)))}),[]);return ze(()=>{for(let v=0;v<n;v++){var p;const y=(p=o[v])==null?void 0:p.current;y&&(A[v*6+0]=y.start.x,A[v*6+1]=y.start.y,A[v*6+2]=y.start.z,A[v*6+3]=y.end.x,A[v*6+4]=y.end.y,A[v*6+5]=y.end.z,d[v*6+0]=y.color.r,d[v*6+1]=y.color.g,d[v*6+2]=y.color.b,d[v*6+3]=y.color.r,d[v*6+4]=y.color.g,d[v*6+5]=y.color.b)}u.setColors(d),u.setPositions(A),c.computeLineDistances()}),h.createElement("primitive",{object:c,ref:e},h.createElement("primitive",{object:u,attach:"geometry"}),h.createElement("primitive",me({object:l,attach:"material",vertexColors:!0,resolution:f,linewidth:r},i)),h.createElement(Lf.Provider,{value:x},t))});class e5{constructor(){this.color=new Ve("white"),this.start=new k(0,0,0),this.end=new k(0,0,0)}}const ch=s=>s instanceof k?s:new k(...typeof s=="number"?[s,s,s]:s),uv=h.forwardRef(({color:s,start:e,end:n},r)=>{const t=h.useContext(Lf);if(!t)throw"Segment must used inside Segments component.";const i=h.useRef(null);return h.useImperativeHandle(r,()=>i.current,[]),h.useLayoutEffect(()=>t.subscribe(i),[]),h.createElement("segmentObject",{ref:i,color:s,start:ch(e),end:ch(n)})}),hv=h.forwardRef(({children:s,hysteresis:e=0,distances:n,...r},t)=>{const i=h.useRef(null);return h.useImperativeHandle(t,()=>i.current,[]),h.useLayoutEffect(()=>{const{current:o}=i;o.levels.length=0,o.children.forEach((a,c)=>o.levels.push({object:a,hysteresis:e,distance:n[c]}))}),ze(o=>{var a;return(a=i.current)==null?void 0:a.update(o.camera)}),h.createElement("lOD",me({ref:i},r),s)});function fv({all:s,scene:e,camera:n}){const r=re(({gl:o})=>o),t=re(({camera:o})=>o),i=re(({scene:o})=>o);return h.useLayoutEffect(()=>{const o=[];s&&(e||i).traverse(l=>{l.visible===!1&&(o.push(l),l.visible=!0)}),r.compile(e||i,n||t);const a=new ga(128);new Jh(.01,1e5,a).update(r,e||i),a.dispose(),o.forEach(l=>l.visible=!1)},[]),null}function Av(){const s=re(e=>e.gl);return h.useEffect(()=>(s.shadowMap.autoUpdate=!1,s.shadowMap.needsUpdate=!0,()=>{s.shadowMap.autoUpdate=s.shadowMap.needsUpdate=!0}),[s.shadowMap]),null}const lh=new Me,uh=new Zs,kc=new Oi,Lc=new k;function dv(s,e){const n=this.geometry,r=this.material,t=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),kc.copy(n.boundingSphere),kc.applyMatrix4(t),s.ray.intersectsSphere(kc)!==!1&&(lh.copy(t).invert(),uh.copy(s.ray).applyMatrix4(lh),!(n.boundingBox!==null&&uh.intersectBox(n.boundingBox,Lc)===null)&&e.push({distance:Lc.distanceTo(s.ray.origin),point:Lc.clone(),object:this})))}function mv({pixelated:s}){const e=re(o=>o.gl),n=re(o=>o.internal.active),r=re(o=>o.performance.current),t=re(o=>o.viewport.initialDpr),i=re(o=>o.setDpr);return h.useEffect(()=>{const o=e.domElement;return()=>{n&&i(t),s&&o&&(o.style.imageRendering="auto")}},[]),h.useEffect(()=>{i(r*t),s&&e.domElement&&(e.domElement.style.imageRendering=r===1?"auto":"pixelated")},[r]),null}function pv(){const s=re(r=>r.get),e=re(r=>r.setEvents),n=re(r=>r.performance.current);return h.useEffect(()=>{const r=s().events.enabled;return()=>e({enabled:r})},[]),h.useEffect(()=>e({enabled:n===1}),[n]),null}const Of=h.createContext(null);function gv({iterations:s=10,ms:e=250,threshold:n=.75,step:r=.1,factor:t=.5,flipflops:i=1/0,bounds:o=A=>A>100?[60,100]:[40,60],onIncline:a,onDecline:c,onChange:l,onFallback:u,children:f}){const A=Math.pow(10,0),[d,x]=h.useState(()=>({fps:0,index:0,factor:t,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:v=>{const y=Symbol();return d.subscriptions.set(y,v.current),()=>void d.subscriptions.delete(y)}}));let p=0;return ze(()=>{const{frames:v,averages:y}=d;if(!d.fallback&&y.length<s){v.push(performance.now());const g=v[v.length-1]-v[0];if(g>=e){if(d.fps=Math.round(v.length/g*1e3*A)/A,d.refreshrate=Math.max(d.refreshrate,d.fps),y[d.index++%s]=d.fps,y.length===s){const[m,_]=o(d.refreshrate),E=y.filter(w=>w>=_),C=y.filter(w=>w<m);E.length>s*n&&(d.factor=Math.min(1,d.factor+r),d.flipped++,a&&a(d),d.subscriptions.forEach(w=>w.onIncline&&w.onIncline(d))),C.length>s*n&&(d.factor=Math.max(0,d.factor-r),d.flipped++,c&&c(d),d.subscriptions.forEach(w=>w.onDecline&&w.onDecline(d))),p!==d.factor&&(p=d.factor,l&&l(d),d.subscriptions.forEach(w=>w.onChange&&w.onChange(d))),d.flipped>i&&!d.fallback&&(d.fallback=!0,u&&u(d),d.subscriptions.forEach(w=>w.onFallback&&w.onFallback(d))),d.averages=[]}d.frames=[]}}}),h.createElement(Of.Provider,{value:d},f)}function yv({onIncline:s,onDecline:e,onChange:n,onFallback:r}){const t=h.useContext(Of),i=h.useRef({onIncline:s,onDecline:e,onChange:n,onFallback:r});h.useLayoutEffect(()=>{i.current.onIncline=s,i.current.onDecline=e,i.current.onChange=n,i.current.onFallback=r},[s,e,n,r]),h.useLayoutEffect(()=>t.subscribe(i),[t])}const t5=h.forwardRef(({children:s,compute:e,width:n,height:r,samples:t=8,renderPriority:i=0,eventPriority:o=0,frames:a=1/0,stencilBuffer:c=!1,depthBuffer:l=!0,generateMipmaps:u=!1,...f},A)=>{const{size:d,viewport:x}=re(),p=Bi((n||d.width)*x.dpr,(r||d.height)*x.dpr,{samples:t,stencilBuffer:c,depthBuffer:l,generateMipmaps:u}),[v]=h.useState(()=>new Kn),y=h.useCallback((g,m,_)=>{var E,C;let w=(E=p.texture)==null||(E=E.__r3f.parent)==null?void 0:E.object;for(;w&&!(w instanceof di);){var I;w=(I=w.__r3f.parent)==null?void 0:I.object}if(!w)return!1;_.raycaster.camera||_.events.compute(g,_,(C=_.previousRoot)==null?void 0:C.getState());const[B]=_.raycaster.intersectObject(w);if(!B)return!1;const S=B.uv;if(!S)return!1;m.raycaster.setFromCamera(m.pointer.set(S.x*2-1,S.y*2-1),m.camera)},[]);return h.useImperativeHandle(A,()=>p.texture,[p]),h.createElement(h.Fragment,null,Ar(h.createElement(i5,{renderPriority:i,frames:a,fbo:p},s,h.createElement("group",{onPointerOver:()=>null})),v,{events:{compute:e||y,priority:o}}),h.createElement("primitive",me({object:p.texture},f)))});function i5({frames:s,renderPriority:e,children:n,fbo:r}){let t=0,i,o,a,c;return ze(l=>{(s===1/0||t<s)&&(i=l.gl.autoClear,o=l.gl.xr.enabled,a=l.gl.getRenderTarget(),c=l.gl.xr.isPresenting,l.gl.autoClear=!0,l.gl.xr.enabled=!1,l.gl.xr.isPresenting=!1,l.gl.setRenderTarget(r),l.gl.render(l.scene,l.camera),l.gl.setRenderTarget(a),l.gl.autoClear=i,l.gl.xr.enabled=o,l.gl.xr.isPresenting=c,t++)},e),h.createElement(h.Fragment,null,n)}const n5=h.forwardRef(({children:s,compute:e,renderPriority:n=-1,eventPriority:r=0,frames:t=1/0,stencilBuffer:i=!1,depthBuffer:o=!0,generateMipmaps:a=!1,resolution:c=896,near:l=.1,far:u=1e3,flip:f=!1,position:A,rotation:d,scale:x,quaternion:p,matrix:v,matrixAutoUpdate:y,...g},m)=>{const{size:_,viewport:E}=re(),C=h.useRef(null),w=h.useMemo(()=>{const B=new ga(Math.max((c||_.width)*E.dpr,(c||_.height)*E.dpr),{stencilBuffer:i,depthBuffer:o,generateMipmaps:a});return B.texture.isRenderTargetTexture=!f,B.texture.flipY=!0,B.texture.type=zt,B},[c,f]);h.useEffect(()=>()=>w.dispose(),[w]);const[I]=h.useState(()=>new Kn);return h.useImperativeHandle(m,()=>({scene:I,fbo:w,camera:C.current}),[w]),h.createElement(h.Fragment,null,Ar(h.createElement(r5,{renderPriority:n,frames:t,camera:C},s,h.createElement("group",{onPointerOver:()=>null})),I,{events:{compute:e,priority:r}}),h.createElement("primitive",me({object:w.texture},g)),h.createElement("cubeCamera",{ref:C,args:[l,u,w],position:A,rotation:d,scale:x,quaternion:p,matrix:v,matrixAutoUpdate:y}))});function r5({frames:s,renderPriority:e,children:n,camera:r}){let t=0;return ze(i=>{(s===1/0||t<s)&&(r.current.update(i.gl,i.scene),t++)},e),h.createElement(h.Fragment,null,n)}const vv=h.forwardRef(({id:s=1,colorWrite:e=!1,depthWrite:n=!1,...r},t)=>{const i=h.useRef(null),o=h.useMemo(()=>({colorWrite:e,depthWrite:n,stencilWrite:!0,stencilRef:s,stencilFunc:LA,stencilFail:Ga,stencilZFail:Ga,stencilZPass:Ga}),[s,e,n]);return h.useLayoutEffect(()=>{Object.assign(i.current.material,o)}),h.useImperativeHandle(t,()=>i.current,[]),h.createElement("mesh",me({ref:i,renderOrder:-s},r))});function Ev(s,e=!1){return{stencilWrite:!0,stencilRef:s,stencilFunc:e?OA:NA,stencilFail:Ha,stencilZFail:Ha,stencilZPass:Ha}}function xv({renderPriority:s=1,zoom:e=0,segments:n=64,children:r,resolution:t=896,...i}){const o=h.useRef(null),a=h.useRef(null),{width:c,height:l}=re(v=>v.size),[u]=h.useState(()=>new fi);h.useLayoutEffect(()=>{u.position.set(0,0,100),u.zoom=100,u.left=c/-2,u.right=c/2,u.top=l/2,u.bottom=l/-2,u.updateProjectionMatrix()},[c,l]);const f=Math.sqrt(c*c+l*l)/100*(.5+e/2),A=new k,d=new Oi(new k,f),x=new Ln,p=h.useCallback((v,y,g)=>{if(y.pointer.set(v.offsetX/y.size.width*2-1,-(v.offsetY/y.size.height)*2+1),y.raycaster.setFromCamera(y.pointer,u),y.raycaster.ray.intersectSphere(d,A))A.normalize();else return;x.getNormalMatrix(a.current.camera.matrixWorld),a.current.camera.getWorldPosition(y.raycaster.ray.origin),y.raycaster.ray.direction.set(0,0,1).reflect(A),y.raycaster.ray.direction.x*=-1,y.raycaster.ray.direction.applyNormalMatrix(x).multiplyScalar(-1)},[]);return ze(v=>{s&&v.gl.render(o.current,u)},s),h.createElement(h.Fragment,null,h.createElement("mesh",me({ref:o},i,{scale:f}),h.createElement("sphereGeometry",{args:[1,n,n]}),h.createElement("meshBasicMaterial",null,h.createElement(n5,{compute:p,attach:"envMap",flip:!0,resolution:t,ref:a},r,h.createElement(s5,{api:a})))))}function s5({api:s}){const e=new k,n=new st,r=new k,t=new fr(0,Math.PI,0);return ze(i=>{i.camera.matrixWorld.decompose(e,n,r),s.current.camera.position.copy(e),s.current.camera.quaternion.setFromEuler(t).premultiply(n)}),null}const o5=ln({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new Te},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),_v=h.forwardRef(({children:s,events:e=void 0,blur:n=0,eventPriority:r=0,renderPriority:t=0,worldUnits:i=!1,resolution:o=512,...a},c)=>{Gt({PortalMaterialImpl:o5});const l=h.useRef(null),{scene:u,gl:f,size:A,viewport:d,setEvents:x}=re(),p=Bi(o,o),[v,y]=h.useState(0);ze(()=>{const C=l.current.blend>0?Math.max(1,t):0;v!==C&&y(C)}),h.useEffect(()=>{e!==void 0&&x({enabled:!e})},[e]);const[g,m]=h.useState(!0),_=dg(m);h.useLayoutEffect(()=>{var C;_.current=(C=l.current)==null||(C=C.__r3f.parent)==null?void 0:C.object},[]),h.useLayoutEffect(()=>{if(_.current&&n&&l.current.sdf===null){const C=new Qe(_.current.geometry,new Jr),w=new Rt().setFromBufferAttribute(C.geometry.attributes.position),I=new fi(w.min.x*(1+2/o),w.max.x*(1+2/o),w.max.y*(1+2/o),w.min.y*(1+2/o),.1,1e3);I.position.set(0,0,1),I.lookAt(0,0,0),f.setRenderTarget(p),f.render(C,I);const S=c5(o,o,f)(p.texture),U=new Float32Array(o*o);f.readRenderTargetPixels(S,0,0,o,o,U);let b=1/0;for(let M=0;M<U.length;M++)U[M]<b&&(b=U[M]);b=-b,l.current.size=b,l.current.sdf=S.texture,f.setRenderTarget(null)}},[o,n]),h.useImperativeHandle(c,()=>l.current);const E=h.useCallback((C,w,I)=>{var B;if(!_.current)return!1;if(w.pointer.set(C.offsetX/w.size.width*2-1,-(C.offsetY/w.size.height)*2+1),w.raycaster.setFromCamera(w.pointer,w.camera),((B=l.current)==null?void 0:B.blend)===0){const[S]=w.raycaster.intersectObject(_.current);if(!S)return w.raycaster.camera=void 0,!1}},[]);return h.createElement("portalMaterialImpl",me({ref:l,blur:n,blend:0,resolution:[A.width*d.dpr,A.height*d.dpr],attach:"material"},a),h.createElement(t5,{attach:"map",frames:g?1/0:0,eventPriority:r,renderPriority:t,compute:E},s,h.createElement(a5,{events:e,rootScene:u,priority:v,material:l,worldUnits:i})))});function a5({events:s=void 0,rootScene:e,material:n,priority:r,worldUnits:t}){const i=re(f=>f.scene),o=re(f=>f.setEvents),a=Bi(),c=Bi();h.useLayoutEffect(()=>{i.matrixAutoUpdate=!1},[]),h.useEffect(()=>{s!==void 0&&o({enabled:s})},[s]);const[l,u]=h.useMemo(()=>{const f={value:0};return[new Tn(new kt({uniforms:{a:{value:a.texture},b:{value:c.texture},blend:f},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${mi>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),f]},[]);return ze(f=>{var A;let d=n==null||(A=n.current)==null||(A=A.__r3f.parent)==null?void 0:A.object;if(d){if(t)i.matrixWorld.identity();else{var x;r&&((x=n.current)==null?void 0:x.blend)===1&&d.updateWorldMatrix(!0,!1),i.matrixWorld.copy(d.matrixWorld)}if(r){var p,v,y;((p=n.current)==null?void 0:p.blend)>0&&((v=n.current)==null?void 0:v.blend)<1?(u.value=n.current.blend,f.gl.setRenderTarget(a),f.gl.render(i,f.camera),f.gl.setRenderTarget(c),f.gl.render(e,f.camera),f.gl.setRenderTarget(null),l.render(f.gl)):((y=n.current)==null?void 0:y.blend)===1&&f.gl.render(i,f.camera)}}},r),h.createElement(h.Fragment,null)}const c5=(s,e,n)=>{let r=new Vt(s,e,{minFilter:wl,magFilter:Bt,type:Tt,format:En,generateMipmaps:!0}),t=new Vt(s,e,{minFilter:Mt,magFilter:Mt}),i=new Vt(s,e,{minFilter:Mt,magFilter:Mt}),o=new Vt(s,e,{minFilter:Mt,magFilter:Mt}),a=new Vt(s,e,{minFilter:Mt,magFilter:Mt}),c=new Vt(s,e,{minFilter:Mt,magFilter:Mt,type:Tt,format:En}),l=new Vt(s,e,{minFilter:Mt,magFilter:Mt,type:Tt,format:En});const u=new Tn(new kt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),f=new Tn(new kt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),A=new Tn(new kt({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/s}, ${1/e}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),d=new Tn(new kt({uniforms:{tex:{value:null},size:{value:new Te(s,e)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),x=new Tn(new kt({uniforms:{inside:{value:l.texture},outside:{value:c.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return p=>{let v=r;p.minFilter=Mt,p.magFilter=Mt,u.material.uniforms.tex.value=p,n.setRenderTarget(t),u.render(n);const y=Math.ceil(Math.log(Math.max(s,e))/Math.log(2));let g=t,m=null;for(let _=0;_<y;_++){const E=Math.pow(2,y-_-1);m=g===t?o:t,A.material.uniforms.level.value=_,A.material.uniforms.maxSteps.value=y,A.material.uniforms.offset.value=E,A.material.uniforms.tex.value=g.texture,n.setRenderTarget(m),A.render(n),g=m}n.setRenderTarget(c),d.material.uniforms.tex.value=m.texture,d.render(n),f.material.uniforms.tex.value=p,n.setRenderTarget(i),f.render(n),g=i;for(let _=0;_<y;_++){const E=Math.pow(2,y-_-1);m=g===i?a:i,A.material.uniforms.level.value=_,A.material.uniforms.maxSteps.value=y,A.material.uniforms.offset.value=E,A.material.uniforms.tex.value=g.texture,n.setRenderTarget(m),A.render(n),g=m}return n.setRenderTarget(l),d.material.uniforms.tex.value=m.texture,d.render(n),n.setRenderTarget(v),x.material.uniforms.tex.value=p,x.render(n),n.setRenderTarget(null),v}},l5={},hh=s=>{let e;const n=new Set,r=(u,f)=>{const A=typeof u=="function"?u(e):u;if(!Object.is(A,e)){const d=e;e=f??(typeof A!="object"||A===null)?A:Object.assign({},e,A),n.forEach(x=>x(e,d))}},t=()=>e,c={setState:r,getState:t,getInitialState:()=>l,subscribe:u=>(n.add(u),()=>n.delete(u)),destroy:()=>{(l5?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},l=e=s(r,t,c);return c},u5=s=>s?hh(s):hh,Nf={},{useDebugValue:h5}=qs,{useSyncExternalStoreWithSelector:f5}=GA;let fh=!1;const A5=s=>s;function d5(s,e=A5,n){(Nf?"production":void 0)!=="production"&&n&&!fh&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),fh=!0);const r=f5(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,n);return h5(r),r}const Ah=s=>{(Nf?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?u5(s):s,n=(r,t)=>d5(e,r,t);return Object.assign(n,e),n},m5=s=>s?Ah(s):Ah;var dh,mh;const ph=typeof window<"u"&&((dh=window.document)!=null&&dh.createElement||((mh=window.navigator)==null?void 0:mh.product)==="ReactNative")?qs.useLayoutEffect:qs.useEffect;function p5(){const s=m5(e=>({current:new Array,version:0,set:e}));return{In:({children:e})=>{const n=s(t=>t.set),r=s(t=>t.version);return ph(()=>{n(t=>({version:t.version+1}))},[]),ph(()=>(n(({current:t})=>({current:[...t,e]})),()=>n(({current:t})=>({current:t.filter(i=>i!==e)}))),[e,r]),null},Out:()=>{const e=s(n=>n.current);return qs.createElement(qs.Fragment,null,e)}}}const g5=s=>s&&s.isOrthographicCamera,gh=new Ve,Gf=p5();function Oc(s,e){const{right:n,top:r,left:t,bottom:i,width:o,height:a}=e,c=e.bottom<0||r>s.height||n<0||e.left>s.width,u=s.top+s.height-i,f=t-s.left;return{position:{width:o,height:a,left:f,top:r,bottom:u,right:n},isOffscreen:c}}function Nc(s,{left:e,bottom:n,width:r,height:t}){let i;const o=r/t;return g5(s.camera)?s.camera.manual?s.camera.updateProjectionMatrix():(s.camera.left!==r/-2||s.camera.right!==r/2||s.camera.top!==t/2||s.camera.bottom!==t/-2)&&(Object.assign(s.camera,{left:r/-2,right:r/2,top:t/2,bottom:t/-2}),s.camera.updateProjectionMatrix()):s.camera.aspect!==o&&(s.camera.aspect=o,s.camera.updateProjectionMatrix()),i=s.gl.autoClear,s.gl.autoClear=!1,s.gl.setViewport(e,n,r,t),s.gl.setScissor(e,n,r,t),s.gl.setScissorTest(!0),i}function Gc(s,e){s.gl.setScissorTest(!1),s.gl.autoClear=e}function yh(s){s.gl.getClearColor(gh),s.gl.setClearColor(gh,s.gl.getClearAlpha()),s.gl.clear(!0,!0)}function y5({visible:s=!0,canvasSize:e,scene:n,index:r,children:t,frames:i,rect:o,track:a}){const c=re(),[l,u]=h.useState(!1);let f=0;return ze(A=>{if(i===1/0||f<=i){var d;a&&(o.current=(d=a.current)==null?void 0:d.getBoundingClientRect()),f++}if(o.current){const{position:x,isOffscreen:p}=Oc(e,o.current);if(l!==p&&u(p),s&&!l&&o.current){const v=Nc(A,x);A.gl.render(t?A.scene:n,A.camera),Gc(A,v)}}},r),h.useLayoutEffect(()=>{const A=o.current;if(A&&(!s||!l)){const{position:d}=Oc(e,A),x=Nc(c,d);yh(c),Gc(c,x)}},[s,l]),h.useEffect(()=>{if(!a)return;const A=o.current,d=c.get().events.connected;return c.setEvents({connected:a.current}),()=>{if(A){const{position:x}=Oc(e,A),p=Nc(c,x);yh(c),Gc(c,p)}c.setEvents({connected:d})}},[a]),h.createElement(h.Fragment,null,t,h.createElement("group",{onPointerOver:()=>null}))}const Hf=h.forwardRef(({track:s,visible:e=!0,index:n=1,id:r,style:t,className:i,frames:o=1/0,children:a,...c},l)=>{var u,f,A,d;const x=h.useRef(null),{size:p,scene:v}=re(),[y]=h.useState(()=>new Kn),[g,m]=h.useReducer(()=>!0,!1),_=h.useCallback((E,C)=>{if(x.current&&s&&s.current&&E.target===s.current){const{width:w,height:I,left:B,top:S}=x.current,U=E.clientX-B,b=E.clientY-S;C.pointer.set(U/w*2-1,-(b/I)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera)}},[x,s]);return h.useEffect(()=>{var E;s&&(x.current=(E=s.current)==null?void 0:E.getBoundingClientRect()),m()},[s]),h.createElement("group",me({ref:l},c),g&&Ar(h.createElement(y5,{visible:e,canvasSize:p,frames:o,scene:v,track:s,rect:x,index:n},a),y,{events:{compute:_,priority:n},size:{width:(u=x.current)==null?void 0:u.width,height:(f=x.current)==null?void 0:f.height,top:(A=x.current)==null?void 0:A.top,left:(d=x.current)==null?void 0:d.left}}))}),v5=h.forwardRef(({as:s="div",id:e,visible:n,className:r,style:t,index:i=1,track:o,frames:a=1/0,children:c,...l},u)=>{const f=h.useId(),A=h.useRef(null);return h.useImperativeHandle(u,()=>A.current),h.createElement(h.Fragment,null,h.createElement(s,me({ref:A,id:e,className:r,style:t},l)),h.createElement(Gf.In,null,h.createElement(Hf,{visible:n,key:f,track:A,frames:a,index:i},c)))}),Cv=(()=>{const s=h.forwardRef((e,n)=>h.useContext(el)?h.createElement(Hf,me({ref:n},e)):h.createElement(v5,me({ref:n},e)));return s.Port=()=>h.createElement(Gf.Out,null),s})(),Js=h.createContext(null),Yo=new k,vh=new k,E5=(s,e,n,r)=>{const t=e.dot(e),i=e.dot(s)-e.dot(n),o=e.dot(r);return o===0?-i/t:(Yo.copy(r).multiplyScalar(t/o).sub(e),vh.copy(r).multiplyScalar(i/o).add(n).sub(s),-Yo.dot(vh)/Yo.dot(Yo))},x5=new k(0,1,0),Eh=new Me,Hc=({direction:s,axis:e})=>{const{translation:n,translationLimits:r,annotations:t,annotationsClass:i,depthTest:o,scale:a,lineWidth:c,fixed:l,axisColors:u,hoveredColor:f,opacity:A,onDragStart:d,onDrag:x,onDragEnd:p,userData:v}=h.useContext(Js),y=re(q=>q.controls),g=h.useRef(null),m=h.useRef(null),_=h.useRef(null),E=h.useRef(0),[C,w]=h.useState(!1),I=h.useCallback(q=>{t&&(g.current.innerText=`${n.current[e].toFixed(2)}`,g.current.style.display="block"),q.stopPropagation();const X=new Me().extractRotation(m.current.matrixWorld),O=q.point.clone(),H=new k().setFromMatrixPosition(m.current.matrixWorld),T=s.clone().applyMatrix4(X).normalize();_.current={clickPoint:O,dir:T},E.current=n.current[e],d({component:"Arrow",axis:e,origin:H,directions:[T]}),y&&(y.enabled=!1),q.target.setPointerCapture(q.pointerId)},[t,s,y,d,n,e]),B=h.useCallback(q=>{if(q.stopPropagation(),C||w(!0),_.current){const{clickPoint:X,dir:O}=_.current,[H,T]=(r==null?void 0:r[e])||[void 0,void 0];let W=E5(X,O,q.ray.origin,q.ray.direction);H!==void 0&&(W=Math.max(W,H-E.current)),T!==void 0&&(W=Math.min(W,T-E.current)),n.current[e]=E.current+W,t&&(g.current.innerText=`${n.current[e].toFixed(2)}`),Eh.makeTranslation(O.x*W,O.y*W,O.z*W),x(Eh)}},[t,x,C,n,r,e]),S=h.useCallback(q=>{t&&(g.current.style.display="none"),q.stopPropagation(),_.current=null,p(),y&&(y.enabled=!0),q.target.releasePointerCapture(q.pointerId)},[t,y,p]),U=h.useCallback(q=>{q.stopPropagation(),w(!1)},[]),{cylinderLength:b,coneWidth:M,coneLength:D,matrixL:N}=h.useMemo(()=>{const q=l?c/a*1.6:a/20,X=l?.2:a/5,O=l?1-X:a-X,H=new st().setFromUnitVectors(x5,s.clone().normalize()),T=new Me().makeRotationFromQuaternion(H);return{cylinderLength:O,coneWidth:q,coneLength:X,matrixL:T}},[s,a,c,l]),G=C?f:u[e];return h.createElement("group",{ref:m},h.createElement("group",{matrix:N,matrixAutoUpdate:!1,onPointerDown:I,onPointerMove:B,onPointerUp:S,onPointerOut:U},t&&h.createElement(ya,{position:[0,-D,0]},h.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:i,ref:g})),h.createElement("mesh",{visible:!1,position:[0,(b+D)/2,0],userData:v},h.createElement("cylinderGeometry",{args:[M*1.4,M*1.4,b+D,8,1]})),h.createElement(_n,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,b,0],lineWidth:c,side:Jt,color:G,opacity:A,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),h.createElement("mesh",{raycast:()=>null,position:[0,b+D/2,0],renderOrder:500},h.createElement("coneGeometry",{args:[M,D,24,1]}),h.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:G,opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},Vc=new k,Wc=new k,Yc=s=>s*180/Math.PI,_5=s=>s*Math.PI/180,C5=(s,e,n,r,t)=>{Vc.copy(s).sub(n),Wc.copy(e).sub(n);const i=r.dot(r),o=t.dot(t),a=Vc.dot(r)/i,c=Vc.dot(t)/o,l=Wc.dot(r)/i,u=Wc.dot(t)/o,f=Math.atan2(c,a);return Math.atan2(u,l)-f},w5=(s,e)=>{let n=Math.floor(s/e);return n=n<0?n+1:n,s-n*e},xh=s=>{let e=w5(s,2*Math.PI);return Math.abs(e)<1e-6?0:(e<0&&(e+=2*Math.PI),e)},jo=new Me,_h=new k,qo=new Zs,jc=new k,qc=({dir1:s,dir2:e,axis:n})=>{const{rotationLimits:r,annotations:t,annotationsClass:i,depthTest:o,scale:a,lineWidth:c,fixed:l,axisColors:u,hoveredColor:f,opacity:A,onDragStart:d,onDrag:x,onDragEnd:p,userData:v}=h.useContext(Js),y=re(G=>G.controls),g=h.useRef(null),m=h.useRef(null),_=h.useRef(0),E=h.useRef(0),C=h.useRef(null),[w,I]=h.useState(!1),B=h.useCallback(G=>{t&&(g.current.innerText=`${Yc(E.current).toFixed(0)}`,g.current.style.display="block"),G.stopPropagation();const q=G.point.clone(),X=new k().setFromMatrixPosition(m.current.matrixWorld),O=new k().setFromMatrixColumn(m.current.matrixWorld,0).normalize(),H=new k().setFromMatrixColumn(m.current.matrixWorld,1).normalize(),T=new k().setFromMatrixColumn(m.current.matrixWorld,2).normalize(),W=new qn().setFromNormalAndCoplanarPoint(T,X);C.current={clickPoint:q,origin:X,e1:O,e2:H,normal:T,plane:W},d({component:"Rotator",axis:n,origin:X,directions:[O,H,T]}),y&&(y.enabled=!1),G.target.setPointerCapture(G.pointerId)},[t,y,d,n]),S=h.useCallback(G=>{if(G.stopPropagation(),w||I(!0),C.current){const{clickPoint:q,origin:X,e1:O,e2:H,normal:T,plane:W}=C.current,[j,L]=(r==null?void 0:r[n])||[void 0,void 0];qo.copy(G.ray),qo.intersectPlane(W,jc),qo.direction.negate(),qo.intersectPlane(W,jc);let z=C5(q,jc,X,O,H),F=Yc(z);G.shiftKey&&(F=Math.round(F/10)*10,z=_5(F)),j!==void 0&&L!==void 0&&L-j<2*Math.PI?(z=xh(z),z=z>Math.PI?z-2*Math.PI:z,z=je.clamp(z,j-_.current,L-_.current),E.current=_.current+z):(E.current=xh(_.current+z),E.current=E.current>Math.PI?E.current-2*Math.PI:E.current),t&&(F=Yc(E.current),g.current.innerText=`${F.toFixed(0)}`),jo.makeRotationAxis(T,z),_h.copy(X).applyMatrix4(jo).sub(X).negate(),jo.setPosition(_h),x(jo)}},[t,x,w,r,n]),U=h.useCallback(G=>{t&&(g.current.style.display="none"),G.stopPropagation(),_.current=E.current,C.current=null,p(),y&&(y.enabled=!0),G.target.releasePointerCapture(G.pointerId)},[t,y,p]),b=h.useCallback(G=>{G.stopPropagation(),I(!1)},[]),M=h.useMemo(()=>{const G=s.clone().normalize(),q=e.clone().normalize();return new Me().makeBasis(G,q,G.clone().cross(q))},[s,e]),D=l?.65:a*.65,N=h.useMemo(()=>{const q=[];for(let X=0;X<=32;X++){const O=X*(Math.PI/2)/32;q.push(new k(Math.cos(O)*D,Math.sin(O)*D,0))}return q},[D]);return h.createElement("group",{ref:m,onPointerDown:B,onPointerMove:S,onPointerUp:U,onPointerOut:b,matrix:M,matrixAutoUpdate:!1},t&&h.createElement(ya,{position:[D,D,0]},h.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:i,ref:g})),h.createElement(_n,{points:N,lineWidth:c*4,visible:!1,userData:v}),h.createElement(_n,{transparent:!0,raycast:()=>null,depthTest:o,points:N,lineWidth:c,side:Jt,color:w?f:u[n],opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},I5=(s,e,n)=>{const r=Math.abs(s.x)>=Math.abs(s.y)&&Math.abs(s.x)>=Math.abs(s.z)?0:Math.abs(s.y)>=Math.abs(s.x)&&Math.abs(s.y)>=Math.abs(s.z)?1:2,t=[0,1,2].sort((x,p)=>Math.abs(e.getComponent(p))-Math.abs(e.getComponent(x))),i=r===t[0]?t[1]:t[0],o=s.getComponent(r),a=s.getComponent(i),c=e.getComponent(r),l=e.getComponent(i),u=n.getComponent(r),A=(n.getComponent(i)-u*(a/o))/(l-c*(a/o));return[(u-A*c)/o,A]},Xo=new Zs,Ko=new k,Ch=new Me,Xc=({dir1:s,dir2:e,axis:n})=>{const{translation:r,translationLimits:t,annotations:i,annotationsClass:o,depthTest:a,scale:c,lineWidth:l,fixed:u,axisColors:f,hoveredColor:A,opacity:d,onDragStart:x,onDrag:p,onDragEnd:v,userData:y}=h.useContext(Js),g=re(O=>O.controls),m=h.useRef(null),_=h.useRef(null),E=h.useRef(null),C=h.useRef(0),w=h.useRef(0),[I,B]=h.useState(!1),S=h.useCallback(O=>{i&&(m.current.innerText=`${r.current[(n+1)%3].toFixed(2)}, ${r.current[(n+2)%3].toFixed(2)}`,m.current.style.display="block"),O.stopPropagation();const H=O.point.clone(),T=new k().setFromMatrixPosition(_.current.matrixWorld),W=new k().setFromMatrixColumn(_.current.matrixWorld,0).normalize(),j=new k().setFromMatrixColumn(_.current.matrixWorld,1).normalize(),L=new k().setFromMatrixColumn(_.current.matrixWorld,2).normalize(),z=new qn().setFromNormalAndCoplanarPoint(L,T);E.current={clickPoint:H,e1:W,e2:j,plane:z},C.current=r.current[(n+1)%3],w.current=r.current[(n+2)%3],x({component:"Slider",axis:n,origin:T,directions:[W,j,L]}),g&&(g.enabled=!1),O.target.setPointerCapture(O.pointerId)},[i,g,x,n]),U=h.useCallback(O=>{if(O.stopPropagation(),I||B(!0),E.current){const{clickPoint:H,e1:T,e2:W,plane:j}=E.current,[L,z]=(t==null?void 0:t[(n+1)%3])||[void 0,void 0],[F,R]=(t==null?void 0:t[(n+2)%3])||[void 0,void 0];Xo.copy(O.ray),Xo.intersectPlane(j,Ko),Xo.direction.negate(),Xo.intersectPlane(j,Ko),Ko.sub(H);let[Q,J]=I5(T,W,Ko);L!==void 0&&(Q=Math.max(Q,L-C.current)),z!==void 0&&(Q=Math.min(Q,z-C.current)),F!==void 0&&(J=Math.max(J,F-w.current)),R!==void 0&&(J=Math.min(J,R-w.current)),r.current[(n+1)%3]=C.current+Q,r.current[(n+2)%3]=w.current+J,i&&(m.current.innerText=`${r.current[(n+1)%3].toFixed(2)}, ${r.current[(n+2)%3].toFixed(2)}`),Ch.makeTranslation(Q*T.x+J*W.x,Q*T.y+J*W.y,Q*T.z+J*W.z),p(Ch)}},[i,p,I,r,t,n]),b=h.useCallback(O=>{i&&(m.current.style.display="none"),O.stopPropagation(),E.current=null,v(),g&&(g.enabled=!0),O.target.releasePointerCapture(O.pointerId)},[i,g,v]),M=h.useCallback(O=>{O.stopPropagation(),B(!1)},[]),D=h.useMemo(()=>{const O=s.clone().normalize(),H=e.clone().normalize();return new Me().makeBasis(O,H,O.clone().cross(H))},[s,e]),N=u?1/7:c/7,G=u?.225:c*.225,q=I?A:f[n],X=h.useMemo(()=>[new k(0,0,0),new k(0,G,0),new k(G,G,0),new k(G,0,0),new k(0,0,0)],[G]);return h.createElement("group",{ref:_,matrix:D,matrixAutoUpdate:!1},i&&h.createElement(ya,{position:[0,0,0]},h.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:m})),h.createElement("group",{position:[N*1.7,N*1.7,0]},h.createElement("mesh",{visible:!0,onPointerDown:S,onPointerMove:U,onPointerUp:b,onPointerOut:M,scale:G,userData:y},h.createElement("planeGeometry",null),h.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:q,polygonOffset:!0,polygonOffsetFactor:-10,side:Jt,fog:!1})),h.createElement(_n,{position:[-G/2,-G/2,0],transparent:!0,depthTest:a,points:X,lineWidth:l,color:q,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,userData:y,fog:!1})))},Hs=new k,wh=new k,b5=(s,e,n,r)=>{const t=e.dot(e),i=e.dot(s)-e.dot(n),o=e.dot(r);return o===0?-i/t:(Hs.copy(r).multiplyScalar(t/o).sub(e),wh.copy(r).multiplyScalar(i/o).add(n).sub(s),-Hs.dot(wh)/Hs.dot(Hs))},B5=new k(0,1,0),Us=new k,Ih=new Me,Kc=({direction:s,axis:e})=>{const{scaleLimits:n,annotations:r,annotationsClass:t,depthTest:i,scale:o,lineWidth:a,fixed:c,axisColors:l,hoveredColor:u,opacity:f,onDragStart:A,onDrag:d,onDragEnd:x,userData:p}=h.useContext(Js),v=re(X=>X.size),y=re(X=>X.controls),g=h.useRef(null),m=h.useRef(null),_=h.useRef(null),E=h.useRef(1),C=h.useRef(1),w=h.useRef(null),[I,B]=h.useState(!1),S=c?1.2:1.2*o,U=h.useCallback(X=>{r&&(g.current.innerText=`${C.current.toFixed(2)}`,g.current.style.display="block"),X.stopPropagation();const O=new Me().extractRotation(m.current.matrixWorld),H=X.point.clone(),T=new k().setFromMatrixPosition(m.current.matrixWorld),W=s.clone().applyMatrix4(O).normalize(),j=m.current.matrixWorld.clone(),L=j.clone().invert(),z=c?1/Ql(m.current.getWorldPosition(Hs),o,X.camera,v):1;w.current={clickPoint:H,dir:W,mPLG:j,mPLGInv:L,offsetMultiplier:z},A({component:"Sphere",axis:e,origin:T,directions:[W]}),y&&(y.enabled=!1),X.target.setPointerCapture(X.pointerId)},[r,y,s,A,e,c,o,v]),b=h.useCallback(X=>{if(X.stopPropagation(),I||B(!0),w.current){const{clickPoint:O,dir:H,mPLG:T,mPLGInv:W,offsetMultiplier:j}=w.current,[L,z]=(n==null?void 0:n[e])||[1e-5,void 0],R=b5(O,H,X.ray.origin,X.ray.direction)*j,Q=c?R:R/o;let J=Math.pow(2,Q*.2);X.shiftKey&&(J=Math.round(J*10)/10),J=Math.max(J,L/E.current),z!==void 0&&(J=Math.min(J,z/E.current)),C.current=E.current*J,_.current.position.set(0,S+R,0),r&&(g.current.innerText=`${C.current.toFixed(2)}`),Us.set(1,1,1),Us.setComponent(e,J),Ih.makeScale(Us.x,Us.y,Us.z).premultiply(T).multiply(W),d(Ih)}},[r,S,d,I,n,e]),M=h.useCallback(X=>{r&&(g.current.style.display="none"),X.stopPropagation(),E.current=C.current,w.current=null,_.current.position.set(0,S,0),x(),y&&(y.enabled=!0),X.target.releasePointerCapture(X.pointerId)},[r,y,x,S]),D=h.useCallback(X=>{X.stopPropagation(),B(!1)},[]),{radius:N,matrixL:G}=h.useMemo(()=>{const X=c?a/o*1.8:o/22.5,O=new st().setFromUnitVectors(B5,s.clone().normalize()),H=new Me().makeRotationFromQuaternion(O);return{radius:X,matrixL:H}},[s,o,a,c]),q=I?u:l[e];return h.createElement("group",{ref:m},h.createElement("group",{matrix:G,matrixAutoUpdate:!1,onPointerDown:U,onPointerMove:b,onPointerUp:M,onPointerOut:D},r&&h.createElement(ya,{position:[0,S/2,0]},h.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:t,ref:g})),h.createElement("mesh",{ref:_,position:[0,S,0],renderOrder:500,userData:p},h.createElement("sphereGeometry",{args:[N,12,12]}),h.createElement("meshBasicMaterial",{transparent:!0,depthTest:i,color:q,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10}))))},bh=new Me,Bh=new Me,Sh=new Me,Zo=new Me,Zc=new Me,Qr=new Me,Mh=new Me,Th=new Me,Dh=new Me,zr=new Rt,Jc=new Rt,Rh=new k,Ph=new k,Qh=new k,zh=new k,ks=new k,Fr=new k(1,0,0),Ur=new k(0,1,0),kr=new k(0,0,1),wv=h.forwardRef(({enabled:s=!0,matrix:e,onDragStart:n,onDrag:r,onDragEnd:t,autoTransform:i=!0,anchor:o,disableAxes:a=!1,disableSliders:c=!1,disableRotations:l=!1,disableScaling:u=!1,activeAxes:f=[!0,!0,!0],offset:A=[0,0,0],rotation:d=[0,0,0],scale:x=1,lineWidth:p=4,fixed:v=!1,translationLimits:y,rotationLimits:g,scaleLimits:m,depthTest:_=!0,axisColors:E=["#ff2060","#20df80","#2080ff"],hoveredColor:C="#ffff40",annotations:w=!1,annotationsClass:I,opacity:B=1,visible:S=!0,userData:U,children:b,...M},D)=>{const N=re(z=>z.invalidate),G=h.useRef(null),q=h.useRef(null),X=h.useRef(null),O=h.useRef(null),H=h.useRef([0,0,0]),T=h.useRef(new k(1,1,1)),W=h.useRef(new k(1,1,1));h.useLayoutEffect(()=>{o&&(O.current.updateWorldMatrix(!0,!0),Zo.copy(O.current.matrixWorld).invert(),zr.makeEmpty(),O.current.traverse(z=>{z.geometry&&(z.geometry.boundingBox||z.geometry.computeBoundingBox(),Qr.copy(z.matrixWorld).premultiply(Zo),Jc.copy(z.geometry.boundingBox),Jc.applyMatrix4(Qr),zr.union(Jc))}),Rh.copy(zr.max).add(zr.min).multiplyScalar(.5),Ph.copy(zr.max).sub(zr.min).multiplyScalar(.5),Qh.copy(Ph).multiply(new k(...o)).add(Rh),zh.set(...A).add(Qh),X.current.position.copy(zh),N())});const j=h.useMemo(()=>({onDragStart:z=>{bh.copy(q.current.matrix),Bh.copy(q.current.matrixWorld),n&&n(z),N()},onDrag:z=>{Sh.copy(G.current.matrixWorld),Zo.copy(Sh).invert(),Zc.copy(Bh).premultiply(z),Qr.copy(Zc).premultiply(Zo),Mh.copy(bh).invert(),Th.copy(Qr).multiply(Mh),i&&q.current.matrix.copy(Qr),r&&r(Qr,Th,Zc,z),N()},onDragEnd:()=>{t&&t(),N()},translation:H,translationLimits:y,rotationLimits:g,axisColors:E,hoveredColor:C,opacity:B,scale:x,lineWidth:p,fixed:v,depthTest:_,userData:U,annotations:w,annotationsClass:I}),[n,r,t,H,y,g,m,_,x,p,v,...E,C,B,U,i,w,I]),L=new k;return ze(z=>{if(v){const F=Ql(X.current.getWorldPosition(L),x,z.camera,z.size);T.current.setScalar(F)}e&&e instanceof Me&&(q.current.matrix=e),q.current.updateWorldMatrix(!0,!0),Dh.makeRotationFromEuler(X.current.rotation).setPosition(X.current.position).premultiply(q.current.matrixWorld),W.current.setFromMatrixScale(Dh),ks.copy(T.current).divide(W.current),(Math.abs(X.current.scale.x-ks.x)>1e-4||Math.abs(X.current.scale.y-ks.y)>1e-4||Math.abs(X.current.scale.z-ks.z)>1e-4)&&(X.current.scale.copy(ks),z.invalidate())}),h.useImperativeHandle(D,()=>q.current,[]),h.createElement(Js.Provider,{value:j},h.createElement("group",{ref:G},h.createElement("group",me({ref:q,matrix:e,matrixAutoUpdate:!1},M),h.createElement("group",{visible:S,ref:X,position:A,rotation:d},s&&h.createElement(h.Fragment,null,!a&&f[0]&&h.createElement(Hc,{axis:0,direction:Fr}),!a&&f[1]&&h.createElement(Hc,{axis:1,direction:Ur}),!a&&f[2]&&h.createElement(Hc,{axis:2,direction:kr}),!c&&f[0]&&f[1]&&h.createElement(Xc,{axis:2,dir1:Fr,dir2:Ur}),!c&&f[0]&&f[2]&&h.createElement(Xc,{axis:1,dir1:kr,dir2:Fr}),!c&&f[2]&&f[1]&&h.createElement(Xc,{axis:0,dir1:Ur,dir2:kr}),!l&&f[0]&&f[1]&&h.createElement(qc,{axis:2,dir1:Fr,dir2:Ur}),!l&&f[0]&&f[2]&&h.createElement(qc,{axis:1,dir1:kr,dir2:Fr}),!l&&f[2]&&f[1]&&h.createElement(qc,{axis:0,dir1:Ur,dir2:kr}),!u&&f[0]&&h.createElement(Kc,{axis:0,direction:Fr}),!u&&f[1]&&h.createElement(Kc,{axis:1,direction:Ur}),!u&&f[2]&&h.createElement(Kc,{axis:2,direction:kr}))),h.createElement("group",{ref:O},b))))}),Iv=h.forwardRef(({options:s={video:!0},...e},n)=>{const r=Xn(()=>navigator.mediaDevices.getDisplayMedia(s),[]);return h.useEffect(()=>()=>{r==null||r.getTracks().forEach(t=>t.stop()),ma([])},[r]),h.createElement(Tl,me({ref:n},e,{src:r}))}),S5=h.forwardRef(({constraints:s={audio:!1,video:{facingMode:"user"}},...e},n)=>{const r=Xn(()=>navigator.mediaDevices.getUserMedia(s),[]);return h.useEffect(()=>()=>{r==null||r.getTracks().forEach(t=>t.stop()),ma([])},[r]),h.createElement(Tl,me({ref:n},e,{src:r}))}),M5=new k(0,0,-1),T5=function(){const s=new k,e=new k,n=new k,r=new k,t=new k;return function(i,o,a,c){return s.copy(i),e.copy(o),n.copy(a),r.copy(e).sub(s),t.copy(n).sub(s),c.crossVectors(t,r).normalize()}}();function D5(s,e){return s.clone().add(e).multiplyScalar(.5)}const R5=h.forwardRef(({points:s=$c.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:e,facialTransformationMatrix:n,faceBlendshapes:r,offset:t,offsetScalar:i=80,width:o,height:a,depth:c=1,verticalTri:l=[159,386,152],origin:u,eyes:f=!0,eyesAsOrigin:A=!1,debug:d=!1,children:x,...p},v)=>{var y;e&&(s=e.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));const g=h.useRef(null),m=h.useRef(null),_=h.useRef(null),E=h.useRef(null),C=h.useRef(null),w=h.useRef(null),I=h.useRef(null),[B]=h.useState(()=>new k),[S]=h.useState(()=>new di),[U]=h.useState(()=>new st),[b]=h.useState(()=>new k),{invalidate:M}=re();h.useEffect(()=>{var O;(O=C.current)==null||O.geometry.setIndex($c.TRIANGULATION)},[]);const[D]=h.useState(()=>new k);h.useEffect(()=>{var O,H;const T=(O=C.current)==null?void 0:O.geometry;if(!T)return;if(T.setFromPoints(s),T.setDrawRange(0,$c.TRIANGULATION.length),n)if(S.matrix.fromArray(n.data),S.matrix.decompose(S.position,S.quaternion,S.scale),S.rotation.y*=-1,S.rotation.z*=-1,U.setFromEuler(S.rotation),t){var W;S.position.y*=-1,S.position.z*=-1,(W=g.current)==null||W.position.copy(S.position.divideScalar(i))}else{var j;(j=g.current)==null||j.position.set(0,0,0)}else T5(s[l[0]],s[l[1]],s[l[2]],B),U.setFromUnitVectors(M5,B);const L=U.clone().invert();if(T.computeBoundingBox(),d&&M(),T.center(),T.applyQuaternion(L),(H=E.current)==null||H.setRotationFromQuaternion(U),f){if(!r)console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");else if(w.current&&I.current&&_.current)if(A){const z=w.current._computeSphere(T),F=I.current._computeSphere(T);u=D5(z.center,F.center).negate(),w.current._update(T,r,z),I.current._update(T,r,F)}else w.current._update(T,r),I.current._update(T,r)}if(_.current){if(u!==void 0)if(typeof u=="number"){const z=T.getAttribute("position");b.set(-z.getX(u),-z.getY(u),-z.getZ(u))}else u.isVector3&&b.copy(u);else b.setScalar(0);_.current.position.copy(b)}if(m.current){let z=1;(o||a||c)&&(T.boundingBox.getSize(D),o&&(z=o/D.x),a&&(z=a/D.y),c&&(z=c/D.z)),m.current.scale.setScalar(z!==1?z:1)}T.computeVertexNormals(),T.attributes.position.needsUpdate=!0},[s,n,r,S,t,i,o,a,c,l,u,f,d,M,B,U,D,b]);const N=h.useMemo(()=>({outerRef:E,meshRef:C,eyeRightRef:w,eyeLeftRef:I}),[]);h.useImperativeHandle(v,()=>N,[N]);const[G]=h.useState(()=>new k),q=(y=C.current)==null?void 0:y.geometry.boundingBox,X=(q==null?void 0:q.getSize(G).z)||1;return h.createElement("group",p,h.createElement("group",{ref:g},h.createElement("group",{ref:E},h.createElement("group",{ref:m},d?h.createElement(h.Fragment,null,h.createElement("axesHelper",{args:[X]}),h.createElement(_n,{points:[[0,0,0],[0,0,-X]],color:65535})):null,h.createElement("group",{ref:_},f&&r&&h.createElement("group",{name:"eyes"},h.createElement(Fh,{side:"left",ref:w,debug:d}),h.createElement(Fh,{side:"right",ref:I,debug:d})),h.createElement("mesh",{ref:C,name:"face"},x,d?h.createElement(h.Fragment,null,q&&h.createElement("box3Helper",{args:[q]})):null))))))}),Ls={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},Fh=h.forwardRef(({side:s,debug:e=!0},n)=>{const r=h.useRef(null),t=h.useRef(null),[i]=h.useState(()=>new Oi),o=h.useCallback(f=>{const A=f.getAttribute("position"),x=Ls.contourLandmarks[s].map(p=>new k(A.getX(p),A.getY(p),A.getZ(p)));return i.center.set(0,0,0),x.forEach(p=>i.center.add(p)),i.center.divideScalar(x.length),i.radius=x[0].sub(x[1]).length()/2,i},[i,s]),[a]=h.useState(()=>new fr),c=h.useCallback((f,A,d)=>{if(r.current){var x;(x=d)!==null&&x!==void 0||(d=o(f)),r.current.position.copy(d.center),r.current.scale.setScalar(d.radius)}if(A&&t.current){const p=Ls.blendshapes[s],v=A.categories[p[0]].score,y=A.categories[p[1]].score,g=A.categories[p[2]].score,m=A.categories[p[3]].score,_=Ls.fov.horizontal*je.DEG2RAD,E=Ls.fov.vertical*je.DEG2RAD,C=_*.5*(m-g),w=E*.5*(v-y)*(s==="left"?1:-1);a.set(C,w,0),t.current.setRotationFromEuler(a)}},[o,s,a]),l=h.useMemo(()=>({eyeMeshRef:r,irisDirRef:t,_computeSphere:o,_update:c}),[o,c]);h.useImperativeHandle(n,()=>l,[l]);const u=Ls.color[s];return h.createElement("group",null,h.createElement("group",{ref:r},e&&h.createElement("axesHelper",null),h.createElement("group",{ref:t},h.createElement(h.Fragment,null,e&&h.createElement(_n,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:u})))))}),$c={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},Vf=h.createContext({}),Uh={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},bv=h.forwardRef(({basePath:s=Uh.basePath,options:e=Uh.options,children:n},r)=>{const t=JSON.stringify(e),i=Xn(async()=>{const{FilesetResolver:o,FaceLandmarker:a}=await HA(async()=>{const{FilesetResolver:l,FaceLandmarker:u}=await import("./vision_bundle-CLqZKGIV.js");return{FilesetResolver:l,FaceLandmarker:u}},[]),c=await o.forVisionTasks(s);return a.createFromOptions(c,e)},[s,t]);return h.useEffect(()=>()=>{i==null||i.close(),ma([s,t])},[i,s,t]),h.useImperativeHandle(r,()=>i,[i]),h.createElement(Vf.Provider,{value:i},n)});function P5(){return h.useContext(Vf)}function kh(s,e){return s.clone().add(e).multiplyScalar(.5)}function Lr(s,e,n){const r=s.localToWorld(e);return n.worldToLocal(r)}const Wf=h.createContext({}),Bv=h.forwardRef(({camera:s,videoTexture:e={start:!0},manualDetect:n=!1,faceLandmarkerResult:r,manualUpdate:t=!1,makeDefault:i,smoothTime:o=.25,offset:a=!0,offsetScalar:c=80,eyes:l=!1,eyesAsOrigin:u=!0,depth:f=.15,debug:A=!1,facemesh:d},x)=>{var p,v;const y=re(F=>F.scene),g=re(F=>F.camera),m=re(F=>F.set),_=re(F=>F.get),E=s||g,C=h.useRef(null),[w]=h.useState(()=>new di),[I]=h.useState(()=>new k),[B]=h.useState(()=>new k),[S]=h.useState(()=>new k),[U]=h.useState(()=>new k),b=h.useCallback(()=>{w.parent=E.parent;const F=C.current;if(F){const{outerRef:R,eyeRightRef:Q,eyeLeftRef:J}=F;if(Q.current&&J.current){const{irisDirRef:ie}=Q.current,{irisDirRef:Z}=J.current;ie.current&&Z.current&&R.current&&(I.copy(Lr(ie.current,new k(0,0,0),R.current)),B.copy(Lr(Z.current,new k(0,0,0),R.current)),w.position.copy(Lr(R.current,kh(I,B),E.parent||y)),S.copy(Lr(ie.current,new k(0,0,1),R.current)),U.copy(Lr(Z.current,new k(0,0,1),R.current)),w.lookAt(R.current.localToWorld(kh(S,U))))}else R.current&&(w.position.copy(Lr(R.current,new k(0,0,0),E.parent||y)),w.lookAt(R.current.localToWorld(new k(0,0,1))))}return w},[E,B,U,I,S,y,w]),[M]=h.useState(()=>new di),D=h.useCallback(function(F,R){if(E){var Q;(Q=R)!==null&&Q!==void 0||(R=b()),o>0?(Yn.damp3(M.position,R.position,o,F,void 0,void 0,1e-9),Yn.dampE(M.rotation,R.rotation,o,F,void 0,void 0,1e-9)):(M.position.copy(R.position),M.rotation.copy(R.rotation)),E.position.copy(M.position),E.rotation.copy(M.rotation)}},[E,b,o,M.position,M.rotation]);ze((F,R)=>{t||D(R)});const N=h.useRef(null),[G,q]=h.useState(),X=P5(),O=h.useCallback((F,R)=>{const Q=N.current;if(!Q)return;const J=Q.source.data,ie=X==null?void 0:X.detectForVideo(J,F);q(ie)},[X]),H=h.useMemo(()=>Object.assign(Object.create(VA.prototype),{computeTarget:b,update:D,facemeshApiRef:C}),[b,D]);h.useImperativeHandle(x,()=>H,[H]),h.useEffect(()=>{if(i){const F=_().controls;return m({controls:H}),()=>m({controls:F})}},[i,H,_,m]);const T=r??G,W=T==null?void 0:T.faceLandmarks[0],j=T==null||(p=T.facialTransformationMatrixes)==null?void 0:p[0],L=T==null||(v=T.faceBlendshapes)==null?void 0:v[0],z={onVideoFrame:O,...e};return h.createElement(Wf.Provider,{value:H},!n&&h.createElement(h.Suspense,{fallback:null},"src"in z?h.createElement(Tl,me({ref:N},z)):h.createElement(S5,me({ref:N},z))),h.createElement(R5,me({ref:C,children:h.createElement("meshNormalMaterial",{side:Jt})},d,{points:W,depth:f,facialTransformationMatrix:j,faceBlendshapes:L,eyes:l,eyesAsOrigin:u,offset:a,offsetScalar:c,debug:A,"rotation-z":Math.PI,visible:A})))}),Sv=()=>h.useContext(Wf);export{f4 as AccumulativeShadows,mv as AdaptiveDpr,pv as AdaptiveEvents,Qy as ArcballControls,Iy as AsciiRenderer,r6 as BBAnchor,j6 as Backdrop,Av as BakeShadows,Nm as Billboard,Vg as Bounds,C6 as Box,t6 as Bvh,ky as CameraControls,W6 as CameraShake,O6 as Capsule,ay as CatmullRomLine,X6 as Caustics,o1 as Center,w6 as Circle,Dv as Clone,tv as Cloud,th as CloudInstance,T4 as Clouds,vy as ComputedAttribute,I6 as Cone,c4 as ContactShadows,My as CubeCamera,Vy as CubeTexture,oy as CubicBezierLine,f6 as CurveModifier,k5 as CycleRaycast,b6 as Cylinder,Cy as Decal,hv as Detailed,$y as DetectGPU,Ty as DeviceOrientationControls,U6 as Dodecahedron,N5 as DragControls,J2 as Edges,fy as Effects,a4 as Environment,Tf as EnvironmentCube,$l as EnvironmentMap,s4 as EnvironmentPortal,o6 as Example,k6 as Extrude,Bv as FaceControls,bv as FaceLandmarker,Uh as FaceLandmarkerDefaults,R5 as Facemesh,$c as FacemeshDatas,Fh as FacemeshEye,Ls as FacemeshEyeDefaults,By as Fbo,Lv as Fbx,Uy as FirstPersonControls,xv as Fisheye,Vv as Float,Dy as FlyControls,Oy as GizmoHelper,Ny as GizmoViewcube,Gy as GizmoViewport,Rv as Gltf,Ay as GradientTexture,$u as GradientType,Hy as Grid,Yy as Helper,ya as Html,Mp as Hud,z6 as Icosahedron,my as Image,Vl as Instance,l6 as InstancedAttribute,Wl as Instances,gu as IsObject,W5 as KeyboardControls,Wy as Ktx2,L6 as Lathe,J6 as Lightformer,_n as Line,O5 as Loader,Ry as MapControls,xy as MarchingCube,Ey as MarchingCubes,_y as MarchingPlane,vv as Mask,nv as MatcapTexture,a6 as Merged,v6 as MeshDiscardMaterial,A6 as MeshDistortMaterial,_v as MeshPortalMaterial,p6 as MeshReflectorMaterial,g6 as MeshRefractionMaterial,y6 as MeshTransmissionMaterial,d6 as MeshWobbleMaterial,Ly as MotionPathControls,E6 as MultiMaterial,rv as NormalTexture,F6 as Octahedron,Pv as OrbitControls,vp as OrthographicCamera,py as Outlines,gv as PerformanceMonitor,Sy as PerspectiveCamera,wv as PivotControls,S6 as Plane,av as Point,x6 as PointMaterial,kg as PointMaterialImpl,Fy as PointerLockControls,cv as Points,$4 as PointsBuffer,Q6 as Polyhedron,Ig as PositionMesh,Z4 as PositionPoint,cy as PositionalAudio,fv as Preload,V5 as PresentationControls,Qv as Progress,sy as QuadraticBezierLine,A4 as RandomizedLight,n5 as RenderCubeTexture,t5 as RenderTexture,V6 as Resize,P6 as Ring,G6 as RoundedBox,yy as Sampler,H6 as ScreenQuad,ry as ScreenSizer,ny as ScreenSpace,Iv as ScreenVideoTexture,H5 as Scroll,G5 as ScrollControls,uv as Segment,e5 as SegmentObject,lv as Segments,ty as Select,q6 as Shadow,ov as ShadowAlpha,N6 as Shape,$6 as Sky,_6 as SoftShadows,iv as Sparkles,B6 as Sphere,by as Splat,Z6 as SpotLight,K6 as SpotLightShadow,h6 as SpriteAnimator,Y6 as Stage,ev as Stars,jy as Stats,qy as StatsGl,wy as Svg,R6 as Tetrahedron,uy as Text,q2 as Text3D,Gv as Texture,T6 as Torus,D6 as TorusKnot,Py as TrackballControls,gy as Trail,s6 as TrailTexture,zy as TransformControls,M6 as Tube,Tl as VideoTexture,Cv as View,S5 as WebcamVideoTexture,sv as Wireframe,Df as accumulativeContext,b4 as calcPosFromAngles,Ql as calculateScaleFactor,Lp as checkIfFrameIsEmpty,c6 as createInstances,ia as getFirstFrame,hy as isWebGL2Available,dv as meshBounds,ln as shaderMaterial,zv as useAnimations,Ky as useAspect,e6 as useBVH,Wg as useBounds,n6 as useBoxProjectedEnv,Zy as useCamera,i6 as useContextBridge,xp as useCubeCamera,rf as useCubeTexture,L5 as useCursor,Xy as useDepthBuffer,Jp as useDetectGPU,Sa as useEnvironment,Bi as useFBO,Ov as useFBX,Sv as useFaceControls,P5 as useFaceLandmarker,Fl as useFont,Fv as useGLTF,kl as useGizmoContext,of as useHelper,dg as useIntersect,Ll as useKTX2,Y5 as useKeyboardControls,Ev as useMask,F4 as useMatcapTexture,bp as useMotion,L4 as useNormalTexture,yv as usePerformanceMonitor,qf as useProgress,h1 as useScroll,iy as useSelect,u6 as useSpriteAnimator,Ol as useSpriteLoader,up as useSurfaceSampler,va as useTexture,lp as useTrail,Cg as useTrailTexture,Uv as useVideoTexture};
